# Core Image: Performance, Prototyping, and Python

## Summary
Core Image is the essential framework for handling image processing tasks in your photo and video apps. In this session, we'll explore new additions to the framework that allow you to achieve great performance in your filter chains and custom CIKernels. We'll also demo a new approach to prototyping in Core Image through the use of an interactive Python environment. Through these techniques you'll discover new ideas for building new creative effects as well as practical approaches to batch processing images for tasks such as image compositing and data boosting for machine learning.

## Info
* Graphics and Games
* WWDC 2018 - Session 719 - iOS, macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=7) [&gt;&gt; All right [applause].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=23) [Thank you [applause].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=24) [Good afternoon everyone and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=27) [thank you for coming to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=28) [session today on Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=29) [My name is David Hayward, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=31) [I'm really excited to be talking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=32) [about the great new performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=34) [and prototyping features our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=35) [team has been adding to Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=37) [Image over the last year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=39) [We have a lot to talk about, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=41) [let's get right into the agenda.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=42) [So, the first thing we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=44) [to be talking about today are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=45) [some great new APIs we've added](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=46) [to Core Image to help improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=48) [the performance of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=50) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=51) [After that, we're going to segue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=52) [into another topic, which is how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=53) [you can use Core Image to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=55) [prototype new algorithm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=57) [development.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=58) [And lastly, we're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=59) [And lastly, we're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=59) [talking about how you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=60) [Core Image with various machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=61) [learning applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=64) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=67) [So, let's get into this and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=68) [start talking about performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=70) [APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=71) [There's two main areas where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=71) [we've worked on performance this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=73) [year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=75) [First of all, we've added some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=75) [new controls for inserting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=76) [intermediate buffers -- we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=78) [talk about that in some detail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=80) [And the second thing is we'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=82) [talking about some new CI kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=83) [language features that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=85) [take advantage of.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=87) [So, let's start by talking about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=88) [intermediate buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=90) [As you are aware, if you've used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=92) [Core Image before, Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=94) [allows you to easily chain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=96) [together sequences of filters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=97) [Every filter in Core Image is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=100) [made up of one or more kernels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=101) [And one of the great features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=104) [that Core Image uses to improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=105) [performance is the ability to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=106) [concatenate kernels in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=108) [minimize the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=109) [intermediate buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=110) [In many cases, to get the best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=112) [performance you want to have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=113) [minimum number of buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=114) [However, there are some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=117) [scenarios where you don't want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=118) [scenarios where you don't want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=118) [to concatenate as much as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=121) [possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=122) [For example, your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=123) [might have an expensive filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=125) [early on in the filter chain.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=126) [And the user of your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=128) [at a given moment in time might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=130) [be adjusting a filter that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=132) [follows it in the graph.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=133) [And this is a classic situation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=135) [where it's a good idea to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=136) [an intermediate buffer at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=138) [location like this in between.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=140) [The idea is that by having an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=142) [intermediate buffer here, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=144) [cost of the expensive filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=146) [does not have to be paid for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=148) [again when you adjust a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=150) [secondary filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=152) [So, how do you do this in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=153) [application?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=155) [We have a new API, very aptly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=156) [named, inserting intermediate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=158) [So, let's talk about how this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=160) [affects our results.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=162) [What we do is instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=163) [concatenating as much as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=164) [possible, we will respect that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=165) [location of the intermediate and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=167) [concatenate as much as possible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=169) [around it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=171) [Some notes on this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=172) [One thing to keep in mind, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=174) [that by default, Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=175) [cashes all intermediate buffers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=177) [so that the assumption is that a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=179) [so that the assumption is that a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=179) [subsequent render can be made as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=181) [fast as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=182) [There are, sometimes, however,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=184) [when you might want to turn off](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=186) [caching of intermediates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=187) [So, for example, if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=189) [application is going to be doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=190) [a batch export of 100 images,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=192) [there is little benefit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=194) [caching the first one, because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=196) [you'll be rendering a completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=197) [different image afterwards.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=198) [So, you can do that today in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=200) [your application by using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=201) [context option cache](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=203) [intermediates and setting that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=204) [value to false.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=206) [However, if you are also using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=208) [this new API that we spoke](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=210) [about, you can still turn on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=211) [caching of intermediates, even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=214) [if this context option is turned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=215) [off.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=217) [So, this allows you to really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=218) [make sure that we cache](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=219) [something and don't cache](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=220) [anything else.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=221) [The next subject I'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=224) [talk about is some new features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=226) [we've added to the kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=228) [language that allows us to apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=230) [image processing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=232) [So, one thing to keep in mind is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=235) [that we have two different ways](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=236) [of writing kernels in Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=238) [Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=239) [The traditional way is to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=240) [the CI kernel language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=242) [And in this case, you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=244) [string inside your source file;](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=245) [either your Swift code or your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=246) [objective C code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=248) [And at run time you make a call,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=249) [to say, kernel with source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=251) [And later on, when you create an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=254) [image based on that kernel, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=257) [can then render that to any type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=258) [of Core Image context, whether](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=260) [that context is backed by Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=261) [or open GL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=264) [When it comes time to render,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=266) [however, that source needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=268) [translated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=269) [It needs to be translated either](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=270) [to Metal or GLSL, and that step](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=271) [has a cost.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=274) [Eventually then, that code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=276) [compiled to the GPU instruction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=278) [set and then executed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=280) [Starting last year in iOS 11, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=282) [added a new way of writing CI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=285) [kernels, which has some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=286) [significant advantages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=287) [And that's CI kernels based on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=289) [the Metal shading language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=290) [In this case, you have your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=292) [source in your project and this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=294) [is -- this source is complied at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=296) [build time rather than at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=297) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=299) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=299) [As before, you substantiate a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=301) [kernel based on this code by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=303) [using the kernel with Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=306) [function name and binary data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=308) [The advantage here is that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=311) [data can be applied without](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=315) [paying the cost of an additional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=317) [compile.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=318) [The caveat, however, is it works](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=319) [on Metal backed CI context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=321) [But it gives a big performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=324) [advantage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=327) [So, starting in this release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=327) [we're going to be marking the CI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=329) [kernel language as deprecated,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=331) [because while we will continue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=333) [to support this language, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=335) [feel that the new way of writing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=337) [Metal kernels offers a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=339) [advantages to you, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=340) [developer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=341) [For one thing, you get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=342) [performance advantage I outlined](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=343) [earlier, but it also gives you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=344) [the advantage of getting build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=346) [time syntax coloring on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=348) [code and great debugging tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=350) [when you're working with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=352) [Metal source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=354) [So, great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=357) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=359) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=359) [So, with that in mind I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=363) [talk about a few other things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=365) [that we've added to our kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=366) [language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=369) [For one thing, we have added](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=369) [half float support.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=370) [There are a lot of cases when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=372) [your CI kernel can be perfectly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=375) [happy with the precision that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=378) [half float gives you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=379) [If you're working with RGB color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=380) [values, half float precision is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=382) [more than adequate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=383) [The advantage of using half](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=385) [floats in your kernel is it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=386) [allows operations to run faster,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=387) [especially on A11 devices like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=389) [the iPhone 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=391) [Another advantage of using half](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=393) [floats in your kernels is it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=394) [allows for smaller registers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=396) [which increases the amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=397) [utilization of the GPU, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=398) [also helps performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=400) [Another great feature we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=402) [added to the kernel language](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=403) [this year is adding support for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=404) [group reads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=406) [This gives your shader the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=407) [ability to do four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=408) [single-channel reads from an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=409) [input image with only one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=411) [instruction, so this really can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=413) [help.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=415) [And as a complement to that, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=416) [also have the ability to write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=418) [groups of pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=419) [groups of pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=419) [This gives you the ability to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=421) [write four pixels of an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=422) [with just one call inside your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=424) [shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=426) [So, all three of these features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=428) [can be used in your shaders to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=430) [give great performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=433) [improvements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=434) [So, let me talk a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=435) [about an example of how that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=436) [works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=437) [So, imagine today you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=438) [simple 3 by 3 convolution kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=440) [that is working only on one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=443) [channel of an image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=445) [This is actually a fairly common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=446) [operation, for example, if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=447) [want to sharpen the luminance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=449) [an image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=450) [So, in a kernel like this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=451) [typically, you're -- each time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=452) [your kernel is evoked, it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=454) [responsible for producing one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=457) [output pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=458) [But, because this is a 3 by 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=459) [convolution, your kernel needs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=461) [to read 9 pixels in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=463) [achieve that effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=466) [So, we have 9 pixels read for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=467) [every one pixel written.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=468) [However, we can improve this by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=471) [making use of the new group](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=472) [write functionality.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=474) [With the new group write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=476) [functionality, your kernel can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=477) [write a 2 by 2 group of pixels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=479) [write a 2 by 2 group of pixels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=479) [in one evocation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=481) [Now, of course this 2 by 2 group](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=483) [is a little bit bigger, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=485) [instead of a 3 by 3, we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=486) [have a 4 by 4 set of pixels read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=488) [in order to be able to write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=491) [those four pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=492) [But, if you do the math, you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=494) [see that that means we have 16](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=496) [pixels read for 4 pixels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=497) [written.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=499) [So, already we're seeing an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=499) [advantage here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=501) [The other feature we have is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=503) [ability to do gathers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=506) [In this example, we're reading a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=509) [4 by 4 or 16 pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=511) [And with this feature, we can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=513) [these 16 pixels red with just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=515) [four instructions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=517) [So again, if you look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=519) [math on this, this means we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=520) [doing just 4 group reads for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=522) [every 4 pixels written.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=523) [And this can really help the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=524) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=526) [Let me walk you through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=527) [process of this on actual kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=528) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=530) [So, here's an example of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=532) [simple convolution like the one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=534) [I described.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=536) [Here, what we're doing is making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=537) [9 samples from the input image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=538) [9 samples from the input image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=538) [and we're only using the red](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=541) [channel of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=542) [And then once we have those 9](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=543) [values, we're going to average](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=545) [those 9 values and write them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=546) [out in the traditional way by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=548) [returning a single vec4 pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=549) [value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=551) [Now, first step to make this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=552) [faster is to convert this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=555) [Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=556) [This is actually quite simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=557) [So, we start with code that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=558) [looks like this, which is our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=559) [traditional CI kernel language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=560) [And with effectively, some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=562) [searching and replacing in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=563) [code, you could update this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=564) [the new Metal-based CI kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=566) [language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=568) [There's a couple things that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=569) [important to notice here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=570) [We have added a destination](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=571) [parameter to the kernel, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=573) [this is important if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=575) [checking for the destination](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=577) [coordinate inside your shader,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=578) [which a convolution-like kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=579) [like this does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=581) [And then we're using the new,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=582) [more modern syntax to sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=584) [from the input by just saying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=585) [sample -- s.sample and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=587) [s.transform.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=589) [And the last thing we've done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=590) [when we've updated this code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=592) [to change the traditional vec4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=593) [and vec2 parameter types to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=595) [float 4 and float 2.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=597) [But as you can see, the overall](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=600) [architecture of the code, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=601) [flow of the kernel is the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=603) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=606) [Step 2 is to use half-floats.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=607) [Again, this is an example where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=610) [we can get away with just using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=611) [the precision of half-floats](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=613) [because we're just working with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=614) [color values, and so again,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=615) [we're going to make again some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=617) [very simple changes to our code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=618) [Basically, places in our code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=620) [where we were using floating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=621) [point precision, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=624) [use half-float precision as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=625) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=626) [This means the sampler parameter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=627) [and the destination parameter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=629) [have an underscore H suffix on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=630) [them and any case in their code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=632) [where we're using float 4 now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=634) [becomes half 4.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=636) [So again, this is very simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=638) [and easy to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=639) [Another thing to be aware of is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=640) [if you've got constancy in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=641) [code, you want to make sure to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=642) [add the H on the end of them,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=643) [like the dividing by 9.0.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=645) [So again these -- this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=647) [another simple thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=649) [The last thing we're going to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=651) [to get the best performance out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=653) [of this example is to leverage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=654) [group reads and group writes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=655) [So, let me walk you through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=657) [code to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=658) [So, again, we want to write a 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=660) [by 2 group of pixels, and from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=662) [that we need to read from a 4 by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=664) [4 group of pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=666) [So, the first thing we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=667) [to do is specify that we want a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=669) [group destination.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=670) [If you look at the function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=671) [declaration, it now has a group](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=673) [destination, H datatype.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=674) [Then, we're going to get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=678) [destination coordinate like we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=679) [had before, and that will point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=680) [to the center of a pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=681) [However, that coordinate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=683) [actually represents the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=684) [coordinate of a group of 2 by 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=686) [pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=689) [The next thing we're going to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=690) [in order to fill in this 2 by 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=692) [group of pixels is do a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=694) [reads from the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=696) [So, the first gather read is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=697) [going to read from a 2 by 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=700) [group of pixels -- in this case,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=701) [the lower left-hand corner of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=703) [our 16.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=705) [And it's going to return the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=706) [value of the red channel in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=708) [half-four array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=711) [The four parameters will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=714) [stored in this order, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=716) [X, Y, Z, W going in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=717) [X, Y, Z, W going in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=717) [counter-clockwise direction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=721) [This is the same direction that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=722) [is used in Metal, if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=724) [familiar with the gather](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=725) [operations in Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=727) [So, again in that one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=730) [instruction we've done four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=731) [reads and we're going to repeat](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=732) [this process for the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=733) [groups of four.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=735) [So, we're going to get group 2,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=736) [group 3, and group 4.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=738) [Now that we've done all 16](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=740) [reads, we need to figure out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=742) [what values go in what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=744) [locations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=745) [So, the first thing we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=746) [to do is get the appropriate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=747) [channels of this 3 by 3 sub](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=749) [group and average them together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=751) [And then we're going to store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=754) [those channels into the result 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=755) [variable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=758) [And we're going to repeat this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=759) [process for the other four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=760) [result pixels that we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=762) [write -- R1, R2, R3, and R4.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=765) [And the last thing we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=766) [to do is called "Destination](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=768) [Write" to write the 4 pixels all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=770) [in one operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=772) [So note, this is a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=774) [different from a traditional CI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=775) [kernel where you would've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=776) [returned a value from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=778) [returned a value from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=778) [kernel and said you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=780) [be calling "Destination Write"](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=781) [instead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=783) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=783) [So, the great result of all this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=784) [is that with very little effort,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=788) [we can now get two times the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=790) [performance in this exact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=792) [shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=793) [This is a very simple shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=793) [You can actually get similar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=794) [results in many other types of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=796) [shaders, especially ones that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=797) [are doing convolutions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=798) [So, this is a great way of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=800) [adding performance to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=801) [kernels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=803) [So I'm going to seg -- I like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=804) [tell people to go to this great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=806) [new documentation that we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=808) [for our kernel language, both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=809) [the traditional CI kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=812) [language and the CI kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=813) [language that's based on Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=815) [I highly encourage you to go and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=816) [read this documentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=817) [But now that we've talked about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=819) [improving the performance of how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=820) [your kernels can run, I'd like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=822) [to bring up Emanuel on stage,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=823) [who will help talk to you about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=825) [how you can make your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=827) [development process of new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=828) [algorithms even faster as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=829) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=831) [&gt;&gt; Thank you, David.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=836) [Good afternoon everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=839) [Good afternoon everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=839) [It's great to be here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=840) [My name is Emmanuel, I'm an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=841) [engineer on a Core Image team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=843) [So, during the next half of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=845) [session, we'll shift our focus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=847) [away from the Core Image Engine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=848) [and explore novel ways to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=850) [prototype using Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=852) [We'll also see how we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=854) [leverage Core Image in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=857) [machine learning applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=858) [So let's get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=859) [Since I want to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=861) [prototyping, let's take a look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=863) [at the lifecycle of an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=865) [processing filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=867) [So, let's say that we are trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=870) [to come up with a foreground to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=873) [background segmentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=874) [And here, what this means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=875) [precisely is that we'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=878) [get a mask which is 1.0 in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=879) [foreground; 0.0 in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=881) [background and has continuous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=883) [values in between.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=884) [The difficulty in implementing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=886) [such a filter heavily depends on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=888) [the nature of data you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=889) [available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=891) [So, for example, if you have an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=891) [additional depth buffer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=894) [alongside your RGB image, things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=896) [can become easier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=898) [can become easier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=898) [And if you're interested to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=900) [combine RGB images with depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=901) [information, I highly encourage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=903) [you to look at the session on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=905) [creating photo and video effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=907) [using that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=908) [Today, I don't want to focus on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=910) [these other sources of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=912) [information, but I want to focus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=913) [on prototyping in general, so --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=915) [so let's say that -- so, we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=916) [this filter well-drafted, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=920) [know the effect we're trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=923) [come up with, so in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=925) [particular case, a foreground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=925) [and background mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=926) [The very next natural step is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=928) [try implementing it, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=930) [pick your favorite prototype in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=932) [the stack and you start hacking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=933) [away and combining different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=934) [filters together and showing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=936) [them in such a way that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=937) [achieve the filter effect that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=939) [you're looking after.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=941) [So, let's say you did just that,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=944) [and here we have an example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=945) [such a foreground to background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=946) [mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=950) [Now, if you're in an iOS or Mac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=951) [OS environment, the very next](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=952) [natural step is to deploy that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=954) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=957) [So, you have a variety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=957) [So, you have a variety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=957) [[inaudible] that you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=960) [such as Core Image,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=961) [Metal-with-Metal performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=964) [shaders, as well as VImage if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=965) [you want to stay on the CPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=967) [That initial port from prototype](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=970) [to production can be quite time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=972) [consuming, and the very first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=973) [render might not exactly look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=975) [like what you're expecting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=977) [And there is a great variety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=979) [sources that can contribute to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=981) [these pixel differences, one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=982) [them being simply the fact that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=984) [the way filters are implemented](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=985) [across frameworks can be quite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=986) [different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=988) [If you take an example here on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=989) [the left-hand side, we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=990) [[inaudible] blur that applies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=992) [this nice feathering from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=993) [foreground to background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=994) [And that's an example of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=996) [filter that can leverage a grid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=997) [variety of performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1000) [optimizations under the hood to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1001) [make it much faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1002) [All these optimizations can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1004) [introduce numerical errors which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1006) [will propagate in your filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1007) [stack, thereby potentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1008) [creating dramatic changes in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1011) [your filter output.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1013) [Another problem that typically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1015) [arises when you're putting your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1016) [code, is that when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1018) [prototyping environment, a lot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1019) [prototyping environment, a lot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1019) [of the memory management is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1020) [taken care of for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1021) [So, you don't often run into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1022) [issues of memory pressure and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1024) [memory consumption until it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1025) [pretty late in the game.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1027) [Another topic, of course, that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1030) [important to consider is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1031) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1035) [Oftentimes, the prototypes are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1036) [already using CPU code, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1037) [over - sometimes-- we often](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1039) [over-estimate the amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1041) [performance we can get from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1042) [pointing our CP Code to GP Code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1043) [thinking that everything is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1045) [going to get real-time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1046) [So, what if we could catch these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1047) [concerns way, way earlier on in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1050) [our prototyping and workflow?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1053) [Well, we believe we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1055) [solution for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1056) [And it's called PyCoreImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1057) [Python bindings for Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1059) [So, this is combining the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1062) [high-performance rendering of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1063) [Core Image with the flexibility](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1065) [of the Python programming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1068) [language together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1069) [And by using Core Image, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1071) [also inherit its support for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1072) [both iOS and Mac OS along with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1074) [more than 200 built-in filters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1076) [Let's take a look at what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1078) [Let's take a look at what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1078) [under the hood of PyCoreImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1080) [So, PyCoreImage is made of three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1083) [main pieces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1085) [It uses Core Image for its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1087) [rendering back end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1089) [It uses Python for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1090) [programming interface.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1092) [And it had -- it also has a thin](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1094) [layer of an [inaudible] code to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1096) [allow interoperability with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1099) [existing code bases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1100) [We believe PyCoreImage can now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1102) [allow you to reduce the friction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1104) [between your prototyping and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1105) [product-ready code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1107) [If you'd like to stay in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1108) [Swift-centric environment, a lot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1110) [of that can be done as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1111) [using Swift playgrounds, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1112) [encourage you to look at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1114) [session on creating your own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1115) [Swift playgrounds subscription.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1116) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1121) [Let's take a look at the main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1122) [components of PyCoreImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1124) [So, PyCoreImage leverages Python](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1126) [bindings for objective C, PyObjC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1128) [and interestingly, we've been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1130) [shipping PyObjC since Mac OS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1132) [10.5 Leopard.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1134) [It was initially implemented as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1136) [a bidirectional bridge between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1138) [Python and Objective C and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1139) [Python and Objective C and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1139) [[inaudible] in the context of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1141) [Coco app development.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1142) [But since then it's been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1143) [extended to support most Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1144) [frameworks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1146) [The calling syntax for PyObjC is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1148) [very simple, you take your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1151) [existing Objective C code and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1152) [you place columns with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1154) [underscore.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1154) [There's a few more intricacies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1155) [and I encourage you to look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1157) [the API if you'd like more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1158) [information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1159) [But let's take our CIVector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1161) [class as an example here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1162) [So here we have some Objective C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1164) [code where we create an instance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1165) [of a CIVector by calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1166) [CIVector, Vector with X, Y, Z,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1168) [W.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1171) [Let's take a look a the PyObjC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1172) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1174) [It's very similar.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1174) [We import the CIVector from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1175) [Quartz umbrella package and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1176) [can call a vector with X, Y, Z,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1179) [W and the CIVector class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1180) [directly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1181) [One thing you may note here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1182) [that the code does not exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1185) [look Python-like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1186) [And so, we're going to address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1188) [that in just a few minutes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1189) [Now, let's take a look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1190) [[inaudible] gram for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1194) [PyCoreImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1195) [So the rendering back in is then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1196) [using Core Image, and Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1197) [is very close to the hardware,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1199) [is very close to the hardware,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1199) [so it's able to redirect your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1200) [filtered calls to the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1201) [appropriate rendering back end,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1202) [to give you as much performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1204) [as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1205) [PyObjC lives on top of Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1207) [Image, and it can communicate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1208) [with it through the Python](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1210) [bindings for Core Image by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1211) [Quartz umbrella package.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1213) [And the Quartz is a package that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1215) [also contains a variety of other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1218) [image processing frameworks such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1219) [as Core Graphics, and all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1220) [classes that's using Core Image,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1222) [such as CIVector, CIImages, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1224) [CI Context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1225) [PyCoreImage lives on top of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1228) [PyObjC, and it provides--](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1229) [essentially leverages PyObjC to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1233) [be able to communicate with Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1236) [Image and makes a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1237) [simplifications under the hood](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1238) [for you, so that you don't have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1239) [as much setup code when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1241) [working with Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1243) [And we'll take a look at this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1244) [just a moment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1245) [A lot of it is done through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1246) [class CIMG that you can also use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1248) [to interpret with NumPy via](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1250) [vendor call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1252) [And you can also wrap your NumPy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1253) [buffers by using the class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1255) [constructor directly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1257) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1259) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1259) [So, let's take an example how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1260) [you can apply a filter using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1262) [PyCoreImage, and you'll see just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1263) [how simple and powerful the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1264) [framework is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1265) [So, the very first thing you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1266) [want to do is import your CIMG](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1267) [class from your PyCoreImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1269) [package, which we can then use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1270) [to load the image from file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1273) [Note that at this point we don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1275) [have a pixel buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1277) [Core Image creates recipes for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1279) [images and in [inaudible] the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1281) [recipe is just giving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1282) [instruction to load the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1284) [from file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1285) [You can create a more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1286) [complicated graph by applying a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1288) [filter, by just calling the CI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1290) [filter name on it and passing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1292) [the input primaries in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1293) [case, a radius.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1294) [And we can that we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1295) [assembling a more complicated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1296) [graph.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1297) [And if we zoom on it, we can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1298) [that we have out blur processor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1300) [right at the middle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1301) [If you want to get your pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1303) [buffer representation, what you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1304) [can do is call render on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1306) [CIMG instance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1307) [And what you get out is a proper](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1308) [unit by buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1310) [So, to make that possible, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1316) [need to make a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1317) [simplifications on how Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1317) [Image is called or do a bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1319) [Image is called or do a bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1319) [the setup code for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1320) [So, for those of you who are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1322) [already familiar with Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1324) [Image, this will not come as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1325) [surprise, but for those of you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1328) [who are not familiar, please](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1329) [stay with me until the end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1331) [You'll see the few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1332) [simplifications we made, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1334) [that should become very clear.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1335) [So, Core Image is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1337) [high-performance GPU image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1339) [processing framework that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1341) [supports both iOS and Mac OS as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1342) [well as a variety of rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1344) [back ends.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1346) [Most pixel formats are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1347) [supported.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1349) [That, of course means bitmap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1349) [data as well as raw files from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1352) [large variety of vendors.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1354) [Most file formats are supported,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1355) [so, like I said, bitmap data and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1360) [raw from a large variety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1363) [vendors, most pixel formats are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1364) [separated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1366) [So, for example, you can load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1366) [your image in an unsigned 8-bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1367) [through your computation and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1370) [half float and during your final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1371) [render in full 32-bit float.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1373) [Core Image can extract image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1376) [metadata for you, for example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1377) [capture time; exist tags, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1379) [capture time; exist tags, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1379) [well as embedded metadata such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1381) [as portrait map and portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1384) [depth information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1386) [Core Image handles color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1389) [management very well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1390) [This is a difficult topic on its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1391) [own that a lot of frameworks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1393) [don't handle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1394) [Core Image supports many battery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1396) [conditions, infinite images, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1397) [has more than 200 built-in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1400) [filters that you can use, so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1401) [don't need to invent the wheel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1403) [All right, so I don't think I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1405) [need to convince you that that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1406) [a lot of information and if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1407) [you're trying to use Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1408) [in your prototype and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1410) [workflow, the learning curve can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1411) [be quite steep.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1414) [So what we did is we kept the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1415) [best of that list, made a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1416) [simplifications, which,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1418) [remember, these simplifications](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1419) [can all be overridden at one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1421) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1422) [And since we'll be giving you a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1423) [weighted code, you can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1424) [hardcode these changes in if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1425) [this was your prototyping stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1426) [The first thing we did is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1428) [we still have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1430) [high-performance feature of Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1431) [Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1434) [We still render to a Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1434) [backend.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1435) [Most all formats are still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1436) [supported in and out and we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1437) [still extract capture time of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1439) [still extract capture time of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1439) [the data as well as portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1440) [depth and matte information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1442) [Last but not least, you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1445) [more than 200 built-in filters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1446) [that you can use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1448) [The first change we made is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1449) [by default, all your renders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1451) [will be done using full 32-bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1452) [float.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1454) [Second change, everything will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1456) [be done using SRGB color spaces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1458) [Third, all the boundary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1461) [conditions will be handled with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1462) [clamped and cropping.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1464) [What that means is, if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1465) [applying convolution or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1466) [creation, for example, your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1467) [image will be repeated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1469) [infinitely.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1470) [A filter will be applied, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1472) [the resulting image will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1473) [cropped back to your input size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1474) [This is a setting that can also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1476) [be overridden at one time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1478) [Finally, infinite images become](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1481) [finite so that we can get their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1484) [pixel buffer representation, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1485) [that's what really PyCoreImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1489) [is under the hood.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1492) [So, before looking at a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1493) [demo of all of this in practice,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1497) [I just want to go through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1499) [quickly a cheat sheet for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1499) [quickly a cheat sheet for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1499) [PyCoreImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1501) [So, let's have a look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1502) [API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1503) [So, as you saw earlier, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1504) [import the CIMG class from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1506) [pycoreimage package.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1508) [We can use this to load images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1510) [fromfile [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1511) [Here's a Swift equivalent for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1512) [those of you who are wondering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1515) [You can use CIImage for contents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1516) [of file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1518) [You can use fromfile to load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1519) [your portrait matte information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1522) [directly as well as your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1523) [portrait depth by just using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1524) [optional arguments usedepth and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1526) [usematte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1528) [You can interpret with NumPy by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1530) [wrapping your NumPy buffers in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1533) [the CIImage constructor or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1535) [calling render directly under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1537) [CIImage instances to go the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1538) [other way around.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1541) [If you're in Swift, there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1543) [bit more set of coding to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1544) [You need to first create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1545) [CIrender destination.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1546) [Make sure to allocate your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1548) [buffer previous.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1549) [Make sure to give the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1551) [buffer properties, initiate and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1552) [create an incidence of the CI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1555) [Contex and Qtest render.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1556) [So, all of that is handled for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1559) [So, all of that is handled for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1559) [you under the hood.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1560) [Core Image also supports](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1562) [residual images, such as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1564) [creating images from a color or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1565) [creating an image from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1568) [generator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1568) [Let's have a look at how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1571) [apply filters now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1572) [So, applying a filter has never](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1574) [been easier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1576) [You take a CIImage instance,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1576) [call the filter name directly on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1578) [it and pass the list of input](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1579) [primaries.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1581) [Every CIImage instance is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1583) [augmented with more than 200](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1584) [lambda expressions, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1586) [directly map to the Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1588) [filters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1590) [If you're in Swift, this is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1591) [syntax you've seen before I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1593) [sure, applying filter, passing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1594) [the filter name as well as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1596) [list of input arguments as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1598) [dictionary of key value pairs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1599) [To apply kernels, you can go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1602) [applykernel in your CIMG](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1605) [instance, passing of the source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1606) [string containing your kernel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1608) [code and the list of input](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1610) [parameters to that kernel, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1612) [we'll have a look at this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1613) [just a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1615) [Then you just specify the extent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1617) [in which you're applying that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1618) [kernel, as well as a region of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1619) [kernel, as well as a region of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1619) [interest from which you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1620) [sampling in the buffer where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1621) [you're sampling from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1623) [PyCoreImage provides a selection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1627) [of useful APIs that you can use,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1629) [such as a composite operations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1630) [Here is a source-over as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1632) [geometrical operations such as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1635) [translation, scaling, rotation,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1636) [and cropping.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1640) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1641) [I just want to spend a bit more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1643) [time on the GPU kernels because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1645) [that's an extremely powerful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1648) [feature especially for pro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1649) [typing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1650) [So what we have here is a string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1651) [containing the code to a GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1653) [fragmentor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1655) [And what we have there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1656) [essentially a way for you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1658) [prototype in real time what that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1659) [effect is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1661) [This is an example of five tap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1663) [Laplacian and we're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1664) [using this for sharpening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1666) [So, we make five samples in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1668) [neighborhood of each pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1670) [Combine them in a way to compute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1671) [a local derivative, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1673) [going to be our detail, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1674) [we're adding in on -- back on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1675) [top of the center pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1676) [I don't want to focus too much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1678) [on the filter itself, but how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1679) [on the filter itself, but how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1679) [call it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1680) [So, we call it black kernel on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1682) [our CIMG instance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1684) [Bass source code, that's just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1686) [sitting above using a triple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1688) [[inaudible] python string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1690) [[Inaudible] the extent in which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1692) [we're going to be applying the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1693) [kernel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1694) [And define the region of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1695) [interest is along the expression](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1698) [that we're going to be sampling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1699) [from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1700) [If you're not familiar with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1701) [concepts of domain of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1703) [destination as well as regions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1704) [of interest, I encourage you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1705) [look at online documentation for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1707) [Core Image as well as previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1709) [WWDC sessions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1710) [But here is the convolutional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1712) [kernel, we are reading one pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1713) [away from the boundary, so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1715) [need to instruct Core Image if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1716) [we're going to be doing so, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1718) [that it can handle boundary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1719) [conditions properly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1720) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1723) [So, that was a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1723) [information and looking at APIs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1724) [is going to always be dry, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1727) [let's take a look at a demo and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1728) [let's put all of this into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1729) [practice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1730) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1735) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1742) [So, during that demo I'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1742) [using Jupiter Notebook, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1743) [a browser-based real-time Python](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1745) [interpreter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1748) [So, all the results you're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1749) [to be seeing are rendered in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1750) [real-time using Core Image in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1752) [the backend.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1754) [So, none of this has been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1754) [pre-computed; this is all done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1755) [live.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1757) [So, the very first thing I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1757) [to do here is import the utility](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1759) [classes we're going to be using,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1762) [the most important one being the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1763) [CIMG class here for my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1764) [PyCoreImage package.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1765) [Then, we just have a bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1768) [setup code so that we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1768) [actually visualize images in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1769) [that notebook.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1771) [Let's get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1772) [First thing I want to show you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1774) [is how to load images in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1776) [So, using from file here, we see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1778) [that the type of my object is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1780) [PyCoreImage CIMG.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1783) [And we can see that it's backed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1785) [by an actually proper Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1787) [object in the back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1789) [We can do a render on our image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1791) [and have a look, I would -- its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1793) [actual pixel representation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1795) [using Matte [inaudible] lib](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1798) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1799) [This is our input image, and now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1800) [I want to apply a filter on it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1804) [so let's take a look at the 200](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1805) [plus filters that are supported](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1807) [in Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1808) [Let's say that I'm interested in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1813) [applying GaussianBlur here, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1814) [I'd like to know which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1816) [parameters are supported by that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1816) [filter, so I'm going to call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1818) [inputs on my CIMG class, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1819) [see that it supports input image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1821) [-- I shouldn't be surprised --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1824) [as well as an input radius.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1825) [So, I'm going to do just that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1826) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1828) [Take my input image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1829) [Apply GaussianBlur filter on it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1831) [with a radius of 100 pixels, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1832) [then show the two images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1835) [side-by-side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1836) [So, pretty easy, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1838) [Okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1842) [Let's keep going.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1843) [Like I mentioned earlier, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1845) [can generate procedural images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1846) [using Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1847) [So, we'll take a look at Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1848) [Image generators.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1849) [And the first thing we do here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1851) [is we call from generator --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1852) [specify the name of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1854) [generator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1855) [In this case, CIQR code and pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1856) [them in the message that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1858) [them in the message that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1858) [trying to encode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1860) [Here it is in real time, so I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1862) [can do changes to that message](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1863) [and see how that affects the QR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1866) [code that's being generated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1868) [Core Image also has support for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1871) [labeling your images, so you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1873) [use a CI text image generator to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1874) [do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1875) [So, here's the example here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1876) [WWDC and using the SFLO font.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1878) [All right, let's keep going.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1882) [As I mentioned, we support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1885) [interoperability with a -- to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1886) [and from NumPy, so this is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1888) [first thing we're going to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1889) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1890) [We're going to start with an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1892) [image and apply some interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1892) [and non-trivial affect to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1894) [In this case, a vortex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1895) [distortion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1897) [Next thing we'll do is, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1898) [render that buffer getting NumPy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1900) [area out of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1905) [You can see its type here as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1906) [well as its shape, its depth,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1907) [and a few statistics on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1910) [It's minimum, median value as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1912) [well as its maximum value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1914) [We can also go the other way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1916) [around and go from NumPy to Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1919) [around and go from NumPy to Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1919) [Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1921) [To do this, let's start with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1922) [NumPy array-- that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1924) [non-trivial.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1925) [In this case, a random -- a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1926) [random buffer where 75% of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1928) [values have been [inaudible] to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1930) [black.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1931) [First thing I do here is wrap my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1932) [NumPy array into my CIMG](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1935) [constructor, and we can see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1936) [we have again, our CIMG class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1938) [instance and the backing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1939) [CIImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1941) [Now that I have my CIImage, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1943) [can apply a variety of filters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1946) [on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1947) [So, the first thing I do is I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1948) [apply this blur.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1949) [I'll use a wire filter; a light](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1951) [tunnel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1953) [Change of contrast in my image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1954) [The exposure adjustment as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1956) [as the gamma value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1958) [Let's take a look at these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1959) [filters side-by-side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1960) [So at this blur, light tunnel,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1962) [exposure adjust; gamma adjust,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1964) [here's our final effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1966) [Pretty fun and really easy to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1968) [work with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1969) [So we -- let's put it all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1972) [together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1973) [So, I'm going to start with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1973) [new image here, and what I'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1974) [showing you in this demo is, how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1977) [we can do bend processing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1979) [we can do bend processing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1979) [For those of you who are filming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1980) [here with slicing images in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1981) [Python, this is exactly what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1983) [we're going to be doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1984) [We'll define bands or slices --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1985) [horizontal slices in our image,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1987) [and we'll only be applying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1989) [filters on these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1990) [Let's take a look at a code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1992) [first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1994) [This is our add band function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1994) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1996) [And we can see that the very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1997) [bottom of it, we render our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=1998) [image in two composites, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2001) [is an actual NumPy buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2002) [But the right-hand side is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2003) [CIImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2004) [By using slicing like this, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2006) [forced Core Image to only do a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2007) [render in that band, not in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2009) [entire image, thereby being much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2011) [more performant.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2013) [So, let's do this and create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2015) [five different bands into our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2018) [image and show the final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2020) [composite.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2021) [Pretty amazing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2024) [And we've got other labels on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2025) [top as well, which correspond to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2028) [the filters being applied.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2029) [It's really that simple to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2032) [with PyCoreImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2033) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2034) [And I mentioned performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2035) [earlier, so let's take a quick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2036) [look at this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2037) [First thing I want to show you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2038) [First thing I want to show you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2038) [is that whenever you call render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2040) [on your CIImage instances, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2042) [NumPy is baked and cached under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2043) [the hood.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2046) [For example, here we create an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2046) [image where we scaled down as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2048) [well as applied GaussianBlur, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2050) [the first call took 56](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2051) [milliseconds; the second one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2053) [only 2 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2054) [And let's take a look at large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2056) [convolutions as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2057) [Core Image is extremely fast and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2058) [is able to handle large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2061) [convolutions as if it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2062) [nothing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2063) [Here we're using CIBlur,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2064) [CIGaussianBlur with a radius --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2066) [with a sigma of 200 -- a value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2068) [of 200 for a sigma, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2071) [huge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2072) [Just to give you a sense here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2072) [as I was look -- showing you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2074) [image, I'm actually executing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2076) [the equivalent using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2078) [scikit-image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2079) [And we had a 16 seconds running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2080) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2082) [But this time the same thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2083) [using CoreImage; 130](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2084) [milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2086) [Yeah, it's that fast [applause]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2087) [-- 200X, yeah.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2088) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2090) [All right, let's keep going.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2091) [So, one of the most powerful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2093) [features of PyCoreImage is its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2095) [ability to create custom GP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2096) [kernels inline and execute them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2099) [kernels inline and execute them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2099) [on the fly and modify them on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2100) [the fly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2102) [So, let's take a look at that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2102) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2109) [So, the first thing I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2109) [show is how to use color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2111) [kernels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2112) [So, color kernels are kernels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2113) [that only take a pixel in and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2114) [spit a pixel out and don't make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2116) [any other samples around that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2118) [pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2120) [So, here's our input image and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2121) [here's our kernel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2122) [So what we actually get in is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2123) [color and we turn a color out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2125) [So, let's take a look at this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2127) [effect here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2130) [I'm going to be swapping my red](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2131) [and blue channels with my blue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2132) [and red channels and we'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2134) [inverting them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2135) [Not a terribly exciting effect,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2136) [but what I want to show you is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2138) [that I can do things like, start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2139) [typing away, and say, maybe I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2142) [want to scale my red channel by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2144) [my blue channel and I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2145) [just play with the amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2149) [scaling I'm playing here, so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2150) [can go from .25 to pretty high](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2151) [values if we want to and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2154) [generate interesting effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2156) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2157) [It's extremely powerful, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2158) [It's extremely powerful, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2158) [this all [inaudible] time so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2160) [can really fine-tune your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2161) [filters this way and make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2162) [you achieve the effect that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2163) [you're looking for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2165) [Let's take a look at a more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2166) [complicated kernel here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2169) [So, we'll look at a general](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2171) [kernel, which is a bit like the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2172) [[inaudible] I showed you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2174) [earlier, which is a kernel that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2175) [makes additional taps in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2176) [neighborhood of each pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2177) [So start with an image from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2179) [file, which is the same image we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2180) [saw earlier, and we have our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2181) [kernel code here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2184) [Without going into the detail,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2185) [this is a bilateral filter,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2186) [which is an edge over blurring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2187) [filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2189) [So let's just get the code in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2190) [and use apply kernel with some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2193) [parameters that will allow us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2199) [get this very nice effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2201) [And what we did here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2202) [essentially, is clipped the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2203) [non-redundant high frequencies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2206) [in the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2207) [And if we take a look -- let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2208) [take a look at this a bit more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2210) [closely.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2211) [Look at a crop here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2212) [We can see how the strong edges](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2214) [are still there, but the fine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2215) [frequencies that are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2217) [redundant were washed away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2218) [And bilateral filter can be used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2220) [for many, many different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2223) [purposes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2223) [In this particular case, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2224) [use it to do sharpening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2225) [And to achieve sharpening with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2227) [this filter, we can simply take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2228) [the image on the left and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2230) [subtract the image on the right,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2231) [giving us a map of high](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2232) [frequencies or details of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2233) [image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2235) [Let's do just that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2235) [So, here what I'm doing is I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2237) [rendering my image, it's an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2239) [NumPy buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2240) [Rendering my bilinear, my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2241) [filtered image and we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2244) [subtracting them together using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2247) [the operator overloading that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2248) [provided with NumPy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2250) [Let's take a look at the detail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2250) [layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2252) [So, if you have detail on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2253) [left-hand side for the entire](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2255) [image and a crop for the center](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2257) [of the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2259) [Now, what we can do with this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2260) [we can add it on top of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2262) [original image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2264) [We're going to be doing just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2265) [that here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2266) [We're going to be adding it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2267) [twice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2268) [By doing this, we achieve formed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2270) [sharpening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2271) [It's really that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2272) [If I wanted, I could go back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2273) [my filter kernel string and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2275) [start hacking away and making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2278) [changes there in real time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2279) [changes there in real time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2279) [The other thing I wanted to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2282) [you is how to load metadata from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2284) [your images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2286) [So, here I have an image that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2287) [has portrait effect matte loaded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2289) [in, as well as portrait depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2291) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2292) [Here are the images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2294) [side-by-side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2295) [The image on the left is the RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2296) [image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2298) [In the center is the depth data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2298) [On the right-hand side is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2300) [high-quality portrait effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2301) [map, which we introduced in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2302) [another session today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2303) [We can also look at the exist](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2305) [tags directly by looking at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2307) [underlying CIImage from CIMG](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2309) [instances and calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2311) [properties.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2313) [Here, we get information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2315) [pertaining to the actual capture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2316) [itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2317) [Like I said, we introduce the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2320) [portrait effects matte at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2321) [another session, Session 503, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2322) [I highly encourage you to look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2324) [at it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2325) [So without going into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2325) [details here, I'm going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2327) [choosing this filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2329) [If you are interested to know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2330) [how we did this, I highly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2331) [encourage you to take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2333) [this session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2335) [Pretty fun stuff [applause].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2337) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2339) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2339) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2342) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2346) [Let's go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2347) [presentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2347) [I want to switch gear a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2348) [bit here and talk about bringing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2350) [CoreImage and CoreML together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2354) [If you would like to get more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2363) [information about working with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2364) [Portrait Matte and Portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2367) [depth information, I encourage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2368) [you to look at session on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2370) [creating photo and video effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2371) [[inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2375) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2375) [Let's look at bringing Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2375) [Image and CoreML together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2376) [This year, we're really excited](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2378) [to announce that we're coming up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2380) [with a new filter, CI CoreML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2382) [model filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2384) [It's an extremely simple, yet](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2385) [very powerful filter that takes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2387) [two input.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2388) [The very first input is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2389) [image itself with a filter and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2391) [input CoreML model, and you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2394) [an output, which has been run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2398) [an output, which has been run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2398) [through the underlying neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2400) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2401) [It's really that's simple;](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2401) [extremely powerful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2402) [Just to show you how simple the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2404) [code is, let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2405) [Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2407) [So, we have an input image on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2409) [the left-hand side, all we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2410) [to do is call applying filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2411) [But as a new filter that we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2413) [entered -- are introducing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2414) [year and give your [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2415) [in the model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2416) [It's really that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2418) [And if you'd like to look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2419) [other ways to leverage machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2421) [learning in your image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2422) [processing applications, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2423) [encourage you to look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2424) [other sessions on A Guide to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2426) [Turi Create as well as Vision](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2428) [with CoreML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2429) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2433) [On a related topic, one of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2433) [common operations we carry in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2435) [our training datasets in machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2437) [learning is data augmentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2438) [And data augmentation can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2440) [dramatically increase the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2443) [robustness of your neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2443) [networks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2445) [In this particular case, let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2446) [say we're doing object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2447) [classification and we're trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2449) [to determine whether that image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2451) [is a bridge or has water in it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2452) [So, augmentation is on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2457) [So, augmentation is on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2457) [original trend dataset will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2460) [increase yet the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2461) [images you have in that dataset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2463) [without needing to gather new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2464) [images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2466) [You essentially get them for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2467) [free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2468) [So, there's many operations you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2469) [can carry.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2470) [One of them is just changing its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2471) [appearance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2472) [For example, the tense, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2473) [temperature and the white point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2474) [of your image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2475) [Changing the spectral properties](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2477) [of your image by adding noise.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2478) [Or changing the geometry of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2481) [image by applying transforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2482) [Well, it turns out all of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2485) [are trivial to achieve using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2486) [Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2487) [Let's take a look at a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2488) [filters and how you can use them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2489) [for your data augmentation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2491) [purposes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2492) [So, we have our input image on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2494) [the left-hand side here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2495) [And we can change the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2497) [temperature and tint using CI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2498) [Temperature and Tint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2500) [We can adjust the brightness,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2501) [contrast, as well as saturation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2503) [in your images using CI color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2504) [controls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2507) [Change the frequency spectrum of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2509) [your image using CI dither as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2510) [well as CI GaussianBlur.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2511) [And change the geometry of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2513) [image using affine transforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2516) [Let's take a look at all of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2518) [Let's take a look at all of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2518) [in practice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2520) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2529) [So, we're back to my Jupiter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2529) [notebook here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2530) [Same setup as before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2531) [First thing I want to show you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2533) [is how to [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2534) [augmentations using Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2535) [So, we're loading an image in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2537) [and we're going to define our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2539) [augmentation function here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2540) [And what we'll be doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2541) [essentially is sampling from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2542) [random space for each of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2543) [filter I've defined here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2545) [So, we'll be applying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2546) [GaussianBlur, scaling rotation,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2548) [a few adjustments -- exposure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2551) [adjustments -- fibrines as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2552) [as dithering for noise.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2554) [All right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2556) [Let's cache that function in and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2558) [let's have a look at a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2560) [realizations of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2561) [augmentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2564) [So my slider here controls the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2565) [[inaudible] that I'm using in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2568) [the back end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2569) [All right, pretty cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2572) [I'm not sure how efficient that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2573) [is, so here I'm going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2575) [processing 200 of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2576) [augmentations in real time and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2577) [we'll take a look at here -- how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2579) [we'll take a look at here -- how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2579) [they are being -- actually saved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2580) [to disc in real time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2581) [So let's just do that, just to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2583) [give you a sense of how fast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2584) [that is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2585) [That's really powerful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2590) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2595) [This next thing I want to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2596) [you is how to use CoreML using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2597) [Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2600) [And first thing you do is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2602) [load your Core ML model in,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2603) [which we did here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2605) [We have a glass model, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2606) [we're going to be using to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2608) [generate interesting effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2610) [So, let's start with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2612) [procedural image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2612) [We've seen this one before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2614) [And then to make it a bit more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2615) [interesting, we'll add some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2617) [texture to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2618) [So, we'll be adding multi-band](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2620) [noise on it as well as some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2622) [feathering and some [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2626) [All right, so this is the input](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2627) [image we're going to be feeding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2631) [to our neural network alongside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2632) [the other -- the CoreML model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2634) [that we have pre-trained.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2635) [All right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2638) [So, let's run this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2638) [So, let's run this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2638) [And --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2645) [There you go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2650) [WWDC 2018, just for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2650) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2653) [On that note, I want to thank](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2654) [you for coming to this session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2656) [today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2658) [I hope you enjoyed this as much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2659) [as we enjoyed preparing these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2661) [slides for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2662) [I highly encourage you to come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2663) [and talk to us tomorrow at Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2665) [Image Technical Lab at 3:00 pm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2667) [and thank you very much.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2669) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/719/?time=2671)