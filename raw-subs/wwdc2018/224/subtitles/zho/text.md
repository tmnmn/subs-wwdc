# Core Data Best Practices

## Summary
As your app gains more customers and becomes more feature-rich, you may find yourself with new problems to solve. Core Data is a powerful tool that has changed a lot over the years. Learn about the new best practices in Core Data, such as how to use concurrency and persistent history, and discover how to test for, and resolve, common problems using familiar technologies.

## Info
* Developer Tools
* WWDC 2018 - Session 224 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=7) [&gt;&gt; 大家下午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=21) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=22) [欢迎来到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=27) [核心数据最佳实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=29) [我叫 Scott Perry](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=29) [在核心数据工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=30) [一会儿也会请到我的同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=32) [Nick Gillett 加入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=33) [今天我们计划](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=36) [首先从核心数据是如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=39) [随着时间的推移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=40) [进行优化开始讲起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=41) [然后我们将讲到一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=43) [通过利用持久化容器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=45) [里的扩展点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=47) [来更简单地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=48) [优化 App 的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=49) [接着会介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=51) [当 App 的要求发生变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=53) [以及数据量增大时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=55) [该如何优化我们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=56) [随后 Nick 将谈到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=59) [随后 Nick 将谈到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=59) [几种使我们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=60) [保持性能的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=61) [即使它超过了我们的想象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=63) [最后我们将用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=64) [转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=68) [调试和测试来收尾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=69) [但是首先 我们先创建一个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=71) [我很喜欢拍照 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=75) [创建一个能让我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=77) [和朋友们分享照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=78) [并得到反馈的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=79) [即使只是 Nick 在问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=81) [我的幻灯片放得怎么样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=82) [我们该如何保留 App 的数据呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=86) [我们可以将它存在网上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=88) [但是我通常都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=90) [在旅行时拍照](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=91) [网络连接可能会不稳定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=92) [我们需要存在本地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=93) [将它整合进存储器里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=95) [我们现在有贴文 评论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=100) [以及它们的实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=102) [二者之间的关系形成了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=104) [对象图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=105) [我们决定将它们保存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=107) [磁盘上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=108) [这就该核心数据上场了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=112) [我们将使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=116) [将模型转化为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=117) [存储器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=119) [存储器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=119) [能够理解的托管项目模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=121) [所有东西都需要字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=123) [比如图片的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=124) [比如图像数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=125) [和发布时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=127) [此外我们还需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=129) [贴文和评论间的关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=131) [我们已经定义了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=132) [存储器的需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=134) [但是随着时间的推移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=135) [数据的维护涉及到很多工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=137) [幸运的是核心数据提供了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=139) [持久化存储协调器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=140) [来进行管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=141) [这个协调器可以处理例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=142) [与存储器的模型版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=144) [对比 App 模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=146) [并随着 App 的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=147) [进行自动迁移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=149) [最终托管对象上下文 会对我们的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=150) [提供安全快捷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=152) [且可预测的访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=154) [即便我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=156) [同时使用很多功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=157) [例如查询生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=159) [连接池以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=160) [历史跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=161) [设置这些要求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=164) [找到模型 进行加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=166) [然后决定如何保存存储器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=167) [但是很多错误路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=169) [在你迁移 App 之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=171) [并不会失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=173) [因此核心数据提供了一个容器类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=174) [能极大的降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=176) [你在设置堆栈时所需的样板文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=177) [只需要按名称引用模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=178) [只需要按名称引用模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=178) [然后持久化容器将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=180) [从主束中加载它 并将它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=183) [储存在持久化的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=185) [这种持久化容器类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=187) [囊括了一整个堆栈以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=190) [共享主队列视图上下文的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=191) [便利构造函数和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=193) [用于生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=195) [背景语上下文的工厂方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=198) [以及执行后台工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=200) [在我们的 App 扩展的同时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=202) [它同样易于操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=203) [举个例子 要将我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=205) [模型层纳入到它自己的框架中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=207) [我们可以通过在 Xcode 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=210) [创建一个新的框架目标然后将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=211) [我们的代码移动进去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=213) [这都非常简单 但是当我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=214) [我们的模型移动到新的目标时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=216) [在已构建的产品中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=217) [目标从 App 移动到了新的框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=218) [本应如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=220) [但是现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=222) [NSPersistentContainer 不知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=223) [在哪才能找到我们的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=225) [这是因为 默认下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=227) [它只会检查主束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=228) [为什么停在那里呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=230) [因为检索 App 里所有束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=231) [会非常缓慢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=233) [你不会希望每次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=234) [加速堆栈的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=236) [都花好长时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=237) [如何修复呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=240) [我们可以自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=242) [在框架束外恢复这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=243) [然后使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=245) [容器的其他初始化 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=246) [比如那个使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=247) [显式托管对象模型的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=248) [但是事实上 NSPersistentContainer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=250) [提供了一种更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=252) [检索对象的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=254) [看 NSPersistentContainer 知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=257) [它什么时候子类化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=259) [然后在搜索模型时 将子类类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=261) [作为提示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=264) [我们所要做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=265) [利用这个功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=266) [创建一个子类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=267) [里面甚至可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=268) [什么都没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=269) [然后 任何通过容器设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=271) [并希望使用我们的模型的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=273) [可以采用那个子类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=275) [然后持久化容器将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=277) [替代它在框架束中检索模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=278) [这很有趣 但是因为我们需要努力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=281) [分解我们 App 的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=285) [如果我们能提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=287) [我们磁盘上数据的组织](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=288) [不是更好吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=289) [在默认情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=291) [新的持久化容器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=293) [带有一个 SQLite 存储的存储描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=294) [它的自动迁移功能在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=296) [iOS 系统中存在我们的 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=298) [文件目录里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=299) [文件目录里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=299) [当我们的模型代码是 App 的一部分时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=300) [这确实很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=302) [但我们需要避免让我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=304) [新框架文件与 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=304) [过度混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=306) [既然我们已经将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=308) [NSPersistentContainer 子类化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=309) [以使搜索模型更加简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=310) [我们在这个基础上进行提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=312) [硬性更改储存位置的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=316) [是在加载存储之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=318) [就在 persistentStoreDescription 里面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=320) [更改 URL 有时候这就是你想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=323) [我们可以在这里使用这种模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=326) [但是我们不需要这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=327) [因为 NSPersistentContainer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=329) [在创建持久化存储描述文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=331) [时会调用它自己默认的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=333) [目录 URL 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=335) [它是用来被覆盖的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=337) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=339) [我们可以增加一个路径组件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=340) [但是为了缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=342) [或其他类型的堆栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=343) [比如说你的任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=345) [需要将它们的存储放在不同位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=346) [设置容器也是一种很好的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=347) [现在我们已经搞清楚了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=350) [核心数据的存量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=353) [我们来看看我们的 App 以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=354) [一些我们所写的视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=355) [看起来 我们有一些非常特别的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=358) [看起来 我们有一些非常特别的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=358) [视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=360) [这里有一个可以显示我所有的帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=362) [另一个可以显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=363) [所有作者发布的所有帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=364) [甚至连详细评论都被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=367) [复制了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=368) [看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=369) [我们只需要写一半的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=370) [我们真正需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=373) [是一个用来展示帖子列表的视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=375) [和另一个显示单个帖子的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=376) [视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=378) [我们可以通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=380) [在使用模型对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=381) [界面形式里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=383) [在视图控制器之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=385) [定义良好边界](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=386) [每个控制器均由其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=389) [模型参数配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=390) [可以基于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=393) [是否展示我的帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=394) [或别人的帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=395) [来自定义单元格中的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=396) [当使用核心数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=397) [草拟视图控制器时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=400) [列表视图应获得读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=402) [评论详情应获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=404) [托管对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=405) [视图控制器也需要一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=407) [托管对象上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=408) [容器的评论上下文或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=410) [一些其它的主队列上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=412) [这个用核心数据来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=414) [生成视图控制器的模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=415) [不仅可以为 UI 服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=416) [也能很好地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=418) [服务于实用 App 类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=419) [服务于实用 App 类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=419) [无需传递核心数据类型给演示文稿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=421) [我们可以将 URL 或](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=422) [序列化数据等传递给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=426) [后台工作控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=428) [然后用后台上下文代替](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=430) [视图上下文来完成我们的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=431) [将它们变为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=433) [全新的升级的托管对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=434) [采用这种连接和工具类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=438) [非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=439) [因为我们拥有初始化器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=440) [我们可以要求参数去创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=442) [控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=443) [但我们如何将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=444) [边缘变量放入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=446) [视图控制器中呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=447) [如果我们使用 segues](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=448) [就可以覆盖 prepare method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=451) [然后得到一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=454) [对 destinationViewController 的引用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=455) [然后在那儿配置它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=457) [如果我们使用故事板或者 nibs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=458) [那么我们已经有可以汇成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=460) [destinationViewController 的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=462) [我们需要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=463) [在演示前设置属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=465) [如果我们在操纵杆](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=468) [我们可以写一个可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=470) [明确的定义边界条件的初始化 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=471) [就像我们在没有效用类型时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=472) [所做的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=474) [好了 现在我们已经有了一个读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=476) [和视图控制器的上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=479) [和视图控制器的上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=479) [但是在我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=481) [混合二者得到结果之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=482) [我们需要对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=484) [读取请求多做一些配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=485) [来确定我们的控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=486) [会表现不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=487) [有时应该设置读取限制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=490) [但按照列表视图的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=492) [使用批处理更合适](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=493) [因为我们希望显示所有的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=495) [我们也知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=496) [我们的视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=498) [一次可以在屏幕上 显示多少个单元格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=500) [总的来说 至少这些选项中的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=502) [需要设置为读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=504) [它返回的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=505) [可能是无限数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=507) [所以这时我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=509) [将读取请求更改为对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=512) [然后用返回结果填充列表视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=513) [但是如果我们想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=515) [让 UI 和发生的更改保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=517) [该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=519) [我们在这里已经讲到了核心数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=521) [和读取结果控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=522) [自 Sierra 系统以来

00:08:46.356 --> 00:08:47.976 A:middle
读取结果控制器可用于所有平台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=524) [要采用它只要求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=527) [在委托协议和它驱动的视图之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=529) [写一个适配器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=530) [要创建它 我们只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=533) [一个读取请求和一个上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=534) [读取结果控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=537) [甚至可以支持对类似区段这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=538) [更加高级的列表视图概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=539) [更加高级的列表视图概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=539) [进行驱动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=541) [如果我们希望将帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=543) [根据发布的日期分成区段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=545) [我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=546) [通过使用计算属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=547) [将 Xcode 生成的帖子类型进行扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=549) [然后将它的名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=550) [传递给读取结果控制器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=552) [初始化 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=554) [这样可以运行得很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=556) [但是如果我们有比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=558) [仅有一个对象列表 更复杂的视图控制器时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=559) [我们该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=560) [如果我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=561) [在 App 上显示类似每日发帖图表的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=562) [该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=564) [我们需要做的第一件事就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=567) [不要低估了读取请求的能力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=568) [我只是一个人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=571) [所以在上个月](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=573) [我没能每天发布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=574) [多于 40 张的照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=576) [在 30 天内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=577) [这仍然是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=579) [一次从存储中取出的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=580) [合理的数据量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=581) [如果我们先前定义的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=583) [日期属性是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=585) [模型中实体的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=586) [我们可以写一个读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=588) [能够将帖子数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=589) [根据发布的日期进行分组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=590) [这个请求有三部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=593) [第一个是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=595) [设置范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=596) [我们希望有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=597) [至少 30 天的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=598) [接下来 我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=599) [接下来 我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=599) [将所有日期属性的值相同的日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=602) [分到一组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=604) [因为我们现在抓取的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=606) [总量而不是单个的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=607) [我们也需要将结果类型修改得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=608) [更加合理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=609) [在这里是字典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=610) [最后 我们要定义一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=614) [在每个组里代表对象数量的表达式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=617) [然后告诉读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=619) [返回它所代表的日期的计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=620) [这个读取请求返回了 30 个结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=624) [它们中的每一个都是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=626) [图表中的一个点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=628) [如果你进入数据库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=631) [这是核心数据从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=634) [读取请求里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=635) [生成的 SQLite 查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=636) [如果你自己写查询语句](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=637) [那么这就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=638) [你要做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=639) [核心数据知道如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=640) [将许多表达功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=641) [转换成最佳的数据库查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=643) [一个通过查询得到的组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=645) [可以聚合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=646) [例如平均 求和 以及标量查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=648) [比如一般的读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=650) [可以使用标量计数以及日期功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=651) [就像 abs 之于绝对值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=653) [now 之于当前时间一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=654) [如果你想知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=657) [更多的关于 NSExpression 的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=659) [更多的关于 NSExpression 的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=659) [你可以去了解一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=660) [功能列表的资料](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=661) [在核心数据里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=663) [很多都受到读取请求的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=664) [所以通过使用表达式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=668) [读取请求可以完成很多事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=670) [但是 SQLite 仍旧会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=672) [处理图表时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=674) [读取每一个帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=676) [用图表展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=679) [一个人的发帖数量时运行良好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=680) [但是如果我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=683) [为更庞大的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=684) [制作图表呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=685) [如果我们想展示一整年的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=687) [或者我们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=688) [要开始处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=690) [更大数量级的数据呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=692) [现在 读取请求至少可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=694) [一个一个地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=695) [计算 50,000 个帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=697) [只为显示 30 个点 这不够快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=699) [视图与模型之间的不协调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=702) [已经到了需要我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=704) [做一些 denormalization 了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=705) [denormalization 是当我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=710) [增加冗余的数据副本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=712) [或者元数据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=713) [以增加簿记为代价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=715) [来提升读取性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=716) [数据库索引就是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=718) [很好的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=719) [很好的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=719) [在我们的存储里加入计数元数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=721) [是为了使我们的图表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=722) [能够再次显示 而做出的牺牲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=724) [让我们看看 我们的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=728) [如何将帖子按照发布的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=730) [日期分组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=732) [我们将需要一个新的实体和两个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=733) [加上一些额外的维护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=735) [以保证其准确性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=737) [按照日期分组很大地提升了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=739) [读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=740) [使它保证在覆盖好几年的数据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=742) [也能有好的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=743) [我们只需要创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=745) [与我们向图表视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=746) [传递的同样水平的 denormalization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=749) [和读取请求即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=750) [这非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=752) [这和我们向其他列表视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=754) [传递的读取请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=755) [没有多大不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=756) [事实上如果你看得够仔细](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=757) [会发现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=759) [有点像一种图表视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=760) [但是特殊维护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=763) [该如何进行呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=764) [当帖子发布时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=766) [我们需要增加计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=767) [当帖子被移除时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=768) [我们需要减少计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=770) [我们可以使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=771) [更改帖子对象的相关状态的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=773) [来实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=774) [但一个更简单明了的方式是去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=775) [根据响应上下文存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=776) [来更新计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=778) [我们可以为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=779) [我们可以为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=779) [托管对象 contextWillSave 提醒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=784) [注册一个功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=787) [使它可以检查所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=789) [添加的帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=790) [对所有相关的日期增加计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=791) [让另外一个循环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=793) [检查所有被删除的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=796) [为每天减少计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=798) [这样就可以在交付数据库之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=799) [影响上下文状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=800) [最后它们会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=802) [一次交付中完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=803) [这样做 延展性很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=805) [非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=807) [因为我的同事 Nick Gilett 将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=808) [探讨当我们的 App 扩展到超出想象时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=810) [核心数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=811) [将如何帮助我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=813) [Nick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=814) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=815) [&gt;&gt; 谢谢 Scott](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=817) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=818) [就像 Scott 所说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=820) [在你的 App 扩张时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=822) [它们变得更加复杂](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=823) [对于核心数据而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=826) [很重要的一点是 你的 App 确实在扩张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=828) [事实上 这是我们想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=830) [这是我们出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=831) [并帮助你管理扩展的全部理由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=833) [通过使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=834) [使你的工作更有效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=836) [帮助你为顾客创造更多的价值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=838) [但是这种方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=840) [对你的 App 来说 会非常特别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=843) [高度匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=845) [顾客的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=846) [或者你希望顾客以何种方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=848) [体验你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=849) [不幸的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=852) [就像所有的复杂系统一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=853) [它也会出现混乱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=855) [所有我们今天将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=859) [探讨核心数据如何帮助你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=860) [管理这些混乱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=862) [并且使系统更有条理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=863) [我们将讨论构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=865) [可预测的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=866) [并帮助你构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=868) [可调容器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=870) [来与你的经验指标匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=871) [这是什么意思呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=876) [当我们想到指标时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=878) [我们有很多不同的方式去思考它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=879) [第一个是 与用户保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=883) [我们一般会将它们定义为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=886) [用户会体验的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=888) [比如有持久化用户界面或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=889) [一个响应滚动视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=891) [或者顾客喜悦度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=893) [但对于我们工程师来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=898) [但对于我们工程师来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=898) [这些都很难捕捉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=901) [我们将它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=903) [翻译为工程指标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=904) [比如运行时的峰值内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=906) [在运行一个任务时电池的消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=908) [或者在运行一个任务时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=909) [所需要的中央处理时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=912) [最后 我们在给予的任务中做了多少 IO](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=914) [为了让它更具体一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=918) [我们将使用这个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=919) [你们中的有些人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=922) [可能还记得去年的 WWDC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=923) [我们介绍的历史演示 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=924) [为了这个演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=927) [我对它进行了修改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=928) [当用户用你的 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=930) [这里有一些它们可以做的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=932) [第一个是它们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=935) [通过敲击 + 键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=936) [将单个的帖子添加到你的数据库中去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=938) [它们也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=940) [通过点击下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=942) [从服务器下载未决数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=944) [最终 对那些还没有被上传到服务区的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=950) [它们可以点击发布全部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=953) [现在 这个 App 有少数几个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=956) [现在 这个 App 有少数几个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=956) [可供顾客使用的交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=960) [但是当这些功能同时发生时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=962) [会产生混乱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=964) [我们可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=968) [即便是这么少的系列动作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=971) [它们同时发生也会导致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=973) [很多不同 App 的状态变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=974) [对我们而言最糟糕的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=975) [出现像这样的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=978) [这些部分完整性的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=982) [对于用户没有意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=985) [事实上 这对我们也没有意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=986) [在这里 核心数据将帮助我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=989) [处理查询生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=990) [在 2016 年的核心数据新品介绍会议上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=993) [我们介绍了查询生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=996) [如果你还不了解它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=998) [我非常建议你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=999) [了解一下那场会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1000) [并获得更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1001) [有关它如何工作的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1002) [你需要知道的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1003) [它需要预写日志模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1005) [并且只能使用 SQLite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1007) [查询生成的目标是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1009) [将你的托管对象上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1011) [从相互矛盾的工作中隔离出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1013) [它可能直接作用于后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1015) [或者你还没有准备在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1016) [给定文本中显示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1018) [给定文本中显示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1018) [用户正在进行的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1020) [查询生成提供了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1024) [数据库的一致而长久的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1025) [它将向读取返回同样的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1027) [无论在给定时间内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1028) [数据库被写入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1030) [何种其它的上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1031) [最好的是我们可以通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1037) [一行代码来实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1039) [这里是重新加载一个表格视图的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1041) [典型变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1043) [我们可以仅仅对 NSManagedObjectContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1044) [setQueryGenerationFrom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1046) [增加一个带有现有查询生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1048) [的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1051) [需要更新时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1053) [我们可以像往常一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1054) [使用 NSMangedObjectContextDidSave 提醒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1057) [来进行更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1060) [这使我们可以在对的时间 在 UI 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1061) [对 App 的数据实现修改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1065) [但是如果我们写的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1072) [和 UI 没有关联呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1073) [例如下载之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1075) [Scott 提到的一些评论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1076) [这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1079) [这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1079) [我们不希望数据出现在用户界面里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1082) [或者对它产生更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1083) [因为所有的变化对用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1085) [都是不可视的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1086) [我们需要通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1088) [历史追踪 来过滤掉这些更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1089) [持续历史追踪是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1092) [iOS 11 和 macOS 10.13 的新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1094) [我们在去年的全球开发者大会中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1098) [核心数据的新功能部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1099) [对它进行过介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1102) [要想了解更多它如何工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1103) [或者它们重点功能是什么的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1104) [你可以将这个会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1106) [作为参考](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1108) [持续历史追踪是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1111) [获得每次与数据库相关的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1113) [事务处理的记录的好方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1115) [对我们很有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1118) [有几点原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1120) [为了本次演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1121) [我们将使用 NSPersistentHistoryChange](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1123) [它能给我们一个 changedObjectID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1125) [和一组 updatedProperties](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1128) [还有 NSPersistentHistoryTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1133) [它将给我们一组变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1133) [以及一个 objectIDNotification](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1135) [我们来想一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1141) [接下来的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1145) [就像你所看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1146) [有一些帖子被加入到了数据库中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1148) [当这件事发生时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1149) [用表格视图来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1152) [我们可以通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1154) [objectIDNotification](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1157) [来更新 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1158) [这和 NSManageObjectContextDidSave](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1160) [提醒相似 它可以通过使用同一的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1161) [来进行合并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1165) [如果我们下载了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1169) [我们不希望在用户更新里显示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1171) [评论列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1173) [我们可以对它进行过滤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1175) [用少量的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1180) [我们可以从给定的事务处理中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1181) [将变化过滤出去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1182) [以决定它们中是否有与帖子实体有关的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1184) [这样我们就不需要更新 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1185) [从而为用户引起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1188) [不必要的波动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1190) [或断续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1193) [就像你在这里看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1196) [我们使用的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1197) [小部分的帖子内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1198) [小部分的帖子内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1198) [事实上 我们只使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1201) [两个属性 图像和标题属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1203) [我们可以有比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1207) [通过实体过滤更好的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1208) [事实上我们可以通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1210) [历史变化来对更新的属性进行过滤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1212) [这样 我们就可以针对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1213) [与用户可以看到的变化一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1217) [的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1219) [创建目标性很强的更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1220) [核心数据还可以支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1222) [你与你的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1228) [进行新的交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1229) [当你的数据逐渐变得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1231) [更复杂更庞大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1232) [有些编辑操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1235) [会变得更昂贵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1236) [例如一个简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1237) [图片浏览器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1239) [一般来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1241) [当我们的 App 扩张时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1242) [我们希望引进新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1244) [能让反复作业更加简单的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1245) [比如 多项选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1247) [核心数据可以通过分批操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1250) [来支持这个功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1253) [事实上 通过几行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1255) [我们就能对整组图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1257) [标记喜欢或不喜欢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1259) [标记喜欢或不喜欢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1259) [通过一行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1263) [我们可以使用分批删除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1265) [将记录从数据库里清除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1267) [这种行为规模](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1269) [不可能将对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1272) [分解进内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1274) [举个例子 在删除过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1275) [传统的调用 NSManagedObject.delete 将使](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1279) [数据库中记录的大小增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1282) [当你删除对象时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1284) [你的内存被分解到上下文中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1286) [你的数据库越大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1287) [它就越贵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1289) [但是通过分批操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1292) [我们可以在一小部分内存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1294) [进行同样的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1296) [它有我们想要的曲线关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1298) [即当数据增加时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1299) [数据集越大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1302) [我们使用的内存越小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1304) [删除 1000 万行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1306) [我们只需用到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1308) [传统内存的 7%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1310) [这是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1312) [节约你的用户设备内存的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1314) [有力方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1315) [但是分批操作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1317) [一个传统问题是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1319) [一个传统问题是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1319) [很难操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1321) [因为它不生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1322) [存储提醒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1323) [这里就是把历史追踪功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1326) [引回来的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1327) [使用持续历史追踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1329) [我们可以将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1330) [分组删除或者更新的处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1331) [从数据库中分离出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1333) [我们可以使用 objectIDNotification 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1334) [来生成一个提醒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1337) [让它像存储提醒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1338) [那样工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1341) [这样 读取结果控制器或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1343) [其他在你的 App 中的上下文就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1344) [渐增式地更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1346) [这些提醒了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1349) [所以这些是你能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1351) [管理逐渐增加的数据的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1355) [但是工作流程自身呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1357) [核心数据可以为开发者和程序员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1360) [做些什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1363) [来使构建和测试你的 App 变得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1365) [更简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1366) [我们能做的第一件事就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1369) [帮助你感知未来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1371) [你可能知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1373) [NSKeyedArchiver 是在变化的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1375) [我们在所有平台上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1377) [使用安全代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1378) [使用安全代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1378) [今年 KeyedArchiver API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1381) [的剧烈变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1383) [也证实了这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1384) [对于核心数据来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1386) [这意味着数值转换器是变化的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1387) [所以如果在你的托管对象模型中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1389) [有一个可转换的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1391) [而你今天没有发送数值转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1393) [你将与默认的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1394) [数值转换器一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1396) [从 DataTransformer 得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1398) [NSKeyedUnarchive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1400) [在未来 你将从 DataTransformer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1402) [得到 NSSecureUnarchive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1405) [它在内部执行安全代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1408) [各位应该在今天就采用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1409) [今天早上有一场非常棒的演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1412) [名为可以信赖的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1413) [我强烈建议各位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1416) [看看这个演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1418) [并对安全代码和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1420) [如何将你的 App 的适应力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1421) [变得更强](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1423) [有更多的了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1424) [你可以在数值转换器名称字段里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1428) [通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1429) [带有可转换属性的模型编辑器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1430) [来指定它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1432) [今天 我希望各位可以自己执行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1435) [在未来的版本中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1440) [它将成为默认项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1441) [在未来的 Xcode 版本中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1443) [它也将向使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1444) [默认转换器名称的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1446) [发出警示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1447) [如果你在用代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1450) [构建模型 你可以通过使用 NSAttribute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1450) [介绍上的 valueTransformerName 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1453) [来对它进行设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1455) [如果你不是在编码自定义类类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1457) [那么这对你来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1459) [是很显而易见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1461) [对于 plist 类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1462) [这是一个无指令操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1463) [你只需要简单的更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1464) [数值转换器名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1465) [就能得到新的安全编码行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1467) [但如果你使用了自定义类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1469) [这些类则需要采用安全代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1470) [你可以到实验室来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1472) [向我们寻求帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1474) [但我们其实可以帮你更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1478) [在核心数据里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1481) [多年来我们花时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1483) [构建新的调试工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1485) [能够帮助你理解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1486) [在堆栈下发生的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1487) [这是我们更喜欢的 默认方案配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1489) [我们有一些过程参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1492) [能帮助你获得更多关于 SQLite 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1494) [调试信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1496) [但是 有一个你需要永远记得运行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1497) [但是 有一个你需要永远记得运行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1497) [是 com.Apple.Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1500) [和 Data.ConcurrencyDebug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1502) [它将抓取你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1504) [任何的队列异常

00:25:07.746 --> 00:25:09.396 A:middle
从主队列和后台队列上下文之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1506) [你可能进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1509) [传输的地方 或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1510) [不遵循托管对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1514) [真实上下文的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1515) [SQLite 也有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1518) [有趣的环境变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1520) [所以它们的线程和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1521) [文件的断言函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1523) [能很好地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1524) [保证你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1525) [的 API 以及文件系统的正确率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1527) [自动追踪是一种使你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1530) [看到内部发生了什么的好方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1532) [是一个对调试日志的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1533) [追加行程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1534) [com.Apple.CoreData.SQLDebug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1536) [有四个层级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1539) [第一层级是最有趣的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1541) [也是系统还原备份](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1543) [最少的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1544) [第四层是最冗长的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1545) [但是在运行过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1547) [产生大量的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1549) [系统还原备份](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1551) [当你启用 SQL 调试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1553) [和多线程断言时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1555) [你会在控制台中看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1557) [几个运行记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1558) [几个运行记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1558) [它们象征着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1560) [断言函数能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1561) [正确运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1562) [当我们使用 SQL debugging 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1564) [你将可以看到例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1566) [读取请求的选择语句](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1567) [以及它需要花费多长时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1568) [如果你被设置为第四级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1571) [你甚至会得到 explain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1573) [向你展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1575) [给定的选择语句的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1576) [查询计划](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1578) [在这里我们能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1579) [我们的表格视图通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1580) [表扫描进行筛选](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1583) [然后按照时间戳的顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1585) [使用内存中的 B 树](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1587) [这是个潜在的性能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1590) [当你在运行你的 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1591) [你可以使用这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1593) [信息来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1595) [你是否做了比你所需要的做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1597) [更多的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1598) [所以 我们该怎么修正它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1600) [事实上我们发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1602) [SQLite3 可以告诉我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1605) [如果我们打开一个数据库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1607) [将我们的 SQL 日志里的选择查询传递给它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1609) [我们就能够启动一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1610) [成为 Expert 的模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1612) [它能够对队列进行分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1614) [然后通过创建覆盖索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1616) [给出合适的优化方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1618) [给出合适的优化方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1618) [如果我们能通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1621) [对发布实体增加读取索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1622) [来在模型编辑器里做这件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1625) [这里我已经将它配置在时间戳上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1627) [将它们以递减的顺序调出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1630) [我们将最近的帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1632) [展示在表格视图的最上端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1633) [当我们再次运行 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1637) [我们会看到同样的选择日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1639) [除了这一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1644) [我们看到选择查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1646) [在查询中达到了覆盖索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1647) [解释命令告诉我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1650) [查询将使用覆盖索引进行排序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1651) [核心数据支持很多类型的索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1658) [包括使用 R 树的符合索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1659) [这对创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1663) [任何类型的查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1665) [或者在选择语句里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1667) [使用边界框的优化查询都很有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1670) [最常见的用途是为了定位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1672) [我们可以通过向发布实体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1673) [增加另一个索引来对它进行设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1675) [为了展示这张幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1677) [我添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1678) [我添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1678) [经纬度属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1680) [我们通过选择 R 树](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1684) [更改了盒子里的查询类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1686) [我们可以在读取请求上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1688) [设置谓词](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1690) [然后获得所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1693) [在中国大陆境内发布的帖子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1694) [这种谓词比较高级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1698) [因为它使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1700) [实际选择语句里的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1701) [来找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1704) [我们在托管对象模型里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1706) [创建的索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1707) [我们在没有这个索引和谓词的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1711) [运行 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1713) [可以看到和我们之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1715) [仅使用时间戳索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1716) [得到的结果是相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1718) [但是当我们在没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1722) [新的索引和谓词的情况下运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1724) [SQLite 会使用索引来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1727) [为两个语句](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1728) [生成更快速的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1731) [不幸的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1735) [我们的时间戳索引没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1736) [任何的复合谓词](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1738) [SQLite 不能用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1739) [SQLite 不能用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1739) [来进行排序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1741) [我们在这里选择的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1742) [是使用复合索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1744) [首先过滤掉更小的对象组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1747) [然后用内存中的 B 树](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1748) [来进行排序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1751) [就像各位看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1754) [这个索引将我们的读取性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1758) [提高了 25%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1760) [这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1763) [性能测试是运行大概 100,000 行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1765) [我们看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1767) [仅对于读取函数而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1769) [就有了 130 毫秒的提高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1771) [这就引出了我的下一个话题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1774) [核心数据的测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1776) [正如各位所知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1778) [我们非常喜欢测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1780) [测试很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1781) [在核心数据里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1783) [我们在内部既使用它们检测正确性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1785) [又使用它们学习](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1786) [核心数据的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1788) [以及 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1789) [在给定的条件下的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1791) [同时也能很好地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1795) [验证你关于核心数据的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1796) [以及它将如何在你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1798) [以及它将如何在你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1798) [帮助你的顾客获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1800) [更好的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1802) [就像各位在前一个例子中看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1804) [我们能够验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1805) [R 树索引可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1806) [优化性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1808) [虽然它使用的是内存里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1810) [B 树排序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1811) [但同样能捕捉到你的产品需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1814) [在核心数据里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1816) [这对我们十分重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1817) [因为它能帮助我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1819) [与你的期望沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1820) [通过测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1822) [我们可以看到你在用代码做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1824) [以及你希望这些代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1825) [如何服务你的顾客](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1827) [你可以设置一些重要的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1829) [使你的工作更容易一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1830) [比如 能够生成持久化容器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1831) [基础类别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1836) [屏幕上的基础类别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1838) [为持久化存储使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1839) [/dev/null 的文件 URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1841) [这是一种很好的测试方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1843) [它对一小部分的托管对象起作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1845) [且运行十分迅速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1848) [因为它们将在整个内存里运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1850) [当你这样做时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1852) [SQLite 实现了一个内存中的存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1854) [非常高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1856) [但是因为是在内存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1857) [如果你有很多数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1859) [如果你有很多数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1859) [会导致你的测试套件中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1860) [内存大量增长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1863) [不过 你需要完成至少一次测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1867) [在磁盘上将存储文件具体化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1871) [这是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1874) [如果不能为了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1875) [你的测试打开存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1876) [那你的顾客也打不开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1878) [如果持久化容器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1881) [在 App 代理里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1882) [你会有一个测试基类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1884) [能将容器取出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1885) [然后直接写入内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1886) [不过当你这样做时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1889) [我必须提醒你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1891) [因为这意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1893) [你在写入一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1894) [被 App 使用的内存文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1895) [所以如果你在个人设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1897) [运行测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1898) [你将在下次打开 App 的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1900) [看到你单元测试的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1902) [如果我告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1907) [我能用 7 行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1908) [添加 100,000 个记录呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1910) [其实有一点作弊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1913) [我会把这个当做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1915) [留给观众的练习](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1916) [但是这种方式的支架代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1918) [可以帮助你构建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1919) [可以帮助你构建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1919) [测试套件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1921) [来评估你的数据的不变性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1922) [通过提前构建这些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1924) [当你的数据变化 或者你意识到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1926) [你的 App 的新用例时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1928) [你可以通过迭代](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1929) [来构建新的边界情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1931) [来为对象图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1933) [构建新的结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1934) [或者在内部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1935) [评估一些特定功能的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1937) [例如性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1939) [这是我用来为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1942) [R 树查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1945) [构建性能测试的单元测试支架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1946) [仅仅在几行代码中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1949) [我们可以对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1950) [读取性能很有信心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1952) [这些类型的测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1954) [信息量很大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1956) [当你尝试去评估](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1957) [核心数据里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1958) [不一样的功能之间的权衡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1960) [这三行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1965) [生成了新的托管对象上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1966) [以及一个容器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1967) [供我们的测试使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1969) [现在这点很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1971) [主要是因为在测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1974) [setup 和 teardown 方法的逻辑可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1975) [对性能表现产生影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1977) [所以需要注意分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1979) [所以需要注意分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1979) [你是否真的在测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1981) [setup 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1982) [还是 teardown 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1984) [还是你在评估](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1985) [查询命令的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1986) [实际运行性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1988) [在你运行测试之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1990) [你可以提交好的错误报告](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1991) [我们喜欢错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1995) [特别是从你们这里反馈的错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1997) [因为我们在构建一个产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1998) [希望它能帮助你构建你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=1999) [但是 没有测试或示例 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2001) [对我们而言是很难理解的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2006) [就像我前面提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2008) [它们不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2009) [像结构良好的测试那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2010) [捕捉你的产品需求和期待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2013) [事实上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2015) [一个连接到 Radar 的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2017) [如果有测试套装](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2019) [哪怕是一个空的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2021) [带有一些 UI 的示例 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2024) [能向我们解释你的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2026) [我们也能更快回复你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2028) [并告诉你该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2030) [它们同样能帮助我们分辨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2033) [我们后续修复的准确性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2035) [所以 如果你要填写一份错误报告](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2037) [请花一点时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2038) [请花一点时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2038) [写一个测试给我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2040) [这就是我今天要讲的所有内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2044) [大家明天可以到实验室来找我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2045) [我们会从下午 1:30 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2048) [在 7 号技术实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2050) [我也强烈建议大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2053) [了解一下明天下午 3:20 在大厅 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2054) [举行的测试技巧与诀窍会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2055) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2058) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/224/?time=2060)