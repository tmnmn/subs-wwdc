# Strategies for Securing Web Content

## Summary
Whether you use web content in your app via an embedded WebKit view, deliver pure web apps, or create web content to be embedded by others, it's important to ensure that you are using the most current web security standards. Learn techniques like such as special cookie attributes and HTTP response headers designed to secure your web content against the latest threats that include cross-site scripting, cross-site request forgeries, and speculative execution attacks, commonly known as Spectre.

## Info
* Frameworks
* WWDC 2018 - Session 207 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/

## Text
 [［ 音乐 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=7) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=21) [&gt;&gt; 大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=27) [我叫 John Wilander](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=29) [是 Safari 浏览器和 Webkit 团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=30) [今天在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=32) [我想介绍如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=35) [维护网络内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=37) [或者 我也喜欢称之为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=38) [采取瑞典人的建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=42) [你可能会问自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=45) [网页内容 这个术语](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=46) [相当宽泛](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=48) [这场会议真的与我有关吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=50) [是的 与你有关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=52) [首先 App 使用大量的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=54) [用于广告 登录流程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=58) [用于广告 登录流程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=58) [和启动画面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=60) [或许你的部分 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=63) [正在使用 Safari View Controller](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=64) [你或许将整个 UI 部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=66) [呈现在网页视图中一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=68) [伴随网页 App 可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=72) [会在 Web 浏览器中呈现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=74) [它们能共享内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=76) [或提供跨 App 和 Web App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=78) [的联合体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=80) [所以 这场会议确实为你量身定做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=82) [安全十分重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=85) [你想要长久经营](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=87) [想提供最好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=89) [客户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=90) [想获得竞争优势](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=91) [你想获得这种权利](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=93) [其他人违背就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=95) [走向衰落 而你被市场选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=97) [好了 我们今天要讨论什么呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=100) [首先我们来说一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=102) [传输安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=105) [在做其他工作前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=107) [我要简单提及这方面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=109) [基本内容 这对于接下来很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=111) [如果不能确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=114) [传输安全 那么其他的就更别提了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=115) [然后 我们再说一下跨域锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=117) [然后 我们再说一下跨域锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=117) [基本上我会向你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=121) [展示一系列在 WebKit 及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=123) [浏览器引擎中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=125) [使用的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=127) [这可以帮助你获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=129) [更安全的 Web 内容默认值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=132) [我们希望为你选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=136) [但我们无法为你测试网站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=137) [或网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=139) [因此我们需要你的加入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=141) [或许 你会有疑问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=143) [为什么我要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=145) [关心这些安全机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=147) [我将向你们展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=148) [一些攻击场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=150) [并将其映射到安全技术上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=152) [以便于你们明白](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=154) [它在哪里发挥作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=156) [以及它怎样保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=157) [你的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=159) [所以 我们先来讲一讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=161) [传输安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=162) [这一点你应该很熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=165) [这与转移到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=167) [HTTPS 和 WSS 有关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=169) [WSS 适用于网络套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=172) [现在 HTTP 和 WS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=175) [这种纯文本等价物的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=178) [这种纯文本等价物的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=178) [持续存在并不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=180) [继续使用它们的借口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=182) [你需要转移到安全传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=184) [因为这将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=185) [确保你在浏览器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=188) [或 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=189) [呈现的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=191) [来自预期的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=193) [而且没有在传输中混淆内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=195) [因此 为使主要内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=200) [转移到 HTTPS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=202) [这里有几项技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=203) [可以为你提供帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=204) [你首先要做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=207) [除了主要内容移动到 HTTPS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=209) [还有绝对的传输安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=211) [或 HSTS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=213) [这是一个 HTTP 响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=215) [可以传送到呈现引擎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=219) [比如 WebKit 告诉它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=220) [嘿 我的域名应一直](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=223) [通过 HTTPS 加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=225) [如果有来自我的 HTTP 请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=227) [只需自动为我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=230) [升级到 HTTPS 即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=232) [请勿将纯文本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=234) [连接到我的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=236) [另外你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=239) [另外你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=239) [告诉呈现引擎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=240) [需要记忆多长时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=242) [所以 通常至少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=244) [提前半年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=245) [现在 你可能正在从其他](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=248) [不受控制的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=249) [加载内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=251) [而不是从你的域名加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=252) [还有一个你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=255) [发送到浏览器引擎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=256) [叫做“升级不安全请求”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=258) [也是一个 HTTP 响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=259) [它会给浏览器指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=263) [嘿 前进并且把其他所有链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=265) [也升级到内容中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=267) [即使不是从我的服务器输出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=268) [即使它们并没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=271) [设置严格的传输安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=273) [所以 这两样东西会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=276) [自动升级到安全传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=278) [另一件需要做的事就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=282) [确保你的 Cookie 的安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=283) [这是你在设置 Cookie 头中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=286) [添加的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=288) [分号 安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=289) [这意味着你在告诉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=292) [网络堆叠这个 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=294) [只能通过安全传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=296) [进行发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=298) [如果由于某种原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=300) [我的服务器出现纯文本请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=301) [请不要发送 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=303) [因为你应该使用安全的传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=306) [所有的 Cookie 都应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=308) [标记为安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=310) [最后 你要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=312) [将安全传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=314) [特定于 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=316) [你可能听说过 App 传输安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=318) [或者 ATS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=319) [这是 iOS App 的默认行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=321) [这意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=324) [只能为网络流量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=326) [使用安全传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=327) [现在 你可以做出选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=330) [在信息列表中表明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=332) [嘿 对于网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=333) [我仍然想做不安全请求 不要这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=335) [你应在信息列表中说“不”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=340) [尤其是对于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=342) [任意网页内容加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=344) [好了 现在我们已经确保传输安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=346) [我们继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=349) [现在来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=350) [跨域锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=351) [将其称为“锁定”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=353) [是因为它真的能为你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=354) [网页内容选择更明智](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=357) [网页内容选择更明智](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=357) [更安全的默认设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=360) [我们将其锁定到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=363) [它本该如此的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=365) [然后你可以打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=366) [具体想要做的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=368) [现在来看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=371) [什么是跨域加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=373) [我们要锁定什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=376) [网页技术有这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=378) [强大的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=380) [你可以将不同服务器及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=382) [不同来源的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=384) [交织在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=385) [如果你愿意的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=387) [不同域名也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=388) [例如图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=390) [你可以将任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=392) [网络服务器的图像加载到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=394) [网页内容中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=396) [这就是一种跨域加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=397) [你也可以从其他服务器上加载脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=399) [有趣的是 这些脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=402) [实际上执行的是与你自己脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=404) [相同的权限和特权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=406) [因此 你需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=408) [谨慎考虑从其他服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=410) [卸载哪些脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=412) [它们或多或少都拥有你的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=414) [用你的同等权限去执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=417) [再例如 iframes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=420) [可用来嵌入其他服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=422) [的完整页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=425) [跨域意思是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=426) [来自不同域名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=428) [以上就是三个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=429) [跨域加载的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=431) [现在 我们已经建立了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=433) [安全机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=435) [一个超过 20 年的网页安全机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=438) [为这些跨域加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=440) [提供基本的保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=441) [它也被称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=442) [同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=444) [但有所不同的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=447) [在这里你能得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=448) [真实域名的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=450) [你得到了加载图像的案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=451) [你还拥有了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=453) [加载脚本的 CDN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=457) [另外你可能还会得到一个社交小部件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=459) [一个 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=461) [来自 social.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=462) [而且 我想说的是这里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=464) [.example 我确信](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=466) [不是在讨论真实的网站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=469) [换个更易理解的说法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=471) [你可以将其看作 .com 或者 .org](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=472) [不管怎样 这些都是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=475) [跨源加载和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=476) [同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=478) [同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=478) [能够跟踪加载图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=481) [加载脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=482) [以及 iframe 的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=484) [因此它能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=485) [提供基本的保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=487) [这种基本保护意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=489) [在这个例子中 你的页面不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=492) [从 social.example 进入到 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=494) [不能读取其字节及内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=496) [也不能写入内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=501) [同源策略是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=502) [防御 网页的这部分内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=504) [实际上来自其他的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=505) [服务器 你不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=507) [直接进入到那里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=508) [修改内容或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=509) [读取用户刚好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=511) [输入的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=513) [同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=515) [简单来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=517) [就是在一个浏览器中匹配两个页面 两个选项卡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=519) [一个选项卡不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=522) [进入另一个选项卡去看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=523) [用户此时此地的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=525) [同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=527) [也在那里高效地运转和工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=529) [下一个 锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=534) [我们如何准确地锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=535) [我们已经有了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=538) [同源策略 但还不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=539) [同源策略 但还不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=539) [所以需要选择一些更多的默认值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=541) [从子资源的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=545) [完整性开始 我之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=547) [会提到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=548) [这只是脚本标记的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=550) [简单更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=552) [第二部分是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=555) [内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=556) [它能够为你的真格页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=557) [提供全面的安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=559) [你可以说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=560) [嘿 我只想从这里加载脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=562) [我不想从其他的服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=564) [得到等框架等等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=565) [我们会看到 第三部分是简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=567) [服务器配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=570) [这些是发出的 HTTP 响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=572) [并告诉浏览器引擎说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=575) [嘿 我想要更安全的默认配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=576) [我不想要这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=578) [旧的传统 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=580) [虽然你一直支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=582) [但我并不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=583) [请帮助我 那么 让我们一起深入其中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=584) [了解子资源的完整性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=587) [现在从 CDN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=590) [即内容分发网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=592) [加载该框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=594) [是非常合理的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=596) [这个脚本标签只包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=598) [这个脚本标签只包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=598) [URL 来获取脚本 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=601) [正如我所提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=605) [你现在正在依靠 CDN 来提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=606) [正确的脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=609) [这保证你的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=610) [按预期方式运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=612) [但实际上 你要知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=614) [如果它们决定碰撞该版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=616) [或是服务器出了问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=617) [它们将会给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=619) [发送错误脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=620) [你的网页内容可能会瘫痪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=621) [有可能出错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=624) [也有可能无法按照预期方式工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=625) [你知道自己期待什么脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=628) [但是当你只是像这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=629) [发送一个脚本标签时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=631) [就像这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=632) [你的行为就只是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=635) [告诉浏览器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=636) [回到 JavaScript 中执行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=639) [换种更好的方式说就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=643) [不 我想确保这是我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=645) [期待的脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=646) [不过 你可以在脚本标记中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=648) [使用完整性属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=649) [在这里 你提供了一个校验和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=653) [这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=654) [用算法 sha256 表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=656) [这是我希望从我的 CDN 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=659) [这是我希望从我的 CDN 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=659) [得到的校验和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=661) [而且只有当我得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=664) [与校验和匹配的东西时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=665) [你才能够执行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=667) [因此 浏览器引擎会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=669) [执行代码前检查和比较](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=671) [确保该校验和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=673) [那么 如果不匹配会怎样呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=677) [如果碰撞到版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=679) [或是哪里出了问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=681) [又或是我得到错误脚本怎么办呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=682) [那么我的网页就出现故障 无法运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=684) [你添加一个校验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=686) [这种情况下 你已经加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=688) [或尝试加载一个框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=689) [如果经检查框架加载正确后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=691) [我现在就可在 dom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=693) [中得到对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=695) [如果错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=696) [那么就从自己控制的服务器加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=699) [并且不做任何更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=701) [虽然这样可能会降低性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=704) [但至少网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=707) [或是网站仍然可以运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=709) [好的 以上就是子资源完整性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=711) [现在我们来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=714) [内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=715) [我提过 这就像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=717) [为页面设置一个策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=719) [为页面设置一个策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=719) [比如这里应该允许什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=720) [实际上我将其看作一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=722) [架构策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=723) [如果你是一名软件工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=725) [你会想追踪相依性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=727) [我可以在这里做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=729) [我可以加载什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=730) [不能加载什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=732) [因此 这又是一个 HTTP 响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=734) [所以 当你从服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=738) [发送一个页面时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=739) [你加一个响应头进去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=741) [并说 嘿 我要运行一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=743) [内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=744) [我将控制我的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=746) [网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=748) [然后你开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=750) [从远程服务器加载任何类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=752) [的内容默认源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=755) [是我自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=756) [只能从我的服务器默认加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=759) [现在 你已经完全锁定它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=762) [如果页面中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=764) [有任何类型的内容加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=766) [试图从不属于你的服务器拉进来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=768) [它会被拒绝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=771) [因为 WebKit 会以与你设置的策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=773) [不匹配的原因而拒绝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=776) [正如你们看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=779) [正如你们看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=779) [我在这儿做了注释](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=780) [没有内联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=781) [这也是默认行为的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=782) [一旦你这样设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=784) [也就是说没有内联脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=786) [只从文件加载脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=788) [这就是为什么我一直认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=791) [它是一个架构策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=792) [因为你将逻辑分为文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=794) [与标记和样式化分开来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=795) [这些样式也在文件中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=801) [CSS 文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=804) [好的 现在你想从 cdn.example 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=806) [加载脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=809) [如果只使用默认源自带](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=811) [那么这将会被锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=813) [对吗 就无法进行远程脚本加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=815) [在内容安全策略中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=818) [有个白名单机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=819) [你只要说 嘿 脚本源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=822) [打开 can.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=824) [因为我想从那里加载脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=827) [现在你可以从自己的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=829) [和 cdn.example 中加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=831) [但在其他地方无法加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=833) [你可能想要在 iframe 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=835) [有社交媒体插件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=837) [有社交媒体插件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=837) [一种小插件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=840) [你可以添加一个框架源代码指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=842) [说我想从 social.example 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=844) [加载 iframes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=845) [但是没有其他人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=847) [在我的页面上有 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=850) [这样 你就掌握了这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=852) [甚至当你的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=854) [被加载到别人页面上的 iframe 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=856) [也会有相反的指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=858) [在这个例子中 news.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=862) [正在加载一个 iframe 中的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=864) [你可以发出指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=867) [这是内容安全策略框架中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=869) [最后一条指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=870) [这是告诉浏览器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=874) [嘿 检查它的框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=875) [一直到首页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=878) [它们都必须在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=880) [我允许的清单上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=882) [所以 在这种情况下 你的网页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=885) [内容已经表示 news.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=886) [我和它们有交易往来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=888) [他们可以在 iframe 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=890) [有我的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=891) [这是相当多的 所以 让我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=894) [逐行快速回顾一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=895) [这样我们就知道 这说的是什么了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=898) [内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=900) [从默认源自带开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=902) [锁定一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=904) [所有将用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=905) [源属性加载的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=906) [都像从服务器加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=908) [需要我的出处以及域名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=910) [然后打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=913) [对于脚本 你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=915) [添加允许使用哪些脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=917) [你可以决定允许自己从哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=920) [加载框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=923) [然后将它们列入白名单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=925) [最后 如果你打算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=926) [在别人的页面中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=928) [使用 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=930) [可以将其放在框架指令的白名单上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=932) [好的 这就是内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=936) [它还有更多内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=939) [我们也会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=942) [一些攻击场景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=944) [看到这些东西的特点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=946) [下面我们来看一下 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=948) [事实上在网络兴起时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=951) [人们将 Cookie 称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=953) [“魔力 Cookie”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=956) [它真的很神奇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=958) [它真的很神奇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=958) [可以用来做很多事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=960) [也许最敏感的是它们对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=962) [用户进行认证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=963) [一旦认证登录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=966) [你就会得到一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=968) [Cookie 保存会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=969) [这个程序 如果它被移动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=971) [或被盗 并且被移动到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=973) [另一个浏览器引擎中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=975) [很多时候可以模仿该用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=977) [所以说 你真的需要保护好你的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=979) [就像我提过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=982) [你应该标记其安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=983) [以便于永远不会泄露](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=985) [纯文本请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=986) [不过 还有更多的事要做 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=988) [来看 HttpOnly Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=990) [这是个相当古老的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=994) [我想它已经有至少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=997) [15 年左右的历史了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=998) [你可能很熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1002) [web API document.Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1005) [这是 JavaScript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1007) [读取和写入 Cookie 的一种方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1010) [JavaScript 功能强大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1013) [而且 就像我提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1015) [如果你从其他服务器加载 JavaScript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1016) [就可以通过这个 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1018) [访问所有用户的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1019) [访问所有用户的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1019) [你不能让它们拥有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1023) [这么多权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1025) [相反 你应该保护你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1026) [Cookie 尤其是你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1027) [身份验证 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1028) [它实际上是以用户登录的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1030) [方法是将其标记为 HttpOnly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1032) [意思是这个 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1036) [你看到的是设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1038) [Cookie 头文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1039) [我们只发送 HTTP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1041) [这意味着不在 API 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1043) [暴露这个 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1045) [因此 JavaScript 现在看不到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1047) [Cookie 当然也不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1050) [篡改 盗取或是操纵它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1051) [所以 这是你应该做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1054) [还有另一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1058) [关于版本的新技术 SameSite Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1060) [同样 当你在浏览器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1064) [设置 Cookie 头时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1065) [将其设置在 Cookie 头上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1067) [看这里 我得到了相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1070) [严格的站点属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1072) [这里也有一个松散的版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1074) [但基本上用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1076) [这个特定的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1078) [这个特定的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1078) [前提是我是页面拥有者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1080) [是主页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1082) [而不是嵌入的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1084) [当我拥有整个用户体验时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1087) [我就有了整个 Web 视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1088) [然后发送到 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1090) [所以 在嵌入式案例中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1093) [如果你的 Web 内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1096) [由不信任的人嵌入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1098) [SameSite Cookie 将不会被发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1099) [且你的服务器也能检测到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1104) [我没有得到 SameSite Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1105) [所以要么是用户没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1107) [登录 要么是我正在被嵌入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1109) [我不能允许这样的事发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1111) [比如 一个敏感的处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1114) [所以 要控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1117) [被嵌入 SameSite Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1120) [好了 跨域锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1123) [现在我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1126) [真正的全新技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1127) [WebKit 首先执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1129) [这两个新的响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1131) [它们都是关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1134) [限制谁来加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1135) [你的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1137) [跨域资源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1138) [跨域资源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1138) [我们之前提到过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1142) [图像和脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1143) [这两种类型的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1145) [允许跨源加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1146) [自网络兴起以来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1149) [它们就一直存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1151) [因此从来没有一个真正的机制说 嘿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1153) [真的不想让其他站点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1157) [加载我的脚本或图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1158) [我可以只是自己加载它们吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1162) [不行 我们在网上有这个东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1165) [任何人在任何服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1167) [都可以加载图像和脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1168) [现在 我们提供给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1171) [一个控制器来告诉浏览器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1173) [嘿 我不想要这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1175) [这就被称为跨域资源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1176) [在这个特殊的例子里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1179) [我给它的指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1181) [是一样的 意味着只有我自己的网站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1183) [可以加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1186) [只有当我的域名是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1187) [主页面域并且我拉入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1189) [这个图像时 才会将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1192) [图像加载到网页内容处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1194) [这里 脚本也是同样的道理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1196) [所以 当其他人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1198) [尝试跨域加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1199) [尝试跨域加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1199) [你的图像或是脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1201) [且你正在发送这个响应头时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1204) [这些内容将不会被加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1205) [所以 这会让你控制住自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1209) [这是一种新技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1210) [最后 在跨域锁定中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1212) [我们获得了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1214) [跨域窗口策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1215) [现在我们真的陷入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1218) [早前的旧的 API 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1219) [你可能很熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1222) [在一个新窗口打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1224) [其他人的页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1227) [或是你自己的页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1228) [不同于你点击的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1231) [常规链接导航](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1232) [或是在同一选项卡中打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1234) [新标签和导航](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1236) [而是打开一个全新的窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1238) [在过去的日子里 我们甚至可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1240) [看到丑陋的弹出窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1242) [以及这类其他东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1244) [但这是旧的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1246) [window. Open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1250) [而且还有一些奇怪的事情发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1251) [所以 如果你的内容是由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1254) [其他人打开的 看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1256) [其他人打开的 看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1256) [就像是用户刚刚访问过我的网站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1260) [我的 SameSite Cookie 一切正常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1263) [但是开启者维护一个操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1265) [并在某种程度上拥有你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1267) [窗口 并拥有特定 API 来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1270) [控制该窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1273) [开启者甚至可以超出你的控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1275) [来导航你的窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1276) [有了新的响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1280) [跨域窗口策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1282) [你终于可以对此说不](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1284) [大部分网站都没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1287) [在开启者拥有的窗口中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1290) [实际使用这种 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1292) [以及这类通信方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1293) [网页上看到这种情况是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1295) [非常罕见的 但是它确实存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1296) [且在默认情况下是这样工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1298) [通过发送这个头文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1300) [在这种情况下为拒绝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1302) [句柄不应该放在那儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1304) [可以打开 但从这一点来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1307) [你不能控制我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1309) [还有一种方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1311) [我不会在这里展示它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1314) [但你可以允许发布信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1315) [你可能想在两个窗口之间对话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1318) [你可能想在两个窗口之间对话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1318) [而不对窗口进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1321) [开启控制 然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1322) [你可以允许发布信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1324) [好的 这也是一项新技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1327) [现在我们已经了解过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1328) [跨域锁定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1330) [你可以看到 这并不难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1332) [这是一组响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1335) [这是内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1338) [可供你将内容列入白名单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1339) [这是脚本标记的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1342) [完整性属性 或多或少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1344) [我们在这里讨论过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1346) [我将会给你一些动力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1347) [我们来看一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1349) [攻击场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1349) [你在捍卫什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1350) [如何使这些安全技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1352) [适应这些攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1354) [接下来我们一起了解一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1357) [跨域攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1358) [推测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1359) [有些人可能听说过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1361) [幽灵 我们还要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1363) [一起了解窗口控制攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1365) [现在让我们首先深入了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1367) [跨域攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1368) [我们讨论一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1370) [当 CDN 出现问题时的跨站点脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1371) [你可以告诉我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1373) [要去向哪里 对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1375) [跨站点请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1377) [伪造跨站点脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1378) [伪造跨站点脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1378) [想象一下你建立了一个信息 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1381) [比如 你将其作为一个本地 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1384) [具有丰富的格式化的网页视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1386) [你可能还有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1388) [配套的网页 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1389) [你或用户可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1391) [常规网页浏览器中访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1393) [可以把消息发送给对方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1395) [并伴随丰富的格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1396) [当然 大多数用户都很友善](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1399) [友善的人会互相](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1402) [发送好的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1403) [他们中有些人讨厌](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1404) [有人发出令人愤怒的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1406) [但偶尔这样的情况确有发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1408) [确实会有用户发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1409) [这样的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1412) [一开始很好 但](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1414) [当时它包含这标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1416) [而现在 如果你出了差错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1418) [无论是在链中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1420) [还是在本地 App 的网页视图中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1422) [又或是在网站中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1423) [它实际上都将会被认为是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1426) [标记而不是信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1428) [而攻击者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1430) [也就是恶意用户就能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1432) [在接收者的浏览器引擎中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1434) [运行脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1438) [然后试图盗取该用户的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1439) [然后试图盗取该用户的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1439) [但请记住 这些脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1442) [正在全力运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1444) [它们可以接管你整个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1445) [用户界面 代表受害者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1447) [向你发出请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1449) [比如说 跨站点脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1451) [就是一个反映不良情况的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1453) [你不会希望这发生在自己身上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1455) [幸运的是 你已经标记了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1457) [你的身份验证 Cookie HttpOnly 对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1459) [所以 它们不适用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1462) [这个恶意脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1465) [如今 HttpOnly Cookie 不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1467) [保护你免受跨站点脚本攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1469) [这种脚本仍在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1471) [HttpOnly Cookie 可以保护的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1473) [因此 你要做的还有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1477) [那么你都做了些什么呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1478) [内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1480) [从默认源自带开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1482) [对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1484) [只有我可以运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1486) [我页面上的脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1488) [这意味着在默认情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1490) [不会有内联脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1492) [且这类所有错误都会消失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1495) [现在没有办法将脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1498) [现在没有办法将脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1498) [加入到你的网页中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1500) [并让它们执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1503) [因为你在页面设置了策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1504) [好 如果你的 CDN 受到威胁怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1508) [这会很糟糕 我们只能希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1512) [它不会发生 但它有可能发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1514) [所以你真的要依靠这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1517) [从 CDN 加载框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1519) [因为它可以执行与你自己脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1522) [相同的权力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1525) [现在 如果它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1528) [已经破解并将脚本请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1530) [重新定向到 evil.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1531) [加载攻击代码怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1533) [突然间你感觉自己得到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1536) [一个框架 也许已经好到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1538) [足以捆绑在框架结构中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1540) [但它仍然做些令人讨厌的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1541) [那么你该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1544) [在内容安全策略中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1547) [将脚本源添加到白名单中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1549) [这样浏览器就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1550) [拒绝执行来自](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1553) [evil.example 的任何代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1555) [好了 现在攻击者需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1558) [好了 现在攻击者需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1558) [变得更加狡猾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1561) [他很可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1563) [会更改 CDN 服务器的脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1565) [而不是将其重新定向到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1567) [evil.example 服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1568) [所以 它在你的白名单上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1571) [你要加载并执行这一脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1572) [不过 你有子资源完整性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1576) [来帮助你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1579) [你可以控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1581) [其他服务器脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1582) [的完整性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1584) [如果校验和不匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1586) [那么你将会从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1588) [自己的服务器上加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1589) [因此 这种攻击也失败了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1592) [好的 这个就是破解 CDN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1595) [最后的跨域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1597) [攻击 即跨站点请求伪造](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1599) [这与最后一个单词相关联即伪造](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1603) [意思是攻击者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1606) [试图伪造一个请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1608) [看起来好像你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1610) [用户正在做些什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1612) [但事实上他们并没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1615) [我们回到信息 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1619) [我们回到信息 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1619) [你拥有这个论坛](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1621) [可以支持用户发送信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1624) [坦白说 当涉及到它时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1626) [它将是 HTTP 请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1628) [可能在 HTTP 邮件中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1630) [当消息进入服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1632) [并查看 Cookie 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1634) [一切看起来都不错 然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1635) [你会将信息发送给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1636) [接收者 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1638) [那么 现在出现了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1640) [恶意攻击者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1641) [当然他已经在偷窥你的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1644) [也就是说他发送了一个链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1646) [并将该用户诱骗到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1649) [攻击者的网站 evil.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1651) [并展示一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1654) [非常吸引人的统计数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1656) [这让受害用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1659) [至少在那里待上一段时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1661) [我的意思是你必须查看这些数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1662) [受害者用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1665) [并不知道你的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1667) [存在隐藏的资源负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1669) [代表受害者用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1671) [发送消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1675) [当然也会自动添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1677) [Cookie 这就是网页的工作原理 对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1679) [Cookie 这就是网页的工作原理 对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1679) [如果网络上发出请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1681) [则会添加 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1682) [我想你的服务器会看起来像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1684) [该用户想要发送信息的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1687) [那可能是垃圾邮件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1690) [或是恶意软件的链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1691) [它可能会和同伴分离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1695) [好吧 也许走不了那么远](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1696) [不过恶意软件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1698) [将继续留在那里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1700) [所以 你不希望发生这种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1702) [幸运的是 你已经使用了相同站点 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1705) [它们不会被发送到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1711) [嵌入式情况当中 这意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1713) [你的服务器将会检测到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1714) [我被嵌入在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1717) [我不允许用户从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1719) [其他页面下的 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1722) [发送消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1724) [当我做这种敏感的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1725) [比如说发送消息时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1727) [我需要得到 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1729) [否认这一请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1731) [这样 情况就在你掌控之中了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1733) [好了 我们现在了解下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1736) [跨域攻击 看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1738) [那些安全机制是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1739) [那些安全机制是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1739) [如何帮助我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1741) [我们来看一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1743) [非常奇特 新鲜的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1744) [幽灵攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1746) [或预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1748) [在这里我想说的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1751) [预测攻击是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1756) [它如何变成一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1759) [攻击 我们又怎样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1760) [去防御它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1762) [那么现在 我们深入 CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1765) [它正在执行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1768) [它已达到有力条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1771) [它会在条件下进行一些行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1774) [它在问自己 嘿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1776) [我这里有个数据索引 x](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1778) [这个是否正确](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1781) [在我数据读取的界内还是界外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1783) [因为如果是界外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1787) [我就会做些错误处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1790) [但如果是界内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1791) [我就会继续操作并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1793) [将数据加载到数组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1794) [如今 现代 CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1797) [如今 现代 CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1797) [如果一次又一次地看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1800) [相同路径 就会学习吸收](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1802) [X 总是处于界内状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1805) [加载这个数组 是可以的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1807) [为什么我不在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1810) [知晓其准确与否之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1811) [先走一步 去推测一下呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1814) [这就是它的工作原理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1816) [它执行此代码 以推测方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1818) [获取代码路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1820) [加载数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1822) [在最终答案出现时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1825) [在该种情况下 不 这是一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1826) [x 不正常的罕见情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1828) [你不能一直加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1830) [该数据 它会将其备份](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1831) [并采用正确的代码路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1833) [这怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1838) [没关系 因为推测路径没有提交](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1839) [它只是提前完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1843) [以便我们可以利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1845) [当原始问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1846) [得出最终答案时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1848) [我已经完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1850) [这就是预测执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1852) [那么这是怎样变成攻击的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1855) [事实证明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1858) [事实证明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1858) [由推测执行造成的缓存效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1861) [可以通过恶意代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1862) [进行监控 然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1864) [还可以泄漏那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1867) [从来不应该发生过的数据读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1870) [这是界外的 该负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1873) [应该没有发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1874) [但它会影响缓存 并且通过测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1876) [缓存 攻击者可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1878) [泄露那些不应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1881) [被加载的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1882) [那么这是如何映射到网页内容的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1885) [还记得同源策略吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1888) [这个东西已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1890) [保护了我们 20 年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1891) [确保了一个来源的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1894) [主框架不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1896) [进入和读取其他框架的字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1898) [或许是你的嵌入内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1899) [而有了预测执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1903) [攻击 我们就可以不再](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1904) [依赖于同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1906) [现在存在一种资格 那就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1908) [如果你可以运行脚本 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1910) [你在同一个过程中 与其他内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1911) [一样的网页内容处理过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1913) [那么你就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1915) [通过预测执行攻击读取内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1917) [通过预测执行攻击读取内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1917) [不过 这对网页来说是个巨大的挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1921) [我可以告诉你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1924) [我一直在和其他浏览器供应商开会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1925) [我们正在努力尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1928) [试图修复默认情况下的网页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1930) [不过我们也需要你们的帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1932) [如果你可以选择一些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1935) [我们已经看过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1937) [防御机制了 对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1939) [如果你能选择这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1940) [你可以帮忙告诉我们说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1942) [我有敏感内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1944) [我想要获得更好的默认值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1946) [你不用为我支持这些遗留的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1948) [然后我们就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1951) [更积极地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1952) [为你打击预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1954) [下面我们看是如何映射的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1957) [想要打击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1959) [预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1961) [你首先要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1962) [确保你的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1964) [永远不会像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1967) [evil.example 那样在同一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1969) [网页内容处理中结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1971) [如果它们有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1973) [框架 evil.example 那么就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1974) [在你网页内容驻留的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1976) [过程中执行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1978) [过程中执行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1978) [并读取你的字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1980) [因此 我们怎样保证这样的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1983) [不会发生呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1984) [我们有这些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1986) [第一个 WKWebView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1987) [现在我们正在使用 WebKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1990) [作为框架来查看 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1991) [我正在寻找 Safari](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1993) [这是一个使用 WKWebView 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1996) [App 的示例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=1998) [我们有时将其称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2000) [现代 WebKit 它已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2002) [使用了很多年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2004) [而且它提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2005) [很好的优势](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2008) [例如这三个选项卡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2010) [evil.example 你的 Web 内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2012) [还有 webkit.org 都在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2014) [单独的网页内容过程里呈现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2016) [此外 WKWebView 给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2020) [提供了一个分离的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2023) [网络过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2024) [在这里 Cookie 得以添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2025) [HTTP 头能够被解析等等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2027) [现在 预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2034) [都依赖于在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2036) [同一个网页内容过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2038) [同一个网页内容过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2038) [进行推测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2040) [试图读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2042) [攻击者不应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2044) [读取的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2046) [如果你把事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2047) [划分成了不同的进程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2048) [那这个攻击就不起作用了 对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2050) [你不能跨进程界限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2052) [来进行预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2054) [因此这已经成为一种防御措施](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2056) [防御措施 当然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2058) [非常重要的一点是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2060) [网页内容进程不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2062) [触及网络进程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2064) [不能在这里预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2066) [但是如果你仍然在使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2070) [UIWebView 那么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2072) [你可能不太对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2074) [我们不赞成这版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2077) [现在 假设你有 evil.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2080) [有网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2083) [以及网络堆栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2085) [然后你将这些全部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2087) [放入你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2088) [那么从预测执行攻击的角度看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2091) [一切都融合在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2094) [这是完全相同的进程空间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2096) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2099) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2099) [没有东西可以防卫预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2100) [你需要离开 UIWebView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2104) [如果你转移到 WKWebView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2107) [你就会得到这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2110) [在 evil.example 内容过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2112) [的进程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2115) [分离和不良情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2116) [不会影响其余部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2118) [我们已经转移到了 WKWebView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2121) [让我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2123) [内容安全策略如何帮助你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2124) [你可能有一个来自 social.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2127) [的嵌入式小部件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2128) [但是另一方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2129) [你也许会得到一个注入式攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2133) [或许这是又一次的信息传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2134) [人们在信息中发送标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2136) [可以偶尔呈现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2138) [并从 evil.example 中引入 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2140) [还有 你可能在这里有一个 AD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2143) [你也想让它在这儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2145) [然后 AD Network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2147) [破解并重新定向到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2148) [evil.example 然后引入一个框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2150) [另外 请牢记 千万不要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2152) [与来自 evil.example 的框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2153) [一起在网页内容进程当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2155) [那么 你做了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2159) [那么 你做了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2159) [你已经部署了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2161) [内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2162) [并且已经从允许框架的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2165) [指定了内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2167) [请不要允许 evil.example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2170) [这就是你如何防止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2172) [意外地从 evil.example 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2174) [获得一个框架的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2176) [那么 相反](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2180) [evil.example 能否将你的网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2182) [拖入恶意程序呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2184) [答案是肯定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2187) [那么 你该怎样防御呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2189) [我们回到内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2191) [现在我们看到了框架祖先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2192) [这是我之前提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2196) [内容稍有不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2197) [事实上也可以说没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2200) [这意味着将永远不要对我进行 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2201) [这个内容不应发放在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2205) [其他人的 iframe 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2207) [这是我的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2209) [只有我才可以呈现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2210) [所以 如果你放置这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2212) [evil.example 页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2215) [就不能在你的 iframe 中插入内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2217) [就不能在你的 iframe 中插入内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2217) [当然 我们也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2221) [在网络进程中进行封锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2223) [这很重要 对 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2225) [预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2227) [只能发生在同一进程空间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2228) [所以 我们要在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2230) [evil.example 可以执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2232) [JavaScript 的位置之前将其切断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2233) [HttpOnly Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2237) [真的能通过映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2239) [预测执行攻击吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2241) [是的 它们能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2242) [它们在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2243) [比尝试攻击跨站点脚本更重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2245) [为什么 还记得那个旧的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2248) [document.cookie 是从 JavaScript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2251) [中查看 Cookie 的方式吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2253) [既然我们不能 也不可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2256) [再依赖同源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2257) [evil.example 可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2258) [从你的内容到达 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2261) [并实际读取 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2263) [非常糟糕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2265) [但是如果你将它们标记为 HttpOnly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2267) [WebKit 将确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2269) [将它们保留在网络进程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2271) [我们不需要将它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2273) [移动到网页内容进程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2274) [因为它们不需要在 document.cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2275) [API 中公开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2277) [因此 这会自动保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2279) [因此 这会自动保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2279) [Cookie 反对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2280) [预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2282) [SameSite Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2284) [这基本上能让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2286) [你的服务器控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2287) [嵌入式案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2289) [同样 evil.example 已经决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2290) [尝试对你的内容进行一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2292) [预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2294) [用你的内容加载一个 iframe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2296) [但 SameSite Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2297) [没有被发送 这样你的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2300) [就会明白 我要在这里嵌入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2302) [而我不允许这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2304) [那你将会拒绝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2305) [整个资源加载服务器端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2307) [那不会在 evil.example 进程中结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2311) [最后 打击这些攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2315) [跨域资源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2318) [这是我告诉过你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2321) [新头文件 你可以对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2322) [网页浏览器引擎说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2324) [嘿 图像 脚本以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2326) [其他来自我的服务器的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2328) [只有我能下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2330) [所以 如果你说 在你的服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2332) [将这个头文件发送给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2333) [你的图像和脚本 我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2335) [确保阻止它们被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2337) [evil.example 加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2339) [evil.example 加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2339) [我们会在网络进程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2341) [执行这一阻止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2342) [同样 给你一个进程分离的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2344) [机会 使预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2346) [不能读取你的字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2348) [好的 我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2352) [最后的攻击类别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2354) [这是一个相当简短的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2356) [窗口控制攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2357) [所以 我们将查看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2360) [恶意的窗口导航](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2361) [有时被称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2363) [标签 然后进行防御](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2364) [现在 我们再一次回到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2368) [evil.example 而不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2369) [嵌入你的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2371) [因此 window.open 在一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2373) [新的窗口中打开你的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2376) [你却不知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2377) [是的 你不能决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2378) [好 有人打开了我的网页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2379) [SameSite Cookie 可能会发送到这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2382) [你可能以为一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2384) [都很好 但是 evil.example 会等到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2386) [你的用户注意力没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2389) [集中在你的页面 然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2392) [使用句柄将它导航到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2394) [一个看起来与你页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2397) [一个看起来与你页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2397) [相像的欺诈页面 并要求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2400) [用户再次登录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2402) [以盗取凭据并将其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2404) [发送给攻击者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2405) [如果你把控制权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2408) [留给了开启者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2409) [这种情况就会发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2410) [相反如果你部署跨域窗口策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2413) [拒绝此项操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2416) [那么攻击者页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2419) [将没有处理程序来导航窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2421) [这就是进攻的最后一道防线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2424) [是时候采取行动了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2428) [我们回顾一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2431) [在这里说过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2432) [以便于你知道自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2434) [回到办公室或者家中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2435) [开始工作时需要做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2437) [首先 我们必须要保证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2440) [这些传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2442) [移动到 HTTPS 和 WSS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2444) [你应该有安全的 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2447) [你也要标记它们 HttpOnly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2449) [如果你接受瑞典人的建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2452) [只需将你的所有 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2454) [设置为 HttpOnly 并确保安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2455) [你需要从 UIWebView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2457) [迁移到 WKWebview](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2459) [迁移到 WKWebview](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2459) [这些是基础](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2462) [然后我们就有了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2463) [我们一直在进行的防御机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2465) [内容安全策略将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2467) [帮助你在这里进行跨站点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2469) [脚本和预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2471) [执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2473) [HttpOnly Cookie 将为你提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2476) [对跨站点脚本的某种保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2477) [这意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2479) [脚本不能窃取 Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2480) [但它肯定会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2482) [帮助你抵御](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2484) [预测执行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2486) [因为 HttpOnly Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2487) [被完全保存在网络进程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2489) [子资源完整性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2493) [这就是抵御](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2494) [受损 CDN 的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2496) [有人正在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2498) [页面上执行你从未想过的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2500) [SameSite Cookie 这是一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2504) [打击伪造请求的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2507) [为了对付某些钓鱼页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2509) [隐藏到你的服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2512) [你会知道 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2512) [当你被嵌入时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2514) [不会发送 SameSite Cookie 所以你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2516) [不用接受请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2517) [它也发生在抵御](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2520) [预测执行攻击上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2521) [因为如果一个恶意页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2523) [试图吸入你的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2524) [以便能够利用对它们的攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2526) [那么同样 SameSite Cookie](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2528) [将不会被发送 你也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2530) [拒绝加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2531) [然后我们了解了这些新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2533) [技术 即跨域资源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2535) [你可以说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2538) [这是图像 脚本和其他](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2540) [跨域加载的方式 拒绝它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2543) [只需加载到我的页面上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2545) [最后 控制窗口是为了确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2548) [如果其他人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2552) [在自己的窗口中打开网页内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2554) [该句柄就会消失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2556) [这些都是很容易采用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2560) [尤其是对你来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2562) [你了解你的网站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2564) [知道你的网站内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2565) [了解 App 知道它们该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2567) [如何工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2568) [如果我们只为所有人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2569) [默认打开它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2570) [它可能会破坏一些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2571) [所以你需要选择这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2573) [通过选择方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2576) [你应该检查安全性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2578) [是否正常工作你可以尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2579) [是否正常工作你可以尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2579) [对自己的内容进行攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2581) [确保我的内容安全策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2582) [能够保护我 很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2585) [当然还要测试本就存在的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2586) [我们有一个博客](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2591) [WebKit 项目是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2592) [公开资源的项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2594) [我们有一个博客来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2595) [讨论这些技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2596) [和其他事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2597) [这是我们将在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2598) [这两个最后响应头上更新的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2600) [跨域资源策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2602) [和跨域窗口策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2604) [因为我们仍在与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2606) [其他浏览器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2608) [供应商讨论这些问题 试图确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2609) [它们是标准的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2610) [以便相同的响应头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2612) [在所有浏览器上有效运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2614) [因此 可能会有轻微的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2616) [名称更改或添加的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2617) [但我们目前还没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2620) [此外 它很新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2622) [所以你实际上无法进入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2624) [直到有种子二或公共种子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2626) [我们还没有完全支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2629) [开发人员的种子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2631) [我再推荐一下其他的会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2635) [请来看我们 包括我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2637) [明天在 2:00 在 Safari WebKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2638) [明天在 2:00 在 Safari WebKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2638) [和密码自动填充实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2640) [你可以到那里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2642) [与我或我的同事讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2644) [如何部署这些技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2646) [让他们更好的为你服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2647) [周五还有一个会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2649) [一个关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2651) [Safari 和 WebKit 中新内容的综合会议 谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2653) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/207/?time=2657)