# Creating Photo and Video Effects Using Depth

## Summary
The TrueDepth camera in the iPhone X streams high-quality depth data in real time allowing you to enhance your photo and video apps in fun and creative ways. Dive deep into the principles and best practices for working with depth data, learn how to use the new Portrait Segmentation API for still images, and see how these techniques can create special effects like background replacement and perspective changes.

## Info
* Media
* WWDC 2018 - Session 503 - iOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=7) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=18) [&gt;&gt; 早上好 很高兴](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=21) [和你们在这里一起探讨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=23) [我的名字是 Emmanuel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=25) [是 Core Image 团队的一名工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=26) [今天 我们将着眼于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=28) [使用深度图创建照片和视频效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=30) [让我们开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=32) [在 iOS 11 中 我们开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=37) [将人像深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=38) [与静态人像图片一同传送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=40) [在去年的 WWDC 会议期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=43) [我们展示了如何利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=45) [深度数据实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=46) [令人惊叹的效果 例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=47) [力度透视 模拟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=49) [景深效果 以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=51) [各种前景和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=52) [背景分离效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=53) [今年我们非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=56) [高兴地宣布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=57) [我们将推出一个新的功能人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=59) [我们将推出一个新的功能人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=59) [因此 在此次会议的前半部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=66) [我们将着重于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=67) [人物静态图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=68) [以及如何很好的使用它们的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=69) [在接下来的一半时间里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=72) [我的同事 Ron 来自视频工程的专家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=74) [将着重于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=75) [使用 TruthDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=77) [来实现实时视频效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=78) [好的 让我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=81) [人像景深识别 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=84) [之前 我提到了人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=87) [那么人像蒙版是什么呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=88) [人像蒙版是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=89) [把前景和背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=90) [分割开来 这意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=92) [你有着一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=93) [前景为 1.0](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=95) [的遮罩 背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=97) [为 0.0 的遮罩 并且你可以在两者之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=100) [获得平缓且连续的数值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=102) [人像蒙版有着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=107) [极高的质量 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=107) [能够很好的保留细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=109) [例如人物的卷发和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=110) [头发上的轮廓](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=112) [这非常的了不起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=114) [蒙版可以实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=116) [很多惊人的效果 此处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=119) [很多惊人的效果 此处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=119) [只是其中以一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=121) [通过使背景变暗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=123) [来实现前景和背景的分离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=124) [我们把这个工具交与你手 这样你可以创造出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=126) [惊人的 App 和新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=129) [效果 从而让你的用户满意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=132) [好的 人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=135) [效果将可以在 iOS 12 中使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=138) [它适用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=142) [前置和后置相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=145) [此技术被使用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=148) [人物静止图像 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=151) [此刻场景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=153) [必须有人物存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=154) [请注意 人像蒙版是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=157) [线性编码 它并不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=159) [伽马编码 所以你得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=161) [的是一个灰度缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=162) [而且也不能保证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=164) [你会获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=166) [人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=167) [当你使用人像静止图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=169) [你总是能获得图像深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=170) [但是你需要测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=171) [去确保人像蒙版的存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=173) [现在 让我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=174) [API 了解如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=177) [加载数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=178) [加载数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=178) [首先 ImageIO 提供了一个简易的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=180) [API 允许你加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=182) [人像蒙版效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=184) [所以通过调用 CGImageSourceCopy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=185) [传递一个新的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=189) [kCGImageAuxiliaryData](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=190) [TypePortraitEffectsMatte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=192) [这个调用将返回一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=195) [包含三个主要信息的结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=196) [图像本身数据定义为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=198) [CFDataRef 与缓冲区本身](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=200) [相关的元数据为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=204) [CFDictionary 以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=205) [与抓取本身相关的元数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=208) [AVFoundation 同时也提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=213) [一个可以比 ImageIO](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=215) [更高级的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=216) [因此从 CGImageSourceCopy 获得输出 然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=218) [你将它输入 AVPortrait effects matte 类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=222) [你从中返回的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=228) [非常的简单 它是一个 CV 像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=229) [缓冲器以及像素格式类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=231) [因此你可以使用这个 CV](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=233) [像素缓冲器来满足你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=234) [进一步的处理需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=236) [这非常的简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=239) [这非常的简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=239) [AVFoundation 还支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=241) [在拍摄时提供人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=242) [典型的 AVFoundation 设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=245) [从 AVCaptureInput 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=247) [然后 AVCaptureDevice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=248) [以及 AVCaptureSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=251) [首先 你需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=252) [你的软件环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=254) [能够支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=255) [人像蒙版效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=256) [要做到这点 你需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=258) [检查是否支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=260) [深度数据传输 以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=261) [人像蒙版效果传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=263) [我们有这两个的原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=265) [是由于深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=266) [和人像蒙版同时存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=267) [你可以选择仅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=269) [获取深度信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=271) [但只要你需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=272) [人像蒙版 你就需要激活](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=274) [深度数据的传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=275) [为了激活或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=278) [选择传输数据 你需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=279) [确保修改你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=281) [AVCapturePhotoSettings 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=282) [启用 isPortraitEffects MatteDelivery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=284) [以及设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=285) [isDepthDataDeliveryEnabled 为 true](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=286) [然后抓取时间 你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=290) [ddiFinishProcessingPhoto](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=292) [回调函数将会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=293) [给你人像蒙版效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=295) [就是如此的简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=297) [Core Image 还为你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=300) [提供加载和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=301) [保存你的人像蒙版效果的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=302) [一个新的队列被引入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=305) [auxiliaryPortrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=306) [EffectsMatte 你只需要传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=307) [imageWithContentsOFURL 到 CIImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=309) [就可以获取人像蒙版效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=313) [Core Image 同时还允许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=319) [你的人像蒙版效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=319) [直接保存到你的文件中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=321) [要做到这一点 这里有一个新的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=324) [称为 portraitEffectsMatteImage 你传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=326) [在 CI Image 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=329) [人像蒙版效果 然后你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=330) [就可以例如用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=332) [writeHEIFRepresntationOfImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=334) [写入你的磁盘](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=335) [这里有一件很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=337) [的事情需要注意 关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=339) [三种图像 你的 RGB 图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=341) [深度图和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=342) [人像蒙版图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=344) [有着不同的分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=347) [例如 对于后置摄像机的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=349) [人像蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=350) [是一半大小 对于深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=351) [甚至更小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=353) [所以让我们一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=355) [来看后置摄像头的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=356) [三种图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=357) [这意味着在你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=359) [这意味着在你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=359) [你需要确保 要不将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=360) [RGB 图像缩减为与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=362) [你的人像深度图或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=364) [人像蒙版图一样的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=366) [或者用相反的方法 将它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=369) [采样到与 RGB 图像相同的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=371) [所以这就是我今天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=373) [想要讨论的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=375) [人像景深识别 API 并且我们准备了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=376) [一个非常棒的演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=378) [让你们观看在这个演示中 我将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=380) [使用 Jupiter Notebook](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=384) [它是一个基于浏览器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=386) [我们将 Python 与 Core Image 绑定起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=393) [我们将会在稍后的一个单独会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=396) [中介绍这些绑定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=397) [让我们开始并加载一张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=405) [包含人像深度数据和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=406) [人像蒙版的图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=408) [所以这将是我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=410) [所要处理的图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=410) [首先 我想为你展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=412) [该图片的深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=414) [看起来是什么样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=416) [让我们来看看这两张图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=417) [在左侧我们有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=419) [在左侧我们有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=419) [人像深度图 在右侧有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=420) [人像蒙版图 你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=422) [看到它们的细节有多好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=423) [我们将在一分钟内做一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=425) [缩放剪裁 以便你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=427) [更好地欣赏它的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=429) [接下来我们要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=433) [调整图像的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=435) [你可以看到 RGB 图和深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=437) [在大小上有很大的区别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=438) [所以我们调整图像的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=442) [让我们再一起看看它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=443) [所以在右侧我们有 RGB 图像和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=445) [深度数据图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=446) [在本演示的第一个部分中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=447) [我将着重于深度数据图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=449) [然后我们将看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=451) [事物在使用人像蒙版效果时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=452) [会变得多么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=453) [所以今天我将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=455) [处理的效果是深度阈值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=457) [基本上我要做的是计算我的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=459) [人像深度数据图中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=462) [灰度值的直方图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=463) [我将在这直方图中运用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=465) [一个阈值或者一个剪切点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=467) [所以一切都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=468) [变为零或者一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=469) [取决于它是否低于或高于该阈值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=471) [我们将排除图片中的小型黑洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=474) [通过使用形态学](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=475) [闭运算操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=477) [然后模糊遮罩 以便](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=479) [然后模糊遮罩 以便](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=479) [获得漂亮的羽化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=481) [让我们看看这个的实际情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=483) [记住 所有的这些都是用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=486) [Core Image 作为后端从而](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=487) [在浏览器中执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=489) [首先 我想给你展示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=491) [是如何改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=493) [百分比点来改变我的遮罩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=495) [所以越高的数值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=497) [越不明显 我剪裁的是前景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=499) [所以让我们选择一个合理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=501) [的数值 也许可以选择这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=502) [你可以在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=505) [看到是我们称之为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=506) [插入到图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=508) [前景的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=509) [这里也有一些我想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=511) [去除掉的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=512) [所以我会做的是添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=513) [一些形态学闭运算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=515) [看看这是多么的神奇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=516) [如果我的数值调的太大 明显的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=518) [将失去我整个的目标 我不想这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=520) [所以让我们选择这个点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=523) [接下来我做的是通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=524) [在其上面做高斯模糊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=526) [来改变羽化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=527) [然后我们再看看 RGB 图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=529) [在此上什么样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=530) [这不是我们刚刚提出来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=531) [效果 只是为了了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=532) [遮罩是怎么被运用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=534) [让我们继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=535) [我在这里为阈值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=537) [选择了一些参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=539) [选择了一些参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=539) [这些将用于我的前景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=541) [接下来 我只在我的前景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=547) [应用效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=549) [所以在这个特定的例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=550) [我将使用 Core Image 的 photoEffectNoir](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=551) [它可以将所有变成灰度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=553) [并且具有一点对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=554) [我正在进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=556) [曝光调整 以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=557) [稍微减弱饱和度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=559) [并进一步增强对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=561) [让我们看看结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=563) [这将是我要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=564) [使用的前景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=565) [我想做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=567) [利用深度数据遮罩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=569) [我将把这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=572) [前景合成到背景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=573) [我们需生成一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=576) [只是比原始图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=577) [较暗版本的背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=579) [然后 我们可以用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=580) [Core Image 的滤镜 称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=583) [blendWithMask 将两者结合到一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=585) [然后我们得到了结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=588) [就是如此的简单 好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=590) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=592) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=595) [如你所见 需要一点点烦琐地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=599) [如你所见 需要一点点烦琐地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=599) [修剪参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=602) [使其平滑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=604) [如此这般](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=605) [这个人像蒙版效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=606) [使你能在没有实际做太多操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=607) [的情况下执行操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=610) [这非常令人兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=611) [让我们看看这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=612) [因此 我们从另一张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=613) [图像开始 它同样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=615) [有着人像深度信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=619) [和人像蒙版信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=620) [让我们来看看这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=622) [像我之前提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=625) [这是一个非常高质量的前景遮罩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=627) [所以让我们来看看这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=629) [头发上的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=631) [看看这细节有多好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=633) [非常的漂亮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=636) [在最右侧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=637) [是一个深度图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=638) [与人像蒙版对比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=639) [它表明深度数据如何的粗糙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=642) [所以在这里我们再做一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=644) [前景分离效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=646) [就像我们刚刚做的一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=647) [但是这次我们使用人像蒙版图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=649) [而不是人像深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=649) [因此 让我们看看我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=651) [与之前类似的前景图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=653) [但是这次我们稍微](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=655) [降低一些前景的饱和度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=656) [增加更多的对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=657) [以及一些图像的振动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=659) [以及一些图像的振动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=659) [现在我们来创建一个背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=663) [这次我们将做一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=664) [discBlur 它是 Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=666) [的另一种滤镜 以及减少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=667) [曝光 使图像变得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=668) [非常的黑暗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=669) [但是我们仍然有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=670) [一些背景 它很微弱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=672) [但仍然存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=673) [再次 我用了 Core Image 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=675) [blendWithMask 它将为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=677) [我们合成图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=679) [然后我们就有了左右两张图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=681) [这难道不美吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=682) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=684) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=688) [好了 让我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=689) [另一个我们称之为 Big Head 的演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=690) [由于人像蒙版是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=692) [如此的好 我们实际上可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=696) [做一些事情例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=697) [改变我们目标的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=699) [相对于背景的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=700) [让我们开始这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=702) [我们现场做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=704) [所以 左边这是我们的输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=706) [图像和右边的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=708) [人像蒙版图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=710) [我将要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=712) [我会改变在我框架中人物的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=715) [大小 注意目标是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=717) [如何的变大和变小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=719) [如何的变大和变小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=719) [你可以在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=723) [框架中给这个目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=725) [更多的权重数值 你也可以做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=727) [很酷的事情 就像现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=729) [我有着这个 让我选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=731) [我最喜欢的尺寸大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=732) [你可以通过在前景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=734) [提供更多对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=737) [并使背景模糊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=739) [来做类似仿真景深的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=740) [从而为拍摄对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=742) [提供更多的突出点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=742) [所以让我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=746) [另一张图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=748) [看看这操作起来是多么的容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=749) [因为它们使用了完全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=750) [相同的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=752) [这是非常的简单 仅仅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=753) [使用了人像蒙版图并用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=754) [去模糊前景和背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=756) [再次 我们输入图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=758) [改变它的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=760) [使它变得更大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=762) [然后应用一些对比度 来给我们的人像更多的焦点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=765) [这很简单 令人兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=768) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=770) [好吧 让我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=775) [另一个演示 我们称它为 Marching](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=777) [我甚至不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=779) [我甚至不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=779) [解释它的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=781) [让我们来看看滤镜的实际操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=782) [你看 有趣的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=790) [因为可以做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=792) [所以我可以添加任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=794) [我想要的数量缝合在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=795) [所以从只有一些贴近你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=796) [到把它推到很远很远](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=798) [令人兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=801) [好的 这就是这个演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=803) [我希望你喜欢这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=811) [所以如果你想了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=813) [更多有关使用 Python 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=815) [Core Image 的东西 我建议你去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=816) [参加今天下午的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=818) [Core Image Performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=819) [Prototyping in Python 的会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=820) [这就是我今天所有的展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=822) [让我来介绍我的同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=825) [Ron 一名视频工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=826) [将介绍使用 TrueDepth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=828) [的实时视频效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=829) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=831) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=832) [&gt;&gt; 谢谢你 Emmanuel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=839) [&gt;&gt; 谢谢你 Emmanuel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=839) [非常精彩的图像效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=841) [那么视频呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=842) [我的名字是 Ron Sokolovsky](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=844) [我是一名视频工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=846) [在这个部分 我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=848) [利用 TrueDepth 的相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=851) [为实时视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=853) [创造类似的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=855) [例如此背景替换 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=857) [为了产生如此的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=861) [我们将深入研究](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=864) [来自 TrueDepth 相机的特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=866) [最佳实践性和挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=869) [我们将为你展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=872) [如何使用点云技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=875) [一个完全不同的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=876) [来处理和渲染丰富的深度信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=878) [后台替换程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=881) [我们称之为 Backdrop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=882) [我们将向你逐步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=884) [展示如何实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=885) [但首先 TrueDepth 相机的流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=888) [由帧组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=891) [每一帧都是一个深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=893) [它是一个 2D 图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=895) [其中每一个像素都包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=897) [深度信息和沿该方向到场景的距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=899) [深度信息和沿该方向到场景的距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=899) [我们选择了特定的着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=905) [方法 近处像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=906) [用红色着色 而远处的像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=908) [用蓝色着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=911) [在它们之间有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=912) [彩色光谱 因此你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=914) [看到深度图的纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=916) [同时还有黑色像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=920) [是那些在深度图中的黑色小洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=922) [对于这些像素 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=924) [没有任何深度的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=925) [今天 我们将发布一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=928) [新的工具 一个示例 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=930) [让你去探索这个流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=932) [我们称之为 TrueDepth Streamer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=934) [你可以在视频流和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=937) [TrueDepth 流之间切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=940) [现在 由于 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=947) [即使在完全黑暗的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=949) [也具有主动照明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=951) [所以 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=953) [仍然正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=956) [所以 现在你可以看到我 现在你不行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=961) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=965) [那么如何将 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=969) [中的数据流添加到你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=971) [首先你需要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=974) [找到 builtInTrueDepthCamera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=977) [然后初始化设备捕捉输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=979) [然后你将 depthDataOutput](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=984) [添加进你的会话类中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=987) [现在你可以开始进行会话类了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=989) [并且会在会话中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=992) [有着 TrueDepth 流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=993) [这些流有着两种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=997) [形式的数据视差和深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=999) [视差数据是深度数据的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1002) [倒数 反之亦然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1004) [所以你应该选择哪个呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1006) [良好的视差数据通常产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1008) [更好的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1011) [特别是对于机器学习 App 来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1013) [但深度数据在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1015) [实际测量方面具有更多意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1016) [你需要知道 当你处理深度时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1020) [深度误差与深度的平方一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1021) [这意味着一个 1 米远的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1026) [物体有着 4 倍于 2 米远](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1028) [物体的深度精度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1029) [我们有视频流和深度流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1036) [它们不一定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1038) [分享相同的分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1039) [TrueDepth 相机的原始分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1041) [是 VGA 或者 640x480](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1043) [你将会获得这种分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1044) [如果你选择一个视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1047) [以屏幕高宽比 4:3 的预设](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1050) [但如果你选择 16x9 的屏幕高宽比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1053) [你将会得到 640x360 的深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1055) [在两种情况下 深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1060) [都将覆盖整个 RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1062) [图像的整个视野](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1065) [现在我们讨论的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1066) [视频 App 所以我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1069) [要非常快速地处理大量数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1071) [随着时间的推移 这可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1072) [对系统产生压力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1075) [所以你可以测试你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1077) [并测试你系统压力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1079) [并测试你系统压力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1079) [水平 从轻松](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1081) [一般 负荷 超负荷 最后关机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1084) [而责任掌握在你的手中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1087) [因为系统会允许你一直测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1088) [直至它最终关机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1091) [但是当这发生了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1092) [所有的捕捉设备也都将受损](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1095) [另一件你可以做的事是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1097) [采用退化方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1102) [如果压力水平变得严重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1104) [你可以将帧速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1105) [降低到每秒 15 帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1107) [或者你可以选择更复杂的方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1109) [用更加柔和的退化方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1111) [每当压力提升 把每秒帧数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1113) [从 30 24 20 一直降到 15](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1117) [而且我们在深度图中有着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1123) [一些黑洞 我们可以做些什么呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1125) [实际上你可以得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1127) [一些已经过滤后的流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1129) [这是一个名为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1132) [isFilteringEnabled 的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1133) [默认为真  它意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1135) [你可以在空间和时间上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1137) [平滑地过滤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1139) [平滑地过滤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1139) [深度图 并从 RGB 图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1141) [填充黑洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1143) [这对于摄影和分割](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1145) [App 非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1147) [因为每次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1148) [查询像素时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1150) [都知道深度值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1152) [在 TrueDepth Streamer 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1153) [你可以切换到滤镜流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1157) [从而查看它是否更平滑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1159) [并且黑孔被填充](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1161) [这非常的好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1163) [但它不适用于所有的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1167) [如果你在处理点云](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1170) [或者任何类型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1171) [真实世界测量 你最好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1174) [保持原始数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1176) [以保证最高的保真度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1178) [如果你这样做的话 你会得到黑洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1180) [你会有像素被标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1182) [为零 它并不意味它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1184) [距离摄像机零米](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1186) [的距离 它只意味着我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1188) [没有关于它们的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1190) [因此 你需要注意如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1193) [求平均和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1195) [降采样的操作 因为你不希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1196) [把真实值和这些零混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1197) [把真实值和这些零混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1197) [但是为什么我们会得到这些黑洞呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1203) [TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1205) [可以探测大约 5 米](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1209) [的物体 但并不是所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1211) [材料都是相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1214) [一些材料有着低反射率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1215) [它们吸收大部分的光线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1217) [例如 这种极端的情景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1221) [这是一块有着极低反射率的材料](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1223) [看看当我一边远离它一边获得深度图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1226) [一边获得深度图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1227) [会发生什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1229) [即使场景中存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1233) [距离较远的物体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1235) [我们也可以在这块材料上看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1237) [黑孔洞 这是因为它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1239) [吸收了大部分的光线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1242) [如果切换到滤镜流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1244) [并重复相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1245) [动作 那么这些黑孔洞会被填满](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1247) [但是这不仅与反射回来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1249) [光的数量有关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1253) [而且它也和反射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1255) [的方向相关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1256) [一些材料是镜面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1259) [一些材料是镜面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1259) [或是有光泽的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1261) [它们本身反射光的方向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1262) [就非常的挑剔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1264) [这有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1265) [极端的情况 你可以观看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1268) [视频流以查看反射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1271) [当我们切换到深度图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1274) [黑孔的形成取决于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1275) [设备和屏幕之间的角度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1278) [因此如果我们切换到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1281) [滤镜流 这些黑孔洞将被填充](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1283) [但是保真度会降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1285) [另一个具有挑战性的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1291) [就是室外 通常在室外场景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1292) [背景十分遥远](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1295) [所以我们不希望从背景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1296) [得到任何深度信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1298) [同时 太阳光被视为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1300) [主动照明的影响因素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1302) [为了证明这个 我在一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1305) [阳光非常明媚的下午](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1308) [去了外面 把自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1310) [置于阳光下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1311) [当我们切换到深度图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1313) [你可以看到背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1314) [没有任何深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1315) [并且在框架的周围有着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1318) [一些黑孔洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1319) [一些黑孔洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1319) [特别是头发](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1321) [但前景大部分深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1323) [仍然完好无损](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1325) [我想介绍的最后一点是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1328) [从 TrueDepth 相机的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1332) [角度来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1334) [投影的光线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1335) [会在返回的路上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1337) [撞击到物体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1339) [所以我们会从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1341) [投影机和相机之间的视差中得到阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1343) [这个杯子的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1346) [右侧就是一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1347) [但这里有些不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1350) [这不是一个深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1352) [那我们为什么还会得到黑孔洞呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1354) [在 TrueDepth Streamer 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1357) [你可以从二维模式切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1358) [到三维 从而为我们提供点云视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1361) [有了点云我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1364) [动态地改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1365) [场景的视角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1367) [从而当我们这么做时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1370) [会产生更多黑孔洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1374) [现在我可以问你的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1376) [这杯子是半空的还是半满的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1378) [这杯子是半空的还是半满的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1378) [答案是我们不知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1381) [通过虚拟地改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1385) [相机的视角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1387) [我们不添加新的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1388) [这是因为 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1390) [可以做很多事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1391) [但是不包括将光线投射进杯子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1393) [让我们来观看现场演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1398) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1401) [所以我开始视频展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1412) [并且我想让你关注于这个角落](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1412) [观察发生了什么 当我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1415) [触摸屏幕 我将触碰我的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1417) [前景 你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1418) [深度的迹象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1419) [如果当我移动手机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1421) [你可以看到动态地变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1424) [我可以办到此事的原因是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1426) [从 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1427) [的流也在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1430) [你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1431) [它覆盖在视频上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1433) [所以我们有着每秒 30 帧的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1435) [实况流 并且我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1438) [实况流 并且我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1438) [切换到滤镜视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1440) [然后使所有的黑孔洞都被填满](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1442) [如果我切换到点云视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1446) [我可以动态地改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1447) [场景的视角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1451) [所以即使我直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1454) [看着设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1455) [它看起来像是有人从上面看我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1457) [我们称之为点云的原因是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1461) [如果我放大 你实际](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1462) [可以看到三维空间中的点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1465) [但是在 WWDC 和你们在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1468) [我觉得我必须要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1472) [要让视角回到正常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1473) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1479) [谢谢 让我们看看点云](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1485) [我们如何创造它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1488) [我们从深度图开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1490) [这是一个二维图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1491) [其中深度 Z 是像素坐标 U 和 V 的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1494) [而且我们想要将它在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1498) [而且我们想要将它在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1498) [三维空间 X Y Z 中转为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1500) [新的坐标系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1501) [我们已经有了 Z](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1504) [这是深度图的深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1506) [但是我们想要获得 X 和 Y](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1507) [因此 我们需要借助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1510) [内参矩阵的帮忙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1513) [该矩阵包含焦距](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1515) [和主点信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1517) [例如 我想要得到 X](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1519) [我需要从像素坐标 U 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1521) [减去主元点 X0](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1522) [乘以深度 Z](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1524) [然后除以焦距 f](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1526) [当然 我也需要对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1529) [另一个维度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1530) [做同样的计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1531) [现在可以通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1533) [相机校准数据访问内参矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1536) [事实上 这个操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1539) [是在 TrueDepth 中的每一帧中完成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1544) [这么做的原因是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1547) [视频流和深度流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1549) [来自两个独立的摄像机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1551) [但是由于 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1555) [为我们提供了一个深度图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1557) [所以我们可以将其转为点云](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1558) [所以我们可以将其转为点云](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1558) [并将其重新投影到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1560) [RGB 图像的视角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1563) [所以深度流已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1566) [存在于视频流中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1567) [这样你就能获得 RGBD 数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1570) [谢谢你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1574) [这非常的酷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1576) [现在 这些类型的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1580) [最好在 Metal Graphic Shaders 中完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1581) [并且你可以下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1584) [TrueDepth Streamer 的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1585) [你要关注这两个方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1587) [在 Vertex Shader 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1589) [我们控制点的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1592) [我们将从深度图开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1593) [并将其转换为真实世界](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1595) [坐标或者 X Y Z](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1596) [然后我们可以将它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1599) [与视图矩阵相乘 用来改变视角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1600) [在 Fragment Shader 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1604) [我们将得到 Vertex 中的输出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1609) [但是我们必须检查它是否是真实值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1611) [或者是一个在深度图中的黑孔洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1614) [如果它是一个黑孔洞 它被标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1616) [为零并且我们不知道它的深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1617) [所以我们无法将它转换到 X Y Z 坐标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1619) [所以我们无法将它转换到 X Y Z 坐标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1619) [因此我们要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1621) [抛弃这个点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1622) [如果它是一个真实值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1625) [我们可以采样 RGB 纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1626) [并为片段或者点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1629) [添加颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1631) [我明白这部分有点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1634) [技术性 并且你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1637) [来自不同的专业背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1639) [不用担心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1641) [我们为你提供 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1642) [一款帮助你替换背景的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1645) [让我们看看它的实况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1646) [我可以将自己放在约塞米蒂国家公园](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1661) [我可以把自己放在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1663) [更抽象的东西上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1666) [我甚至可以一路去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1668) [亚利桑那州的羚羊峡谷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1671) [上次花了我 15 个小时到达那里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1673) [现在我只要刷下屏幕就到达](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1674) [节省了我一大笔的油钱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1675) [事实上 这个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1679) [事实上 这个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1679) [甚至可以将你放入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1682) [一个没有人可以听到你的空间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1684) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1691) [所以我们如何实现这些的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1696) [任何时候我们在处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1699) [视频 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1701) [都会根据每帧的情况进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1703) [其它操作 在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1705) [我们必须检测面部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1708) [从深度图建立一个全新的遮罩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1711) [将其平滑并升级为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1713) [RGB 分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1716) [然后我们将这个前景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1717) [遮罩再次放大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1719) [直到低光背景图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1721) [然后我们可以混合或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1723) [组合它们 但是我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1724) [可以做些什么来减少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1726) [一些复杂度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1729) [如果每次我们加载背景图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1731) [我们只将其调整为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1734) [RGB 分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1736) [而不是每帧一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1737) [那么我们就不需要第二次放大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1739) [那么我们就不需要第二次放大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1739) [并且以低分辨率完成混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1741) [这会产生很大的差异](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1742) [所以让我们深入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1746) [这些深度数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1747) [首先我们需要找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1748) [脸部的中心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1750) [在 iOS 中 有很多方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1752) [可以获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1754) [脸部元素组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1756) [你可以使用 Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1758) [的探测器 或者 Vision](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1759) [Framework 但是在此情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1760) [因为我们只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1762) [脸部中间的像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1765) [我们可以使用 AV 元数据对象 类型为脸](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1766) [但它使我们成为 RGB 图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1770) [编码系统的中心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1772) [我们需要将它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1774) [映射到可能不是一样分辨率的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1776) [深度图中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1778) [一旦我们获得了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1781) [人脸深度的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1783) [我们就可以使用它加上 25 厘米特征的边距](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1785) [来确定深度图的阈值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1787) [并创造一个二进制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1790) [掩码 前景为 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1792) [背景为 0](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1794) [事实上 我们可以在这里停下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1796) [我们可以使用这个二进制掩码并创建效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1798) [我们可以使用这个二进制掩码并创建效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1798) [从背景到前景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1801) [的过度将非常的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1802) [尖锐 但我们会在边缘周围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1804) [得到一些差的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1806) [所以我们想要滤波一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1809) [第一阶段将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1811) [使用从背景到前景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1814) [的一些平滑技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1815) [在此情况 用高斯模糊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1816) [高斯模糊的半径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1818) [将决定转换的斜率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1820) [你可以使用该值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1822) [来获得不同的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1825) [另一个我们添加的处理阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1829) [是伽马调节 它允许我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1831) [进一步微调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1833) [从背景到前景的这种转变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1835) [如果我们使用高于 1 的伽玛值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1837) [我们将获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1839) [更窄的前景蒙板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1841) [另一方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1844) [如果我们使用小于 1 的伽马值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1845) [我们将得到更宽的前景蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1847) [也许会有一些光环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1849) [所以你可以通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1852) [组合这两个参数来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1853) [创建不同的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1856) [如果你使用一个大的模糊半径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1857) [如果你使用一个大的模糊半径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1857) [和一个大的伽马值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1861) [你就创建了一种透明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1862) [的过度 让你看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1864) [好像是空间中的全息图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1866) [或者类似地 它可能是在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1869) [水下 你可以调整](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1870) [这些数值来创造不同的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1873) [如果我保持大的半径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1875) [但将伽马值减小到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1878) [很低的值 我就会创造出围绕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1879) [在头上的光环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1882) [所以你可以用这个来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1883) [创造你自己的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1884) [我们如何实现这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1887) [在 Core Image 它非常的简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1891) [直接 我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1893) [把三个滤镜连接在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1894) [首先是用 CIGaussianBlur](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1896) [然后添加 CIGammaAdjustment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1899) [再升级到 RGB 分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1902) [但是 为了最好的实际操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1906) [这里我想强调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1908) [一些小的方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1909) [无论何时 你使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1912) [一个基于高斯模糊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1914) [的卷积操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1915) [最好的做法是从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1917) [clampedtoExtent 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1919) [clampedtoExtent 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1919) [通过向外重复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1921) [边界像素 我们可以确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1923) [图像所有的边界](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1926) [都被滤镜正确地处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1927) [而且 在滤镜之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1931) [和在升级分辨率之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1933) [最好的操作是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1935) [修剪到原来的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1936) [因为这是我们真正](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1938) [关心的图像中的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1940) [在这一点上 我们有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1941) [一个 alpha 前景蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1945) [你可以使用它为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1947) [背景和前景创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1949) [不同的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1950) [就像 Emmanuel 在上半场展示的一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1951) [在 Backdrop 中 我们使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1954) [从 TrueDepth 相机创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1959) [alpha 蒙版将 RGB 流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1961) [与加载的背景图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1963) [融合在一行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1965) [Core Image 代码中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1966) [以创建此背景替换效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1969) [所以这个 TrueDepth 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1973) [给了我们每秒 30 帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1978) [640x480 分辨率的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1979) [640x480 分辨率的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1979) [深度图 并且它已经存在于视频流中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1982) [你可以使用它来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1986) [创建点云和动态地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1989) [改变场景的透视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1990) [或者使用深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1992) [滤镜来创造不同的视频效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1996) [你可以访问网页并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2001) [下载 Jupiter Notebook](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2002) [TrueDepth Streamer 和 Backdrop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2005) [我们希望它能激发你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2009) [在你的 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2011) [加入许多新奇炫酷的视频效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2014) [欢迎你们来 AVCapture 实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2019) [非常感谢你的支持 祝你有美好的一天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2021) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2023)