# Creating Photo and Video Effects Using Depth

## Summary
The TrueDepth camera in the iPhone X streams high-quality depth data in real time allowing you to enhance your photo and video apps in fun and creative ways. Dive deep into the principles and best practices for working with depth data, learn how to use the new Portrait Segmentation API for still images, and see how these techniques can create special effects like background replacement and perspective changes.

## Info
* Media
* WWDC 2018 - Session 503 - iOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=18) [&gt;&gt; Good morning, it's a pleasure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=21) [to be here with you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=23) [My name is Emmanuel and I'm an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=25) [engineer on the Core Image team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=26) [This morning we'll be looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=28) [creating photo and video effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=30) [using depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=31) [Let's get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=32) [With iOS 11 we started](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=37) [delivering portrait depth data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=38) [alongside your portrait still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=40) [images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=41) [During last year's WWDC sessions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=43) [we showed how you can leverage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=45) [that depth data to achieve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=46) [amazing effects, such as force](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=47) [perspective, simulated depth of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=49) [field effects, as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=51) [various foreground and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=52) [background separation effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=53) [This year we're extremely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=56) [excited to announce that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=57) [coming out with a new feature, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=59) [coming out with a new feature, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=59) [portrait matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=61) [So during the first half of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=66) [session we'll be focusing on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=67) [portrait still images and how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=68) [you can apply really great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=69) [effects on them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=71) [During the next half my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=72) [colleague Ron over from video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=74) [engineering will be focusing on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=75) [using a TrueDepth camera to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=77) [achieve real-time video effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=78) [All right, let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=81) [the portrait segmentation API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=84) [So I mentioned a portrait matte,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=87) [so what is a portrait matte?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=88) [A portrait matte is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=89) [segmentation from foreground to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=90) [background and what this means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=92) [precisely is that you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=93) [mask which is 1.0 in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=95) [foreground and 0.0 in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=97) [background and you get soft and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=100) [continuous values in between.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=102) [The portrait matte is of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=107) [extremely high quality and is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=107) [able to preserve fine details,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=109) [such as curl and hair on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=110) [outline of your subject.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=112) [This is amazing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=114) [The matte can be used to achieve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=116) [great many effects, here is just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=119) [great many effects, here is just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=119) [one of them where we essentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=121) [do a foreground and background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=123) [separation by darkening the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=124) [background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=126) [But we're really putting this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=126) [tool into your hands so that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=128) [can create amazing apps and new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=129) [effects and delight your users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=132) [All right, so the portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=135) [effects matte is coming to you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=138) [with iOS 12.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=140) [It is available for both the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=142) [front and the rear facing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=145) [camera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=147) [It is available to you with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=148) [portrait still images and at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=151) [moment only when there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=153) [people in the scene.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=154) [Note that the portrait matte is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=157) [linearly encoded, so it's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=159) [gamma encoded and what you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=161) [is a grayscale buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=162) [And also there's no guarantee](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=164) [that you will be getting a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=166) [portrait matte alongside your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=167) [portrait still images, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=169) [always do get the depth data but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=170) [you need to make sure to test](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=171) [for its existence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=173) [All right, let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=174) [the API and how we can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=177) [load that data in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=178) [load that data in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=178) [So ImageIO provides a low-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=180) [API that allows you to load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=182) [portrait effects matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=184) [So by calling CGImageSourceCopy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=185) [there's a new key it can pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=189) [kCGImageAuxiliaryData](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=190) [TypePortraitEffectsMatte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=192) [And this call returns a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=195) [dictionary containing three main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=196) [pieces of information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=197) [The image data itself as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=198) [CFDataRef, metadata pertaining](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=200) [to the buffer itself as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=204) [CFDictionary, as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=205) [metadata pertaining to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=208) [capture itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=210) [AVFoundation also provides a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=213) [higher-level API that sits on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=215) [top of ImageIO that you can use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=216) [So taking the output from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=218) [CGImageSourceCopy you can feed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=220) [it to the AVPortrait effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=222) [matte class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=223) [And what you get out of it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=228) [very simple it's a CV pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=229) [buffer along with pixel format](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=231) [type so you can use that CV](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=233) [pixel buffer for your further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=234) [processing needs, it's really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=236) [that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=239) [that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=239) [AVFoundation also supports](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=241) [portrait matte delivery at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=242) [capture time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=244) [So starting with your typical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=245) [AVFoundation setup with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=247) [AVCaptureInput, device, as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=248) [as capture session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=251) [The first thing you want to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=252) [is make sure that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=254) [environment supports the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=255) [delivery of the portrait effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=256) [matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=257) [To do this you'll be checking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=258) [for is that data delivery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=260) [supported, as well as is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=261) [portrait effects matte delivery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=263) [supported.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=264) [The reason we have the two there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=265) [both depth and portrait effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=266) [matte is that they come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=267) [together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=268) [You can either opt in to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=269) [only the depth data, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=271) [whenever you want the portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=272) [effects matte you also need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=274) [activate the depth data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=275) [delivery.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=276) [And to activate or to opt in for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=278) [that delivery make sure to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=279) [modify your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=281) [AVCapturePhotoSettings and set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=282) [the isPortraitEffects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=284) [MatteDelivery enabled, as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=285) [as isDepthDataDeliveryEnabled to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=286) [true.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=289) [Then the capture time your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=290) [ddiFinishProcessingPhoto](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=292) [callback will give you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=293) [portrait effects matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=295) [It's really that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=297) [All right Core Image also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=300) [provides you with a way to load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=301) [and save your portrait effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=302) [matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=304) [A new queue was introduced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=305) [auxiliaryPortrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=306) [EffectsMatte which you just pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=307) [your image with contents of URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=309) [and you get a CI image back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=311) [which contains the portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=313) [effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=314) [Core Image also allows you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=319) [save your portrait effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=319) [mattes directly into your files.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=321) [To do this there's a new context](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=324) [option called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=326) [portraitEffectsMatteImage, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=327) [pass in your CI image containing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=329) [the portrait effects matte, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=330) [then you can write your file to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=332) [disk using for example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=334) [writeHEIFRepresntationOfImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=335) [All right so one thing that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=337) [important to note here is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=339) [the three images, so your RGB,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=341) [the depth buffer, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=342) [portrait matte buffer live at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=344) [different resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=347) [So for example, the portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=349) [matte for the rear facing camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=350) [is half-size and the depth data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=351) [is even smaller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=353) [So let's look at the images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=355) [side-by-side in the case of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=356) [rear facing camera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=357) [What this means that in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=359) [What this means that in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=359) [applications you need to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=360) [sure to either down-sample your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=362) [RGB image to the size of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=364) [portrait depth or portrait matte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=366) [or [inaudible] and sample them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=369) [to the size of your RGB image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=371) [So that's all I wanted to talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=373) [about today for the portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=375) [segmentation API and we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=376) [great demo for you to see this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=378) [live in action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=380) [So during this demo I'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=382) [making use of a Jupyter Notebook](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=384) [which is a browser-based,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=386) [real-time interpreter for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=388) [Python.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=392) [And we'll be making use of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=393) [Python bindings for Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=394) [which we'll be introducing later](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=396) [today in a separate session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=397) [So let's start and load an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=405) [that contains portrait depth and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=406) [portrait matte in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=408) [So this is the image we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=410) [to be working with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=410) [The first thing I want to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=412) [you is what the depth data looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=414) [like for that image, so let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=416) [look at the two side-by-side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=417) [So we have the portrait depth on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=419) [So we have the portrait depth on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=419) [the left and the portrait matte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=420) [on the right-hand side and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=422) [can just see how fine the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=423) [details are.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=424) [And we'll do a zoom crop in just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=425) [a minute so that you can better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=427) [appreciate just how high quality](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=429) [it is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=432) [Then next thing we do is we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=433) [resize the images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=435) [As you see the RGB and the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=437) [data vary greatly in size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=438) [So we resize our images and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=442) [let's have a look at them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=443) [side-by-side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=444) [So we have our RGB and our depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=445) [data on the right-hand side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=446) [During the first part of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=447) [demo I'll focus on depth data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=449) [then we'll see how things get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=451) [much, much simpler when you use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=452) [a portrait effects matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=453) [So the effect I'm going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=455) [working on today is depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=457) [thresholding and essentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=459) [what I'll be doing is computing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=461) [a histogram of the gray level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=462) [values in my portrait depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=463) [And I'll be applying a threshold](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=465) [or a clipping point in that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=467) [histogram so that everything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=468) [becomes zero or one depending if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=469) [it's sitting below or above that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=471) [threshold.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=472) [Then we'll be closing holes in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=474) [the image by using morphological](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=475) [closing operations and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=477) [blurring the mask so that we get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=479) [blurring the mask so that we get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=479) [a nice feathered look.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=481) [Let's have a look at this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=483) [action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=485) [So remember all of this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=486) [executed live in the browser](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=487) [using Core Image as a back end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=489) [All right so the first thing I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=491) [want to show you is how changing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=493) [percentile point changes my mask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=495) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=496) [So the higher it is the less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=497) [aggressive I am on clipping the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=499) [foreground.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=500) [So let's pick a value that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=501) [reasonable, maybe something like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=502) [this here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=504) [And what you can see here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=505) [that there are regions or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=506) [islands we call them that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=508) [connected to my foreground and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=509) [there's a bit of the subject](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=511) [here I'd like to take out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=512) [So what I'll do is I'll add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=513) [bit of morphological closing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=515) [Look at how this appears](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=516) [magically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=518) [If I go too far obviously I lose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=518) [my entire subjects, I don't want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=520) [to do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=521) [So let's pick something like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=523) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=523) [What I can do then is change the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=524) [feathering by applying the mask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=526) [on top of it all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=527) [Let's take a look at how the RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=529) [is threshold in back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=530) [This is not the effect we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=531) [coming up it's just to give a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=532) [sense of how the mask is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=534) [applied, so let's keep going.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=535) [So I've chosen a few parameters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=537) [for this thresholding here and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=539) [for this thresholding here and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=539) [this is what I'll be using for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=541) [my foreground.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=542) [Next, I'm applying an effect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=547) [only on my foreground, so in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=549) [this particular case I'm using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=550) [the Core Image photo effect Noir](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=551) [which turns everything grayscale](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=553) [and has a has a bit of contrast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=554) [I'm doing an exposure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=556) [adjustment, as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=557) [desaturating my image slightly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=559) [and augmenting the contrast even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=561) [further.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=562) [Let's take a look at the output.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=563) [This is going to be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=564) [foreground that I'll be using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=565) [and what I want to do here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=567) [leverage the depth data mask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=569) [that I have to composite this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=572) [foreground onto a background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=573) [Let's just generate a background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=576) [which is just a darker version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=577) [of the original image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=579) [We can then composite the two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=580) [together using the Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=583) [filter blendWithMask and we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=585) [the result right there, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=588) [that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=590) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=591) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=592) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=595) [Okay so as you saw that required](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=599) [Okay so as you saw that required](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=599) [a bit of fiddling with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=602) [parameters for clipping, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=602) [smoothing, and then so on and so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=604) [forth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=605) [The portrait effects matte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=606) [enables you to do this without](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=607) [actually doing much process,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=610) [this is really exciting so let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=611) [have a look at this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=612) [So here we're starting with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=613) [another image that also has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=615) [portrait depth and portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=619) [matte information embedded into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=620) [it, so let's look at these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=622) [As I mentioned earlier, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=625) [an extremely high-quality](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=627) [foreground mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=628) [So let's have a look at a crop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=629) [on this hair.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=631) [Look at how fine the detail is,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=633) [this is beautiful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=636) [On the right-hand side here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=637) [the depth that it shows you just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=638) [how coarse the depth data is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=639) [compared to effect matte.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=642) [So we'll do another foreground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=644) [separation effect here similarly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=646) [to what we just did but we used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=647) [a portrait matte instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=649) [using the portrait depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=649) [So let's look at our foreground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=651) [similar as before but in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=653) [case, we'll desaturate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=655) [foreground slightly, add a bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=656) [of contrast, as well as some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=657) [vibrance to the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=659) [vibrance to the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=659) [Now let's generate a background,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=663) [in this case we'll do a disk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=664) [blur which is another Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=666) [filter, as well as bring down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=667) [the exposure so things get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=668) [pretty dark.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=669) [But we still get a bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=670) [background remaining, it's quite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=672) [faint but it's still there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=673) [And again, I use a CI blend with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=675) [mask which is going to do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=677) [compositing for us with the mask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=679) [and we have left and right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=681) [Isn't this beautiful?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=682) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=684) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=688) [All right let's look at another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=689) [great demo which we call Big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=690) [Head.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=692) [So because the portrait matte is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=692) [so fine we can actually do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=696) [things like change the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=697) [[inaudible] size of our subject](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=699) [with respect to the background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=700) [using it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=701) [So let's do just that and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=702) [do it live.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=704) [So here's our input image on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=706) [left here and the portrait matte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=708) [on the right-hand side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=710) [And what I'll be doing here as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=712) [I'll be playing with the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=715) [the subject in my frame notice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=717) [how the subject is getting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=719) [how the subject is getting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=719) [smaller and bigger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=721) [And you can actually you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=723) [give more weight to the subject](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=725) [in your frame, but you can also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=727) [do pretty cool things like now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=729) [that I have this let's say that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=731) [I pick my favorite size here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=732) [You can do things like pseudo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=734) [simulated depth of field here by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=737) [giving more contrast to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=739) [foreground and using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=740) [[inaudible] in the background to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=742) [give more pop to your subject.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=742) [All right let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=746) [just another image to see just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=748) [how easy that is because they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=749) [using the exact same pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=750) [under the hood which is very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=752) [simple just using the portrait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=753) [matte and using it to blur the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=754) [foreground and background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=756) [Again our input image here, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=758) [can change the size of it, make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=760) [it bigger, then apply a bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=762) [contrast to give more focus to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=765) [our subject.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=767) [It's that easy, really exciting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=768) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=770) [All right let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=775) [another demo which we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=777) [Marching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=778) [I'm not even going to try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=779) [I'm not even going to try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=779) [explain what it does, let's just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=781) [take a look at the filter in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=782) [action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=784) [There you go, fun stuff and just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=790) [because we can do it I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=792) [expose how many of these I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=794) [to stitch together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=795) [So going from just a few to you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=796) [really, really pushing that way,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=798) [way too far.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=799) [Really exciting stuff.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=801) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=803) [So that's it for this demo, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=809) [hope you enjoyed this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=811) [So if you'd like to know more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=813) [about using Python bindings for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=815) [Core Image I encourage you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=816) [come to this afternoon's session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=818) [on Core Image Performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=819) [Prototyping in Python.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=820) [That's all for me today, let me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=822) [introduce you to my colleague](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=825) [Ron from video engineering who](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=826) [will be talking about real-time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=828) [video effects with TrueDepth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=829) [Thank you everybody.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=831) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=832) [&gt;&gt; Thank you Emmanuel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=839) [&gt;&gt; Thank you Emmanuel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=839) [Great photo effects but what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=841) [about video.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=842) [My name is Ron Sokolovsky and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=844) [am from video engineering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=846) [In this part we are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=848) [leverage the TrueDepth's camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=851) [to create similar effects with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=853) [real-time video, like for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=855) [example this background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=857) [replacement app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=859) [In order to create such effects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=861) [we are going to deep dive into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=864) [the stream coming from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=866) [TrueDepth camera, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=867) [characteristics, best practices,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=869) [and challenges.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=871) [We are also going to show you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=872) [how to work with point clouds, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=875) [completely different way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=876) [process and render rich depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=878) [information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=880) [And that background replacement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=881) [app we're calling it Backdrop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=882) [and we'll show you how to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=884) [it step-by-step.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=885) [But first things first, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=888) [stream for the TrueDepth's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=890) [camera is made of frames, each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=891) [frame is a depth map, a 2-D](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=893) [image in which each pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=895) [contains the depth information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=897) [or the distance to the scene in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=899) [or the distance to the scene in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=899) [that direction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=900) [We've chosen a specific coloring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=905) [scheme, closed pixels are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=906) [colored in red while fire red](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=908) [pixels are colored in blue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=911) [In between them there is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=912) [colorful spectrum so you can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=914) [the texture of the depth map.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=916) [There are also black pixels,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=920) [those are holes in a depth map.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=922) [For those pixels we have no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=924) [information what is the depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=925) [We are releasing today a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=928) [tool, a sample app for you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=930) [explore this stream and we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=932) [it TrueDepth Streamer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=934) [You can slide between the video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=937) [stream and the TrueDepth stream.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=940) [Now because the TrueDepth camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=947) [has active illumination even in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=949) [complete darkness while the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=951) [video is pitch black it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=953) [business as usual for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=956) [TrueDepth camera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=958) [So now you see me and now you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=961) [don't.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=964) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=965) [So how do you add the stream](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=969) [from the TrueDepth camera into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=971) [your application?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=972) [Well I'm glad you asked.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=974) [The first thing you need to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=976) [is to discover the built-in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=977) [TrueDepth camera and then you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=979) [initialize the device capture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=982) [input.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=983) [And you add the depth data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=984) [output into your session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=987) [At this point you're good to go,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=989) [you can start the session and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=991) [you will have the TrueDepth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=992) [stream with your session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=993) [This stream can come in two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=997) [forms of data, disparity or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=999) [depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1001) [Now disparity is the inverse of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1002) [depth and vice versa, so which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1004) [one should you choose?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1006) [Well disparity usually yields](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1008) [better results, especially for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1011) [machine learning applications](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1013) [but the depth data has more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1015) [meaning in terms of real-world](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1016) [measurements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1018) [Know that if you work with depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1020) [that the depth error goes with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1021) [the depth squared.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1025) [That means that an object at 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1026) [meter would have four times the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1028) [depth accuracy as an object at 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1029) [meters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1031) [We have two streams, video and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1036) [depth, and they don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1038) [necessarily share the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1039) [resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1040) [The native resolution of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1041) [TrueDepth's camera is VGA or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1043) [640x480 and that's what you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1044) [get if you choose a video preset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1047) [of an aspect racial of 4:3.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1050) [If however you choose an aspect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1053) [ratio of 16x9 you'll get a depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1055) [map of 640x360.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1057) [In both cases the depth map will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1060) [cover the entire field of view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1062) [of the RGB image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1065) [Now we are talking about video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1066) [applications, so we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1069) [crunching a lot of numbers very,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1071) [very fast and that could create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1072) [system pressure over time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1075) [So you can test your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1077) [and gauge the system pressure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1079) [and gauge the system pressure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1079) [level which goes from nominal to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1081) [fair, serious, critical, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1084) [then shutdown.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1086) [And the responsibility is in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1087) [your hands because the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1088) [will let you go all the way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1091) [shutdown but when it does it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1092) [bye-bye every capture device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1095) [Another thing you can do is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1097) [adopt a degradation scheme, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1102) [the pressure level gets serious](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1104) [you can reduce the frame rate to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1105) [15 frames per second or you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1107) [choose a more elaborate scheme](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1109) [with gentle degradation going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1111) [from 30, 24, 20 and 15 frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1113) [per second anytime the pressure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1117) [level increases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1119) [So we have holes in the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1123) [map what can we do about it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1125) [Well, in fact you could get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1127) [stream already filtered for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1129) [There is a parameter called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1132) [isFilteringEnabled and it's'](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1133) [defaulted to true, which means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1135) [you get a filtered depth map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1137) [smooth, spatially and temporally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1139) [smooth, spatially and temporally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1139) [and the holes are filled from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1141) [the RGB image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1143) [This is especially useful for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1145) [photography and segmentation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1147) [applications because you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1148) [every time you query a pixel you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1150) [get the depth's value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1152) [In TrueDepth Streamer you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1153) [switch to the filter stream and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1157) [see that it is smoother and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1159) [holes are filled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1161) [So this is great, but it is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1163) [applicable to 100% of the use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1167) [cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1169) [If you're working with point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1170) [clouds or any type of real-world](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1171) [measurements you're better off](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1174) [staying with the raw data which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1176) [holds the highest fidelity.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1178) [If you do you will have holes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1180) [you will have pixels marked as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1182) [zero, it does not mean that they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1184) [are the distance of zero meters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1186) [from the camera it just means we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1188) [have no information about them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1190) [Therefore, you should watch out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1193) [for operations like averaging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1195) [and downsampling because you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1196) [don't want to mix those real](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1197) [values with those zeros.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1199) [values with those zeros.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1199) [But why do we even get holes?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1203) [Well the TrueDepth camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1205) [detects objects up to a distance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1209) [of about 5 meters, but not all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1211) [materials are made the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1214) [Some materials have low](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1215) [reflectivity.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1216) [they absorb most of the lights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1217) [For example this extreme](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1221) [scenario is a very low](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1223) [reflective fabric watch what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1226) [happens when we switch to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1227) [depth map and I walk away from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1229) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1233) [Even though there are objects in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1233) [the scene with larger distance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1235) [we see holes forming on this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1237) [fabric because it's absorbing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1239) [most of the light.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1242) [If we switch to the filtered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1244) [stream and repeat the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1245) [motion those holes are filled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1247) [But it's not only about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1249) [amount of light reflected back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1253) [it's also about the direction in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1255) [which it is reflected to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1256) [Some materials are specular or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1259) [Some materials are specular or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1259) [shiny and they are very picky](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1261) [and choosy in which direction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1262) [they send back the light.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1264) [An extreme scenario would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1265) [this display, you can watch the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1268) [video stream to see the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1271) [reflection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1272) [And when we switch to the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1274) [map holes are forming depending](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1275) [on the angle between the device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1278) [and the screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1279) [And if we switch to the filtered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1281) [stream those holes are filled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1283) [but with less fidelity.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1285) [Another challenging scenario is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1291) [outdoor, typically in an outdoor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1292) [scene the background is very far](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1295) [away so we don't expect to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1296) [any depth on the background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1298) [Also, the sun acts as an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1300) [aggressor to the active](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1302) [illumination.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1304) [To demonstrate that I went](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1305) [outside on a very sunny](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1308) [afternoon, positioned myself](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1310) [against the sun.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1311) [And when we switch to the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1313) [map you can see there's no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1314) [depths on the background and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1315) [get some holes around the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1318) [frames, specifically in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1319) [frames, specifically in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1319) [case the hair.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1321) [But still most of the depth on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1323) [the foreground is intact and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1325) [very useful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1327) [One final point I want to cover](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1328) [for getting holes is the fact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1332) [that from the perspective of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1334) [TrueDepth camera some of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1335) [light projected hits an object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1337) [on the way back so we get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1339) [shadows from the parallax](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1341) [between the projector and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1343) [camera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1345) [You can see an example on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1346) [right side of this mug, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1347) [something is different here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1350) [This is not a depth map so why](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1352) [do we even get holes?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1354) [Well in TrueDepth Streamer you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1357) [can switch from 2-D mode into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1358) [3-D mode, which gives us a point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1361) [cloud view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1363) [With point clouds we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1364) [dynamically change the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1365) [perspective of the scene](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1367) [creating even more holes when we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1370) [do so.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1374) [And now I can ask you is this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1376) [mug half empty or half full and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1378) [mug half empty or half full and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1378) [the answer is we have no idea.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1381) [By virtually changing the point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1385) [of view of the camera we don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1387) [add new information and that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1388) [because the TrueDepth camera can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1390) [do many things, but bending](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1391) [light into the mug not one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1393) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1397) [Let's see this live.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1398) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1401) [So I'm starting with a video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1412) [view and I want you to look in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1412) [this corner.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1414) [Watch what happens when I touch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1415) [the screen, I will touch my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1417) [forehead, you can see an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1418) [indication of the depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1419) [And if I move the phone you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1421) [see the [inaudible] changing and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1424) [the reason I can do so is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1426) [because we have the stream from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1427) [the TrueDepth camera running as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1430) [well and you can see that it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1431) [overlaid on the video.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1433) [So we have this livestream 30](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1435) [frames per second and we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1438) [frames per second and we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1438) [switch to the filtered stream](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1440) [and then all the holes are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1442) [filled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1445) [If I switch to the point cloud](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1446) [view I can dynamically change](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1447) [the point of view to the scene.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1451) [So even though I'm looking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1454) [directly to the device it looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1455) [as if somebody's watching me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1457) [from up above.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1459) [Now the reason we call this a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1461) [point cloud is if I zoom in you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1462) [can actually see the points in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1465) [3-D space.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1467) [But being here with you in WWDC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1468) [I feel like I have to pinch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1472) [myself just to get things back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1473) [in perspective.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1475) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1479) [Thank you so that brings us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1485) [point clouds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1487) [How do we create them?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1488) [We're starting from a depth map,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1490) [a 2-D image in which the depth Z](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1491) [is a function of the pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1494) [coordinates U and V.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1495) [And we want to transform it to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1498) [And we want to transform it to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1498) [new coordinate system in 3-D](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1500) [space, X, Y, Z.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1501) [Now we already have Z right,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1504) [that's the depth from the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1506) [map but we want to get X and Y.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1507) [For that we need to get the help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1510) [from the Intrinsics Matrix which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1513) [holds information for the focal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1515) [lengths and principle point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1517) [If for example I want to get X I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1519) [need to start with the pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1521) [coordinate U, subtract the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1522) [principle point, multiply by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1524) [depth, and divide by the focal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1526) [lengths.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1528) [And naturally I have to do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1529) [same thing for the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1530) [dimension as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1531) [Now this Intrinsics Matrix is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1533) [accessible through the camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1536) [calibration data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1538) [In fact, this operation is done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1539) [in every frame of the TrueDepth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1544) [stream.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1546) [The reason for that is that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1547) [video stream and the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1549) [stream are coming from two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1551) [separate cameras.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1553) [But because the TrueDepth camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1555) [gives us a depth map we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1557) [transform it into a point cloud](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1558) [transform it into a point cloud](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1558) [and re-project it to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1560) [perspective of the RGB image so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1563) [the depth stream is already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1566) [registered on the video stream](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1567) [for you and you get RGBD data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1570) [Now, thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1574) [Yeah, it's pretty cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1576) [Now these types of operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1580) [are best done in metal graphic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1581) [shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1583) [And you can download the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1584) [for TrueDepth Streamer and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1585) [want to focus on two areas.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1587) [In the vertex shader we control](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1589) [the location of the points,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1592) [we'll start with the depth map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1593) [and transform it to real-world](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1595) [coordinates or X, Y, Z.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1596) [Then we can multiply it with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1599) [view matrix to change the point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1600) [of view to the scene.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1603) [In the fragment shader we get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1604) [the output of the vertex, but we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1609) [have to see if it's a real value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1611) [or a hole in the depth map.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1614) [If it's a hole and it's marked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1616) [as zero we don't know its depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1617) [so we cannot transform it to X,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1619) [so we cannot transform it to X,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1619) [Y, Z and we would need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1621) [discard this point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1622) [If it is a real value we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1625) [sample the RGB texture and add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1626) [color to the fragment or point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1629) [in this case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1631) [So I understand this part was a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1634) [bit technical and a lot of you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1637) [come from different backgrounds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1639) [Have no fear we have just the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1641) [app for you, an app to replace](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1642) [your background, let's see it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1645) [live.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1646) [Let's see it live.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1658) [So I can put myself in Yosemite,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1661) [I can swipe down put myself in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1663) [something more abstract.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1666) [I can even go all the way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1668) [Antelope Canyon, Arizona, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1671) [took me 15 hours to get there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1673) [last time, I could have just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1674) [swiped down, saved a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1675) [money on gas.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1677) [In fact, this application can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1679) [In fact, this application can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1679) [even put you in space where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1682) [nobody can hear you stream.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1684) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1691) [So how do we create that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1696) [Anytime we're dealing with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1699) [video application there's other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1701) [things that are going on a per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1703) [frame basis, in this case we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1705) [have to detect a face, create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1708) [brand-new mask from the depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1711) [map, smooth and upscale it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1713) [the RGB resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1716) [And then we take this foreground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1717) [mask and upscale it again to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1719) [low-light background image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1721) [And then we can blend or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1723) [[inaudible] them, but there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1724) [something we can do to reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1726) [some of the complexity.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1729) [If anytime we load a background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1731) [image we resize it to the RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1734) [resolution just once not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1736) [per-frame, then we don't need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1737) [that second upscale and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1739) [that second upscale and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1739) [blending is done at low](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1741) [resolution which makes a big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1742) [difference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1744) [So let's deep dive into those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1746) [depths.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1747) [The first thing we need is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1748) [find the center of the face.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1750) [And in iOS there are actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1752) [quite a few ways you can get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1754) [face metadata.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1756) [You can use a Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1758) [detector or the Vision](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1759) [Framework, but in this case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1760) [since we just need the pixel at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1762) [the center of the face we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1765) [use AV meta data object type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1766) [face.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1768) [But it gives us the center in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1770) [the coding system of the RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1772) [image and we need to map it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1774) [the depth map which might not be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1776) [in the same resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1778) [Once we have the value of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1781) [depth of the face we can use it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1783) [plus a margin of characteristic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1785) [25 centimeters to threshold the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1787) [depth map and create a binary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1790) [mask, foreground is one,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1792) [background is zero.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1794) [In fact, we can stop here, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1796) [can use this binary mask and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1798) [can use this binary mask and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1798) [create the effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1800) [The transition from background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1801) [to foreground will be very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1802) [sharp, but we'll get some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1804) [fidgeting around the edges.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1806) [So we want to filter it a bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1809) [The first stage will be to apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1811) [some smoothing from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1814) [background to the foreground, in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1815) [this case Gaussian Blurring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1816) [The radius of Gaussian Blurring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1818) [will determine the slope of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1820) [transition and you can play with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1822) [the value to get different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1825) [effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1827) [Another processing stage we add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1829) [is gamma adjustments, it allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1831) [us to further fine-tune this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1833) [transition from background to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1835) [foreground.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1836) [If we use a gamma value which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1837) [higher than one we'll get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1839) [narrower foreground mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1841) [On the other hand, if we use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1844) [gamma value that is smaller than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1845) [one we'll get a wider foreground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1847) [mask and maybe some aura.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1849) [So you can create different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1852) [effects by combining those two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1853) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1856) [If you use a large blur radius](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1857) [If you use a large blur radius](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1857) [and a large gamma value you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1861) [create this transparent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1862) [transition that makes you seem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1864) [as if you're a hologram in space](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1866) [or similarly it could be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1869) [underwater and you can play with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1870) [the values to create different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1873) [effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1875) [If I keep the radius high and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1875) [reduce the gamma value to a very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1878) [low number I create this halo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1879) [around my head.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1882) [So you can play with this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1883) [create your own effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1884) [How do we implement this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1887) [In Core Image it is very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1891) [straightforward, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1893) [concatenate three filters in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1894) [row.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1895) [We start with a Gaussian Blur,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1896) [we add the gamma adjustment, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1899) [we upscale to the RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1902) [resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1904) [But there are a couple of small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1906) [points I want to emphasize as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1908) [best practices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1909) [Anytime you work with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1912) [convolutional based operation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1914) [such as Gaussian Blurring the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1915) [best practice will be to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1917) [by clamping to extent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1919) [by clamping to extent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1919) [By repeating the border pixels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1921) [outwards we can make sure all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1923) [the borders of the image are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1926) [handled correctly by the filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1927) [Moreover, after the filtering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1931) [and just before the upscaling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1933) [the best practice will be to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1935) [crop back to the original extent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1936) [because that's the part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1938) [image we really care about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1940) [At this point we have an alpha](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1941) [matte of the foreground and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1945) [can use it to create different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1947) [kinds of effects for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1949) [background and the foreground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1950) [just like Emmanuel showed in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1951) [first half.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1953) [In Backdrop, we blend the RGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1954) [stream with a loaded background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1959) [image in a single line of Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1961) [Image code using the alpha matte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1963) [we created from the TrueDepth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1965) [camera to create this background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1966) [replacement effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1969) [So the TrueDepth camera gives us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1973) [a resolution of depth map of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1978) [640x480 coming at you 30 frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1979) [640x480 coming at you 30 frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1979) [a second, already registered to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1982) [the video stream.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1985) [You can use it to create point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1986) [clouds and dynamically change](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1989) [the perspective of the scene or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1990) [use the filter depth to create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1992) [different kinds of video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1996) [effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=1997) [You can go to the webpage and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2001) [download the Jupiter Notebook](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2002) [TrueDepth Streamer and Backdrop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2005) [and we hope it inspires you as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2009) [starting point to many new cool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2011) [video effects to create in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2014) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2017) [Come say hi at the AVCapture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2019) [lab, thank you so much for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2021) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2022) [Have a great day.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2022) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/503/?time=2023)