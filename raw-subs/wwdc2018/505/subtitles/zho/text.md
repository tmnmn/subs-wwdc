# Integrating with Photos on macOS

## Summary
Make your apps even better through improved integration with Photos on macOS. We'll dive deep into the Photos Project Extension API that was introduced in macOS High Sierra and update you on what's new. You'll also learn best practices for handling file promises and image URLs to better handle drag & drop from Photos to your app.

## Info
* Media
* WWDC 2018 - Session 505 - macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/

## Text
 [（macOS上的Photos集成
演讲505）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=17) [早上好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=22) [早上好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=25) [我的名字叫Eric Hanson](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=26) [我是Photos平台的技术传播者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=27) [我今天会和Photos工程团队的
三位同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=31) [来给你们介绍一下macOS上
你的app与Photos的集成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=34) [我们要介绍两个关键问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=42) [第一个是对于我们去年在macOS
High Sierra上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=46) [所介绍的
Photos项目扩展API的更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=49) [然后我们要介绍的是利用拖拽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=53) [来跟你的app交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=59) [来跟你的app交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=59) [但是首先让我们来谈一下
Photo项目扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=61) [当iPhoto于2002年
首次发布的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=67) [Apple成为了首批允许人们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=72) [制作漂亮的书 然后是卡片与日历的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=75) [公司之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=80) [而至今已有超过七千万的
照片书、卡片与日历](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=84) [是使用iPhoto
和Photos制作出来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=91) [但是与此同时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=97) [十六年的时间 我们一直在关注着
这个蓬勃发展的市场](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=98) [用户现在已经有了很广泛的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=104) [利用他们的物理与数码照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=106) [来创建所有这些内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=110) [正是因为遵照这个很棒的生态系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=114) [才能让我们在去年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=118) [才能让我们在去年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=118) [推出了基于这个生态系统的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=120) [Photo项目扩展API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=123) [我们已经看到一些不错的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=128) [例如 Mimeo Photos](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=131) [它可以让你创建
高质量的书、卡片和日历](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=134) [Whitewall可让你从照片中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=140) [创建画廊级别的装裱印刷品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=144) [我们还有Wix.com
这样的数字业务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=146) [可以让你非常轻松地创建出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=149) [可以跟朋友和家人分享的网络相册](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=152) [我们现在还看到了一些新的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=156) [就像是这个叫Motif的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=159) [它是一个直接集成到Photos的
全新的本地化体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=162) [它会在今年夏天推出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=168) [所有的这些选择
还有这个生态系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=173) [对于你们开发者来说是个巨大的机遇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=177) [对于你们开发者来说是个巨大的机遇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=177) [你可以利用这些丰富的元数据
上下文环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=182) [以及我们传到你扩展中的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=186) [来构建内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=190) [在macOS上
使用这个全栈的本地框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=191) [来创造一些新奇的很棒的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=195) [让全世界的用户为之倾倒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=199) [正是因为这个原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=205) [Apple宣布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=207) [我们会将整个打印产品业务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=209) [转移到macOS Mojave
这个生态系统上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=212) [用户可以使用项目扩展来创建书](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=217) [卡片以及日历等所有这些内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=221) [所有这些你利用扩展创造出的
让我们大吃一惊的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=224) [利用这个生态系统 我们给大家
构建出了更好的Photos体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=229) [让我们来介绍下
扩展API中的新特性吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=236) [首先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=240) [就是UI的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=243) [现在我们会获取你扩展的UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=245) [并将其直接集成到
Photos app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=247) [而你所熟悉的侧边栏一直都有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=251) [用户可以在你的扩展中创建一个项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=255) [并且能从侧边栏抓取内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=259) [直接拖拽到你的项目中就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=261) [他们也可以弹出照片搜索](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=264) [搜索他们想要用的照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=268) [然后复制并粘贴到在做的项目中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=270) [我们还可以让你直接集成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=276) [Photos强大的编辑工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=279) [例如 你可以让用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=284) [只需双击照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=287) [就可以对其进行编辑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=291) [你现在用个一行的API就能实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=292) [你可以调用Photos的编辑器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=295) [我们在照片载入的时候
将编辑会话推入了视图栈的顶端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=299) [我们在照片载入的时候
将编辑会话推入了视图栈的顶端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=299) [让用户来进行想做的调整](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=304) [我们还让他们可以访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=307) [项目中用到的所有其他资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=308) [当他们的编辑会话结束时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=312) [只需要点击完成按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=314) [他们就可以回到正在做的项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=316) [你会得到库有变化的通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=320) [你可以对其进行反应
并相应地更新你的UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=323) [但是如果很难找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=329) [app和你创建的扩展的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=332) [那一切都没有意义了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=334) [因此我们要进而介绍下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=336) [你们app的可见性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=338) [Photos app可以通过
创建菜单连接到Mac App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=342) [而现在有了macOS Mojave上
全新的Mac App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=347) [我们实际上可以直接连接到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=351) [一个致力于扩展体验的故事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=355) [这是个一直会存在的故事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=360) [我们可以对其进行更新
在新的体验中起到重要作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=362) [并且教用户用
新的方式来处理他们的照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=366) [当用户从这个故事中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=371) [下载了一个app时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=374) [他们下载的是包含了扩展的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=376) [按原来的经验
这可能会让你们开发者要花时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=380) [教用户如何在你的独立app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=385) [使用Photos的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=387) [但我们觉得可以做得更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=390) [如果用户下载了app以后
马上就能获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=392) [Photos中的项目
创建体验不是很好吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=396) [我们正在使其成为现实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=399) [我们可以在Photos中
加入定制的URL方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=401) [你可以传入你的扩展标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=404) [或是传入一个分类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=408) [Photos会从后台到前台来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=412) [并且可以选择想显示给用户的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=416) [并且可以选择想显示给用户的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=416) [所以它们在首次启动的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=421) [就马上被带入创建的体验了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=425) [我们觉得这很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=426) [最后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=431) [当他们创建项目的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=432) [我们想让项目运行在适合的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=435) [就在用户的Photo库中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=438) [我们实际上是这么实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=442) [我们在Photos中有项目总览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=443) [可以让用户看到他们创建的所有内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=446) [而且现在我们允许该扩展
为每个项目创建一个定制的预览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=448) [该预览可以呈现出项目是什么样子的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=453) [以这个照片为例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=457) [用户不仅能通过双击其中的一个项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=461) [来返回到你的扩展并继续工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=464) [还可以从其他项目来创建项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=467) [他们可以通过选择项目
进入创建菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=470) [来从中创建一些新的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=473) [我们会尽我们所能的将所有东西传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=475) [来帮助你的扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=477) [让你以良好的势头开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=479) [让你以良好的势头开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=479) [但是在Apple项目中
我们会做得更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=482) [确实是的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=486) [我们逐张照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=488) [逐页地发给你
就以它们所呈现的布局那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=491) [以便可以让你的扩展
可以从Apple项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=494) [创建一个完全的转换体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=498) [我们强烈建议你们这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=500) [这就是从UI层面高度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=505) [来介绍的新内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=508) [但我还想更深入介绍一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=509) [我想请我的同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=511) [Photos工程团队的Tobias Conradi
来给你们介绍一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=513) [Tobias](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=516) [早上好 谢谢 Eric](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=522) [你们好 我叫
Tobias Conradi](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=524) [我是Photos团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=526) [我会详细介绍一些我们对于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=527) [Photos项目扩展所做的修改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=530) [首先就是创建菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=532) [当我们首次在macOS
High Sierra上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=535) [引入Photos项目扩展时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=537) [我们将所有扩展以平面列表的形式
放到了创建菜单里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=539) [我们将所有扩展以平面列表的形式
放到了创建菜单里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=539) [但结果是 有时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=543) [仅凭扩展的名字是很难猜到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=545) [你要创建的哪种项目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=548) [我们想改善用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=551) [所以我们引入了项目分类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=553) [macOS Mojave中
新的创建菜单看起来是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=556) [我们在创建菜单中有分类和子菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=560) [我们今年引入的分类有书籍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=565) [日历、卡片、墙面装饰
印刷品、幻灯片展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=568) [还有不适用于这些分类扩展的
其他分类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=572) [现在用户就可以带着
明确的目的来到菜单中了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=577) [例如 我想要创建墙面装饰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=580) [用户可以看到
支持该类项目的所有扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=584) [那么扩展是如何显示在分类中的呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=589) [我们在扩展Info.plist的
扩展属性字典中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=592) [有一个新的键值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=596) [它叫做
PHProjectCategory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=598) [该键的值就是
所支持的项目分类的列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=600) [在本例中就是墙面装饰和其他](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=605) [用户从扩展中所看到的下一个内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=610) [就是类型选取表单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=612) [你给我们提供此数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=614) [我们就会显示
你所提供的项目类型描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=616) [我们去年介绍的那个API的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=623) [就是它有点难以提供最新的价格信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=626) [或是当前的报价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=631) [这就是为什么我们引入了
新改进的 允许动态更新的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=632) [它看起来是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=638) [除了动态更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=640) [我们现在还支持在表单底部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=642) [显示一个定制的页脚文本信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=646) [如果你需要的话
可以在那里显示法律信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=647) [在API层面上
新的动态API看起来是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=653) [我们的新方法是在
projectExtensionsController协议中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=659) [我们的新方法是在
projectExtensionsController协议中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=659) [我们请求了一个数据资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=663) [而不是产品类型描述的列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=665) [并且从扩展被选中的菜单中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=667) [传入分类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=672) [还有一个使其无效化的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=673) [在你返回数据源后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=675) [我们会为项目类型描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=677) [以及可选的页脚文本信息
来请求该数据源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=681) [每当你的扩展需要将返回的信息
无效化处理时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=683) [你就可以用这个无效化器
来让项目类型描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=687) [或是页脚文本信息变得无效
而且在需要的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=690) [Photos会从数据源
重新获取数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=693) [并且在UI中显示最新的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=696) [下一个主题是
projectInfo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=702) [projectInfo
是关于该项目内容的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=705) [结构化补充信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=707) [它会结构化到section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=710) [以及反映了创造层级的
sectionContents中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=713) [元素有着基本的布局暗示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=717) [元素有着基本的布局暗示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=717) [还有资源的权重和分数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=721) [而且资源中还包含了资源的
意向区域中的重要区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=725) [这就是对于projectInfo
的一个大概介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=731) [欲了解
projectInfo更多内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=734) [我强烈建议你们看下去年的演讲
“Photos API新特性”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=736) [projectInfo在项目
开始时就在你的扩展中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=744) [每当用户将新的资源加入到项目中时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=750) [projectInfo就会过期
因为它是个静态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=755) [我们想引入新的API
来解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=758) [新的API位于
projectExtensionsContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=761) [它会用来获取更新的项目信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=763) [以及项目当前的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=766) [让我们以此为例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=768) [我们会在项目创建时
将projectInfo给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=769) [然后用户就可以向项目
加入更多的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=773) [你可以调用
updatedProjectInfo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=775) [还有projectInfo
我们会更新所有现有的分区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=778) [还有projectInfo
我们会更新所有现有的分区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=778) [并且为添加的资源附上一个新的分区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=783) [如果用户添加了更多的资源
你可以进行同样的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=786) [传入项目信息
我们会更新现有的分区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=789) [并且为添加的资源附上一个新的分区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=792) [让我们更深入地介绍
projectInfo中一个元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=797) [意向区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=800) [意向区域
表明了资源中重要的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=802) [例如 人们的脸](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=806) [如果相同的人出现在了多张图片中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=808) [对于相同人的
意向区域标识符就是相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=812) [让我们暂时关注于B这个人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=818) [除了意向区域标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=821) [我们还有意向区域的权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=824) [表明了项目中意向区域的重要性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=828) [如果你想决定要选
哪张照片作为某个人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=835) [或是意向区域的话
用API来实现的话有点困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=839) [或是意向区域的话
用API来实现的话有点困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=839) [这就是为什么我们
加入了一个新的质量分数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=844) [它代表了资源中意向区域的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=846) [在左手边 B有点失焦了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=852) [而且不在图片的中间
在右手边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=856) [他对上焦了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=859) [这就是为什么右手边的质量分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=860) [比左手边更高一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=863) [在API层面上
它看起来是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=867) [我们有这个替换的权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=869) [也就是在项目环境中
意向区域的重要性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=870) [然后就是资源中的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=875) [我想给你们做一个快速的演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=879) [看看你可以如何利用
你扩展中的意向区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=882) [来改善体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=884) [并在监听库通知
在资源或是项目产生变化的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=886) [会获得通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=890) [而且还使用了一个新的
updateProjectInfo API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=892) [好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=903) [我创建了一个幻灯片显示扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=905) [为了给你们看看它是什么样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=909) [我在相册中选取了一些资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=911) [并且会利用该扩展
来创建一个新的项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=914) [这个扩展有两个视图
一个是概览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=920) [它包含了项目中的所有资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=922) [另一个是播放该幻灯片
显示的回放程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=925) [你可能会注意到 该幻灯片显示
一直会聚焦于图片的中心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=931) [这是有点无聊的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=936) [我想用意向区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=938) [来聚焦于照片中有意思的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=940) [让我们切换到Xcode来修复一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=944) [在我的资源模型里
有preferredZoomRect的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=950) [它总会返回相同的值
这是有点无聊的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=954) [让我们在代码中替换一下它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=958) [让我们在代码中替换一下它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=958) [我要做的是从资源元素中
获取所有的意向区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=966) [且按照它们的权重和质量来进行排序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=970) [从意向区域的排好序的列表中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=974) [我们想获得最后的元素并返回它的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=978) [如果我们现在重新运行这个扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=982) [我们就会一直聚焦于
资源中最重要的意向区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=998) [我觉得这样看起来要好得多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1004) [接下来我想向项目中再多加一些资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1008) [我从侧边栏抓取了一个相册
并将它拖拽到扩展上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1011) [在指针附近有个加号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1015) [看起来就像是
扩展接受了这次拖拽操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1017) [我松开鼠标按键的话
什么都没有发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1020) [资源会被加入到项目中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1022) [但是我的扩展并没有列出变化通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1024) [而且也不知道加入到项目中的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1028) [让我们切换回Xcode
来修复一下吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1032) [在我的projectViewController中
我有begin和resumeProject方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1036) [它们是projectExtensionController
协议的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1041) [这里我想要注册观察到的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1045) [我们在两个方法中有着相同的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1051) [首先我们获得了
感兴趣的PhotoKit对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1056) [我们对添加到项目中的资源感兴趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1059) [所以我们获取了一份项目中
所有资源的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1063) [然后我们注册了库的资源变化观察者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1067) [在项目结束的时候 我们再取消注册](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1071) [由于Xcode提示我们
没有实现这个协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1076) [我们要将变化观察者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1079) [我们要将变化观察者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1079) [加到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1081) [下面这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1082) [我们实现了
photoLibraryDidChange](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1089) [PhotoLibraryDidChange](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1092) [会在照片库中有内容
发生变化的时候被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1094) [我们会以方法参数的形式
获得changeInstance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1098) [我们可以请求
changeInstance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1103) [获得我们感兴趣的
changeDetails的一个对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1105) [我们对项目中
fetchAllAssets的变化感兴趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1108) [所以我们要传入
fetchResult](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1113) [如果返回了
changeDetails](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1115) [我们会利用fetchResultsAfterChanges
来更新本地缓存的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1118) [并获得projectExtensionContext
以及调用updatedProjectInfo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1125) [传入我们的项目信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1130) [在updatedProjectInfo
被返回给我们之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1133) [我们可以调用相同的设置代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1136) [但是你可以实现更复杂的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1138) [但是你可以实现更复杂的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1138) [让我们重新运行下这个项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1142) [好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1159) [我现在就可以从侧边栏拖拽相册](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1163) [把它放到扩展
并且将资源添加到项目中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1166) [而且扩展会监听照片库的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1172) [在其变化以及我们更新了
项目信息的时候获得通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1176) [正如你们所见 只要几步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1188) [我就可以通过使用
projectInfo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1191) [及projectInfo中
意向区域改进扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1196) [还可以注册资源变化观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1198) [还可以注册资源变化观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1198) [在照片库有任何变化的时候获得通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1202) [并更新我的项目信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1205) [我想强调集成中的两个内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1210) [Photos会默认处理
从Photos到扩展中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1213) [资源的复制和粘贴](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1217) [但是如果你的扩展也想实现粘贴区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1220) [也就是你在处理文字之类的
内容时所要做的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1223) [我们需要你的帮助以了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1226) [你的扩展应该什么时候处理粘贴区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1228) [以及Photos
应该什么时候处理粘贴区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1230) [因此如果菜单操作是粘贴
请实现validateMenuItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1233) [检查你的扩展是否可以
处理当前剪切板中的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1239) [如果不能 就返回假
我们就会将其作为Photos处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1243) [否则的话 如果你要处理它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1247) [就返回真 那么你的
Photos就会进行粘贴操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1249) [对于拖拽的操作也是类似的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1254) [Photos会默认处理
PhotoKit对象到扩展的拖拽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1256) [Photos会默认处理
PhotoKit对象到扩展的拖拽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1256) [但是如果你注册了错误类型的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1262) [你的扩展可能会受到干扰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1265) [所以请留意注册到
你扩展的内容的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1267) [只注册扩展内部拖拽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1271) [或是你确实想处理的拖拽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1274) [请在使用的时候
特别留意WKWebView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1276) [因为它默认会注册一堆拖拽类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1280) [这就是关于照片项目扩展的所有内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1286) [现在让我将讲台交给我的同事
Sanaa 让她来介绍一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1288) [以第三方app来
与Photos进行交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1293) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1296) [谢谢 Tobias](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1300) [大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1302) [我叫Sanaa](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1303) [我是一名Photos的工程师
今天我会和我的同事Joachim](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1304) [来介绍一些最佳的实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1307) [有关我们利用拖拽
在macOS的app间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1310) [接收和提供图片或是视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1312) [拖拽是将物品从一处移动到另一处的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1317) [拖拽是将物品从一处移动到另一处的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1317) [最直观和简单的方式之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1320) [但有时你可能会遇到这样的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1323) [如果你的app中出现了这样的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1330) [那你就来对地方了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1332) [那么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1334) [让我们退一步来思考下发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1338) [macOS上的拖拽会用到
NSPasteboard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1342) [当它被封装到剪切板的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1346) [读写数据会在接收和提供app时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1348) [发生于主交易中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1351) [在过去 由于只有本地的数据
才会存储在本地磁盘上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1354) [你可以把文件的URL放到剪切板中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1358) [但是现在事情有了变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1361) [如果用户在使用iCloud的话
图片或者视频可能并没有在磁盘上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1363) [所以在Photos中 我们需要
在将文件URL放到剪切板中之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1368) [首先下载完全分辨率的项目文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1372) [而且Photos
是尊重拖拽的隐私设置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1376) [而且Photos
是尊重拖拽的隐私设置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1376) [所以如果用户选择保留位置信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1380) [Photos就会导出一个
不包含此元数据的新文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1384) [下载和导出文件都要花时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1389) [你不应该在主交易中这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1392) [因为这样会阻塞你的app UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1394) [为了能实现这一功能
我们需要一个异步API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1399) [其实我们有这么一个API
它叫文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1404) [文件承诺是一种承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1410) [某个还没有出现在
磁盘上的特定类型文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1412) [会被写入到一个提供的位置上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1416) [它还允许发送者在后台写文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1419) [有两种与文件承诺进行交互的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1425) [通过NSFilePromiseReceiver
来接收文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1428) [以及通过NSFilePromiseProvider
来提供文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1432) [这两个先进的API在两年前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1435) [就跟macOS Sierra
一起推出了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1439) [就跟macOS Sierra
一起推出了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1439) [首先让我们看看接收文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1442) [基本原则就是app支持的拖拽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1448) [应该一直接受文件URL和文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1452) [我会解释下为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1456) [有很多的app提供了文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1460) [Photos会在拖拽图片的时候
使用文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1463) [对于视频或是整个相册也是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1467) [从macOS Mojave开始
你可以…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1469) [我们添加了拖拽人或是回忆的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1472) [我们并不是唯一使用
文件承诺的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1476) [邮件会在将短信拖拽到
访达的时候使用文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1480) [以保存包括附件在内的整个邮件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1484) [Safari会在拖拽图片的时候
使用文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1487) [Keynote会在拖拽幻灯片
的时候使用文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1491) [创建一个包含了这些幻灯片的新文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1496) [如果你想从这些app中接收文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1500) [或是有app提供了文件承诺的话
你的app需要读取这些文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1503) [并且需要接受这些文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1507) [让我们通过代码来看看如何实现吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1509) [首先在设置时 视图必须通过调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1515) [来注册接受的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1518) [为了接受文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1521) [你可以使用
NSFilePromiseReceiver上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1524) [类属性
readableDraggedTypes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1528) [当执行拖拽操作 枚举或是
使用draggingItems时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1532) [你应该添加对于
NSFilePromiseReceiver的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1539) [以确保首先对它进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1542) [因为它是最有可能包含
最高质量呈现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1545) [对于每个filePromiseReceiver
你要调用承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1552) [当文件准备好的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1557) [读取器块会在所提供的
operationQueue上被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1559) [读取器块会在所提供的
operationQueue上被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1559) [你可以在那里对文件进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1563) [提供后台operationQueue
是很重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1567) [可以在等待文件下载完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1572) [下载或被源文件写入时
不会阻塞主交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1578) [因为这个过程会花很长时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1582) [你不应该在缓慢的网络中
下载文件的时候使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1586) [为了获得更好的用户体验
你需要显示一个载入活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1593) [当文件准备好的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1599) [你可以用真实的内容来替换UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1600) [这里你可以看到一个邮件的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1605) [在等待通过文件承诺来下载图片时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1609) [会显示一个占位的URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1612) [这就是接收文件承诺的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1621) [让我们看下要如何提供文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1623) [如果你想发送到拖拽的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1627) [在磁盘上还没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1631) [那么你应该在app进行实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1632) [让我们通过看这个API
来看下应该如何实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1636) [首先你需要创建一个
NSFilePromiseProvider实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1645) [你应该为每个承诺的文件
创建一个实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1652) [在将filePromiseProvider对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1655) [写入到剪切板之前
它必须包含一个类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1659) [以及一个代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1662) [这些代理会将文件写入磁盘中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1664) [在NSFilePromiseProvider
代理中只有三个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1668) [第一个方法由拖拽的目的地所调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1673) [并且返回的是文件名
而不是整个路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1676) [第二个方法会返回一个
operationQueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1679) [第二个方法会返回一个
operationQueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1679) [文件会被写入其中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1686) [我们强烈建议你实现这个可选的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1690) [提供一个后台
operationQueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1695) [否则主队列会被用在其他内容上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1699) [最后writePromiseToFile
会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1704) [让你将文件写入磁盘上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1708) [在你完成的时候
别忘了调用完成句柄](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1711) [这就是接收以及提供文件承诺的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1717) [我们还介绍了你可以用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1721) [将你的app调整为可以
接收和提供文件承诺的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1724) [现在我想请Joachim上台来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1728) [通过示例app
给你们展示所有这些内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1732) [谢谢 Joachim？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1734) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1739) [早上好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1742) [我们会看一个简单的光线生成app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1743) [它有些拖拽方面的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1746) [我们会进到Xcode
来一起解决这些问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1749) [这就是我的简单app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1759) [我会从桌面上拿一个文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1761) [放到它的窗口中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1765) [就像是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1767) [在右上角我有一个小按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1769) [我可以在这添加一个文本框
还可以在我的图片上添加一些文字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1771) [我可以选择它 移动它
并且在准备好的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1778) [我可以将它发送到iMessage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1783) [虽然这张图片很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1792) [但我还是想用我在网上找到的图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1794) [让我们打开Safari](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1797) [试着将这张图片拖放到
我们的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1801) [不幸的是 这样不行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1806) [让我们进入Xcode
看看能不能修复这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1809) [我现在在app的
主ViewController中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1817) [我们要直接跳到
viewDidLoad中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1820) [看看发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1824) [在这里 我们只注册了文件的URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1828) [让我们修复这个问题
把FilePromiseReceiver也注册了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1833) [然后在处理拖拽操作的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1841) [我们也需要对
FilePromiseReceiver进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1846) [让我们跳到下面的这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1851) [这个是所支持的类的列表
而我们只有NSURL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1856) [这个是所支持的类的列表
而我们只有NSURL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1856) [所以我们要在第一个索引那里添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1861) [NSFilePromiseReceiver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1866) [在这里的枚举方法中
我们要添加一个新的case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1875) [来接收所承诺的文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1886) [如果我们刚刚通过拖拽得到了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1890) [文件的URL
我们可以对其调用刚才调用过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1892) [相同的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1896) [让我们看看这样行不行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1900) [这就是我们的简单app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1908) [让我们回到Safari
将这个图片拖拽到窗口中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1910) [这很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1920) [我只需要修改两个现有的方法
就可以接收文件承诺了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1921) [现在让我们添加一些文字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1928) [就像是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1935) [如果我还没准备好
将我的模因发给别人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1936) [那我可以将它拖拽到桌面就可以
将其保存为图片文件不是很棒吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1940) [正如你所见 这样是行不通的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1947) [让我们回到Xcode
试着解决一下这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1949) [在这个类的底部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1958) [我们有这个会返回遵从于NSPasteboardWriting
对象的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1959) [如你所见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1964) [我们这里返回一个简单的
NSImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1966) [我们会用filePromiseProvider
来替换它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1969) [我们要创建一个文件供应器
并且我们要提供一个JPEG图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1977) [我们要创建一个文件供应器
并且我们要提供一个JPEG图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1977) [我们会用这个userInfo属性
来储存snapshotItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1983) [我们后面会用它来将文件写到磁盘上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1988) [然后我们要遵从
NSFilePromiseProviderDelegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=1993) [就像是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2002) [回到下面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2004) [实现你刚才听到的三个代理方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2006) [第一个会返回文件名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2012) [为了简单
我们这里只返回了一个静态文件名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2016) [第二个代理会返回
operationQueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2021) [我们这里正好有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2024) [第三个代理要将文件写入到磁盘中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2027) [这里所发生的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2038) [这里所发生的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2038) [我们要从filePromiseProvider对象中
拿出snapshotObject](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2040) [并且我们要用它的JPEG呈现
来将文件写入到磁盘中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2046) [让我们来看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2053) [这次我们要跳到Photos中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2059) [我们要拿到这张图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2064) [把它拖拽到我们的app中
添加一些文字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2067) [然后把它拖到Finder桌面上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2076) [这是这样了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2082) [如果你照着我刚刚的步骤来做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2095) [你就可以为你的app添加
对于文件承诺的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2098) [你就可以为你的app添加
对于文件承诺的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2098) [并改进你的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2101) [我想让Eric来给你们介绍一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2104) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2107) [（演示
为文件承诺来调整你的app）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2108) [非常棒的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2112) [我希望你们能喜欢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2114) [我就想说几句话来做下总结](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2115) [将这些内容串连到一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2119) [首先我想说的是
Photos对我们来说很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2122) [对吗？
全世界数以百万计的人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2129) [每天都会拍数以百万计的照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2132) [所有这些照片都可以
放到Photos app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2135) [但如果它们不能进行分享的话
就没什么用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2141) [如果它们不能被展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2143) [不能被妥善地保存起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2145) [所以拍摄了这些照片的人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2149) [依赖于你们这些开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2153) [创造出可以让他们发挥创造力
对照片进行处理的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2155) [如果你今天从这个演讲
有两个必须要记住的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2160) [就是要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2163) [支持文件承诺](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2165) [它可以很轻松地实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2167) [跟Photos app的交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2171) [请一定要实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2173) [第二个就是 我们强烈建议你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2175) [去看看所有那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2177) [在Photos的项目扩展体验中
可用的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2180) [回到我最开始所讲的内容
这是个蒸蒸日上的生态系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2186) [使用它的话你可以有很大的机遇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2190) [我们一起努力的话就可以为每个人
创造一个更好的Photos体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2193) [为了这一目的
请加入我们今天下午的实验室吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2200) [我们会有很多工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2204) [来帮助你们解答
任何关于PhotoKit的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2207) [不管是关于iOS还是
macOS的Photos扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2210) [我们期待着跟你们聊一聊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2213) [请享受WWDC剩下演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2216) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/505/?time=2218)