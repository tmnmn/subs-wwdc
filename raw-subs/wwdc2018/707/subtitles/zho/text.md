# New Ways to Work with Workouts

## Summary
Tracking workouts with Apple Watch is popular with fitness professionals and novices alike.  See how the new workout API streamlines the entire lifecycle of a workout, complete with ability to restart a session after a crash to prevent you from losing data. Learn how the new workout classes, types, and queries provide quick access to baseline sample data you would typical calculate without limiting access to the fine grained samples you may occasionally require.

## Info
* Frameworks
* WWDC 2018 - Session 707 - iOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/

## Text
 [［ 音乐 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=7) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=17) [&gt;&gt; 早上好 各位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=25) [欢迎来到玩转体能训练新方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=26) [我是 Niharika](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=29) [我是 Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=30) [健身团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=31) [来自我们健康团队的同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=33) [工程师 Karim](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=34) [也将加入我们今天的话题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=36) [我们非常兴奋地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=37) [与你们分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=39) [一些全新的特性与功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=40) [它们已经随着 iOS 12](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=41) [和 watchOS 5 加入了 HealthKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=43) [Apple Watch 发布于 3 年前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=49) [从那时起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=51) [我们的用户就热衷于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=52) [使用它的健康与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=54) [健身功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=55) [他们喜欢完成每日任务圆环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=56) [及达成各种成就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=57) [并乐于和好友彼此分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=59) [并乐于和好友彼此分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=59) [但他们最喜欢的还是完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=61) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=62) [虽然只是一个开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=64) [但这块手表正在形成一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=66) [充满活力 不断进化的生态系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=67) [其中少不了在座各位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=69) [开发人员的贡献](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=71) [仅仅 2017 年第四季度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=75) [App Store 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=76) [健康健美类别下的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=78) [下载量超过了 2 亿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=81) [这是个惊人的数字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=82) [两亿这个数字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=86) [实在太酷了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=87) [更重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=88) [这证明了两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=89) [其一 它证明了你们各位开发人员的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=91) [杰出贡献](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=93) [为用户带来了绝佳的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=95) [产品体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=96) [其二 这意味着人们在这一块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=98) [有切实的需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=100) [人们密切关注着这一领域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=101) [翘首期盼](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=103) [你们的新成果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=104) [这一生态系统的核心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=108) [是这两个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=109) [健身记录和健康](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=110) [健身记录是为你呈现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=112) [可视化运动数据的主界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=114) [你可以查看你的体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=117) [查看热量消耗和锻炼时常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=118) [查看热量消耗和锻炼时常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=118) [健康 App 包括更多东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=121) [当然 所有这些的核心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=123) [也就是我们今天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=125) [齐聚于此的理由 就是 HealthKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=126) [我们今天有海量激动人心的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=130) [事情要讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=132) [在我们开始那些话题之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=133) [我们要先谈一谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=135) [一件极其重要的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=136) [那就是隐私和授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=138) [由于数据是相当敏感的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=139) [尤其是健康数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=141) [因此在设计研发 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=143) [确保有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=145) [完整的隐私政策](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=146) [至关重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=148) [然后 Karim 会和大家分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=150) [我们全新的训练功能特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=152) [可以使你更加轻松地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=154) [打造一款可靠的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=156) [体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=158) [最后 我激动地跟大家分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=159) [我们全新的 Quantity 系列 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=161) [这是一个储存与关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=162) [高频数据的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=164) [全新方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=166) [好 让我们开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=168) [正如我所提到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=172) [隐私和授权必须](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=173) [先行于任何开发过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=175) [我们 Apple 看待隐私](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=177) [有一条简单的原则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=179) [有一条简单的原则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=179) [隐私以用户为本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=183) [HealthKit 就是以此为基础 设计而成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=184) [HealthKit 的设计使用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=187) [成为数据的主人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=188) [用户可以授权访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=191) [也可以随时取消授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=193) [作为开发人员的你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=196) [是这一环里的最后一块拼图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=197) [我们想要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=199) [我们提供给你们的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=201) [我们想了几条](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=205) [简单的规则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=208) [第一条是根据你 App 的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=209) [收集部分数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=211) [意思是说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=213) [你应当根据 App 需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=214) [仅收集必要的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=217) [当然这不是永远](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=218) [固定的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=220) [刚开始时 数量可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=220) [不会很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=222) [根据你的实际情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=223) [当你的功能特性增加时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=225) [你所需的数据也会更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=226) [但是按照当时的特定需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=228) [来收集必要数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=230) [是非常重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=231) [第二条是 HealthKit 的授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=234) [是可以更改的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=237) [这一条有些微妙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=238) [比如说 如果用户重置了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=240) [他们的位置与隐私数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=242) [位置与隐私设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=244) [你必须确保尊重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=245) [他们的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=248) [这是你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=249) [应尽的义务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=250) [最好的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=253) [是将 HealthKit 视作真实数据的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=254) [唯一来源 因为 HealthKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=255) [会不断更新用户的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=258) [授权状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=260) [你必须保证不私藏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=261) [任何用户数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=263) [保证你永远只从 HealthKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=265) [获取你所需的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=266) [这一点尤为重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=268) [这两个想法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=269) [可以被提炼成 3 条规则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=271) [当我们涉及隐私与授权时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=274) [你应当仅取所需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=276) [仅在需要时索取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=278) [且每次都要单独索取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=280) [在代码实现上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=284) [这同样简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=286) [如果我要做一个体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=287) [开始着手做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=289) [理所当然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=290) [我需要先从隐私与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=291) [授权下手](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=293) [首先 由于我在创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=294) [一个体能训练 App 我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=295) [和 HealthKit 共享训练类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=297) [所以我需要明确表明我需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=299) [所以我需要明确表明我需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=299) [共享训练类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=301) [接下来 因为我只是在起步阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=303) [我需要追踪的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=304) [数据类型并不多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=305) [我想追踪用户的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=307) [心率 热量消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=308) [还有步行与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=310) [跑步的路程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=312) [现阶段我只需要这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=312) [所以我就是我要请求的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=314) [全部数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=316) [最后 在我的 HealthStore 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=318) [我仅请求以上这些数据的授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=319) [我请求要共享的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=321) [以及要读取的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=323) [通过以上三个简单的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=324) [我们就能切实地确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=326) [我们为尊重用户隐私](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=327) [完成了必要的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=329) [隐私如此重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=332) [越好的 App 越重视隐私](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=335) [在开发伊始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=336) [时刻注意这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=338) [是至关重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=339) [现在我们就能访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=342) [用户数据了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=344) [我迫不及待地向大家介绍 Karim](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=346) [他会向大家展示全新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=347) [体能训练的功能特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=349) [［掌声］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=351) [&gt;&gt; 大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=356) [感谢大家今天参加这个会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=358) [感谢大家今天参加这个会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=358) [我怀着激动的心情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=361) [与你们分享全新的体能训练 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=363) [如果这是你第一次接触 HealthKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=366) [你会发现它如此简单好用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=368) [让你能从零开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=371) [打造一款功能完善的训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=372) [另一方面 假如你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=375) [在 App Store 已经拥有一款训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=377) [你仍然能看到关于这个 API 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=379) [所有全新的功能特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=380) [让你的 App 获益匪浅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=382) [让我们深入了解一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=385) [首先我想先谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=386) [通常情况下体能训练 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=389) [生命周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=392) [假如说我们正在创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=394) [训练 App 来追踪用户的活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=395) [首先第一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=397) [是配置你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=401) [在这个阶段 我们知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=404) [用户想要做体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=406) [训练的具体类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=408) [我们需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=411) [我们的 UI 已经就位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=412) [一旦配置完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=415) [我们就能开始体能训练了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=418) [我们就能开始体能训练了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=418) [在这个阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=421) [用户会积极锻炼](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=423) [当然 过了一会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=426) [用户会想要结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=428) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=432) [在那时 我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=433) [在 HealthKit 中保存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=435) [这条健身记录以及相关数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=437) [这就是一款体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=440) [通常的生命周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=443) [现在让我们观察一下用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=446) [在活跃时都发生么什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=449) [你通过交互界面与用户产生关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=450) [这个过程中你想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=454) [完成的任务之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=456) [就是收集那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=459) [显示在用户界面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=461) [训练数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=464) [你同时得确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=466) [用户可以掌控](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=467) [训练过程的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=470) [随时暂停或是继续训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=472) [如果你熟悉 HealthKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=475) [你可能了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=479) [你可能了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=479) [watchOS 上的 HKWorkoutSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=481) [HKWorkoutSession 可以处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=486) [生命周期中的某几个步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=489) [它会使设备的传感器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=493) [进入随时准备收集数据的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=496) [使你能够准确地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=499) [收集到训练相关的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=501) [比如热量消耗 或是心率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=504) [它还能让你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=507) [在训练进行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=509) [可以在后台运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=511) [你也能够用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=516) [HKWorkoutSession 来控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=519) [这次训练的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=521) [以及最后 你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=524) [产生生成类似游泳](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=526) [圈数的活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=528) [当然 这样还不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=530) [你还需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=533) [收集训练过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=537) [收集训练过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=537) [设备产生的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=540) [然后将它都保存到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=542) [HealthKit 上面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=544) [为了实现这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=547) [我很高兴介绍一个新的类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=549) [HKWorkoutBuilder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=552) [这个 workout builder 是你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=555) [收集数据并将其保存在 HealthKit 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=556) [一站式解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=559) [所以这个 builder 会创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=562) [并存储一个 HKWorkout 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=565) [它在 HealthKit 中代表了一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=568) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=570) [然后你可以在创建体能训练时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=573) [在 builder 中添加样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=576) [活动以及自定义的元数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=579) [并且如果你在 watchOS 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=582) [你可以使用它的子类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=585) [HKLiveWorkoutBuilder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=587) [所以它仅限于 watchOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=590) [而且又因为它是 HKWorkoutBuilder 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=594) [子类 它有这个 builder 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=596) [所有优点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=598) [但又因为它在 watchOS 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=599) [但又因为它在 watchOS 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=599) [它和 HKWorkoutSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=602) [紧密合作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=604) [它有那些很酷的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=606) [功能 比如说自动样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=608) [自动活动收集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=611) [我们之后会再说到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=612) [所以让我们回到体能训练的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=615) [App 的生命周期 我们会看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=618) [我们如何用新的 workout builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=621) [设置并开始体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=623) [那么首先 我们需要创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=629) [workout builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=631) [我们需要用一个初始化程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=633) [我们需要传入一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=634) [healthStore 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=637) [一个配置项 包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=639) [体能训练类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=641) [户内或户外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=643) [其他有关信息的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=645) [最后 一个可选的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=648) [比如说如果数据来自](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=651) [一个外部的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=653) [一旦我的 builder 被创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=656) [我所需要做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=658) [调用 beginCollection 并且传入一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=659) [调用 beginCollection 并且传入一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=659) [开始时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=662) [就是这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=664) [如果你在 watchOS 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=666) [你可以用 HKLiveWorkoutBuilder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=669) [首先 你需要创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=671) [体能训练 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=673) [传入 healthStore 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=675) [以及 workoutConfiguration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=676) [然后你不要自己创建 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=679) [你可以直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=681) [从 session 中获取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=683) [通过这次调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=685) [一旦我们有了 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=687) [和 builder 我们可以继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=689) [并开始了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=690) [调用 session 上的 startActivity](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=692) [和 builder 上的 beginCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=695) [传入一个开始时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=697) [就是这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=699) [这就是如何用 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=701) [设置并创建一个体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=705) [现在 我们来看看我们如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=708) [收集直接展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=710) [在用户界面上的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=713) [以及如何控制体能训练的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=716) [当用户需要它的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=718) [当用户需要它的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=718) [为了收集数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=722) [如果我们想要添加与体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=725) [有关的样本数据 比如卡路里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=728) [距离 心率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=731) [我们可以调用一个简单的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=734) [即 builder.add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=736) [给它传入一个 HKSample 数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=739) [如果我们有想要添加到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=742) [体能训练中的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=745) [也非常类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=747) [我们只需调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=749) [builder.addWorkoutEvents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=750) [至于元数据 你们肯定猜到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=753) [有了元数据字典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=756) [我们只需调用 builder.addMetadata](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=759) [然后传入字典即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=761) [但是在 Apple Watch 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=764) [因为设备是在手腕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=768) [而且有众多传感器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=771) [你可以产生真实的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=774) [比如卡路里和距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=776) [那么如果我们可以让 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=779) [那么如果我们可以让 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=779) [全自动地收集所有数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=781) [岂不是很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=783) [从 watchOS 5 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=787) [我们有了自动数据收集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=790) [这一切从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=794) [HKLiveWorkoutDataSource 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=795) [所以这个数据源会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=798) [收集与当前体能训练相关的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=802) [体能训练相关的样本数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=805) [不过 你仍然可以选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=809) [你想要收集的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=813) [你可以添加或移除类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=814) [只需根据你的需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=817) [它的工作方式如下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=819) [首先 我们创建一个数据源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=821) [在这 我传入了 healthStore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=825) [同时也传入了 workoutConfiguration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=827) [由于我传入的配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=830) [包含了活动类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=831) [的有关信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=832) [数据源从而能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=834) [推断针对这次体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=836) [应该收集哪些类型的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=839) [应该收集哪些类型的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=839) [接下来 我只需把](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=843) [数据源设置在 live workout builder 上面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=845) [以及可选地 你可以增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=849) [或移除正在收集的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=851) [比如说我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=854) [添加类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=856) [我可以指明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=857) [我想在这里添加的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=860) [如果我想要进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=862) [限制被收集的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=864) [也可以指明一个可选的谓词](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=866) [最后 我们只需调用 dataSource](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=867) [.collectStatistics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=869) [传入类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=871) [同样还有 optionalPredicate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=874) [那么现在数据正在被收集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=877) [我们来看看如何可以将其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=881) [直接显示在用户界面上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=884) [每次 builder 的委托方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=888) [带来新数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=893) [workoutBuilder 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=895) [didCollectDataOfcollectedTypes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=898) [会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=899) [会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=899) [那么在这里 比如说如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=901) [我对心率类型感兴趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=903) [我会确保它是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=904) [被收集的数据类型之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=907) [然后 我只需利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=909) [用 builder 的针对数量类型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=911) [数据方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=914) [它会返回一个 HKStatistics 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=916) [其中包含了相关信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=919) [在这个例子中 有最小值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=921) [最大值 平均值 以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=923) [在此次体能训练中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=925) [最近记录的心率数值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=928) [这样 我就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=931) [更新用户界面了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=933) [在体能训练类 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=935) [表示时间流逝的计时器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=937) [非常常见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=940) [所以 当然 我们要在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=943) [训练开始时开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=946) [计时 但这并不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=948) [因为暂停或继续事件会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=950) [影响训练持续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=952) [时间的计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=954) [所以每当新活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=956) [被添加进 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=958) [被添加进 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=958) [builder 的委托方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=960) [workoutBuilderDidCollectEvents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=962) [就会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=964) [这样 你就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=965) [用 builder 的 elapsedTime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=968) [属性 它会告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=970) [此体能训练当前已](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=972) [持续的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=974) [就这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=976) [接下来 我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=979) [如何控制训练的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=981) [首先 我想要讨论一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=984) [训练 session 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=988) [所有的不同的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=990) [第一个是 Not Started](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=992) [这意味着训练还没有开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=996) [我们还没有 哦不](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=997) [用户还没有开始体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1001) [在这之后 我们会转到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1004) [Prepared 状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1007) [Prepared 状态会让系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1009) [处于 Session 模式下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1012) [意味着你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1014) [会有后台运行能力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1016) [传感器也会做好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1018) [传感器也会做好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1018) [追踪活动的准备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1020) [但是训练还未开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1022) [比如说 如果你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1026) [在训练前有一个倒数秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1028) [你可以在这之前将 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1030) [置为 Prepared 状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1032) [以此来确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1034) [设备已经准备好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1036) [开始追踪活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1037) [在这之后 我们可以转到 Running 状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1039) [这时 用户在积极地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1043) [进行体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1046) [当然 用户也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1047) [变成 Paused 然后回到 Running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1049) [然后在两者之间来回切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1052) [直到训练结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1053) [这时 设备仍然处于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1058) [Session 模式下 意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1062) [你的 App 仍然在后台运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1063) [这就为你争取了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1065) [一点额外时间 让你需要的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1067) [可以保存这次体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1069) [这之后 我们就可以结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1071) [体能训练了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1074) [从这起 系统就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1076) [退出 Session 模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1078) [想要在这些状态之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1080) [切换 你只需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1083) [在体能训练 session 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1085) [调用这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1088) [这就是我们收集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1094) [用户界面展示数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1096) [以及控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1098) [session 状态的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1101) [我们来看看如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1103) [结束体能训练并且将其保存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1105) [HealthKit 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1106) [为了结束体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1107) [首先调用 session.end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1112) [同时调用 builder.endCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1115) [传入体能训练的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1117) [结束时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1119) [在这一时间点 尚未有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1121) [任何有关此体能训练的数据被收集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1123) [数据被收集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1124) [然后 如果你想把体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1125) [保存在 HealthKit 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1128) [你直接调用 builder.finishWorkout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1130) [然后你会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1132) [completion handler 中得到一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1134) [体能训练对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1136) [与它相关的数据已经被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1138) [与它相关的数据已经被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1138) [保存在 HealthKit 中了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1140) [这就是现在使用新的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1144) [创造一个体能训练 App 的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1146) [接下来 我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1150) [用一个样本来演示一遍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1152) [我们会在 demo 中创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1155) [为 Apple Watch 设计的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1156) [［掌声］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1159) [我目前实际上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1170) [正在写一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1172) [让用户记录跑步的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1174) [体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1177) [它是个非常简单的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1178) [这里有一个大的 “Run” 按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1180) [当点击它时 我会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1183) [显示这样一个界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1185) [其中会显示此次训练的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1187) [逝去时间以及一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1189) [其他指标 比如消耗的卡路里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1191) [最近心率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1194) [还有在这次训练中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1196) [已经跑的距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1199) [已经跑的距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1199) [当然 用户也](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1200) [可以控制训练的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1202) [因此 用户可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1204) [暂停 继续 以及结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1206) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1208) [实际上我已经提前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1211) [写好了这些用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1214) [剩下的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1216) [使用新的体能训练 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1218) [让我的 App 可以跑起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1220) [我们要做的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1222) [就是确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1225) [这个项目的设置是正确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1227) [想要做到这个 我准备前往](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1230) [我的项目设置页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1231) [然后打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1232) [Capabilities 标签页 确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1235) [这里的 HealthKit Capability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1237) [处于开启状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1240) [同时针对你的 WatchKit App 扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1242) [也需要做相同的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1244) [所以再一次 确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1246) [HealthKit Capability 是开启的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1248) [当我完成了这些 我们也应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1251) [把这两个目的字符串添加在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1253) [info.plist 文件中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1256) [以告知我的用户我为什么需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1259) [以告知我的用户我为什么需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1259) [访问他们的健康数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1261) [这里的第一条字符串是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1263) [“Health Share Usage Description”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1266) [告诉用户我为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1269) [想要把数据存储在 HealthKit 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1271) [同时帮助更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1274) [用户描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1276) [它会告诉用户为什么我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1277) [需要读取 HealthKit 中的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1279) [完成了这些 现在我可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1283) [开始使用新的体能训练 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1285) [当然 使用 API 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1287) [前提条件是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1290) [确保我请求了我需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1292) [数据的相关授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1294) [当然 每个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1298) [都是不同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1300) [在这次例子中 如果我们回到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1301) [我的 App 我会保存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1303) [一个体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1307) [所以这是我需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1308) [有权限访问的类型之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1310) [另外 我也需要能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1313) [读取卡路里 心率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1315) [还有距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1317) [咱们来做这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1319) [咱们来做这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1319) [当然 我们需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1321) [当我们真正需要授权的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1323) [才发起请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1324) [在我的例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1327) [我需要在每次用户看到这个 UI 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1329) [来请求 这样我可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1331) [确保我获得了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1334) [我获得了相关的授权 在开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1335) [体能训练前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1337) [所以这里的这个视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1339) [由 WorkoutStartView 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1340) [WKInterFaceController 控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1344) [那我准备在 didAppear 方法中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1345) [来执行授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1348) [所以首先 我这里的 typesToShare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1353) [应该是 workout 因为我希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1356) [在最后可以保存一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1357) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1359) [接下来 我希望读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1362) [心率 动态卡路里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1364) [同时还有步行 + 跑步距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1367) [一旦设置好了 typesToShare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1370) [和 typesToRead 我只需在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1373) [healthStore 上调用 requestAuthorization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1376) [并且传入这两个类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1377) [并且传入这两个类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1377) [那么我们现在来运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1381) [一下这个代码看看会发生什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1383) [而且因为 Apple Watch 的屏幕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1385) [比较小 用户会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1388) [手机上看到一张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1391) [授权表单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1393) [所以你需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1395) [在你的 iPhone App 上也能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1397) [处理授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1399) [那我们继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1402) [先关闭这个视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1404) [那么我们现在打开我的 iPhone App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1405) [这里 我看到了一张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1408) [授权表单 在这我可以决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1410) [我是否授予这个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1413) [访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1415) [对于现在这个样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1417) [我会把所有类别都打开 并且点击“允许”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1419) [这就是如何给我的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1424) [授予访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1425) [接下来 我们终于可以开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1429) [用体能训练 API 了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1431) [所以当我点击这里的这个按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1434) [这个视图会被传过来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1436) [包含体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1439) [包含体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1439) [相关信息的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1441) [workoutConfiguration 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1443) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1445) [这是个跑步训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1446) [从那里 我可以继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1447) [设置我的体能训练了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1449) [这个视图由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1452) [我的体能训练 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1453) [WatchKit 界面控制器支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1456) [我会在唤醒方法中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1458) [完成设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1460) [那么首先 我会创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1461) [HKWorkoutSession 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1464) [HKLiveWorkoutBuilder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1466) [我们用初始化程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1469) [创建了 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1473) [我们再把体能训练配置对象传给它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1475) [然后 我们只需从 session 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1477) [直接获取 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1480) [如果体能训练配置项无效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1484) [创建 session 可能会失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1486) [所以这就是为什么我会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1488) [把这段代码放在一个 do-catch 区块中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1490) [如果有任何错误 会被忽略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1493) [接下来 让我们设置这个 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1496) [接下来 让我们设置这个 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1496) [和 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1500) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1501) [我希望我的界面控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1504) [可以是 session 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1506) [builder 的委托](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1508) [因为我也想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1509) [收集设备产生的采样数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1511) [我需要在这里使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1513) [一个实时的数据源并且传给它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1515) [一个体能训练配置项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1518) [这样各种类型就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1520) [为我自动推断出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1522) [最后 我只需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1525) [启动 session 和 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1528) [那么既然我的体能训练已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1531) [开始 我需要做的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1535) [就是启动我的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1537) [elapsedTime 计时器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1539) [我会在 beingCollectionCall 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1540) [回调中来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1543) [完成这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1545) [我这里有一个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1546) [可以帮我做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1551) [当然 因为暂停和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1552) [继续事件也会影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1555) [持续时间的计算 我在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1558) [持续时间的计算 我在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1558) [builder 的 didCollectEvent 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1560) [也需要调用这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1562) [现在 我们来实现这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1567) [所以在我的 UI 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1570) [我使用了一个 WKInterfaceTimer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1573) [如果你对这个对象不熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1575) [这个对象需要一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1576) [过去时间 然后从那个时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1579) [开始计时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1582) [所以我接下来会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1583) [用 builder 的 elapsedTime 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1584) [来创建我的时间对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1587) [因为我想要的时间是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1590) [过去时间 我需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1591) [确保这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1593) [有一个负号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1595) [接下来 我只需在主队列上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1597) [调度因为我在做 UI 方面的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1599) [然后我只用在计时器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1601) [设置时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1603) [我也需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1606) [计时器只在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1607) [session 运行的时候运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1611) [让我们来做这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1613) [首先 我拿到 session 状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1615) [然后 再一次我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1618) [在主队列上调度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1619) [在主队列上调度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1619) [如果 session 正在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1620) [我会启动计时器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1623) [如果不在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1624) [我就停止计时器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1626) [这是你所需要做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1628) [让计时器追踪已用时长的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1629) [全部事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1632) [接下来 我们来确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1633) [我们在 UI 上展示的所有指标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1635) [也是准确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1638) [所以每次 builder 收集到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1639) [新的样本数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1642) [这里的这个方法会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1645) [那么这里 我也只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1647) [重复这里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1649) [collectedTypes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1651) [而且 在我的例子中 所有我需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1656) [数据都是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1659) [数量型样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1661) [所以我要确保我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1662) [只处理这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1664) [从这里 我们可以利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1666) [针对数量数据的 builder 的新方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1669) [builder.statistics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1673) [它会返回给我一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1675) [HKStatistics 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1677) [包含了每个数据类型的最小值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1679) [包含了每个数据类型的最小值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1679) [最大值 平均值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1681) [以及最近值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1684) [所以我拿到这个统计对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1687) [从这 我有一个已经实现过的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1689) [会返回给我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1693) [针对特别的数量类型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1695) [用户界面标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1697) [它会用统计对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1700) [更新我的标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1702) [接下来 我们来确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1705) [当用户需要的时候我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1709) [可以控制状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1710) [所以每当用户轻点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1713) [暂停按钮 这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1715) [会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1717) [这样 我只需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1719) [调用 session.pause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1720) [对于继续 也很类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1723) [我会执行 session.resume](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1726) [以及最后 为了结束体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1729) [我会调用 session.end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1733) [再调用 builder.endCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1736) [然后传入体能训练的结束时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1739) [然后传入体能训练的结束时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1739) [然后 我们只需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1741) [调用 finishWorkout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1743) [来真正把这次体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1745) [和所有相关数据保存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1747) [在 HealthKit 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1748) [然后 我们只需要无视它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1750) [那么我们来运行这段代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1752) [看看现在会发生什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1753) [那么我来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1764) [启动我的体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1765) [如我们所看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1768) [我的计时器在更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1771) [我的数据由 builder 直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1773) [收集并且在我的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1775) [用户界面上展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1777) [当然 我也可以响应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1780) [状态变化 所以现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1782) [来暂停这次体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1785) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1787) [计时器暂停了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1789) [数据采集也暂停了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1791) [我可以继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1793) [就像这样 只用几行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1795) [现在我有了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1798) [现在我有了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1798) [全功能的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1801) [［掌声］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1803) [我现在准备停止体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1809) [我们来看看我们在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1812) [iPhone 的健康 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1816) [保存了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1819) [这就是我刚刚保存的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1820) [体能训练 而且现在我们看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1825) [直接保存在 HealthKit 中的体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1827) [有非常丰富的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1830) [信息展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1832) [我有设备的详细信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1833) [还有相关的所有样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1836) [比如心率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1837) [距离 活动能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1839) [还有当我暂停和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1842) [继续 session 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1844) [产生的体能训练活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1846) [现在在 Apple Watch 上创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1857) [一个全功能的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1859) [一个全功能的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1859) [就是这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1862) [［掌声］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1865) [不过当然 有时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1870) [事情并不像我们计划的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1872) [比如说我在跑我的第一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1874) [马拉松 我特别激动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1877) [在用我最喜欢的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1879) [来追踪这次马拉松](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1881) [而我在最后才发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1883) [这个 App 在途中的某个时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1885) [居然崩溃了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1888) [搞得我失去了所有的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1890) [好吧 在 watchOS 5 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1893) [我们带来了体能训练恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1895) [可以帮你解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1898) [［掌声］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1901) [如果你的 App 恰好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1904) [在一次活跃的体能训练中崩溃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1906) [我们会自动重启你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1909) [给它一个恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1911) [体能训练的机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1912) [体能训练 session 和 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1915) [会以之前的状态恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1917) [会以之前的状态恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1917) [所以你不应该在 builder 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1920) [调用 startActivity 或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1921) [beginCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1924) [如果你在使用一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1927) [自动收集数据的数据源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1929) [你需要重新设置它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1932) [下面是它的工作原理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1934) [如果你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1938) [在一次崩溃后重启 我们会调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1940) [WKExtensionDelegate 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1943) [handleAcitiveWorkoutRecovery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1945) [这样 你只需创建一个 healthStore 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1949) [然后调用 recoverActiveWorkoutSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1953) [然后你会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1957) [completion handler 中拿回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1959) [一个 session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1961) [就这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1962) [这就是我们新的体能训练 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1964) [它让创造优秀的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1969) [变得前所未有的简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1972) [我们也有一个新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1974) [数量系列 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1977) [有关这个 我想把麦克风](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1978) [有关这个 我想把麦克风](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1978) [交还给我的同事 Niharika](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1980) [她会告诉你们更多有关它的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1982) [［掌声］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1984) [&gt;&gt; 刚才那些是不是好到难以置信](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1988) [在不到 10 分钟的时间里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1990) [Karim 能够创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1992) [全功能的体能训练 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1993) [这非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1994) [因为 像我刚才提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1996) [我们的用户喜爱做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1997) [体能训练](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=1999) [而这些体能训练会带来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2001) [相当多的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2002) [比如说我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2003) [做一个足球 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2005) [我非常想弄清楚](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2006) [我的用户到底是如何运动的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2008) [而且我想追踪在一次体能训练中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2010) [他们在球场上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2011) [从一边跑到另一边时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2013) [移动的距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2016) [当我们开始体能训练时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2017) [样本数据就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2019) [开始产生了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2021) [我的用户先跑了 2.25](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2022) [然后 1.6](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2025) [然后又跑了一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2027) [然后 结束了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2029) [从前 这里的每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2030) [距离都会被存储为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2032) [一个单独的 HKQuantity 样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2034) [每一个都是独立的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2037) [而且会被分开储存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2039) [而且会被分开储存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2039) [我们考虑一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2041) [如果你可以有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2042) [一个追踪累计总数的样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2043) [但同时其背后仍然有那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2045) [独立的数量支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2048) [是不是很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2049) [这就是为什么我们引入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2051) [HKCumulative](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2053) [QuantitySeriesSample 它是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2054) [全新的样本类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2056) [让你可以更高效地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2057) [存储高频数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2059) [它很棒 有两个原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2061) [原因一 你只需要存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2063) [一个由多个数量支撑的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2065) [样本 因此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2066) [你可以更高效地存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2068) [那些来自体能训练的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2070) [高频数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2071) [第二 你现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2073) [可以知道组成一个样本的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2076) [多个数量与样本本身的联系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2078) [因此我们新的 QuantitySeriesSample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2080) [是 HKQuantitySample 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2083) [子类 你们中也许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2084) [有些人已经很熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2085) [如果你之前用过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2088) [HKQuantitySample 我们新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2089) [样本类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2091) [基本上一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2093) [那么为什么你想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2095) [用这个呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2096) [比方说你想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2097) [数据可视化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2099) [数据可视化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2099) [你的 App 需要复杂的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2100) [图表或图形](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2102) [你正努力用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2104) [一种漂亮的方式可视化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2105) [用户的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2106) [实际上我们建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2108) [你继续使用我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2109) [HKStatisticsQuery 或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2111) [HKStatisticsCollectionQuery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2113) [这是因为那些类正是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2115) [已有的 query 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2116) [做这件事的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2118) [你有权访问到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2119) [真正详细的丰富的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2120) [而这些 query 将会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2123) [在新的系列样本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2124) [得到详细的数据 所以你无需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2126) [做任何额外的工作来获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2128) [那些详细信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2130) [如果 比方说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2132) [你想要做数据分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2133) [你要更进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2135) [你想要弄清楚](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2137) [组成一个样本的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2138) [实际数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2140) [我们建议你使用我们新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2141) [系列样本 query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2144) [最后 如果你和我一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2145) [有一个足球 App [ 笑声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2147) [或者任何会高频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2148) [收集数据的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2150) [我们建议你使用我们新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2153) [数量系列样本 builder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2154) [它作为一种全新的方式 让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2156) [能够真的创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2157) [那些新的累计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2159) [那些新的累计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2159) [数量系列样本 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2160) [以更有效率的方式存储数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2162) [那么让我们开始 sample query 吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2165) [像我刚提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2167) [你可以通过这种方式来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2169) [看得更深入并且真正理解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2171) [组成一个数量系列样本的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2173) [独立的 HK 数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2175) [在代码里 当然 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2178) [首先想要搞清楚](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2180) [我们会把这些新的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2181) [存储在哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2182) [在我的例子中 我会把它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2183) [存在一个数量的数组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2185) [接下来我们初始化 query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2186) [我们用我们感兴趣的样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2190) [来初始化它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2192) [我们的完成处理器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2193) [正是这部分工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2195) [进行的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2196) [在我的例子中 我有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2197) [叫做 analyzeQuantity 的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2199) [会来完成我想要对数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2201) [做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2202) [就是把它添加到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2203) [刚才我声明的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2205) [数量数组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2206) [最后 我们来执行 query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2208) [就是如此简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2211) [你们中有人熟悉我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2213) [其他的一些 query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2214) [这里的表现非常相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2215) [接下来 我们有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2219) [接下来 我们有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2219) [QuantitySeriesSampleBuilder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2221) [如我刚才提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2223) [对于那些会产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2224) [高频数据的 App 非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2226) [因为用这种方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2228) [存储数据效率更高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2229) [而且还允许你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2230) [创建它们之间的联系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2233) [那么首先 当然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2235) [我们从创建样本 builder 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2236) [我们用 HealthStore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2239) [配合我们感兴趣的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2240) [quantityType 来初始化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2242) [接下来 无论你希望用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2245) [什么样的频率来插入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2247) [样本 你只管做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2248) [那么以我这个足球 App 为例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2250) [我非常需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2253) [我的用户移动的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2254) [实际距离 所以我要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2256) [声明这个测量单位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2257) [是我想要的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2259) [并且把它插入在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2261) [seriesBuilder 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2263) [最后 我在我的系列上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2264) [调用结束 然后我们实际上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2268) [会得到新的数量系列样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2270) [并且能够来储存它 用一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2272) [更有效的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2275) [因此 我们真的真的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2276) [为你们感到激动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2277) [你们可以开始在新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2279) [你们可以开始在新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2279) [Quantity series API 上实现你们的 App 了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2281) [因为这种全新的方式存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2282) [数据更高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2284) [而它将数据关联在一起的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2286) [能力让一些有趣的分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2287) [成为了可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2289) [那么我们已经讨论了很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2294) [有意思的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2296) [我们认为考虑这些事情最好的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2298) [应该是用更完整的角度来看待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2299) [因为这些东西整合在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2301) [真的可以让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2303) [从开始到结束都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2304) [更加重视你的用户的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2306) [当然 我们必须开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2309) [尊重用户的隐私](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2311) [我们的用户在把他们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2312) [最敏感的数据给予我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2315) [而确保我们怀着它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2316) [赢得的尊重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2318) [来处理这些数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2319) [尤其重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2321) [接下来 有了 Karim 介绍的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2322) [全新的体能训练特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2324) [我们得以创造无缝的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2326) [用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2328) [有了像体能训练崩溃恢复的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2329) [我们能够呈现给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2330) [用户真正期望的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2332) [用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2334) [最后 通过使用新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2336) [Quantity series API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2338) [Quantity series API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2338) [你能够遵守设备的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2340) [能力并且真正确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2341) [从开始到结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2343) [你都在给你的用户提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2345) [能力范围内的最佳体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2346) [由于健康和健身类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2348) [和体能训练 App 持续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2350) [增长 而且用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2351) [用得越来越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2353) [我们很高兴看到这些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2355) [组合在一起能够创造](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2357) [真正难以置信的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2358) [更多信息 请参见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2361) [我们的开发人员文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2362) [但实际上如果今天能和你们当面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2363) [聊聊 会更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2365) [今天下午 1 点到 3 点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2366) [我们会有一个实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2368) [今天晚上 还有健康 健身和搜索聚会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2370) [我们很乐意回答你们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2373) [任何问题 听听你们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2374) [故事 与你们面对面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2375) [另外 我想说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2378) [在 HealthKit 中我们有一些全新特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2379) [我们很乐意你们都去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2381) [看看他们的会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2383) [用 HealthKit 访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2384) [健康数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2385) [非常感谢各位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2387) [我们期待看到你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2388) [用这些做的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2389) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2390) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/707/?time=2392)