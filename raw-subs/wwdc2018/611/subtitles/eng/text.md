# Metal for VR

## Summary
On macOS, Metal 2 adds specialized support for virtual reality (VR) rendering and external GPUs. Learn about new features and optimizations to take advantage of these technologies within your Metal 2-based apps and games. Understand best practices for scheduling workloads across multiple GPUs and techniques for frame pacing while multi-threading.

## Info
* Graphics and Games
* WWDC 2018 - Session 611 - macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=17) [&gt;&gt; Good morning everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=23) [My name is Karol Gasinski, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=25) [am a member of GPU Software](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=26) [Architecture Team at Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=28) [We will start this session with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=29) [a brief summary of what is new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=32) [in [inaudible], in terms of VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=35) [adoption.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=37) [Then, we will take a deep dive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=38) [into a new Metal 2 features,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=41) [designs specifically for the VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=43) [this year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=45) [And finally, we will end this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=46) [session with advanced techniques](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=48) [for developing VR applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=50) [Recently, we introduced new iMac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=53) [and iMac Pro that have great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=56) [GPUs on board; iMac is now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=57) [GPUs on board; iMac is now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=57) [equipped with [inaudible] based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=60) [GPUs and have up to 80 gigabytes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=61) [of video memory on board.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=65) [While iMac Pro are equipped with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=67) [even more advanced and even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=69) [bigger based GPUs, with up to 16](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=71) [gigabytes of video memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=74) [That's a lot of power that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=76) [now in your hands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=78) [But we are not limiting our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=80) [service to iMac on their own.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=81) [With recent announcement of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=84) [extended GPU support, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=85) [now turn any Mac into powerful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=88) [workstation that gives you more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=90) [than 10 [inaudible] of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=94) [processing power.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=95) [And that's not all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=97) [Today we are introducing plug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=99) [and play support for HTC Vive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=100) [head mounted display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=103) [It has two panels with 1,440 by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=105) [1,600 and 650 pixels per inch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=108) [That's 78% increase in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=114) [resolution, and 57% increase in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=118) [resolution, and 57% increase in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=118) [pixel density compared to Vive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=121) [And with support for better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=123) [panels comes support for its new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=126) [dual-camera front-facing system,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=129) [so developers will now be able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=131) [to use those cameras to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=133) [experiment with pass-through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=134) [video on Mac.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=136) [And together with Vive Pro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=138) [support comes improved tracking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=139) [system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=141) [So, you might be wondering how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=143) [you can start developing VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=145) [application on Mac OS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=146) [Both HTC Vive and Vive Pro work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=148) [in conjunction with Valve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=152) [SteamVR runtime, that provides a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=154) [number of services including VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=157) [compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=159) [Valve is also making open VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=160) [framework that is available on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=163) [Mac OS, so that you can do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=166) [map that works with SteamVR.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=168) [We've been working very closely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=170) [with both Valve and HTC to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=172) [sure that Vive Pro is supported](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=174) [in SteamVR runtime on Mac OS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=177) [in SteamVR runtime on Mac OS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=177) [So, now let's see how new Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=183) [features that we're introducing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=184) [can develop a [inaudible] Mac OS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=186) [Mojave can be used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=187) [fiber-optimize your VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=189) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=191) [As a quick refresher, let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=192) [review current interaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=195) [between application and VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=196) [compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=198) [Application will start by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=198) [rendering image for left and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=201) [right eye into 30 multi-sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=203) [textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=205) [Then it will resolve those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=206) [images into iOS surface back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=208) [textures that can be further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=210) [passed to VR compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=212) [VR compositor will perform final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=213) [processing step that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=217) [include [inaudible] distortion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=219) [correction, chromatic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=221) [aberration, and order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=222) [operations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=223) [We can call it in short warp.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=224) [Once the final image is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=228) [produced, it can be sent to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=229) [headset for presentment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=232) [It is a lot of work here that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=234) [happening twice, so let's see if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=236) [you can do something about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=239) [you can do something about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=239) [See, now with VR application it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=242) [wants to benefit from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=244) [multi-sample [inaudible], it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=245) [needed to use the dedicated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=247) [textures per i, or single shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=248) [one, for both.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=252) [But none of those layouts is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=253) [perfect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=255) [The dedicated textures require](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=256) [separate draw calls and passes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=258) [as we just saw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=260) [While straight textures enable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=263) [rendering of both eyes in single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=265) [rendered and results pass, they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=267) [are problematic when it comes to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=270) [post-processing the effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=272) [[Inaudible] textures have all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=274) [the benefits of both dedicated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=276) [and shared layouts, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=279) [currently they couldn't be used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=281) [with MSAA.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=283) [This was forcing app developers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=285) [to use different rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=287) [part-time layouts, based on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=288) [fact if they wanted to use MSAA](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=291) [or not.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=294) [Or use different tricks to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=294) [around it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=296) [So let's see how we can optimize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=297) [this rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=299) [this rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=299) [Today, we introduce new texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=302) [types to the multi-sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=304) [already textured.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=306) [This texture type has all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=308) [benefits of previously mentioned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=310) [types without any of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=313) [drawbacks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=314) [Thanks to that it is now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=315) [possible to separate from each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=317) [other rendering space, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=319) [simplifies the post-processing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=322) [effects, views count, so that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=324) [application can fall back easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=328) [to monoscope rendering and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=330) [control over anti-aliasing mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=333) [As a result, application can now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=336) [have single rendering files that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=338) [can be easily adopted to any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=340) [situation, and most important,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=343) [that can be rendered with single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=346) [draw and render pass in each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=348) [case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=350) [So here we see code snippet for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=353) [creation of mentioned 2D multi](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=355) [sample [inaudible] texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=357) [We set up sample count to 4, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=361) [it's an optimal tradeoff between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=363) [quality and performance, and at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=365) [the same time, we set up our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=367) [other length to 2 as we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=369) [store each image for each I in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=372) [separate slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=376) [So let's see how our pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=378) [will change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=381) [We can now replace those 2D](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=383) [multi-sample textures with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=385) [single 2D multi-sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=387) [[inaudible] one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=392) [So now application can render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=393) [both I in single render pass and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=394) [if it's using instancing, it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=398) [even do that in single draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=400) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=402) [So that already looks great, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=402) [we still need to resolve those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=405) [2D multi-sample array texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=407) [slices into separate iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=409) [[inaudible] faces before we pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=412) [them to compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=414) [So let's focus on our way,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=416) [application shares textures with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=419) [application shares textures with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=419) [compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=421) [So now, for sharing textures, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=421) [use IOSurfaces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=424) [They are sharing textures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=426) [between different process spaces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=428) [and different GPUs, that we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=430) [got [inaudible] comes a price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=434) [IOSurfaces can be only used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=436) [share simple 2D textures, so if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=439) [you have a multi-sampled one,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=442) [storing [inaudible] or having](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=444) [[inaudible], they couldn't be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=446) [shared.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=447) [That's why today we introduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=449) [shareable Metal textures that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=450) [allow your applications to share](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=452) [any type of Metal texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=454) [between process spaces, as long](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=456) [as these textures stay in scope](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=459) [of single GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=462) [This file features [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=463) [advanced view of these cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=466) [For example, sharing depth of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=469) [your scene with VR compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=472) [But, of course, it's not limited](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=474) [just to that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=475) [Now, let's look how those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=477) [textures can be created.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=479) [textures can be created.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=479) [Because shareable textures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=482) [allows us now to pass complex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=483) [textures between processes, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=486) [will create 2D array texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=488) [that we will pass to VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=490) [compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=492) [As you can see, to do that, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=493) [use new methods, new shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=496) [texture with this creator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=498) [And while doing that, you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=499) [to remember to use private](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=503) [storage mode, as this texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=505) [can be only accessed by the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=507) [on which it was created.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=509) [Now, we see a code snippet](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=513) [showing us how our VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=516) [application would send IOSurface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=518) [to VR compositor in the past.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=521) [We will now go through this code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=524) [snippet, and see what changes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=525) [needs to be applied to switch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=527) [from using IOSurfaces to shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=530) [Metal textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=532) [So we don't need those two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=534) [IOSurfaces anymore, and those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=536) [two textures that were backed by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=539) [two textures that were backed by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=539) [them can now be replaced with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=541) [single shareable Metal texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=543) [that is over 2D array type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=545) [We will then assign this texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=549) [to both texture descriptors from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=552) [open VRSDK, and change its type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=555) [from IOSurface to Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=559) [After doing these few changes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=561) [we can submit image for the left](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=565) [and right I to the compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=567) [Compositor will now know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=572) [we've passed shared Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=574) [texture with advanced layout,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=575) [instead of IOSurface, and if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=577) [check, if its type is 2D array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=580) [or 2D multi-sampling array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=582) [If it is, then compositor will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=585) [automatically assume that image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=587) [for the left i is stored in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=589) [slice 0, and image for right i](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=591) [is stored in slice 1.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=594) [So your application doesn't need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=596) [to do anything more about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=597) [And of course, sharing Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=599) [And of course, sharing Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=599) [textures between application and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=603) [compositor is not the only use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=605) [case for shareable Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=606) [textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=608) [So here we have simple example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=609) [of how you can pass Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=611) [texture between any two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=612) [processes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=614) [So we start exactly in the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=615) [way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=617) [We create our shareable Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=618) [texture, but now from this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=619) [texture, we create special](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=623) [shared texture handle that can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=625) [be passed between process spaces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=627) [using cross-process](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=630) [communication connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=631) [Once this handle is passed to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=633) [other process, it can be used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=636) [recreate texture object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=639) [But while doing that, you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=642) [to remember to recreate your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=645) [texture object on exactly the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=647) [same device as it was originally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=649) [created in other process space,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=651) [as this texture cannot leave](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=653) [scope of GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=656) [So now let's get back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=658) [So now let's get back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=658) [pipeline and see what will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=662) [change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=665) [Application can now replace](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=665) [those separate IOSurfaces with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=667) [one 2D array texture, storing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=670) [the image for both i's.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=673) [This allows further optimization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=675) [as original 2D multi-sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=678) [array texture can be now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=680) [resolved in one pass as well to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=681) [just create it shareable through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=684) [the array texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=685) [But that's not everything.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=687) [Let's look at the compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=689) [Once we have simplified](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=692) [rendering parts on application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=693) [site, there is nothing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=695) [preventing compositor from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=696) [benefiting from those new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=698) [features as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=699) [So compositor can now use those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=701) [incoming 2D array textures and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=705) [perform work for both i's in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=707) [single render pass as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=710) [And as you can see, we've just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=711) [simplified the whole pipeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=714) [So let's do recap of what we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=717) [just learned.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=719) [We've just described two new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=721) [Metal features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=723) [Shareable Metal textures, and 2D](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=724) [multi-sample array texture type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=727) [And the way they can be used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=729) [further optimize your rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=732) [pipeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=734) [Both features will be soon](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=736) [supported in upcoming SteamVR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=737) [runtime updates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=739) [So now, let's focus on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=742) [techniques that will allow your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=743) [application to maximize its CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=745) [and GPU utilization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=747) [We will divide this section into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=749) [two subsections-- Advanced frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=752) [pacing and a reducing free rate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=754) [We will start with frame pacing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=758) [And in this section, we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=761) [analyze application frame pacing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=763) [and how it can be optimized for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=765) [VR.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=767) [So let's start with simple,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=768) [single-threaded application that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=770) [is executing everything in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=772) [serial monitoring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=773) [Such application will start its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=775) [frame by calling WaitGet pauses,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=777) [to receive pauses, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=780) [synchronize its execution to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=783) [frame rate of the headset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=785) [Both Vive and Vive Pro has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=789) [refresh rate of 90 frames per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=791) [second, which means the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=793) [application has only 11.1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=794) [milliseconds to process the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=797) [whole frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=798) [For comparison, blink of an eye](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=800) [takes about 300 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=802) [So in this time, the application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=805) [should render 50 frames.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=807) [So once our application receives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=810) [pauses from WaitGet pauses, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=812) [can start simulation of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=814) [trial [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=817) [When this simulation is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=818) [complete, and state of all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=819) [objects is known, application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=821) [can continue with encoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=823) [command buffer that will be then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=826) [sent to GPU for execution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=828) [Once GPU is done, an image for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=831) [both i's is rendered, it can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=834) [sent to VR compositor for final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=837) [post-processing, as we talked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=839) [post-processing, as we talked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=839) [about a few slides before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=841) [After that, frames scanned out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=842) [from memory to [inaudible] in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=847) [the headset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=848) [This transfer takes additional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=849) [frame as all pixels need to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=852) [updated before image can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=855) [presented.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=857) [Once all pixels are updated,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=859) [[inaudible] and user can see a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=863) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=865) [So as you can see from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=867) [moment the application receives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=868) [pauses, to the moment image is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=869) [really projected, it takes about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=872) [25 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=874) [That is why application receives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=875) [pauses that are already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=879) [predicted into the future, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=881) [the moment when photons will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=883) [emitted, so that the rendered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=885) [image is matching the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=887) [pause.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=889) [And this cascade of events](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=890) [overlapping with previous and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=894) [next frame is creating our frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=896) [basing diagram.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=898) [As you can see, in case of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=899) [As you can see, in case of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=899) [single-threaded application, GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=902) [is idle most of the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=904) [So let's see if we can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=907) [anything about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=908) [We are now switching to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=911) [multi-threaded application,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=913) [which separates simulation of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=915) [its visual environment from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=917) [encoding operations to the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=920) [Encoding of those operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=923) [will now happen on separate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=924) [rendering threads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=926) [Because we've separated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=928) [simulation from encoding,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=929) [simulation for our frame can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=931) [happen in parallel to previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=933) [frame encoding of GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=936) [operations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=938) [This means that encoding is now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=940) [shifted area in time, and starts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=943) [immediately after we receive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=945) [predicted pauses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=947) [This means that your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=949) [will now have more time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=950) [encode the GPU [inaudible] and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=952) [GPU will have more time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=954) [process it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=956) [So, as a result, your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=957) [application can have better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=959) [application can have better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=959) [visualize.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=960) [But there is one trick.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=962) [Because simulation is now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=965) [happening one frame in advance,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=967) [it requires separate set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=969) [predicted pauses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=972) [This set is predicted 56](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=974) [milliseconds into the future so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=976) [that it will match the set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=978) [predicted for rendering thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=980) [and both will match the moment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=982) [when photons are emitted.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=984) [This diagram already looks good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=987) [from CPU side, as we can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=988) [application is nicely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=991) [distributing its work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=992) [[inaudible] CPU course, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=993) [let's focus on GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=996) [As you can see, now our example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=998) [application is encoding all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1003) [these GPU [inaudible] for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1006) [whole frame into a single common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1008) [buffer, so unless this common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1011) [buffer is complete, GPU is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1014) [waiting idle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1016) [But it's important to notice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1018) [But it's important to notice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1018) [that encoding of GPU operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1020) [on a CPU takes much less time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1022) [than processing of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1025) [operations on the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1026) [So we can benefit from this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1028) [fact, and split our encoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1030) [operation into a few common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1033) [buffers while a few common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1035) [buffer will be encoded very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1037) [fast, with just few operations,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1039) [and submitted to GPU as fast as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1041) [possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1043) [This way, now our encoding is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1045) [processing in parallel to GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1050) [already processing our frame,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1053) [and as you can see, we've just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1055) [extended the time when GPU is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1056) [doing its work, and as a result,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1060) [further increase amount of work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1063) [that you can submit in a frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1065) [Now, let's get back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1068) [diagram, and see how it all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1069) [looks together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1070) [So as you can see, now both CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1073) [and GPU are fully utilized.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1075) [So [inaudible] application is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1078) [So [inaudible] application is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1078) [already very good example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1080) [your application, but there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1081) [still few things we can do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1083) [If you will notice, rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1087) [thread is still waiting with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1089) [encoding of any type of GPU work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1091) [before it will receive predicted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1094) [pauses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1096) [But not all [inaudible] in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1097) [frame requires those pauses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1099) [So let's analyze in more detail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1102) [to pick our frame workloads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1104) [Here, you can see a list of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1107) [workloads that may be executed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1110) [in each frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1112) [Part of them happen in screen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1114) [space or require general](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1115) [knowledge about pause for which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1117) [frame is rendered.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1119) [We call such workloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1121) [pause-dependent ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1122) [At the same time, there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1124) [workloads that are generic and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1126) [can be executed without](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1128) [knowledge about pauses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1130) [immediately.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1131) [We call those workloads pause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1133) [independent ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1134) [So currently, our application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1136) [was waiting for pauses to encode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1139) [was waiting for pauses to encode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1139) [any type of work to GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1141) [But if we split those workloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1143) [in half, we can encode pause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1145) [independent workloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1148) [immediately and then wait for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1149) [pauses to continue with encoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1152) [pause-dependent ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1154) [In this slide, we've already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1156) [separated pause independent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1159) [workloads from pause dependent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1161) [ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1163) [Pause independent workloads is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1164) [now encoded in [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1166) [common buffer, and is marked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1167) [with a little bit darker shade](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1169) [than pause-dependent workload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1171) [following it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1172) [Because pause-independent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1174) [workload can be encoded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1175) [immediately, we will do exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1176) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1179) [We will encode it as soon as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1179) [previous frame workload is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1181) [encoded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1182) [This gives CPU more time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1184) [encode the GPU work, and what is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1186) [even more important, it ensures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1189) [us that this GPU work is already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1191) [waiting for being executed on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1194) [GPU so there will be exactly no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1196) [idle time on GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1199) [idle time on GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1199) [As soon as previous frame is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1200) [finished, GPU can start with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1201) [next one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1204) [The last subsection is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1206) [multi-GPU workload distribution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1209) [We can scale our workload across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1213) [multiple GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1215) [Current Mac Book Pro has two GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1216) [on board, and while they have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1219) [different performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1221) [characteristics, there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1222) [nothing preventing us from using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1223) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1225) [Similarly, if each GPU is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1226) [connected, application can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1227) [it for rendering to the headset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1229) [while using Mac's primary GPU to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1232) [offload some work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1234) [So we've just separated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1239) [pause-independent work and moved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1240) [it to a secondary GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1243) [We could do that because it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1245) [already encoded much earlier in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1248) [our frame, and now this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1252) [pause-independent workload is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1253) [executing in parallel to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1255) [pause-dependent workload of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1257) [previous frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1259) [As a result, we further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1260) [increased the amount of GPU time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1261) [that you had for your frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1263) [But, by splitting this work into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1267) [multiple GPUs, we now get to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1269) [point where we need a way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1273) [synchronize those workloads with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1274) [each other.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1276) [So today we introduce new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1282) [synchronization parameters to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1284) [deal exactly with such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1286) [situation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1287) [MTL Events can now be used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1288) [synchronize GPU work in scope of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1291) [single GPU across different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1293) [Metal cues and MTL Shared Events](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1295) [extends this functionality by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1299) [allowing it to synchronize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1301) [workloads across different GPUs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1302) [and even across different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1304) [processes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1306) [So here we will go through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1309) [simple code example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1311) [We have our Mac, with attached](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1313) [eGPU through Thunderbolt 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1315) [connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1317) [This eGPU will be our primary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1318) [This eGPU will be our primary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1318) [GPU driving the headset, so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1320) [can use GPU that is already in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1324) [our Mac as secondary supporting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1326) [GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1328) [And we will use shared event to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1330) [synchronize workloads of both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1332) [GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1338) [Event initial value is zero, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1339) [it's important to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1341) [synchronization counter from 1.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1342) [That's because when we would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1346) [wait on just initialized event,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1347) [its counter of zero will cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1350) [it to return immediately, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1352) [there would be no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1354) [synchronization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1355) [So our rendering thread now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1357) [starts encoding work for our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1359) [supporting GPU immediately.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1361) [It will encode pause-independent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1364) [work that will happen on our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1366) [supporting GPU course, and once](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1368) [this work is complete, its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1371) [results will be stored in locker](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1373) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1375) [That's why we follow with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1376) [encoding brief operation that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1379) [encoding brief operation that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1379) [will transfer those results to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1381) [system memory that is visible by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1383) [both GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1385) [And once this transfer is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1387) [complete, our supporting GPU can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1388) [safely signal our shared event.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1392) [This signal will tell eGPU that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1395) [now it's safe to take those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1398) [results.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1399) [So our rendering thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1401) [committed this [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1403) [common buffer, and supporting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1404) [GPU is already processing its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1406) [work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1408) [At the same time, we can start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1410) [encoding command buffer for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1412) [primary GPU that is driving the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1414) [headset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1416) [In this command buffer, we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1417) [start by waiting for our shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1419) [event to be sure that the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1421) [is in system memory, and once](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1423) [it's there, and the shared event](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1425) [is signaled, we can perform a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1427) [brief operation that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1430) [transfer this data through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1431) [Thunderbolt 3 connection, back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1432) [to our [inaudible] GPU and once](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1435) [this transfer is complete, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1437) [safe to perform pause-dependent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1439) [safe to perform pause-dependent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1439) [work, so a second command buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1441) [will signal lockout event to let](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1445) [pause-dependent work know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1448) [it can start executing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1450) [After encoding and submitting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1452) [those two command buffers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1454) [rendering thread can continue as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1456) [usual, with waiting for pauses,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1458) [and later encoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1460) [pause-dependent work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1461) [So now we have a mechanism to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1466) [synchronize different workloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1468) [between different GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1470) [But as you can see, our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1471) [secondary GPU is still a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1475) [bit idle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1477) [That's because in this example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1478) [we decided to push through it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1480) [pause dependent workloads that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1484) [have dependency with pause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1485) [dependent ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1487) [Excuse me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1489) [But of course there are types of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1490) [workloads that have no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1492) [dependencies, and they can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1493) [happen at lower frequencies, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1495) [frequency of the headset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1497) [One example of such workloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1499) [One example of such workloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1499) [can be, for example, simulation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1501) [of physically based accurate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1503) [[inaudible] or anything else](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1505) [that requires a lot of time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1507) [be updated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1511) [Such workload can happen in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1513) [background, completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1515) [asynchronously from rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1517) [frames, and each time it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1518) [ready, its results will be sent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1520) [to primary GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1523) [It's marked here with gray color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1525) [to indicate that it's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1527) [related to any particular frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1528) [So, of course there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1532) [different GPUs with different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1533) [performance characteristics, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1536) [they will have different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1538) [bandwidth connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1538) [And your application will have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1540) [different workloads in a single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1543) [frame with different relations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1544) [between them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1547) [So you will need to design a way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1548) [to distribute this workload on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1551) [your own, but saying all that,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1553) [it's important to start thinking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1556) [about this GPU workload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1558) [about this GPU workload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1558) [distribution, as multi-GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1560) [configuration are becoming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1562) [common on Apple platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1564) [So let's summarize everything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1567) [that we've learned in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1570) [section.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1571) [We showed multi-thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1572) [application to take full benefit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1573) [of all CPU codes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1576) [And split your command buffers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1577) [to ensure that GPU is not idle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1580) [When doing that, if possible,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1583) [try to separate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1586) [pause-independent from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1587) [pause-dependent workloads, to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1588) [able to encode this work as soon](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1591) [as possible, and even further,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1592) [splitting workloads by frequency](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1596) [of update so if your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1598) [will execute on multi-GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1601) [configuration, you can easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1602) [distribute it across those GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1604) [And while doing that, ensure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1608) [that you drive each GPU with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1611) [separate rendering threads to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1613) [ensure that they all execute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1615) [asynchronously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1617) [Now, you switch to reducing fill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1619) [Now, you switch to reducing fill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1619) [rate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1621) [Vive Pro introduces new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1623) [challenges for VR application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1625) [developers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1626) [To better understand scale of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1628) [the problem, we will compare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1629) [different medium fill rates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1631) [So, for example, application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1632) [rendering in default scaling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1635) [rate to Vive headset, produces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1638) [436 megapixels per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1642) [And most advanced [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1647) [against that [inaudible] HD TVs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1650) [have fill rate of 475 megapixels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1652) [per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1659) [Those numbers are already so big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1660) [that game developers use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1664) [different tweaks to reduce this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1665) [fill rate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1667) [Now, let's see how Vive Pro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1668) [compares to those numbers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1669) [Vive Pro has a normal fill rate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1673) [of 775 megapixels per second,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1675) [and if you add to that four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1679) [and if you add to that four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1679) [times multi-sampling [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1680) [or bigger scaling rate, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1683) [number will grow even more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1685) [That is why reducing fill rate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1686) [is so important.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1689) [There are multiple techniques](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1692) [there and new techniques are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1693) [made every day.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1694) [So I encourage you to try them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1696) [all, but today we will focus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1699) [only on a few still as they are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1702) [the simplest to implement and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1704) [bring nice performance gains.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1707) [So we will start with clipping](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1710) [invisible pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1711) [Here, you can see image rendered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1713) [for left eye.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1716) [But due to the nature of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1718) [lens work, about 20% of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1720) [pixels are lost after compositor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1724) [performs its distortion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1727) [correction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1729) [So on the right, you can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1730) [image that will be displayed on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1732) [a panel in a headset before it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1733) [goes through the lens.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1735) [So, the simplest way to reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1738) [So, the simplest way to reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1738) [our fill rate is to prevent our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1740) [application from rendering those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1743) [pixels that won't be visible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1745) [anyway, and you can do that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1747) [easily by using SteamVR Stencil](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1749) [Mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1752) [So we've just saved 20% of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1754) [fill rate by applying this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1758) [simple mask, and reduce our Vive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1760) [Pro fill rate to 620 megapixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1762) [Now, we will analyze implication](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1769) [of this lens distortion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1772) [correction in more detail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1773) [We will divide our field of view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1776) [into nine sections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1780) [Central section has field of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1783) [view of 80 degrees horizontally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1785) [by 80 degrees vertically, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1788) [have surrounding sections on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1791) [edges and corners.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1793) [We've color tinted them to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1795) [better visualize the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1797) [contribution to final image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1798) [contribution to final image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1798) [So as you can see, corners are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1801) [almost completely invisible and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1805) [edges have matched less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1808) [contribution to the image than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1811) [in the original one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1813) [In fact, if you see this image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1815) [in the headset, you wouldn't be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1817) [able to look directly at the red](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1820) [sections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1822) [The only way to see them would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1824) [be with your peripheral vision.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1825) [So this gives us great hint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1828) [We can render those edge and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1833) [corner sections and a reduced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1835) [fill rate, as they are mostly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1837) [invisible anyway.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1840) [We render the central section as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1842) [we did before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1845) [But then we will render vertical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1847) [edges with half of the width and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1849) [horizontal sections with half of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1851) [the height.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1853) [And finally, we will render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1854) [corner edges at one-fourth of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1857) [corner edges at one-fourth of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1857) [the resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1860) [Once our expensive rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1863) [pass is complete, we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1865) [perform cheap upscaling pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1866) [that will stretch those regions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1869) [back to the resolution at which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1871) [they need to be submitted to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1873) [compositor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1874) [So you are wondering how much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1876) [we've gained by doing that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1878) [In case of 80 by 80 degree](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1881) [central region, we reduced our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1883) [fill rate all the way down to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1885) [491 megapixels per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1887) [But you remember that we just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1891) [talked about clipping invisible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1892) [pixels, so let's combine those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1894) [two techniques together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1896) [By clipping pixels combined with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1900) [multi-resolution shading, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1902) [can reduce your fill rate even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1904) [further to 456 megapixels per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1905) [second, and that is not a random](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1908) [number.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1910) [In fact, that's a default fill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1911) [rate of Vive headset, so by just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1914) [using those two optimization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1917) [techniques, your application can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1919) [techniques, your application can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1919) [render to Vive Pro with much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1921) [higher resolution using exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1923) [the same GPU as it did when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1925) [rendering to Vive headset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1928) [Of course, you can use those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1930) [techniques when rendering to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1932) [Vive as well, which will allow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1933) [you to bring visualize of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1935) [application even further and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1937) [make it prettier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1940) [There is one caveat here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1941) [Multi-resolution shading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1945) [requires few render passes, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1947) [it will increase your workload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1950) [on geometric [inaudible], but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1954) [you can easily mitigate that by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1956) [just reducing your central](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1958) [vision by a few degrees.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1959) [Here, by just reducing our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1962) [central vision by 10 degrees,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1964) [we've reduced fill rate all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1966) [way to 382 megapixels per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1968) [second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1970) [And if your geometry workload is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1971) [really high, you can go further,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1973) [and experiment with lower fill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1976) [rate, lower regions, that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1979) [rate, lower regions, that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1979) [reduce fill rate even more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1982) [In case of 55 by 55 degrees](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1984) [central region, 80% of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1987) [[inaudible] eye movement will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1991) [still inside this region, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1992) [we've reduced our fill rate by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1995) [more than half, to 360](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=1997) [megapixels per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2000) [So of course there are different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2003) [ways to implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2005) [multi-resolution shading.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2006) [And you will get different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2010) [performance gains from that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2012) [So I encourage you to experiment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2014) [with this technique and try what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2016) [will work for you best.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2018) [So let's summarize everything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2021) [that we've learned during this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2022) [session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2026) [We've just announced plug and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2027) [play support for Vive Pro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2028) [Headsets, and introduced new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2030) [Metal 2 features that allow you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2033) [now to develop even more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2035) [advanced VR applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2037) [And I encourage you to take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2039) [And I encourage you to take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2039) [advantage of multi-GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2041) [configurations, as they are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2043) [becoming common on other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2045) [platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2046) [You can learn more about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2048) [session from this link, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2052) [would like to invite all of you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2054) [to meet with me and my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2056) [colleagues during Metal 4 VR](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2057) [Lab, that will take place today](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2059) [at 12:00 p.m. in Technology Lab](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2061) [6.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2064) [Thank you very much.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2064) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/611/?time=2067)