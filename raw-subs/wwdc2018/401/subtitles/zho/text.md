# What's New in Swift

## Summary
Hear about the latest advancements in Swift, the safe, fast, and expressive language. Find out about improvements to build times, code size, and runtime performance. Learn how to take advantage of new features in your code that eliminate boilerplate, increase safety and security, and improve your overall development productivity.

## Info
* Developer Tools
* WWDC 2018 - Session 401 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=7) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=25) [&gt;&gt; 上午好 欢迎参加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=29) [Swift 新功能介绍会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=31) [今年对于 Swift 和 Swift 社区来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=33) [发生了许多激动人心的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=37) [接下来的 40 分钟里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=37) [Slava 和我将很荣幸](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=39) [向大家介绍一系列最新进展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=40) [本会议大致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=43) [分为两部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=44) [首先 我会介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=46) [Swift 开源计划](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=47) [以及整个社区的新情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=48) [接下来 我们会探讨 Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=51) [Swift 4.2 将从今天起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=52) [在 Xcode 10 测试版中提供预览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=54) [2015 年年底开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=58) [2015 年年底开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=58) [Swift 作为开源项目登陆 GitHub](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=60) [用户社区十分活跃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=64) [大家展开讨论 提交新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=66) [审核后将新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=70) [加入语言和标准库中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=71) [在此期间 有 600 人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=75) [向 GitHub 上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=77) [Swift 开源项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=78) [贡献了代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=80) [总共合并了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=82) [18000 多项合并请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=83) [自从 Swift.org 上线以来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=87) [Swift 便可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=89) [Swift.org 上下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=91) [作为可下载工具链用于 Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=93) [以及多个版本的 Ubuntu](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=96) [其中既包括开发快照 也包括正式版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=98) [我们希望 Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=105) [得到所有平台的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=106) [方便大家使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=108) [重要工作之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=110) [就是拓展社区的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=113) [测试支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=115) [许多开源项目用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=117) [也在努力让 Swift 支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=118) [也在努力让 Swift 支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=118) [其他平台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=121) [我们也想要助一臂之力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=122) [大约一个月前 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=125) [扩展了公共持续集成系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=127) [以支持社区设立的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=128) [持续集成节点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=130) [如果你是社区的一员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=132) [想要让 Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=133) [得到其他平台的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=134) [你现在可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=136) [直接接入你的硬件支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=138) [并开始测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=139) [这一前提可以帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=141) [Swift 得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=142) [其他平台的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=143) [我们还投入了很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=146) [建立了 Swift 开源项目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=149) [周边社区 在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=151) [社区成员可以讨论语言中的所有变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=153) [大约六个月前 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=156) [不再使用邮件列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=158) [因为信息量太大 而改用论坛](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=160) [这是当时社区的呼声](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=162) [起初有很多人想要以适合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=165) [自己的方式真正](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=168) [参与项目 但发现困难重重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=170) [有了论坛 你们就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=174) [以适合自己的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=175) [方式参与项目 论坛非常成功](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=177) [方式参与项目 论坛非常成功](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=177) [我们也想拓展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=180) [它的用途 支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=182) [整个开源项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=184) [如果你在维护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=187) [一个开源项目 例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=190) [很受欢迎的 Swift 库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=191) [你就可以用论坛](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=193) [来讨论项目内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=195) [例如与用户沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=196) [或讨论开发进度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=198) [我们还想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=200) [拓展 Swift.org 的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=202) [让它能为整个社区所用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=204) [本周 我们将把 Swift 编程语言手册](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=206) [迁移到 Swift.org](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=209) [地址为 docs.swift.org](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=211) [我们今后也会在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=213) [公布更多文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=215) [供社区使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=217) [关于 Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=219) [最激动人心的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=222) [人们很喜欢使用 Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=225) [并且在很多场合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=226) [讨论 Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=228) [例如博客 聚会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=229) [还有会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=231) [而 Apple 认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=233) [我们很有必要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=234) [参与其中 因为讨论就是在这些地方发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=236) [过去一年间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=240) [我们格外重视](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=242) [参与这些会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=244) [并且进行了技术展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=246) [包括我们在 Swift 上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=249) [工作 Swift 的工作原理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=250) [还有你们参与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=253) [开源项目的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=254) [这些我们在今后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=256) [也会致力于向前推进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=257) [其中一项重要努力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=261) [是周五在 WWDC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=262) [场地附近举办的 try Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=265) [圣何塞会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=267) [届时会有工作坊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=269) [成员来自社区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=271) [帮助有兴趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=273) [为 Swift 开源项目做贡献的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=274) [与会人员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=276) [届时 Apple 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=278) [编译器团队也会出席](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=279) [帮助大家进行交流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=282) [以上就是关于社区的新进展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=285) [我们来谈谈 Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=289) [我认为 首先应当谈谈 这个版本的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=290) [内容 以及在整体发展过程中的地位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=293) [Swift 更新 特别是大版本更新 大约](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=298) [Swift 更新 特别是大版本更新 大约](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=298) [两年一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=301) [Swift 4.2 是继 Swift 4.1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=302) [和 4.0 之后的大版本更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=304) [总体而言 这个版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=308) [有两大要点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=310) [第一是进一步关注](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=312) [开发者效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=314) [你们可以在很多方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=315) [感受到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=316) [项目构建速度更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=317) [但整体而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=319) [核心工具的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=320) [也大幅改善](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=322) [例如调试器（Debugger）和编辑器（Editor）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=324) [Swift 社区也](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=326) [也不断重视改进语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=328) [从而改善一般的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=330) [开发者工作流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=332) [去除鸡肋代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=333) [Apple 也一直在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=334) [改进 SDK 从而](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=336) [让 Objective-C API 更好地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=339) [映射到 Swift 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=341) [改善对语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=344) [和 API 的运用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=345) [另一方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=348) [语言底层得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=349) [大幅改善](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=351) [运行时间也有很多变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=353) [以实现二进制兼容性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=355) [这一功能将在 Swift 5 中推出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=358) [这一功能将在 Swift 5 中推出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=358) [预计于 2019 年早些时候发布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=361) [什么是二进制兼容性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=365) [二进制兼容性指](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=368) [构建 Swift 代码时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=369) [你可以使用 Swift 5 的编译器和层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=371) [而在二进制层面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=373) [代码可以与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=375) [同一编译器或其他编译器层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=376) [构建的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=377) [相互操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=379) [这一点十分重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=380) [标志着这门语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=382) [走向成熟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=383) [有了这一功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=385) [Apple 就可以将 Swift 运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=386) [移入操作系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=388) [App 可以直接使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=390) [而不再需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=392) [将其放入 App 包中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=393) [这样可以缩减代码体积](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=395) [但同样重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=397) [启动时间和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=398) [内存使用也能得到优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=400) [对社区而言帮助很大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=402) [我们也会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=404) [公布实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=406) [ABI 稳定性或二进制兼容性的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=408) [相关进展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=410) [可以访问 Swift.org 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=411) [ABI 稳定性总览页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=412) [跟踪进展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=414) [今天的重点是 Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=417) [今天的重点是 Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=417) [这是实现 Swift 5 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=420) [重要一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=421) [我们来谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=423) [源兼容性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=425) [像 Xcode 9 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=427) [Xcode 10 只搭载一种 Swift 编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=430) [如果你使用 Xcode 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=433) [你就在使用 Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=435) [但就像 Xcode 9 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=437) [这一编译器也支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=440) [多种语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=442) [兼容性模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=443) [在所有模式中 你都可以使用新 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=445) [可以使用全部新特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=448) [这足以带来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=450) [影响代码源的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=451) [前两个模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=454) [在 Xcode 9 中就已存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=457) [保留它们是为了提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=459) [开箱即用式的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=460) [你可以直接构建 Swift 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=461) [和 Swift 4 代码 不需修改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=463) [Swift 4.2 模式与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=465) [Swift 4 模式基本相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=467) [但包含刚才提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=469) [SDK 改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=471) [就这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=473) [如果使用之前版本的 Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=474) [可以使用迁移帮助（Migrator Support）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=477) [该功能位于编辑（Edit）菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=478) [用来自动进行大部分修改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=479) [用来自动进行大部分修改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=479) [我想先做一项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=482) [关于 Swift 4.2 SDK 变化的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=483) [免责声明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=486) [后期的 Xcode 10 测试版可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=487) [会进一步改进 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=489) [这是为了能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=491) [整合大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=493) [关于 API 改进方向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=494) [和改进如何反映在 Swift 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=496) [等反馈意见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=498) [这意味着 如果你提前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=500) [迁移到 Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=502) [就要注意后续可能出现的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=503) [你也可以先不迁移 之后再选择迁移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=505) [完全取决于你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=507) [Swift 4.2 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=510) [我们在加速让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=512) [Swift 代码成型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=514) [并面向未来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=515) [这是语言成熟的重要阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=516) [因此 我们认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=521) [大家都有必要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=523) [从 Swift 3 迁移到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=524) [Swift 4.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=527) [代码体积得到了重要改善](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=528) [语言整体也](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=530) [有所改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=531) [Xcode 10 将会是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=532) [最后一个支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=534) [Swift 3 兼容模式的版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=535) [我们来谈谈工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=539) [我们来谈谈工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=539) [方面的改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=540) [在 Platform State of the Union 会议中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=542) [我们提到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=544) [Xcode 9 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=545) [Swift 项目构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=546) [也得到了显著改善](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=547) [这些结果是在一台配备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=550) [四核 i7 处理器的 MacBook Pro 上得到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=552) [我们来仔细看看其中之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=553) [这个项目混合了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=558) [Objective-C 和 Swift 代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=560) [它最初是一个 Objective-C 项目 随后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=562) [开始采用 Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=564) [这种情况很常见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=566) [屏幕上的构建时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=568) [提升无法反映](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=569) [构建这段 Swift 代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=572) [到底比之前快了多少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=573) [如果我们只关注](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=576) [Swift 构建速度的提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=577) [构建速度实际上快了三倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=579) [这就是为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=583) [项目速度提升只有 1.6 倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=585) [可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=589) [构建速度提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=591) [整体取决于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=592) [项目性质 使用多少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=593) [Swift 代码 以及处理器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=594) [核数 但实际情况中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=596) [许多项目都提速多达两倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=598) [许多项目都提速多达两倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=598) [提升主要由于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=602) [Swift 目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=604) [具有跨文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=606) [可见性 这是 Swift 的优异特性之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=608) [不需要头文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=610) [过去编译器会执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=612) [许多冗余工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=613) [于是 我们就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=615) [重新设计了编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=617) [流程 大幅减少了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=618) [冗余 并且更好的利用处理器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=620) [你机器上的核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=621) [因此才会有这样的速度提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=623) [欲知更多细节 本周晚些时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=625) [会有两场讲座](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=627) [深入分析构建过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=628) [背后的工作原理 会提到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=630) [更多细节 解释](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=631) [为何会有如此性能提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=632) [性能大幅提升是由于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=636) [调试版本构建的改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=638) [我想重点讲这一功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=641) [为何出现在 Xcode 的构建选项中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=644) [最近我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=648) [编译模式（Compilation Mode）从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=649) [优化水平（Optimization Level）中分离出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=651) [编译模式决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=653) [项目构建的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=655) [如果是构建发行版本（Release）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=657) [默认设置是全模组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=658) [编译（Whole Module Compilation）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=659) [编译（Whole Module Compilation）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=659) [目标中全部文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=661) [总是一起构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=662) [进行优化的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=664) [可能性最高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=665) [重点不是优化的数量 而是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=667) [进行优化的可能性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=669) [而如果是调试版本（Debug）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=672) [则是增量（Incremental）构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=674) [并非所有文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=675) [都会构建 或者再构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=676) [这是性能表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=679) [和构建时间权衡的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=680) [调试版本构建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=683) [优化水平默认仍然是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=684) [无优化（No optimization）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=685) [这样构建速度更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=686) [调试信息更全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=687) [发行版本构建则着重优化速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=689) [我们稍后会再提到优化水平](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=692) [好的 分离编译模式和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=698) [优化水平](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=702) [反映了一个非常有趣的权宜之计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=705) [有人发现有时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=706) [如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=708) [结合全模组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=710) [编译并且无优化时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=711) [可以更快的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=713) [构建调试版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=715) [这是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=716) [这一组合显著减少了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=718) [这一组合显著减少了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=718) [我们现在努力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=722) [消除或大幅减少的冗余工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=724) [而这样组合的问题在于 它会减慢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=730) [增量构建的速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=732) [只要你修改了目标中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=733) [一个文件 整个目标就要重新构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=734) [而 Xcode 10 改进了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=737) [调试版本构建 我们认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=738) [你们不再需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=740) [使用这种权宜之计 我们也](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=741) [发现 默认的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=744) [增量构建 表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=745) [同这种组合相当 甚至更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=747) [特别是现在 增量构建得到了正式支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=749) [我们来谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=754) [运行时得到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=755) [底层优化 这也是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=757) [实现二进制兼容的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=758) [环节之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=759) [Swift 使用自动内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=763) [管理 并且像 Objective-C 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=765) [使用引用计数（reference counting）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=767) [管理对象实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=769) [这张幻灯片上 用备注](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=771) [显示出编译器在哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=773) [插入（insert） 保留（retain） 释放（release）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=774) [这是 Swift 4.1 中的运行方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=777) [这是 Swift 4.1 中的运行方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=777) [对象创建时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=782) [会关联一个 +1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=783) [引用计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=784) [惯例是 如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=785) [对象作为一个参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=788) [传递到另一个函数中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=789) [那个函数的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=791) [就应该释放对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=792) [这基本上就是让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=794) [函数调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=796) [释放对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=798) [这样一来 就有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=800) [机会改进性能 缩减](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=801) [一些对象的生命周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=802) [限制到最小范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=805) [但是 如果你的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=807) [将对象传递到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=810) [不同 API 的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=812) [可能会是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=814) [由于存在这种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=815) [调用惯例 就依然存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=817) [这种往复操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=818) [最初的引用计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=820) [在最后的调用中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=821) [抵消](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=822) [但中间的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=823) [又应当有额外的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=824) [保留和释放过程 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=825) [这是惯例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=828) [这样会造成浪费 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=830) [对象在函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=832) [执行期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=833) [始终存活（alive）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=835) [所以 Swift 4.2 中 我们改变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=837) [调用惯例 这样一来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=839) [调用惯例 这样一来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=839) [就不再由被调用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=841) [一方来释放对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=842) [这样一来 所有的保留](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=845) [和释放都不复存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=846) [可以显著减少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=850) [保留和释放的数据量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=852) [这有两重意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=853) [一 可以缩减代码体积](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=855) [因为这些调用不复存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=856) [二 可以改善运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=859) [另一项重要的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=861) [针对字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=864) [Swift 4.2 的字符串为 16 个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=866) [字节长 此前长度为 24](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=868) [这也是我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=870) [权衡内存使用和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=871) [性能的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=873) [但同时 这一长度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=875) [也足以对小字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=877) [进行优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=878) [如果字符串不足 15](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=880) [字节长 实际的字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=882) [就可以直接用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=885) [字符串类型表示 而不用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=886) [分配单独的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=888) [缓冲区来表示字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=889) [这显然既有利于内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=891) [也有利于性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=893) [这很像我们在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=895) [NSString 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=896) [所做的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=897) [但我们可以存储更大的字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=898) [但我们可以存储更大的字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=898) [最后 在我把舞台交给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=903) [Slava 之前 我们来谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=905) [语言本身的改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=906) [我想多谈一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=907) [缩减代码体积方面的努力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=908) [我之前在谈到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=912) [调用惯例改变的时候 提到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=913) [缩减代码体积](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=914) [我们还推出了一个新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=915) [优化水平选项 即优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=917) [体积（Optimize for Size [-Osize]）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=919) [这一点很有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=921) [尤其是当 App 非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=922) [关心体积限制的时候 例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=924) [使用蜂窝网络进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=925) [下载的限制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=927) [Swift 是一门强大的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=929) [静态语言 以静态的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=930) [理解程序行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=933) [因此 编译器有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=935) [优化性能的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=936) [机会 例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=938) [将函数调用内联（function call inlining）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=940) [以及推测性去虚化（speculative](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=941) [devirtualization） 这些方法牺牲代码体积](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=943) [以换取性能 然而](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=944) [有时候 这部分性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=945) [并非实际需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=947) [这是对 Swift 源编译套件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=949) [实行 Osize 优化的结果 其中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=951) [包括一系列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=954) [GitHub 项目 如框架和 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=955) [可以看到 优化范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=959) [可以看到 优化范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=959) [取决于使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=960) [哪些语言特性 代码体积](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=961) [缩减了 10% 到 30%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=963) [这里所说的代码体积指的是编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=965) [Swift 代码过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=967) [构建的机器码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=969) [不是 App 的整体体积](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=971) [App 整体体积取决于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=972) [应用素材等多重因素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=974) [现实中 我们发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=977) [运行时性能会下降大约 5%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=979) [这需要牺牲一小部分性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=981) [对很多 App 而言 这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=984) [无伤大雅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=985) [所以确实取决于实际用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=986) [但如果你对此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=989) [感兴趣 我们也鼓励你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=990) [进行尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=991) [现在 我要把舞台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=994) [交给 Slava  他会谈到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=995) [Swift 4.2 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=996) [语言方面的重大改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=997) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1000) [&gt;&gt; 大家好 我是 Slava Pestov](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1006) [我负责 Swift 编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1007) [今天 我想谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1009) [Swift 4.2 中的新语言特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1010) [可以如何帮助你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1012) [写出更简单 更易维护的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1014) [在讲到语言的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1017) [新变化之前 先来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1019) [新变化之前 先来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1019) [回顾一下改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1020) [语言的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1022) [如同 Ted 所说 Swift 是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1024) [开源项目 也具备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1026) [开放式设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1028) [也就是说 如果你有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1030) [改进语言的想法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1031) [你可以在论坛上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1033) [提出来 如果想法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1034) [得到足够认可 并列入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1036) [提议案 你就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1038) [把想法和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1040) [实现提交给核心团队](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1041) [以供审核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1043) [此时 会有正式审核期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1044) [社区成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1046) [可以提供额外反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1047) [之后 核心团队](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1049) [就会决定是否](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1050) [接受提议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1052) [如果访问 Swift Evolution](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1054) [网站 就能看到一系列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1056) [提议 这些提议均得到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1058) [接受 并将在 Swift 4.2 中实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1059) [列表中包含的提议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1063) [数量很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1064) [我今天无法涉及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1066) [所有提议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1067) [但有一点我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1068) [强调 那就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1070) [有很多提议是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1071) [由社区设计并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1073) [实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1075) [这表明 这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1076) [提议针对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1078) [你们遇到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1079) [你们遇到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1079) [各类常见问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1081) [也是你们想出了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1083) [解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1085) [并向 Swift 贡献了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1087) [解决方案 使人人收益](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1089) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1092) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1094) [第一项改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1099) [我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1101) [如何在使用枚举时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1102) [去除鸡肋代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1103) [比如说 我要获得一个枚举](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1106) [我想要打印出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1108) [这个枚举包含的所有值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1110) [在 Swift 4 中 我需要定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1113) [一个属性 例如包括所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1116) [可能样例的列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1119) [如果我要添加新的样例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1121) [我要记得更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1124) [属性 否则就会呈现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1126) [行为或运行时错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1128) [这种做法并不好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1130) [因为你在向编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1133) [重复自己的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1134) [所以在 Swift 4.2 中 我们添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1136) [新的 CaseIterable 协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1139) [新的 CaseIterable 协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1139) [如果你表示遵从（conformance）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1141) [这一协议 编译器就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1143) [将包含所有样例的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1144) [同步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1146) [简短而有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1147) [[ 鼓掌 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1149) [下一项改进 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1153) [要去除另一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1155) [鸡肋代码的根源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1156) [这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1158) [你的代码往往](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1159) [不够泛型（generic）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1160) [Swift 4 中 我们为序列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1162) [引入了 contains() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1164) [这就要求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1167) [序列的元素类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1168) [为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1170) [才能找出所需的元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1172) [当然 我可以对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1174) [字符串组成的数组调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1176) [因为字符串是 Equatable 类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1178) [但如果对数组组成的数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1179) [调用呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1181) [如果子数组包含整型（integer）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1183) [类型就不为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1185) [也就是说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1188) [编译时间错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1189) [你可能会问 为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1191) [标准库不让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1193) [所有数列为 Equatable 呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1195) [但那样不合逻辑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1197) [因为如果数列的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1198) [因为如果数列的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1198) [元素类型不为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1200) [Equatable 例如函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1201) [你也不能让数列为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1203) [但显然 如果数列的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1207) [元素类型为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1209) [我就可以为数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1210) [定义等值运算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1212) [以比较数组中的元素对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1214) [而这就是条件一致性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1217) [（conditional conformance）对标准库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1218) [发挥的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1220) [现在 如果数组元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1221) [类型为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1223) [那么数组样例也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1224) [实现 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1226) [Swift 4.2 中 之前展示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1227) [例子可以运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1229) [除了数组为 Equatable 外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1231) [标准库还定义了其他一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1234) [条件一致性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1237) [例如 选项（options）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1239) [和字典（dictionaries）也是 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1241) [前提是它们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1242) [元素类型为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1244) [Hashable Encodable 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1246) [Decodable 同理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1249) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1252) [这样一来 你就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1258) [用全新的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1259) [用全新的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1259) [构建集合（collections）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1261) [这里 有一些由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1262) [整数构成的数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1265) [一切运行正常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1269) [欲知更多细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1270) [本周晚些时候有一场会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1273) [可以进一步了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1274) [条件一致性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1277) [以及 Swift 4.2 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1278) [今天无法提及的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1279) [泛型改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1281) [如果要定义自己的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1283) [Equatable 和 Hashable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1285) [成员（conformances）呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1286) [Swift 中的通用做法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1288) [用包含许多存储属性（stored properties）的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1290) [结构体来实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1292) [而这些存储属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1294) [应为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1296) [接下来 要想让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1297) [结构体 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1298) [只需比较两个值的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1300) [属性即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1302) [此前在 Swift 4 中 你需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1303) [亲手写出这些内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1305) [这就是鸡肋代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1307) [如果添加一个新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1308) [存储属性 就要记得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1310) [更新 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1311) [实现 很容易在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1313) [拷贝粘贴等过程中出错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1314) [Swift 4.1 中 我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1317) [合成 equality（相等性）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1319) [合成 equality（相等性）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1319) [的使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1321) [如果忘记了实现部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1323) [编译器会为你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1325) [补上 前提是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1326) [存储属性本身为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1328) [这也适用于 Hashable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1331) [那么如果是泛型呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1333) [这个数据类型中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1336) [值可能是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1337) [左类型的实例 或者是右类型的实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1339) [我想让左右类型都为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1342) [Equatable  因为我想令这两个类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1346) [为函数 错误（errors）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1348) [或其他不为 Equatable 的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1351) [但显然 我可以定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1352) [条件一致性 这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1354) [如果左右类型都为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1356) [Equatable  二者之一即为 Equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1357) [但还可以进一步改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1360) [注意此处的可等性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1362) [实现 只有一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1363) [显然正确的实现方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1365) [需要确保两个值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1367) [包含相同的样例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1369) [如果确实如此 则需要检查载体（payloads）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1371) [以确保可等性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1373) [你可能会想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1374) [编译器应该能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1376) [替你进行合成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1377) [Swift 4.2 中确实可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1378) [Swift 4.2 中确实可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1378) [该功能也可用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1381) [Hashable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1382) [比方说 现在就可以创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1384) [元素为整型或字符串的集合了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1387) [好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1391) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1392) [有时 你确实需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1396) [手动实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1398) [可等性和哈希值（Hashing）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1399) [我们来看一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1403) [假如说 有一个数据类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1406) [表示一座城市 其中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1408) [包括城市名 包括所在的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1410) [州 还包括城市的人口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1412) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1414) [我只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1415) [比较城市名和州](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1418) [以确保可等性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1419) [如果数值相等 就不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1421) [对比人口了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1422) [如果我让编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1424) [合成可等性的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1426) [实现 就会产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1428) [冗余 因为它还比较了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1429) [人口信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1432) [我当然可以把这部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1433) [写成代码 或许此时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1435) [这样还可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1436) [但 Hashable 呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1438) [如果我想计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1441) [城市对象的哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1442) [我就要算出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1445) [城市名的哈希值和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1447) [州的哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1448) [再想办法结合二者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1449) [但该怎么做呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1451) [可以用异或运算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1453) [也可以用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1455) [网上随便找的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1458) [或者自己编的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1460) [运算方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1461) [但这两种办法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1463) [都不够好 好像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1464) [结合哈希值的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1467) [是一种魔法似的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1469) [而出错的成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1470) [也相当高 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1472) [字典和集合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1474) [要想具备良好性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1475) [确实需要依赖](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1477) [高质量的哈希函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1479) [同时也有安全考量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1482) [如果攻击者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1484) [打造的输入能生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1486) [相同的哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1489) [并通过互联网发给你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1491) [就可能降低 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1492) [运行速度 以致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1494) [无法使用 即发起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1495) [阻断服务攻击（denial-of-service attack）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1496) [所以 在 Swift 4.2 中 我们添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1498) [所以 在 Swift 4.2 中 我们添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1498) [更好的 API 实现该功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1501) [可以回想一下 Swift 4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1503) [和 4.1 中的 Hashable 协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1505) [其中一个 hashValue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1507) [要求（requirement） 返回一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1509) [整型值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1510) [Swift 4.2 中 我们重新设计了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1512) [Hashable 协议 现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1514) [有了新的 Hash into 要求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1517) [Hash into 不产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1520) [单一哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1521) [而是选用一个 Hasher 实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1523) [之后可以将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1526) [多个值传入 Hasher](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1527) [Hasher 会结合传入值 生成一个哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1529) [回到城市数据类型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1532) [例子 我们只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1534) [对我们给出的 Hasher 对象实例中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1536) [传入的城市名和州](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1538) [进行递归的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1542) [Hash into 调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1544) [Hasher 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1546) [哈希合并算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1549) [可以有效平衡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1551) [哈希值质量和性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1553) [还可以作为额外保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1555) [抵御阻断服务攻击](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1556) [为此 它使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1557) [App 启动时生成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1559) [App 启动时生成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1559) [随机预处理种子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1561) [我们认为 你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1565) [很轻松地迁移代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1567) [来使用新的 Hashable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1569) [协议 我们也鼓励你这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1570) [有一条警告](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1573) [你可能原本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1575) [希望哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1576) [能够在多次运行 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1578) [保持不变 或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1580) [在遍历字典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1582) [或集合的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1583) [希望以同一顺序获取元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1585) [这些已经不再可行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1587) [因为使用了随机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1588) [预处理种子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1589) [你可能需要调整代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1590) [为了简化工作 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1592) [添加了一项构建设置 即](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1595) [SWIFT_DETERMINISTIC_HASHING](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1597) [环境变量 你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1598) [在方案编辑器（Scheme Editor）中激活](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1599) [以暂时停用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1602) [随机预处理种子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1603) [接下来 来谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1605) [随机数生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1609) [现在 你们在 Swift 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1612) [如何生成随机数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1613) [你需要导入 C 语言的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1615) [这确实不够理想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1618) [因为 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1619) [因为 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1619) [因平台而异](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1621) [名字不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1623) [行为不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1624) [需要检查构建配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1626) [此外 这些 API 位于底层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1628) [还会用到一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1630) [不太直观的常见运算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1632) [例如 如果我想得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1635) [1 到 6 之间的随机数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1636) [我需要调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1639) [Darwin 中的 arc4random 函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1641) [再除以 6](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1643) [来求余](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1645) [但这样的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1646) [往往并非均匀](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1647) [分布在 1 到 6 之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1649) [Swift 4.2 中 我们添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1652) [一组新的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1655) [以简化操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1657) [首先 我们为所有数字类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1659) [定义了 random 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1661) [可以获取一个范围 返回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1663) [平均分布在范围中的数字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1665) [这种方法使用了正确算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1668) [也适用于浮点型（floats）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1669) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1672) [对于顶层代码 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1679) [对于顶层代码 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1679) [为集合协议添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1680) [randomElement 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1683) [可以像 min 和 max 方法一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1684) [返回选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1687) [如果传入空集合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1688) [会返回空](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1690) [最后 我们为集合添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1692) [shuffle 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1694) [可以生成一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1697) [该集合元素的随机排列组合的数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1698) [我们认为 默认的随机数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1702) [生成器（Random Number Generator）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1705) [适合大多数 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1706) [但你也可以采用自己的算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1708) [现在 有了新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1710) [RandomNumberGenerator 协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1711) [一旦你创建一个符合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1714) [该协议的类型 就可以将它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1715) [传递给我提到的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1717) [API 拥有一个使用 using 参数的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1719) [额外重载（additional overload）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1720) [可以接收 RandomNumberGenerator](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1723) [作为输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1724) [好的 之前我们看到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1726) [构建配置检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1729) [我们再多了解一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1731) [这是 Swift 中常见的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1734) [有一小段代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1737) [在 iOS 和 macOS 间共用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1738) [在 iOS 和 macOS 间共用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1738) [在 iOS 上 你应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1740) [使用 UIKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1743) [在 macOS 上 你应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1745) [使用 AppKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1746) [现在要做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1748) [你要写一段 #if 代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1750) [来进行编译时间检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1752) [之后需要列出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1754) [支持 UIKit 的操作系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1755) [但你真正关心的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1758) [不是你在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1760) [什么操作系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1761) [而是导入 UIKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1763) [Swift 4.2 中 我们添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1765) [canImport() 构建配置指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1767) [（Build Configuration Directive）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1770) [帮助你表达本意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1772) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1774) [而利用 Swift 4.2 的新特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1776) [我还可以进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1778) [完善代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1779) [比方说 我还要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1781) [专门检查 AppKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1783) [如果 UIKit 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1785) [AppKit 都不可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1787) [例如我在 Linux 上构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1788) [我就可以使用新的 #error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1790) [构建指令来生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1792) [编译时间错误信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1793) [好的 还有一种类似的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1797) [鸡肋代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1799) [鸡肋代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1799) [如果我想在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1801) [模拟器环境中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1803) [编译代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1805) [在 Swift 4 中 我需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1806) [把这一段东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1809) [拷贝 粘贴到所有我想要进行检查的地方 才能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1811) [进行检测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1812) [Swift 4.2 中 你可以使用新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1814) [hasTargetEnvironment() 环境判断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1816) [来更好地表达本意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1818) [还可以直接询问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1821) [编译器 我是不是在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1823) [为模拟器编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1825) [说到这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1826) [我们再把 FIXME 换成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1828) [#warning 构建指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1830) [来生成信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1832) [或运行时间 提醒我别忘了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1834) [修复 FIXME](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1835) [好的 这差不多就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1838) [我今天要讲的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1840) [全部特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1842) [但我还有几项要提一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1843) [我们来解析一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1846) [隐式解析选项（Implicitly Unwrapped](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1847) [Optionals） 这个梗没效果啊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1848) [好吧 隐式解析选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1850) [可能会有点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1852) [让人疑惑 我们先来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1854) [看看它的思维模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1857) [看看它的思维模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1857) [应该如何理解它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1860) [从 Swift 3 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1861) [不是表达式的一种类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1864) [不要认为它是一种类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1866) [而要认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1868) [它是声明的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1869) [特性之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1871) [当你引用这种声明是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1873) [编译器会首先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1875) [检查它的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1877) [看它是不是普通的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1879) [如果在它的使用场景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1881) [它不合理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1883) [编译器就会将其解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1884) [进行类型检查 将其标记为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1886) [下划线类型（underlined type）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1888) [我们来看看第一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1890) [情况的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1891) [这里有两个函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1893) [第一个会生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1894) [整型的隐式解析选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1896) [第二个则会接受](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1897) [任何类型的传入值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1899) [我要用第一个函数的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1901) [结果 来调用第二个函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1903) [这个例子中 我可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1905) [在任意（Any）类型中存入整型选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1907) [不会进行强制解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1910) [值会变成一个普通的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1913) [我们再看看第二种情况的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1915) [现在 第一个函数生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1920) [对不起 第二个函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1922) [现在接受整型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1925) [如果我使用第一个函数的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1927) [结果 调用第二个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1929) [函数 我就不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1930) [传递整型选项 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1933) [函数需要整型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1934) [所以 编译器必须进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1936) [强制解析 之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1938) [代码运行正常 因为这里需要整型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1941) [也传入了整型 这个思维模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1942) [可以很好地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1946) [帮助理解隐式解析选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1947) [但直到最近 编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1950) [还是会遇到一些不遵从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1952) [此模型的极端案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1954) [所以记住 隐式解析选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1956) [不能是其他类型的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1958) [Swift 4.2 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1962) [依然如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1963) [数组不能包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1964) [隐式解析整型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1966) [但在 Swift 4 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1969) [有一些像这样的极端案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1971) [我可以定义一个 typealias](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1973) [它的实际类型可以是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1975) [隐式解析整型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1977) [接下来 我就可以用这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1979) [接下来 我就可以用这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1979) [typealias 创建数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1981) [从而使编译器的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1983) [匪夷所思 令代码难以理解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1984) [因此 在 Swift 4.2 中 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1987) [重新采用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1989) [隐式解析选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1990) [完美契合我之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1992) [提到的思维模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1994) [这一段匪夷所思的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1997) [现在会生成编译时间错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=1999) [编译器也会将其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2001) [按照普通整型数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2003) [或整型选项数组来解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2005) [大多数代码不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2008) [因隐式解析选项的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2010) [这一变化而受影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2012) [但如果你碰巧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2014) [用到了这些极端案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2015) [我建议你看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2017) [Swift.org 上的这篇博客文章](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2018) [这篇文章包含更多细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2021) [举了很多例子 来说明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2022) [变化的种类和方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2024) [好的 还有最后一项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2027) [我们来谈谈内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2030) [独占性检查（memory exclusivity checking）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2032) [大家还记得 在 Swift 4 中 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2035) [带来了所谓的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2037) [内存独占性检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2039) [内存独占性检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2039) [该功能结合了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2041) [运行时检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2042) [和编译时检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2045) [但一些功能受限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2046) [我们专门限制了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2049) [对同一内存区域的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2051) [重复访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2053) [这意味着什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2054) [我们来看个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2055) [这一段代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2057) [为操作系统路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2060) [实现了一个数据类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2061) [表现为包含路径元素的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2063) [一个数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2065) [还使用了 withAppended 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2067) [这个方法可以向数组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2070) [添加元素 再调用 closure()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2071) [作用于你传入的元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2073) [再将它从数组中移出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2075) [这段代码没有问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2078) [在 Swift 4 中运行无误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2080) [但我们来看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2082) [Path 数据类型的使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2084) [这个 path 变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2086) [存储在局部变量中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2087) [我对它调用 withAppended 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2090) [在 closure 中 我再访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2092) [这个局部变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2094) [并将它打印出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2096) [问题出在哪儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2097) [事实上 这段代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2099) [事实上 这段代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2099) [有歧义 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2101) [当我访问 closure 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2103) [局部变量时 它已经被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2106) [withAppended](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2108) [这一可变方法（mutating method）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2110) [修改过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2111) [歧义之处在于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2113) [我所指的是 path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2116) [在调用 withAppended 之前的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2118) [原始值 还是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2120) [修改之后的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2122) [当前值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2124) [Swift 4 中 这是一处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2126) [编译时错误 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2128) [它违反了独占性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2130) [要解决这一问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2132) [消除歧义 办法之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2134) [是告诉编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2135) [我想要获得当前值 所以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2137) [我只将其作为参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2140) [传入 closure 而不去捕获它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2141) [可以 但再看看这个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2145) [这个函数和刚才的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2148) [几乎相同 除了这是一个泛型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2149) [函数 参数由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2151) [closure 返回值的类型决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2153) [这个例子中 我们会遇到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2155) [类似的歧义 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2157) [要从闭包内部获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2159) [要从闭包内部获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2159) [path 的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2161) [但 Swift 4 无法在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2162) [编译时捕获到这个错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2164) [Swift 4.2 中 我们改进了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2168) [静态独占性检查（static exclusivity](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2170) [checking） 可以在更多情况下 指出这样的歧义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2172) [除了改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2176) [好吧 你还可以用类似方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2179) [将变量值作为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2180) [closure 的参数传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2182) [来消除歧义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2183) [除了改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2184) [静态检查 我们还新增了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2186) [使用运行时独占性检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2188) [和释放构造的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2190) [这会牺牲一些性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2193) [但如果你的 App 不注重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2195) [性能 我们鼓励你尝试一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2196) [并且始终开启](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2198) [这一功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2199) [未来 我们会将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2200) [动态检查的性能损耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2202) [大幅降低 这样就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2204) [始终开启这一功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2206) [这一功能还能带来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2208) [额外保护 就像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2209) [数组边界检查（array bounds checking）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2210) [或整型溢出检查（integer overflow checking）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2213) [一样 Swift 4.2 中还有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2215) [很多我没有涉及的特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2218) [很多我没有涉及的特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2218) [我们鼓励大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2222) [在现有 App 中尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2223) [我们希望大家多尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2225) [新特性 如果有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2226) [任何问题 欢迎来到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2228) [实验室 咨询我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2230) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2232) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/401/?time=2234)