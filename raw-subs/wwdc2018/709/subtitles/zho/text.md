# What’s New in Core ML, Part 2

## Summary
The Core ML tools ecosystem gives you many options for building and optimizing models to meet your app requirements. Learn how to add flexibility to existing models, quantize them, and take advantage of Core ML's support for customization.

## Info
* Frameworks
* WWDC 2018 - Session 709 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/

## Text
 [（Core ML新特性
第二部分）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=17) [大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=24) [欢迎来到Core ML
第二部分演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=31) [我是Aseem
Core ML团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=34) [众所周知
Core ML是Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=40) [用于设备上推理的机器学习框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=43) [而我最喜欢Core ML的原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=48) [是它在所有Apple硬件上
都得到了优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=50) [过去一年中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=55) [我们在所有Apple平台上看到了
许多令人惊叹的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=57) [我们在所有Apple平台上看到了
许多令人惊叹的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=57) [所以这真的很令人兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=63) [而我们对今年推出的新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=65) [甚至更加兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=67) [现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=70) [你可以大幅缩减app的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=72) [通过使用新的批处理预测API
你可以使你的app运行更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=76) [并且你可以轻松将最先进的研究成果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=83) [通过自定义机制整合到你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=87) [这些是对第一次演讲的回顾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=91) [如果你错过了那次演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=94) [我强烈建议你回去看一下幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=96) [在这次演讲中 我们将会看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=101) [如何实际使用这些特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=104) [更具体地说
我们将通过几个例子向你展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=107) [你如何通过简单的几步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=111) [使用Core ML Tools
来缩减模型的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=115) [以及你如何在模型中使用自定义特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=120) [这是这次演讲的议程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=124) [我们从Core ML Tools
生态系统的最新进展开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=127) [然后我们将深入并演示
量化和自定义转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=131) [让我们先从生态系统开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=138) [你如何得到一个ML模型呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=143) [最简单的是 如果你…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=146) [如果你可以…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=149) [如果你能在网上找到它
只需下载它 对吧？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=152) [一个下载ML模型的好地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=156) [是Apple机器学习着陆页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=159) [那上面有许多模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=162) [现在让我们假设你想
在你的数据集上训练一个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=165) [在这种情况下 你可以使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=169) [Create ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=172) [这是我们今年刚刚发布的一个新框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=173) [你无需成为机器学习专家即可使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=177) [你无需成为机器学习专家即可使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=177) [它非常易于使用
它就在Xcode中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=181) [所以去试试吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=184) [你们中的一些人已经熟悉了
开源社区中的一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=188) [令人惊叹的机器学习工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=193) [为此我们去年发布了一个Python包
即Core ML Tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=196) [此外我们还发布了一些转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=202) [去年这个领域有许多活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=208) [这就是现在的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=212) [正如你所看到的 还有更多的转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=217) [现在确实有很多不同的
训练框架以供你选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=222) [所有这些转换器都建立在
Core ML Tools之上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=228) [现在 我想在这里强调
几个不同的转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=235) [去年我们与Google合作
发布了TensorFlow转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=241) [这很令人兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=247) [如你所知 TensorFlow
在爱尝试新层的研究人员中颇受欢迎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=250) [所以我们最近在转换器中添加了
对自定义层的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=255) [最近TensorFlow发布了
对在训练过程中进行量化的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=261) [这种支持是通过
Core ML 2实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=266) [这个特性很快就会添加到转换器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=269) [另一个令人兴奋的是
我们与Facebook和Prisma的合作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=273) [这些合作的成果就是ONNX转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=278) [ONNX的优势在于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=282) [现在你可以使用许多不同的训练库了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=285) [通过使用新的ONNX转换器
它们都可以被转换为Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=290) [这是对Core ML Tools
生态系统最新进展的快速总结](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=296) [这是对Core ML Tools
生态系统最新进展的快速总结](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=296) [为了讨论量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=300) [我想邀请我的朋友
Sohaib到舞台上来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=302) [大家早上好
我叫Sohaib](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=314) [我是Core ML团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=316) [今天 我们将看看
Core ML Tools 2.0中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=318) [新的量化功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=321) [Core ML Tools 2.0支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=328) [最新的Core ML模型格式规范](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=329) [它也有一些实用工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=332) [使你可以轻松地添加
弹性形状和量化功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=333) [到你的神经网络机器学习模型中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=337) [在Core ML中
使用这些优秀新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=340) [你不仅可以缩减模型的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=342) [还可以减少app中模型的数量
并且减少app的占用空间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=345) [现在 我们先看一下量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=350) [Core ML Tools
支持训练后量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=354) [我们从Core ML
神经网络模型开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=357) [我们从Core ML
神经网络模型开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=357) [它具有32位浮点权重参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=360) [我们用Core ML Tools
来量化这个模型的权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=363) [生成的模型体积较小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=368) [模型大小的缩减直接依赖于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=370) [我们量化模型的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=373) [现在 我们中的很多人可能会想
量化到底是什么？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=377) [它如何缩减模型的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=381) [让我们窥视一下幕后所发生的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=383) [神经网络由层组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=390) [这些层可以被视为数学函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=392) [这些数学函数有参数 称为权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=396) [这些权重通常存储为32位浮点数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=399) [在我们之前的演讲中
我们谈到了ResNet50](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=404) [这是一种流行的机器学习模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=407) [可以用于图像分类等等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=409) [这个模型拥有
超过2500万个权重参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=412) [所以你可以想象
如果你能以某种方式以更少的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=417) [所以你可以想象
如果你能以某种方式以更少的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=417) [来表示这些参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=420) [我们就可以大大缩减这个模型的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=423) [实际上 这个过程被称为量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=426) [在量化过程中 我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=430) [在最小值和最大值之间的层的权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=433) [映射为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=436) [无符号整数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=438) [对于APIC量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=440) [我们将这些值映射到0到55的范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=442) [对于7位量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=447) [我们将它们映射到0到127
一直到1位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=448) [即将这些权重映射为0或1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=452) [由于我们使用更少的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=456) [来表示相同的信息
因此我们缩减了模型的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=457) [真棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=462) [你们中许多人可能已经注意到
我们正在将浮点数映射为整数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=463) [你可能已经得出结论 在这种映射中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=468) [可能会有一些精确度损失 这是对的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=471) [经验法则是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=474) [你用来量化模型的位数越少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=475) [我们的模型在准确性方面
所受到的影响越大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=478) [我们的模型在准确性方面
所受到的影响越大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=478) [我们稍后还会谈到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=481) [以上是对量化的概述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=483) [但问题依然存在
我们如何获得这种映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=485) [有很多流行的算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=489) [和技术能帮助你做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=491) [Core ML支持
其中两种最流行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=493) [线性量化和查找表量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=497) [让我们简要介绍一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=500) [线性量化是一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=506) [以均匀的方式映射参数的算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=508) [这种量化是通过比例系数和偏差值
进行参数化的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=512) [这些值是通过计算得到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=517) [该计算基于我们正在量化的层的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=519) [了解这种映射工作原理
的一种非常直观的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=523) [是我们退后一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=526) [看看我们如何从位于底部的量化权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=528) [恢复到原来的浮点数权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=530) [在线性量化中
我们只需用量化权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=533) [乘以比例系数再加上偏差](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=537) [Core ML支持的
第二种量化技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=542) [是查找表量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=545) [顾名思义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=547) [我们构造一个查找表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=549) [再想象一下我们如何从量化后的权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=551) [得到原来的权重
会很有帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=554) [在这种情况下 量化权重只是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=557) [查找表中的一些索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=560) [现在 如果你注意到
与线性量化不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=564) [我们现在可以自由移动
我们的量化权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=566) [它们不必以线性方式间隔开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=569) [回顾一下
Core ML Tools支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=573) [线性量化和查找表量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=578) [我们从一个全精度神经网络模型开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=580) [并使用这些工具来量化该模型的权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=582) [现在你可能在想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=586) [太好了
我可以缩减我的模型的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=587) [但该如何找出量化的参数呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=590) [如果我正进行线性量化
我该如何计算出比例系数和偏差呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=594) [如果我正在执行查找表量化
我该如何构建查找表呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=598) [如果我正在执行查找表量化
我该如何构建查找表呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=598) [我在这里告诉你
你不必关心这其中任何一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=603) [你所要做的就是决定
你想要量化模型的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=606) [并决定要使用的算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=610) [剩下的工作交给
Core ML Tools来完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=613) [事实上…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=616) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=617) [事实上 量化一个
Core ML模型是如此简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=622) [以至于我们可在几行
Python代码中完成它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=627) [既然我们可以在这里演示
何必继续浪费口舌呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=630) [为了演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=640) [我需要一个
Core ML模型格式的神经网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=642) [正如我的同事Aseem所说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=646) [Core ML机器学习主页是一个
找到这些模型的好地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=648) [我已经提前下载了该页面中的
一个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=652) [这个模型叫做SqueezeNet
让我们打开它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=655) [正如我们所看到的
这个模型的大小是5兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=660) [它有一个输入
是一个227*227像素的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=663) [它有两个输出
其中一个是类标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=668) [由一个字符串表示
它代表该图片最有可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=672) [属于的标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=676) [第二个输出是这些字符串对应的概率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=677) [鉴于此 如果我们传入图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=681) [我们会得到这个图像
可能是什么的概率列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=684) [现在让我们开始量化这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=688) [我首先要做的是
进入一个Python环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=691) [我比较喜欢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=694) [Jupyter Notebook](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=695) [现在我们打开它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=698) [让我们打开一个新的笔记本并放大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=706) [我们先导入
Core ML Tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=711) [让我们来运行它
然后我想做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=718) [让我们来运行它
然后我想做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=718) [导入所有
在Core ML Tools中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=721) [新量化工具
我们通过运行这句代码来达到目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=723) [现在我们需要加载想要量化的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=736) [即我们刚看到的
SqueezeNet模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=739) [我们需要获取该模型的一个实例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=741) [将参数设置为我的桌面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=752) [很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=757) [现在 为了量化这个模型
我们只需要做一个简单的API调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=759) [让我们尝试使用线性量化
来量化这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=763) [它的API名称很简单
叫quantize_weights](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=771) [我们传入的第一个参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=774) [是你刚加载的原始模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=776) [然后是我们想要量化模型的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=779) [然后是我们想要量化模型的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=779) [这里我们将其设为8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=782) [以及我们想要使用的量化算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=784) [让我们试试线性量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=787) [现在所发生的事情是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=790) [这些工具会遍历线性网络的所有层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=791) [并量化这些层中的所有权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=795) [我们完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=798) [如果你还记得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=800) [几分钟前我提到量化我们的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=802) [会造成精确度上的损失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=805) [所以我们想知道我们的量化模型
与原始模型相比效果如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=807) [这样做的最简单方法是
将一些数据传给它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=812) [并使用我们的原始模型推理该数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=816) [再使用我们的量化模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=820) [对相同的数据进行相同的推理
并比较这两者的预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=823) [来看看它们的一致程度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=827) [Core ML Tools
有帮助你做到这一点的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=829) [我们可以通过调用这个
称为compare_models函数来达到目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=831) [我们传入全精度模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=836) [然后是我们刚刚量化过的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=838) [然后是我们刚刚量化过的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=838) [由于这个模型是一个简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=841) [图像分类器 它只有一个图像输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=844) [我们有一个方便的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=848) [我们只需传入一个
包含样本数据图像的文件夹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=849) [在我的桌面上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=853) [我有一个文件夹
里面有一组与我的app相关的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=854) [因此我将这个文件夹的路径
作为临时参数传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=858) [很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=867) [现在我们看到我们正在分析
该文件夹中的所有图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=868) [我们正在推理…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=871) [我们先使用全精度模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=874) [然后再用量化模型进行推理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=876) [最后比较这两个预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=878) [我们似乎已经完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=881) [你可以看到我们的Top 1
Agreement值是94.8%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=883) [看起来不错 这个Top 1
Agreement是什么意思呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=887) [这意味着当我向原始模型输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=891) [比如一只狗的图像时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=894) [它会预测这张图片是一只狗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=897) [而我的量化模型也作出同样预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=899) [而我的量化模型也作出同样预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=899) [这种情况发生在
数据集中94.8%的图片上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=901) [我可以在我的app中使用此模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=905) [但我想看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=908) [其他量化技术
是否在这个模型上效果更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=910) [正如我所提到的
Core ML支持两种量化技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=913) [线性量化和查找表量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=917) [所以让我们继续尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=919) [使用查找表量化来量化此模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=921) [我们再次传入原始模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=930) [和我们想要量化模型的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=932) [以及我们的量化技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=935) [哎呀 这里有个错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=939) [让我们运行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=948) [K-means是一种
简单的聚类算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=950) [能够逼近我们的权重分布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=953) [使用这种分布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=956) [我们可以为我们的权重构建查找表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=958) [我们可以为我们的权重构建查找表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=958) [我们在这里做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=962) [我们遍历神经网络中的所有层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=964) [对其执行量化过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=967) [并为那个特顶层计算查找表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=969) [如果你是一位专家
并且你了解你的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=972) [你也知道你的模型架构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=975) [而且你知道K-means
不是最合适你的算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=977) [你可以灵活地传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=979) [你自己的自定义函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=982) [而不是这里的这个算法
这个工具将使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=984) [你的自定义函数来为你构造查找表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=987) [我们使用查找表方法
再次完成了对这个模型的量化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=990) [现在让我们看看这个模型
与我们的原始模型比较效果如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=995) [所以我们再次调用
compare_models API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=998) [我们传入原始模型
接着传入查找表模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1002) [我们再次传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1006) [示例数据文件夹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1010) [我们再次使用原始模型和量化模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1014) [对所有图像进行推理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1019) [对所有图像进行推理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1019) [我们看到这一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1021) [我们得到了一个更好一点的
Top 1 Agreement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1022) [对于这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1026) [我们看到查找表是正确的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1027) [但是这与模型有关 对于其他模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1030) [可能是线性量化效果更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1033) [现在我们对这个结果感到高兴
并且认为这对我的app来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1034) [已经够好了
现在让我们保存此模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1037) [我们通过调用save函数来保存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1043) [再给它起个有创意的名字
就叫QuantizedSqueezeNet](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1050) [可以了
现在我们有了一个量化模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1061) [这是一个原始模型
我们看到它的大小是5兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1063) [让我们打开我们的量化模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1068) [我们立即注意到的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1072) [是这个模型的大小只有1.3兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1074) [如果你注意一下会发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1084) [有关量化模型的所有细节
都与原始模型相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1085) [它仍然需要一个图像输入
仍然有两个输出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1091) [若我有一个使用此模型的app
我可以做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1095) [如我们在演示中看到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1098) [将这个量化模型直接
拖入我们的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1100) [并开始使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1102) [只需这样 我们就缩减了
app的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1104) [这就是使用
Core ML Tools量化的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1112) [回顾一下 我们看到使用Core ML Tools
来量化我们的模型是多么容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1118) [使用一个简单的API
传入我们的原始模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1124) [我们想要量化模型的位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1128) [和我们想要使用的量化算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1131) [我们也看到Core ML Tools中
有一些实用工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1134) [来帮助我们比较量化模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1136) [从而了解它与我们的
原始模型相比较效果如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1139) [从而了解它与我们的
原始模型相比较效果如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1139) [正如我们在演示中看到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1143) [量化我们的模型会导致
相应精度的损失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1145) [这个…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1149) [这种精度损失高度依赖于模型和数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1151) [一些模型在量化之后
比其它模型表现更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1154) [作为一般经验法则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1159) [我们量化模型的位数越少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1161) [我们精度所受的影响就越大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1164) [在演示中我们看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1166) [我们能使用Core ML Tools中的
Top 1 Agreement指标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1168) [来比较我们的量化模型
和原始模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1171) [但你必须弄清楚](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1175) [你的模型和用例的
相关度量标准是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1177) [并验证你的量化模型是可接受的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1180) [在之前的演讲中
我们看了一个风格转换演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1184) [这个网络输入一幅图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1188) [然后输出一个风格化的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1191) [让我们来看看这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1195) [在不同的量化级别下表现如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1197) [在左上角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1200) [我们看到原始模型是32位
大小为6.7兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1204) [我们的8位线性量化模型
只有1.7兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1210) [而且我们发现 从视觉上来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1214) [该效果对于我的风格转换演示来说
已经足够了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1217) [我们还可以看到 即使低至4位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1220) [我们也不会在效果方面损失太多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1224) [我甚至可能会说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1226) [对于我的app来说
即使3位也可以正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1228) [从2位开始我们可以看到
这时出现了很多痕迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1230) [这个模型可能不适合我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1234) [以上就是如何使用
Core ML Tools进行量化的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1238) [接下来我将话筒交回给Aseem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1241) [他将会谈论自定义转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1243) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1245) [谢谢Sohaib](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1252) [我想谈一下一个非常重要的特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1255) [它让我们能够跟上
机器学习领域的发展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1258) [它让我们能够跟上
机器学习领域的发展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1258) [大家都知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1262) [机器学习领域正在迅速发展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1264) [因此 为你提供必要的软件工具
来解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1267) [对于我们Core ML团队来说
非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1270) [现在举一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1275) [假设你正在尝试一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1277) [Core ML尚不支持的新模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1280) [或者假设你有一个
运行在Core ML上的神经网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1282) [但是也许其中有一两层
Core ML暂时无法提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1287) [在这种情况下 你希望仍然能够使用
Core ML的强大功能 对吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1292) [对这个问题的回答是
是的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1299) [自定义机制将帮助你达到这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1301) [在接下来的几分钟内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1306) [我想重点关注当我们有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1307) [新的神经网络层的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1310) [然后向你展示
你将如何将它转换为Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1313) [以及如何在你的app中实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1317) [让我们先来看看模型转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1320) [如果你使用过我们的转换器
或者即使你没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1323) [它是一个非常简单的API
这只是对一个函数的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1327) [这是Keras转换器的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1332) [它与ONNX转换器
或TensorFlow转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1335) [都很相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1337) [当你调用这个函数时
大多数情况下都是正常的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1341) [但有时你可能会得到
类似这样的错误消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1345) [它可能会说
“嘿 不支持的某某操作”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1350) [如果这件事发生在你身上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1355) [你只需要多做一点事
就可以避开这个错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1357) [更具体地说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1361) [这样的错误信息表明
你应该使用自定义层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1362) [在我向你展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1368) [你需要做点什么才能成功转换之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1370) [让我们先看几个
你需要使用到自定义层的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1374) [假设你有一个图像分类器
这是它在Xcode中的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1381) [这是一些关于该模型的高级描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1386) [如果你能看到它的内部
很可能这是一个神经网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1388) [而且很可能是一个卷积神经网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1393) [所以它会有很多层
卷积层 激活层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1396) [现在可能会发生这种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1400) [即有一个新的激活层出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1401) [而Core ML还不支持它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1404) [并且…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1405) [就像在每次机器学习会议上一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1407) [研究人员总是在提出新的层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1410) [所以这是一个很常见的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1412) [如果发生这种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1415) [你只需要使用这个新层的自定义实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1416) [然后你就准备好了
这就是这个模型的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1421) [唯一的区别是在底部的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1424) [这个依赖部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1427) [其中…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1429) [具有这个模型所包含的
这个自定义层的描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1431) [我们来看看另一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1435) [假设我们有一个非常简单的
数字分类器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1437) [最近](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1441) [我看到了一篇研究论文
它的题目是“空间变换网络”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1442) [它所做的事情是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1447) [它在数字之后插入一个神经网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1450) [用来定位数字的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1454) [然后将其传入一个网格采样器层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1457) [这会重新渲染这个数字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1460) [但这次它已经能够定位在数字本身上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1462) [然后你将它传递给你的旧分类方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1465) [我们不关心这里的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1468) [但要注意的一点是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1472) [绿色部分是Core ML支持的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1475) [而红色部分是新的网格采样器层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1477) [是Core ML不支持的新实验层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1480) [我想通过这个特定模型的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1484) [来向你展示如何使用
Core ML Tools对其转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1487) [现在我们来演示一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1491) [我希望能够一次成功](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1500) [好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1503) [好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1505) [我先关闭这些窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1507) [让我清除这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1514) [我也将使用
Jupyter Notebook来进行演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1518) [导航到我的预训练网络的文件夹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1529) [你可以在这里看到我的
spatial_transformer文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1534) [这是一个预训练的Keras模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1539) [如果你想知道
我是如何得到这个模型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1542) [基本上我做的是…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1548) [我可以轻松找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1550) [空间变换器的开源实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1551) [我刚在Keras中执行了该脚本
然后我就得到了这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1554) [除此以外 我还有这个
网格采样器层的Python脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1558) [除此以外 我还有这个
网格采样器层的Python脚本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1558) [我正在谈论的这个网格采样器层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1563) [在Keras中也没有原生支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1566) [所以我在网上找到的这个实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1569) [使用Keras自定义层来实现该层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1572) [正如你所见 自定义概念
并不是Core ML独有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1576) [实际上 在大多数机器学习框架中
这是非常普遍的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1580) [这就是人们在新层中进行实验的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1584) [好的 到目前为止
我只有一个Keras模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1587) [现在我想专注于
如何获得Core ML模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1590) [所以我将打开…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1594) [让我们看看…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1598) [在这里 让我启动一个
新的Python笔记本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1600) [我将从在Python环境中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1604) [导入Keras模型开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1606) [先导入Keras](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1611) [再导入我们的Keras自定义层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1615) [现在我将在Keras中加载模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1618) [现在我将在Keras中加载模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1618) [这就是你如何加载Keras模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1622) [你将该部分提供给模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1625) [如果有一个自定义层
就把它传给这部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1627) [好的 现在我们有了这个模型
让我们将其转换为Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1630) [我要先导入coremltools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1635) [执行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1638) [现在 正如我之前展示给你的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1639) [只需要调用一个函数来转换它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1642) [我们来试试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1646) [这是我的调用
正如预期的那样 我得到一个错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1648) [Python喜欢抛出
这些冗长的错误信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1653) [但是我们真正关心的是最后一行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1656) [让我…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1660) [正如我们在这最后一行所看到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1666) [采样器层不受支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1669) [现在我们看看怎样才能解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1671) [我关掉这些以便你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1675) [现在我稍微改一下我的转换器调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1678) [现在我稍微改一下我的转换器调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1678) [这是我的Core ML模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1681) [现在我要传递一个额外的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1686) [它被称为
custom_convertions_functions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1689) [这是一个字典类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1699) [它是从层的名称到一个
我稍后会定义的函数的映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1701) [将其命名为
covert_grid_sampler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1706) [让我退后一步并解释这里发生的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1707) [转换器的工作方式是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1710) [它会遍历每个Keras层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1714) [先进入第一层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1716) [将其参数转换为Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1718) [然后转到第二层继续转换它的参数
如此类推](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1720) [当它碰到这个自定义层时
它不知道该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1724) [所以我传入的这个函数
convert_grid_sampler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1727) [将帮助我的转换器做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1731) [我们来看看这个函数长什么样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1734) [就是这个函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1740) [这里有几行代码
但它所做的只有三件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1742) [首先 它给出了一个类的名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1747) [正如我们注意到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1751) [该层的实现不在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1753) [实现将稍后在app中出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1755) [它将被封装在一个类中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1758) [这是我们稍后将实现的类的名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1761) [在转换过程中
我们只需要指定这个类名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1764) [就这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1768) [然后设置其描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1769) [你应该提供它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1770) [如果有其他人…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1772) [以便如果有人正在看你的模型
他们知道它是干什么的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1774) [第三件事基本上就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1779) [将Keras层的任何参数
转换为Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1780) [对于这个特定的层
它有两个参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1785) [输出高度和输出权重
我只是把它转换成Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1787) [如果你的自定义层没有任何参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1791) [那么你不需要这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1794) [如果你的层有很多参数
它们都应该在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1798) [如果你的层有很多参数
它们都应该在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1798) [并且被封装在Core ML模型中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1801) [你可能已经注意到了
我在这里所做的一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1806) [与你定义类的方式非常相似 对吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1808) [你给出一个类名 可能有一个描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1811) [也许还有些参数
现在让我来执行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1813) [现在我们看到转换进行得很顺利](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1819) [让我……](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1825) [不知道为什么 这里有点奇怪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1828) [如果你不介意 我把这些都删了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1835) [现在让我可视化这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1840) [你可以简单的调用
Core ML Tools中的函数来做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1842) [这个函数叫
visualize_spec](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1847) [这里你可以看到该模型的可视化效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1850) [正如我们所看到的那样
这里是定位网络和一些层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1854) [这是我们的自定义层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1858) [这是我们的自定义层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1858) [如果我点击它
我可以看到它的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1860) [这是我给它的类名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1863) [这些是我设置的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1866) [可视化你的Core ML模型
总是一个好主意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1870) [在拖放之前 检查一下一切是否正常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1873) [好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1877) [不是这个笔记本
现在我要保存这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1879) [现在我们来看看这个模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1891) [让我关闭它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1894) [好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1897) [让我导航到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1902) [这个目录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1906) [我的模型在这里
如果我点击并在Xcode中查看它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1911) [看看它是什么样的
我们可以看到它在这里有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1914) [一个自定义网格描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1919) [一个自定义网格描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1919) [让我们回到幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1921) [我们刚刚看到的是
只用几行简单的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1930) [我们就可以轻松将函数
转换为Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1934) [这过程和你用TensorFlow
转换器或ONNX转换器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1937) [的过程几乎是一样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1940) [左边是我们的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1945) [带参数的自定义层模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1948) [当你将此模型拖放到Xcode中时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1950) [你需要在一个文件中提供该类的实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1953) [比如gridSampler.swift
这就是这个文件的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1956) [这就是你的类 它有一个初始化函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1960) [它将会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1966) [初始化模型中的任何参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1967) [这个类的主要函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1970) [是evaluate函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1974) [这是该层需要执行的数学运算的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1978) [这是该层需要执行的数学运算的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1978) [真正实现部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1981) [还有另一个函数也会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1985) [这个outputShapes
(forInputShapes)函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1986) [它会指定该层产生的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1988) [输出区域的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1990) [这有助于Core ML在加载时
分配缓冲区大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1992) [以便你的app在运行时更高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1996) [我们刚刚看到你将如何处理
神经网络中的一个新层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2001) [有一个非常类似于自定义层的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2007) [它被称为自定义模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2010) [它们的原理差不多 但它更具通用性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2013) [对于自定义模型
你可以处理任何类型的网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2017) [它不一定是一个神经网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2021) [并且在整体上能给你更多的灵活性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2025) [让我总结一下这次演讲
我们看到…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2030) [Core ML Tools的
这个生态系统有多丰富](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2034) [这对你们来说很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2039) [这对你们来说很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2039) [因为现在你有更多的选择
来获得Core ML模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2040) [我们看到量化Core ML模型
是多么容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2044) [我们还看到只需几行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2048) [我们就可以很轻松地在模型中
集成一个新的自定义层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2053) [你可以在我们的文档页面
找到更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2060) [欢迎来实验室并与我们交谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2063) [好的 谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2066)