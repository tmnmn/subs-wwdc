# Whatâ€™s New in Core ML, Part 2

## Summary
The Core ML tools ecosystem gives you many options for building and optimizing models to meet your app requirements. Learn how to add flexibility to existing models, quantize them, and take advantage of Core ML's support for customization.

## Info
* Frameworks
* WWDC 2018 - Session 709 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=6) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=21) [&gt;&gt; Hello!](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=24) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=26) [So welcome to the second session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=31) [of Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=33) [My name is Aseem, and I'm an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=34) [engineer in the Core ML team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=36) [As you all know, Core ML is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=40) [Apple's machine learning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=42) [framework for on-device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=44) [inference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=45) [And the one thing I really like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=48) [about Core ML is that it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=49) [optimized on all Apple hardware.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=51) [Over the last year, we have seen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=55) [lots of amazing apps across all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=58) [lots of amazing apps across all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=58) [Apple platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=61) [So that's really exciting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=63) [And we are even more excited](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=65) [with the new features that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=67) [have this year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=68) [Now you can reduce the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=70) [your app by a lot.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=73) [You can make your app much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=76) [faster by using the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=78) [batch-predict API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=80) [And you can really easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=83) [include cutting-edge research](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=85) [right in your app using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=87) [customization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=89) [So that was a recap of the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=91) [session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=93) [And in case you missed it, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=94) [would highly encourage you to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=96) [back and check the slides.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=97) [In this session, we are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=99) [see how to actually make use of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=103) [these features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=106) [More specifically, we'll walk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=107) [through a few examples and show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=110) [you that how in a few simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=112) [steps using Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=114) [You can reduce the size of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=118) [model, and you can include a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=119) [model, and you can include a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=119) [custom feature in your model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=121) [Here's the agenda of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=124) [session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=125) [We'll start by a really quick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=127) [update on the Core ML Tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=128) [ecosystem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=130) [And then we'll dive into a demo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=131) [of our quantization and custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=133) [conversion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=136) [So let me start with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=138) [ecosystem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=138) [So how do you get an ML model?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=143) [Well, the best thing is that if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=145) [you, if you can, if you find it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=147) [online, you just download it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=152) [right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=156) [Very good place to download your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=156) [ML models is the Apple Machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=158) [Learning landing page.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=161) [We have a few models there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=162) [Now let's say you want to train](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=165) [a model on your data set.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=166) [In that case, you can use Create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=169) [ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=172) [This is a new framework that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=172) [have just launched this year,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=175) [and you do not have to be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=177) [machine learning expert to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=179) [machine learning expert to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=179) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=180) [It's really easy to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=181) [It's right there in Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=182) [So go and give it a try.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=184) [Now some of you are already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=188) [familiar with the amazing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=190) [machine learning tools that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=192) [have outside in the community.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=193) [And for that, last year we had](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=196) [released Core ML Tools, a Python](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=199) [package.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=201) [And along with that, we had](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=202) [released a few converters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=204) [Now there has been a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=208) [activity in this area over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=210) [last year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=211) [And this is how the picture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=212) [looks now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=214) [So as you can see, there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=215) [many more converters out there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=218) [And you really do have a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=222) [choice to choose your training](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=224) [framework now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=226) [And all of these converters are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=228) [built on top of Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=230) [Now, I do want to highlight a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=232) [couple of different converters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=237) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=238) [Last year, we collaborated with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=241) [Google and released the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=243) [TensorFlow converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=245) [So that was exciting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=246) [As you know, TensorFlow is quite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=250) [popular with researchers who try](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=252) [out new layers so we recently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=254) [added support for custom layers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=256) [into the converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=258) [And TensorFlow recently released](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=260) [support for quantization during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=262) [training and that's Core ML 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=265) [supports quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=267) [This feature will be added soon](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=269) [to the converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=270) [Another exciting partnership we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=273) [had was with Facebook and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=274) [Prisma.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=277) [And this resulted in the ONNX](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=278) [converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=280) [The nice thing about ONNX is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=282) [that now you have access to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=283) [bunch of different training](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=288) [libraries that can all be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=289) [converted to Core ML using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=290) [new ONNX converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=293) [So that was a quick wrap-up of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=294) [Core ML Tools ecosystem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=298) [Core ML Tools ecosystem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=298) [Now to talk about quantization,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=300) [I would like to invite my friend](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=302) [Sohaib on stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=304) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=306) [&gt;&gt; Good morning, everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=314) [My name is Sohaib.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=315) [I'm an engineer in the Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=316) [team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=317) [And today we're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=318) [taking a look at new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=319) [quantization utilities in Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=320) [ML Tools 2.0.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=321) [Core ML Tools 2.0 has support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=328) [for the latest Core ML model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=329) [format specification.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=331) [It also has utilities which make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=332) [it really easy for you to add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=334) [flexible shapes and quantize in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=336) [your own network machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=338) [learning models.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=338) [Using these great new features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=340) [in Core ML, you can not only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=341) [reduce the size of your models.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=343) [But also reduce the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=344) [models in your app, reducing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=346) [footprint of your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=348) [Now let's start off by taking a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=350) [look at quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=351) [Core ML Tools supports](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=354) [post-training quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=355) [We start off with a Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=357) [neural network model which has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=359) [neural network model which has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=359) [32-bit float weight parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=361) [And we use Core ML Tools to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=363) [quantize the weights for this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=365) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=367) [The resulting model is smaller](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=368) [in size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=369) [Now size reduction of the model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=370) [is directly dependent on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=372) [number of bits we quantize our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=373) [model to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=375) [Now, many of us may be wondering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=377) [what exactly is quantization?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=379) [And how can it reduce the size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=381) [of my models?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=382) [Let's step back and take a peek](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=384) [under the hood.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=385) [Neural networks are composed of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=390) [layers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=391) [And these layers can be thought](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=392) [of as mathematical functions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=393) [And these mathematical functions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=395) [have parameters called weights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=397) [And these weights are usually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=399) [stored as 32-bit floats.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=401) [Now in our previous session, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=403) [took a look at ResNet50.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=405) [A popular machine-learning model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=407) [which is used for image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=409) [classification amongst other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=410) [things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=411) [Now this particular model has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=412) [over 25 million weight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=413) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=415) [So you can imagine, if you could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=416) [somehow represent these param --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=418) [somehow represent these param --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=418) [these parameters using a fewer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=420) [number of bits, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=422) [drastically reduce the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=423) [this model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=424) [In fact, this process is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=425) [quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=428) [In quantization, we take the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=430) [weights for our layers which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=432) [[inaudible] to minimum and to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=433) [maximum value and we map them to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=435) [unsigned integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=438) [Now for APIC quantization, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=440) [map these values from a range of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=442) [0 to 55.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=444) [For 7-bit quantization, we map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=447) [them from 0 to 127, all the way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=448) [down to 1 bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=451) [Where we map these weights as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=452) [either zeros or ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=454) [Since we're using fewer bits to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=456) [represent the same information,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=457) [we reduce the size of our model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=459) [Great. Now many of you may have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=462) [noticed that we're mapping](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=464) [floats to integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=466) [And you may have come to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=467) [conclusion that maybe there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=468) [some accuracy loss in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=470) [mapping.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=472) [That's true.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=473) [The rule of thumb is the lower](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=474) [the number of bits you quantize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=476) [your model to, the more of a hit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=477) [our model takes in terms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=479) [our model takes in terms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=479) [accuracy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=480) [And we'll get back to that in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=480) [bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=482) [So that's an overview of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=483) [quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=484) [But the question remains.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=486) [How do we obtain this mapping?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=487) [Well, there are many popular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=489) [algorithms and techniques out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=490) [there which help you to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=492) [And Core ML supports two of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=493) [most popular ones: linear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=495) [quantization and lookup table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=497) [quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=499) [Let's have a brief overview.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=500) [Linear quantization is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=506) [algorithm in which you map these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=507) [full parameters equally.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=509) [The quantization is parametrized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=512) [by a scale and by values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=514) [And these values are calculated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=517) [based on the parameters of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=518) [layers that we're quantizing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=520) [Now and a really intuitive way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=523) [to see how this mapping works is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=524) [if we take a step back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=526) [And see how we would go back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=527) [from our quantized weights which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=529) [are at the bottom back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=530) [original float weights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=532) [In linear quantization, we would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=533) [simply multiply our quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=535) [weights with the scale parameter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=537) [and add the bias.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=539) [The second quantization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=542) [technique that Core ML supports](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=543) [is lookup table quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=545) [And this technique is exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=547) [what it sounds like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=548) [We construct a lookup table.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=549) [Now again it's helpful if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=551) [imagine how we would go back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=553) [from our quantized weights back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=554) [to our original weights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=555) [And in this case, the quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=557) [weights are simply indices back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=559) [into our lookup table.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=561) [Now, if you notice, unlike](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=564) [linear quantization, we have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=565) [ability to move our quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=566) [weights around.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=568) [They don't have to be spaced out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=569) [in a linear fashion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=570) [So to recap, Core ML Tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=573) [supports linear quantization and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=575) [lookup table quantization where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=578) [we start off with a full](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=580) [precision neural network model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=581) [And quantize the weights for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=582) [that model using the utilities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=583) [Now you may be wondering well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=586) [great, I can reduce the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=588) [my model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=589) [But how do I figure out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=590) [parameters for my quantization?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=592) [If I'm doing linear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=594) [quantization, how do I figure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=595) [out my scale and bias?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=596) [If I'm doing lookup table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=598) [quantization, how do I construct](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=599) [quantization, how do I construct](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=599) [my lookup table?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=601) [I'm here to tell you that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=603) [don't have to worry about any of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=604) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=605) [All you do is decide on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=606) [number of bits you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=608) [quantize your model to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=609) [And decide on the algorithm you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=610) [want to use, and let Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=611) [Tools do the rest.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=613) [In fact --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=616) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=617) [In fact, it's so simple to take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=622) [a Core ML neural network model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=624) [And quantize it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=626) [Then we can do it in a few lines](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=627) [of Python code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=629) [But why stand here and talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=629) [about it when we can show you a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=631) [demo?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=632) [So for the purposes of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=640) [demo, I'm going to need a neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=642) [network in the Core ML model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=644) [format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=645) [Now, as my colleague Aseem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=646) [mentioned, a great place to find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=647) [these models is on the Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=649) [machine learning home page.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=650) [And I've gone ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=652) [downloaded one of the models](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=652) [from that page.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=654) [So this model's called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=655) [SqueezeNet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=656) [And let's go ahead and open it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=657) [up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=658) [As we can see, this model is 5](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=659) [As we can see, this model is 5](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=659) [megabytes in size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=662) [It has a input which is an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=663) [of 227 by 227 pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=666) [And it has two outputs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=668) [One of the outputs is the class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=670) [label which is a string, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=671) [this is the most likely label](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=673) [for the, for the input image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=675) [And the second output is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=677) [mapping of strings to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=679) [probabilities given that if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=680) [pass an image, it's going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=683) [a list of probabilities of what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=684) [that image may be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=685) [Now let's start quantizing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=688) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=690) [So the first thing I want to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=690) [is I want to get into a Python](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=692) [environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=694) [Now a Jupyter Notebook is one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=694) [such environment that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=696) [comfortable with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=697) [So I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=698) [open that up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=699) [Let's open up a new notebook and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=706) [zoom in on that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=709) [Alright. So let's start off by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=711) [importing Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=713) [Let's run that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=718) [Now the second thing I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=719) [Now the second thing I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=719) [do is I want to import all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=721) [new quantization utilities that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=722) [we have in Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=723) [And we do that by running this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=725) [And now we need to load up the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=736) [model which we want to quantize.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=737) [And we just saw the SqueezeNet](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=739) [model a minute okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=740) [We're going to go ahead and get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=741) [an instance of that model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=742) [Send this to my desktop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=752) [Great. Now to quantize this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=758) [model, we just need to make one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=760) [simple API call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=761) [And let's try a linear,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=763) [quantizing this model using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=764) [linear quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=766) [And its API is simply called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=771) [quantize weights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=773) [And the first parameter we pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=774) [in is the original model which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=776) [you just loaded up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=778) [The number of bits we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=779) [The number of bits we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=779) [quantize our model to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=780) [In this case, it's 8 bits.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=782) [And the quantization algorithm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=784) [we want to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=785) [Let's try linear quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=787) [Now what's happening is that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=789) [utility is iterating over all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=791) [the layers of the linear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=792) [networks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=794) [And is quantizing all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=795) [weights in those layers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=796) [And we're finished.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=798) [Now, if you recall a few moments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=800) [ago I mentioned that quantizing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=803) [our model had an associated loss](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=804) [in accuracy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=806) [So we want to know how our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=807) [quantized model stacks up to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=808) [original model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=810) [And the easiest way of doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=811) [this is taking some data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=813) [passing and getting inference on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=815) [that data using our original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=817) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=819) [And doing the same inference on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=820) [the same data using our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=822) [quantized model and comparing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=823) [the predictions from that model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=825) [And seeing how well they agree.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=827) [Core ML Tools has utilities](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=829) [which help you to do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=830) [And we can do that by making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=831) [this call which is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=833) [compare models.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=834) [We pass in our full precision](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=836) [model, and we pass in our model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=837) [which we had just quantized.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=839) [which we had just quantized.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=839) [And because this model is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=841) [simple image classifier which it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=843) [only has one image inputs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=845) [We, we have a convenience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=848) [utility.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=849) [So we can just pass in a folder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=849) [containing sample data images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=851) [Now on my desktop here, I have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=853) [folder with a set of images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=854) [which are relevant for my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=856) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=857) [So I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=858) [pass a path to this folder as my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=858) [[inaudible] parameter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=862) [Great. So now we see we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=868) [analyzing all the images in that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=869) [folder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=871) [We're running inference on the,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=871) [we're using full prediction or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=873) [full precision model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=875) [And we're running inference on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=876) [our quantized model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=877) [And we're comparing our two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=878) [predictions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=879) [So we seem to have finished](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=881) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=882) [And you can see our Top 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=882) [Agreement is 94.8%.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=885) [Not bad. Now what does this Top](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=887) [1 Agreement mean?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=890) [This means that when I pass in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=891) [my original model, that image of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=892) [a dog for example, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=895) [predicted that this image was a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=897) [dog.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=898) [My quantized model did the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=899) [My quantized model did the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=899) [And that happened over 98, 94.8%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=900) [of the data set.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=903) [So I can go ahead and use this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=905) [model in my app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=907) [But I want to see if other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=908) [quantization techniques work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=910) [better on this model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=911) [As I mentioned, Core ML supports](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=913) [two types of quantization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=915) [techniques.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=916) [Linear quantization and lookup](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=917) [table quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=918) [So let's go ahead and try and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=919) [quantize this model using lookup](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=921) [table quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=923) [Again, we pass in an original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=930) [model, the number of bits we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=931) [want to quantize our model to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=933) [And our quantization techniques.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=935) [Oops, made a typo there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=937) [Let's go ahead and run this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=948) [Now, k-means is a simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=950) [clustering algorithm which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=952) [approximates the distribution of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=954) [our weights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=955) [And using this distribution, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=956) [can construct the lookup table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=958) [can construct the lookup table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=958) [for our weights.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=960) [And what we're doing over here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=962) [is that we're iterating over all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=964) [the layers in the neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=965) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=966) [And we're quantizing and we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=967) [figuring out the lookup table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=968) [for that particular layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=969) [Now, if you're an expert and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=972) [know that your model, you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=974) [your model architecture and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=975) [know that k-means is not the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=977) [algorithm for you, you have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=978) [flexibility of passing in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=980) [own custom function instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=982) [this algorithm and the utility](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=984) [will use your custom function to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=986) [actually construct the lookup](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=988) [table.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=989) [So we finished quantizing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=990) [model again using the lookup](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=992) [table approach.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=994) [And now let's see how well this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=995) [model compares with our original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=996) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=998) [So once again we call our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=998) [compare model's API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1000) [We pass in our original model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1002) [and we pass in our lookup table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1003) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1006) [And again we pass in our sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1007) [data folder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1011) [Again, we run inference over all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1012) [the images using both the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1016) [original model and the quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1019) [original model and the quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1019) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1020) [And we see this time we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1021) [getting a much better, little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1022) [bit better Top 1 Agreement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1024) [Now for this model, we see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1026) [lookup table was the right way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1028) [to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1029) [But again, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1030) [model-dependent and for other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1031) [models, linear may be the way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1032) [So now that we're happy with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1034) [this and we see that this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1035) [good enough for at least my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1037) [application, let's go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1038) [save this model out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1039) [We do that by causing or calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1042) [save.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1044) [I'm going to give it the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1051) [creative name of Quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1051) [SqueezeNet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1053) [And there we go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1061) [We have a quantized model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1062) [So this was an original model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1063) [And we saw that it was 5](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1065) [megabytes in size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1066) [Let's open up our quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1068) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1069) [And the first thing we notice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1070) [right off the bat is that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1073) [model is only 1.3 megabytes in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1074) [size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1077) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1078) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1078) [So if you notice, all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1084) [details about, about our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1086) [quantized model are the same as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1087) [the original model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1090) [It still takes in an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1091) [input, and it still has two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1092) [outputs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1094) [Now, if I had an app using this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1095) [model, what I could do as we saw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1097) [in the previous demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1098) [Is we could just drag this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1100) [quantized model into our app and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1101) [start using that instead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1102) [And just like that, we reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1103) [the size of our app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1105) [So that was quantization using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1112) [Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1114) [To recap, we saw how easy it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1118) [to use Core ML Tools to quantize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1121) [our model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1123) [Using a simple API, we provided](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1124) [our original model, the number](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1127) [of bits we wanted to quantize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1129) [our model to, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1130) [quantization algorithm we wanted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1131) [to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1133) [We also saw that Core ML Tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1134) [has utilities which help us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1135) [compare our quantized model to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1137) [see how it performs against our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1139) [see how it performs against our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1139) [original model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1141) [Now as we saw in the demo, there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1143) [is a loss of accuracy associated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1145) [with quantizing our model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1147) [And this loss of accuracy is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1149) [highly model and data dependent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1152) [Some models work well or perform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1154) [better than others after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1157) [quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1158) [As a general rule of thumb](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1159) [again, the lower the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1160) [bits we quantize our model to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1162) [the more of a precision hit we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1164) [take.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1165) [Now in the demo we saw that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1166) [were able to use Core ML Tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1168) [to compare our quantized model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1170) [and the original model using our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1171) [Top 1 Agreement metric.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1173) [But you have to figure out what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1175) [the relevant metric for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1177) [model and your use case is and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1178) [validate that your quantize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1180) [model is acceptable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1181) [Now in a previous session, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1184) [took a look at a style transfer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1185) [demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1187) [And this network took in an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1188) [input image, and the output for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1190) [this network was a stylized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1192) [image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1194) [Let's take a look at how this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1195) [model performs at different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1196) [levels of quantization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1197) [So on the top, top left here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1200) [your left.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1203) [We see that original model is 30](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1204) [-- is 32 bits and it's 6.7](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1206) [megabytes in size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1209) [And our 8-bit linearly quantized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1210) [model is only 1.7 megabits in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1212) [size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1214) [And we see that the performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1214) [by visual inspection it's good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1216) [enough for my style transfer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1218) [demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1219) [Now we can see that even down to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1220) [4 bits, we don't lose out much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1223) [in the way of performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1225) [I would even argue that for my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1226) [app at least, the 3 bit will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1227) [work fine as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1229) [And we see at 2 bit, we start to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1230) [see a lot of artifacts and this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1232) [may not be the right model for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1234) [us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1237) [And that was quantization using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1238) [Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1240) [Now I'm going to hand it back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1242) [Aseem who's going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1243) [custom conversion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1244) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1245) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1246) [&gt;&gt; Thank you, Sohaib.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1252) [So I want to talk about a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1253) [feature that is essential to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1256) [keep pace with the machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1258) [learning research that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1259) [learning research that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1259) [happening around us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1260) [As you all know, the field of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1262) [machine learning is expanding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1264) [very rapidly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1266) [So it's very critical for us at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1267) [Core ML to provide you with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1269) [necessary software tools to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1271) [with that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1274) [Now let's take an example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1275) [Let's say you are experimenting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1277) [with a new model that that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1279) [not supported on Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1281) [Or let's say you have a neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1282) [network that runs on Core ML but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1284) [maybe there's a layer or two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1287) [that Core ML does not have yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1289) [In that case, you should still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1292) [be able to use the power of Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1294) [ML, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1297) [And the answer to that question](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1298) [is yes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1300) [And the feature of customization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1301) [will help you there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1303) [In the next few minutes, I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1305) [to really focus on the specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1307) [use case of having a new neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1310) [network layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1312) [And show you how you would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1313) [convert it to Core ML and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1315) [how you would implement it in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1317) [your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1318) [your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1318) [So let's take a look at model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1320) [conversion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1322) [So if you have used one of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1323) [converters, or even if you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1325) [not, it's a really simple API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1326) [It's just a call to one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1328) [function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1330) [This is how it looks for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1331) [Keras converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1334) [And it's very similar for say](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1335) [the ONNX converter or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1337) [TensorFlow converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1339) [Now when you call this function,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1341) [mostly everything goes right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1343) [But sometimes you might get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1346) [error message like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1347) [It might say, "Hey, unsupported](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1350) [operation of such-and-such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1352) [kind."](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1354) [Now if that happens to you, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1355) [only need to do a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1357) [more to get past this error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1359) [More specifically, such an error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1361) [message is an indication that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1363) [you should be using a custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1364) [layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1367) [And before I show you what is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1368) [the little bit of extra effort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1370) [that you need to do to convert,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1371) [let's look at a few examples](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1373) [where you would need to use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1375) [custom layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1377) [So let's say you have an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1381) [classifier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1382) [This is how it looks in Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1383) [So it will be high-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1386) [description of the model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1387) [If you look inside, it's very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1388) [likely that it's a neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1391) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1392) [And it's very likely that it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1393) [convolutional neural network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1394) [So it has a lot of layers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1396) [convolution, activation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1397) [Now it might happen that there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1400) [a new activation layer that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1402) [comes up that Core ML does not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1403) [support.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1404) [And it's like at every machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1405) [learning conference, researchers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1409) [are coming up with new layers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1410) [all the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1412) [So this is a very common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1412) [scenario.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1413) [Now if this happens, you only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1413) [need to use a custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1417) [implementation of this new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1419) [layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1420) [And then you are good to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1421) [So this is how the model will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1422) [look like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1423) [The only difference is this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1424) [dependency section at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1426) [bottom.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1428) [Which would say that this model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1429) [contains a description of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1432) [custom layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1434) [Let's take a look at another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1434) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1436) [Let's say we have a very simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1437) [digit classifier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1438) [Now I came across this research](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1441) [paper recently.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1443) [It's called Spatial Transformer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1445) [Network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1446) [And what it does is this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1447) [So it inserts a neural network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1449) [after the digit that tries to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1452) [localize the digit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1455) [And then it feeds it through a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1457) [grid sampler layer which renders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1458) [the digit again, but this time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1461) [it has already focused on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1463) [digit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1465) [And then you pass it through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1465) [your old classify method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1466) [Now we don't need to worry about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1469) [the details here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1471) [But the point to note is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1472) [the portion in green is what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1473) [Core ML supports.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1475) [And the portion in red, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1477) [this new grid sampler layer, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1478) [this new experimental layer that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1481) [Core ML does not support.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1482) [So I want to take an example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1484) [this particular model and show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1485) [you how you would convert it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1487) [using Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1490) [So let's go to demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1491) [I hope it works on the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1500) [try.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1501) [Back, oh yes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1503) [Okay. So let me close off these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1505) [windows.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1509) [Let me get, clear this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1514) [Clear the ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1516) [Okay, so I'm also going to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1518) [Jupyter Notebook to show the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1520) [demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1522) [So I just navigate to the folder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1530) [where I have my pre-trained](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1531) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1533) [So what you see here is that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1534) [have this spatial transformer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1535) [dot [inaudible] file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1538) [This is a pre-trained Keras](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1539) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1541) [And if you are wondering if I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1542) [did something special to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1544) [this model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1545) [Basically what I did was I could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1547) [easily find an open source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1550) [implementation of spatial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1552) [transformer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1553) [I just exhibited that script in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1554) [Keras, and I got this model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1555) [And along with this model, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1557) [also got this grid sampler layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1559) [also got this grid sampler layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1559) [Python script.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1561) [Now this grid sampler layer that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1563) [I'm talking about, it's also not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1564) [supported on Keras natively.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1567) [So the implementation that I got](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1569) [online used that Keras custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1571) [layer to implement the layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1573) [So as you can see, the concept](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1576) [of customization is not unique](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1578) [to Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1580) [In fact, it's very common in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1580) [most machine learning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1582) [frameworks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1583) [This is how people experiment in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1584) [new layers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1586) [Okay, so so far, I just have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1587) [Keras model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1590) [And now I want to focus on how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1590) [can I get a Core ML model?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1592) [So I'll open -- there, let me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1594) [launch a new Python notebook.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1600) [So I'll start by importing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1603) [Keras model into my Python](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1606) [environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1607) [Okay? So I import Keras, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1609) [import the, the custom layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1613) [that we have in Keras.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1616) [And now I will load the model in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1618) [And now I will load the model in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1618) [Keras.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1620) [Okay? So this is how you load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1622) [model, Keras models.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1625) [You give the part to the model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1626) [and if there's a custom layer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1627) [you give a part to that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1628) [Okay. So we have the model now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1631) [Now let's convert this to Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1633) [ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1634) [So I'm going to import Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1635) [Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1636) [Execute that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1638) [And now as I, as I showed you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1639) [before that this is just a call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1642) [to one function to convert it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1644) [So let me do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1646) [That's my call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1648) [And I get an error as expected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1649) [Python likes to throw these huge](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1652) [error messages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1655) [But really what we're focused on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1656) [is this last line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1658) [Let me --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1660) [So as we can see in this last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1666) [line it says that hey, the layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1667) [or sampler is not supported.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1669) [So now let's see what we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1671) [do to get rid of that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1673) [Maybe I clear this all so that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1675) [you can see.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1677) [Okay. So now I change my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1677) [converter call just a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1679) [converter call just a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1679) [so I have my Core ML model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1681) [And now I'm going to pass one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1683) [additional argument.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1688) [It's called custom conversion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1689) [functions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1694) [And this will be a dictionary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1699) [from the name of the layer to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1701) [function that I will define in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1703) [minute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1705) [And that I'm calling a good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1706) [sampler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1707) [So let me take a step back and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1707) [explain what is happening here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1709) [So as we know the way converter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1710) [works is that it goes through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1711) [each and every Keras layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1714) [It will, if you look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1716) [first layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1718) [Then [inaudible] its parameters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1718) [to Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1720) [If you go to the second layer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1720) [then translate its parameters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1721) [and so on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1723) [Now when it hits this custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1724) [layer, it doesn't know what to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1725) [do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1726) [So this function that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1727) [passing here that convert this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1729) [sampler is going to help my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1730) [converter in doing that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1733) [And let me show you what this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1734) [function looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1736) [So this is a function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1741) [There are a few lines of code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1741) [but all that it's doing is three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1743) [things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1745) [First, it's giving a name of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1747) [class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1751) [So as we might have noticed, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1751) [implementation of the layer is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1753) [not here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1755) [The implementation will come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1755) [later in the app and it will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1757) [encapsulated in a class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1759) [And this is the name of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1761) [class that we'll later](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1762) [implement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1763) [So during conversion, we just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1764) [need to specify this class name.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1766) [That's it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1768) [And then there's the description](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1769) [which is a, which you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1770) [provide so that if anybody is,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1772) [if somebody is looking at your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1774) [model, they know what it has.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1777) [And the third thing is basically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1779) [translating any parameters that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1780) [the Keras layer had to Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1782) [For this particular layer, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1785) [has two parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1786) [The output height, and output](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1787) [weight.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1788) [And I'm just translating it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1789) [Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1790) [If your custom layer that does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1791) [not have any parameters, then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1792) [you load, then you do not need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1794) [to do, do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1796) [If your layer has lots of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1798) [parameters, they can all go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1799) [parameters, they can all go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1799) [here, and they will all be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1801) [encapsulated inside the Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1802) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1804) [So as you might have noticed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1805) [that all I did here was very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1807) [similar to how you would define](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1809) [a class, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1810) [You give a class name.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1811) [Maybe a description, maybe some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1812) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1814) [So now let me execute this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1815) [And now we see that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1820) [converter went, conversion went](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1820) [fine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1825) [So let me this is behaving very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1825) [weirdly for some reason.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1830) [If you don't mind, I'm just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1835) [going to delete this all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1836) [So let me visualize this model,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1840) [and you can do that very simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1842) [using function in Core ML Tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1844) [That's called visualize spec.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1847) [And here you can see a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1850) [visualization of the model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1853) [So as we can see, we have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1854) [[inaudible] and some layers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1856) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1856) [And this is our custom layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1857) [And this is our custom layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1857) [And if I click on this, I see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1860) [the parameters that it has.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1861) [So this is the name of the class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1863) [that I gave.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1865) [And this, and these are the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1866) [parameters that I set.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1867) [It's always a good idea to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1870) [visualize your Core ML model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1870) [before you drag and drop just to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1873) [see if everything looks fine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1874) [Okay. This is the wrong](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1877) [notebook.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1880) [Okay. And now I'll save out this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1881) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1883) [And now let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1890) [this model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1892) [So let me close this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1893) [Okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1897) [Let me actually let me navigate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1902) [to the directory that I have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1904) [And here's my model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1911) [So if I click on it and see it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1912) [in Xcode just to see how it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1913) [looks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1915) [We can see that it has the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1915) [custom description here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1918) [custom description here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1918) [Okay. Let me go back to slides.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1921) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1924) [So what we just saw was with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1930) [few simple lines, we could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1932) [exhibit a convert a function to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1935) [Core ML.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1936) [And the process is pretty much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1937) [the same if you are using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1939) [TensorFlow converter or the ONNX](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1941) [converter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1943) [So we have our model here on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1945) [left-hand side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1946) [The custom layer model with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1947) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1949) [Now when you drag and drop this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1950) [model into Xcode, you will need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1951) [to provide the implementation of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1953) [the class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1955) [In a file say, for example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1956) [[inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1958) [And this is how it would look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1958) [like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1959) [So you have your class, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1960) [you'll have the initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1962) [function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1965) [So this would be just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1965) [initializing any parameters that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1967) [we had in the model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1969) [And then the main function in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1970) [this class would be evaluate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1972) [This is where the actual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1976) [implementation of whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1979) [implementation of whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1979) [mathematical function the layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1980) [is supposed to perform will go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1981) [here, in here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1983) [And then there's one more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1984) [function called output shape or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1985) [input shapes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1987) [This just specifies the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1988) [the output area that the layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1990) [produces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1991) [This helps Core ML in allocating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1992) [the buffer size at load time so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1994) [that your app is more efficient](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1997) [at runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=1999) [So we just saw how you would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2001) [tackle a new layer in a neural](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2004) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2006) [There's a very similar concept](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2006) [to a custom layer, and it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2009) [called custom model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2010) [It has the same idea, but it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2012) [sort of more generic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2015) [So with a custom model, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2017) [deal with any sort of network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2019) [It need not be a neural -- it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2021) [need not be a neural network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2023) [And basically gives you just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2025) [more flexibility overall.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2026) [So let me summarize the session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2030) [We saw how much more rich is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2032) [this ecosystem around Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2037) [Tools and that's great for you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2038) [Tools and that's great for you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2038) [guys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2040) [Because now you have lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2040) [choice to get Core ML models](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2041) [from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2043) [We saw how easy it was to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2044) [quantize this, quantize Core ML](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2046) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2049) [And we saw that with a few lines](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2050) [of code, we could easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2053) [integrate a new custom layer in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2056) [the model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2059) [You can find more information at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2060) [our documentation page.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2062) [And come to the labs and talk to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2063) [us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2065) [Okay, thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2066) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/709/?time=2067)