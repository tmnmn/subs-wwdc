# Metal for OpenGL Developers

## Summary
Metal is the foundation for accelerated graphics and compute on Apple platforms, enabling your apps and games to tap into the incredible power of the GPU. Get introduced to essential Metal capabilities and understand the recommended approach for transitioning OpenGL-based apps onto the Metal API.

## Info
* Graphics and Games
* WWDC 2018 - Session 604 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=21) [&gt;&gt; Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=28) [My name is Dan Omachi, I'm an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=29) [engineer in Apple's Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=30) [Ecosystem Team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=32) [Now my main role on that team is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=33) [to help developers learn Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=35) [and have a great experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=37) [using it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=38) [But prior to this I worked on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=39) [Apple's OpenGL and OpenGL ES](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=41) [frameworks for many years.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=43) [And even before joining Apple I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=45) [worked on a couple of other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=46) [OpenGL implementations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=47) [So I'm really proud of what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=50) [we've accomplished with OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=53) [over the past years, but I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=55) [also really excited about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=57) [direction Metal's taking us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=59) [direction Metal's taking us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=59) [Today my colleague Sukanya](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=62) [Sudugu and I are going to give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=64) [you a brief introduction to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=65) [Metal and provide some guidance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=67) [about how you can easily port](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=70) [your OpenGL apps over.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=72) [Now this is particularly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=75) [important this year because as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=76) [announced in yesterday's state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=79) [of the union OpenGL, openGL ES](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=80) [and OpenCL are deprecated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=83) [Now existing and soon-to-be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=86) [launched apps can still use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=88) [OpenGL ES on tvOS and iOS12 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=90) [OpenGL and OpenCL on macOS 10.14](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=95) [Mojave and this will remain so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=100) [for some time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=103) [However, new projects should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=105) [target Metal from their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=108) [inception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=109) [So if you're not already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=111) [familiar with Metal, then it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=111) [time to get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=113) [Before you rip out all of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=115) [OpenGL code and start porting it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=116) [all to Metal you've got a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=118) [options to consider.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=119) [options to consider.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=119) [Apple offers several high-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=121) [frameworks that do rendering,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=123) [different kinds of rendering,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=125) [SpriteKit for 2D games, SceneKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=126) [for some 3D, Core Image for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=128) [great effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=130) [Also, each of the major](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=133) [third-party game engines already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=135) [use Metal as their primary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=137) [renderer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=139) [But you may decide that these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=140) [approaches just aren't for you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=142) [and the path forward is to do it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=144) [yourself in Metal, that's what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=145) [we'll talk about today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=148) [So let's start out with Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=150) [design and some fundamental](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=151) [concepts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=153) [So OpenGL was originally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=155) [designed 25 years ago and its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=157) [core reflects the origins of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=159) [hardware accelerated 3D](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=161) [graphics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=162) [So updates with new versions and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=164) [extensions have really served us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=166) [well by exposing new GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=168) [features and performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=169) [techniques.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=171) [However, there are still some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=172) [fundamental design choices that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=174) [no longer apply to current](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=176) [hardware.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=178) [The OpenGL pipeline was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=180) [originally an entirely fixed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=182) [function and although today](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=183) [OpenGL supports a programmable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=185) [pipeline it doesn't neatly match](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=187) [that of modern GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=189) [Also, asynchronous processing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=193) [not a core feature of the API,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=195) [there are a number of features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=197) [which allude to the fact that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=198) [the GPU works in parallel with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=199) [your app but much of this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=200) [implicit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=202) [And 25 years ago only the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=203) [expensive workstations and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=206) [servers had multiple cores.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=207) [So designing an efficient](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=209) [multithreading model wasn't a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=210) [priority.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=212) [So back in 2014, it was clear to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=213) [us that a new application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=217) [interface for the GPU was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=219) [necessary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=220) [Obviously, we needed an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=221) [interface that could efficiently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=222) [harness the GPU's power.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=224) [To do that the app needed the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=226) [CPU out of the way so the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=228) [could do its thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=229) [But when an app needs the CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=232) [for rendering it needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=233) [able to use all of the CPU,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=234) [including its multiple cores.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=236) [If the interface needed to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=239) [If the interface needed to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=239) [predictable to prevent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=241) [developers from falling into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=242) [hidden pitfalls in the API every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=244) [call should have an obvious](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=248) [consequence and few operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=249) [should be performed implicitly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=252) [Part of this predictability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=254) [would be the need to control](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=256) [where resources were placed and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=257) [if and when synchronization was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=259) [necessary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=261) [Now Apple had a few other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=262) [requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=266) [We wanted this interface to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=267) [approachable, it needed to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=269) [the right balance between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=271) [low-level control and clear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=272) [usage because the easier it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=274) [for you to understand something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=276) [the more effectively and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=277) [efficiently you can use it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=279) [And of course, we designed Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=281) [to map well to all modern GPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=283) [In particular, we knew that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=286) [hardware coming down the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=289) [pipeline needed software that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=290) [could push it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=292) [This included the Apple designed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=293) [GPU of the A11 bionic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=295) [So how is Metal different than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=299) [So how is Metal different than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=299) [OpenGL?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=301) [Well you perform the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=302) [expensive operations less often.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=303) [Objects are designed in such a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=307) [way that API state can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=308) [translated and prepackaged into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=309) [GPU commands at creation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=312) [This way, there's much less cost](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=315) [to use them later on when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=317) [actually rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=318) [The graphics pipeline with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=320) [Vertex and fragment shaders also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=321) [reflects the modern GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=323) [So it's less costly to translate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=325) [the API's configuration to GP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=327) [commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=329) [This doesn't mean the pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=331) [is entirely different or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=332) [requires some whole new way of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=334) [thinking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=335) [The main difference in Metal is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=336) [that the grouping of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=338) [pipeline stages into objects is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=339) [more efficient, not that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=341) [pipeline itself is changed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=343) [Metal also has a clear model for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=346) [multithreaded execution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=349) [There are a number of different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=351) [ways for applications to drive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=352) [the GPU from different threads,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=353) [but for each there are explicit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=356) [but unconstraining rules to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=357) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=359) [Additionally, the most commonly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=361) [used objects like textures,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=362) [buffers and shaders can safely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=363) [and efficiently be used across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=365) [threads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=367) [Metal does not need to perform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=368) [any expensive internal logging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=370) [operations to prevent these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=371) [objects from getting into some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=373) [invalid state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=374) [Finally, the execution model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=377) [reflects what really goes on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=379) [between software and the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=381) [Many of the implicit operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=383) [performed by OpenGL are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=385) [explicitly performed by an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=386) [application using Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=388) [This allows you to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=390) [intelligent decisions as to when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=391) [and how your app uses the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=393) [It also means there's less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=396) [software between your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=397) [application and the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=399) [Most Metal calls go directly to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=401) [the GPU driver and that driver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=403) [also needs to do less processing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=405) [to translate from API calls to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=406) [GPU commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=408) [So let's dive in and see how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=411) [this works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=412) [All GL calls are performed on an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=413) [OpenGL context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=416) [The context does a ton of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=417) [things, it tracks API state, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=419) [things, it tracks API state, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=419) [manages OpenGL objects and other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=422) [memory, and translates and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=423) [submits GPU commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=425) [Metal splits all of these jobs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=427) [of an OpenGL context into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=429) [number of smaller objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=430) [The first object that creates is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=434) [a Metal device which is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=436) [abstract representation of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=438) [physical GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=440) [The device creates objects such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=442) [as textures, buffers and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=446) [pipeline objects which contain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=447) [shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=449) [It also creates a key object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=451) [called a Metal command queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=453) [The command queue really only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=455) [has one job, to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=457) [sequence of command buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=459) [Here we've created one command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=461) [buffer and a command buffer is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=463) [simply a list of GPU commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=464) [that your app will fill and send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=466) [to the GPU for execution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=468) [Typically your app will create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=471) [single command buffer per frame,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=472) [however, there are some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=475) [situations where it makes sense](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=475) [to create two or three in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=477) [to create two or three in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=477) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=480) [But an app doesn't write these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=481) [commands directly to the command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=482) [buffer, instead it creates a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=483) [Metal command encoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=485) [The command encoder translates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=487) [API calls into GPU instructions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=489) [and writes them to the command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=491) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=493) [After a series of commands have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=494) [been encoded your app will end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=495) [encoding and release the encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=497) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=498) [There are actually a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=500) [different kind of encoders and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=501) [your app can create new encoders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=502) [from the command buffer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=504) [encode more commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=505) [Now it's important to note that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=511) [up until now on this diagram the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=512) [GPU hasn't done any work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=514) [Metal has created objects and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=517) [encoded commands all with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=518) [CPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=520) [It's only after your app has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=521) [finished encoding commands and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=523) [committed the command buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=525) [that the GPU begins to work and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=527) [executes those commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=529) [You can also encode commands to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=532) [multiple command buffers in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=534) [parallel on separate threads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=536) [Now I've already spoken about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=538) [Now I've already spoken about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=538) [how the command queue produces a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=542) [sequence of command buffers and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=543) [that you create a command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=546) [encoder from a command buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=547) [Let's take a closer look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=550) [these encoder objects used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=551) [write to our command buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=553) [There are three main types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=555) [There's the Render Command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=558) [Encoder whose commands resemble](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=558) [that of an OpenGL command string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=560) [where you set state, bind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=562) [objects, and issue draw calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=563) [There's the Blit Command Encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=566) [with which you can issue texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=567) [and buffer copy operations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=569) [You can also use it to generate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=571) [Mipmap for textures and transfer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=572) [pixel data from buffers similar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=574) [to how glReadPixels operates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=576) [with OpenGL's pixel buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=578) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=579) [And then there's the Compute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=580) [Command Encoder which allows you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=583) [to dispatch commute kernels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=586) [The Render Command Encoder is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=589) [probably the encoder you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=590) [become most familiar with as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=591) [it's responsible for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=593) [majority of operations that a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=594) [graphic centric app needs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=596) [The set of commands encoded into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=599) [The set of commands encoded into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=599) [a Render Command Encoder is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=600) [often referred to as a Render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=602) [Pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=603) [In a Render Pass you set up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=605) [render objects for the graphics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=606) [pipeline and issue draw commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=608) [with those objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=610) [This includes operations similar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=612) [to glDrawArrays and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=613) [glDrawElements and other OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=615) [draw commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=618) [Each Render Command Encoder is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=621) [strongly associated with a set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=622) [of render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=624) [And the render target is simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=626) [a texture that can be drawn to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=628) [This includes color, depth and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=630) [stencil textures, as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=632) [multi-sample textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=634) [You specify a set of render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=636) [targets when you create a render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=637) [command encoder from a command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=638) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=642) [And all draw commands are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=642) [directed to these targets for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=643) [the lifetime of the encoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=645) [To direct commands to a new set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=648) [of targets you end encoding with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=649) [a current render command encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=651) [and create a new encoder with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=653) [new targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=655) [This creates a very clear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=657) [delineation between commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=658) [delineation between commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=658) [directed to different sets of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=661) [render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=662) [Let's talk a little bit about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=664) [the object you'll use for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=666) [rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=667) [Metal has a number of similar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=669) [objects to OpenGL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=670) [There are textures, buffers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=671) [samplers and pipeline state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=675) [objects which resemble OpenGL's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=677) [program objects, and also depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=679) [stencil state objects which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=682) [don't really exists in OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=683) [but are just the containers for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=685) [the same depth and stencil state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=686) [that OpenGL's got.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=688) [One significant difference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=691) [between OpenGL and Metal objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=693) [are how they are created and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=695) [managed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=697) [The objects are all created from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=699) [a device object so they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=700) [associated with a single GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=701) [You set most of an object state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=704) [when you create it by specifying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=706) [properties in a descriptor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=708) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=710) [All states set when the object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=711) [is created is fixed and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=713) [immutable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=715) [Although the state of textures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=716) [and buffers are fixed upon](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=718) [creation, data contained by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=719) [creation, data contained by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=719) [these objects can be changed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=722) [Metal can do all the expensive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=724) [setup for an object once when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=727) [it's created.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=729) [OpenGL's mutable model makes it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=730) [completely possible that if your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=732) [app touches a little piece of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=733) [state the recompilation of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=735) [object may occur.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=738) [And even if your app doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=739) [change an object state OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=741) [needs to check a hierarchy of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=743) [flags to confirm this before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=745) [drawing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=746) [So with this immutable model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=748) [Metal never needs to check for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=750) [object state changes make draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=752) [calls much faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=754) [Additionally, objects can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=757) [efficiently used across threads,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=759) [Metal never needs to lock an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=761) [object to prevent it from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=762) [getting into an invalid state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=763) [from a change on another thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=765) [So let's talk about porting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=771) [Here is the typical phase, here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=772) [are typical phases of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=777) [rendering application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=779) [rendering application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=779) [You build the app compiling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=781) [source and bundling your assets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=782) [Start up and initializing it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=784) [Loading the assets and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=786) [initializing objects that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=787) [persist for the lifetime of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=789) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=791) [And you repeatedly render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=793) [setting up state, issuing many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=795) [draw calls, and presenting frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=796) [after frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=799) [I'll talk about developing for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=800) [Metal in the earlier stages of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=803) [the application's lifetime,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=805) [including building shaders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=808) [offline and creating object's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=809) [initialization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=811) [And Sukanya will describe how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=813) [port your per frame rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=814) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=816) [So let's start out with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=818) [application build time which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=819) [where shaders are typically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=821) [compiled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=823) [We'll begin with a look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=824) [shading language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=826) [The Metal shading language is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=827) [based on C++.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=829) [So just like C++ you can create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=830) [classes, templates, structures,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=833) [define enums and namespaces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=835) [Like GLSL there are built-in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=838) [Like GLSL there are built-in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=838) [vector and matrix types, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=840) [numerous built-in functions and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=842) [operators commonly used for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=844) [graphics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=845) [And there are classes to specify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=846) [sampler state and operate on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=849) [textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=851) [The best way to describe the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=852) [language is just to show you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=853) [So here is a vertex and fragment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=855) [shader pair.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=857) [The vertex keyword at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=859) [function at the top specifies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=860) [that that function is a vertex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=862) [shader, likewise for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=864) [fragment keyword for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=865) [function at the bottom.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=867) [Note that they have custom names](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=869) [unlike GLSL where every shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=871) [is just called main.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=873) [This is important because it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=874) [allows you to build large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=875) [libraries of unique shaders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=877) [using names to indicate what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=879) [they do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=881) [Anything passed from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=881) [application is an argument to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=884) [one of these shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=886) [There aren't any loose variables](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=888) [outside of functions as there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=889) [are with GLSL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=890) [As you can see, there are these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=892) [bracketed symbols next to each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=893) [parameter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=895) [These are attribute specifiers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=896) [which extend upon the C++](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=898) [language to indicate special](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=899) [language to indicate special](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=899) [variables.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=901) [So this vertex ID attribute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=903) [indicates that this VID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=905) [parameter should contain the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=907) [index of the current vertex when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=908) [this vertex executes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=911) [It's used down here in two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=913) [places to index into an array of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=914) [vertices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=917) [These parameters here with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=918) [buffer attribute specifier these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=920) [indicate that these variables](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=922) [are filled by buffer's objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=924) [set in the Metal API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=926) [I'll talk more about how the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=927) [Metal API relates to these in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=929) [just a minute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=931) [But first let's take a closer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=932) [look at some of the types used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=933) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=934) [Now these are all custom types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=936) [that you would define.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=938) [The vertices parameter here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=940) [defined as a pointer to a vertex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=941) [type and its definition is right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=943) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=945) [The structure has two members, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=946) [model position member and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=948) [texture coordinate member.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=950) [It defines the layout and memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=952) [of each vertex in a vertex array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=954) [passed into this vertex shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=956) [Let's look at this vertex output](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=959) [Let's look at this vertex output](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=959) [type returned by our vertex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=961) [shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=962) [Its definition here specifies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=963) [what's passed down for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=966) [rasterization stage and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=967) [eventually to the fragment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=969) [program.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=970) [The four-component](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=971) [floating-point member named](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=973) [clipPos has this position](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=975) [attribute specifier next to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=977) [This indicates that this member](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=979) [will serve as the output](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=980) [position of our vertex shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=982) [This texCoord member which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=985) [doesn't have an attribute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=986) [specifier defaults to a variable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=987) [that will be interpolated with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=990) [the texture coordinate values of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=991) [other vertices defining the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=994) [rasterized triangle much like a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=996) [varying in GLSL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=998) [Let's take a look at some of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1001) [parameters of our fragment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1002) [shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1003) [So we're using this vertexOutput](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1005) [struct that we just looked at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1006) [down here as an input to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1009) [fragment shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1011) [And it gives us the interpolated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1012) [texture coordinate that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1014) [constructed in the vertex shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1015) [and we use it here to sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1018) [and we use it here to sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1018) [from a texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1020) [In our application code which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1023) [written in Objective-C we use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1024) [Render Command Encoder to map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1026) [objects to shader parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1028) [The index argument with each of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1032) [these calls are similar to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1035) [OpenGL's attribute indices,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1036) [vertex attribute indices, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1038) [textured units.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1039) [They specify indices which map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1041) [to indices in our shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1043) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1045) [So by calling the encoder's set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1047) [fragment buffer method with an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1049) [index of three we map this my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1050) [uniform buffer object to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1053) [uniform's parameter of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1055) [encoder, of our shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1057) [We make similar calls to set our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1059) [texture and sampler objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1062) [Now I want to talk about one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1070) [library that's incredibly useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1072) [for shader development.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1074) [This is called SIMD.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1077) [Now SIMD is actually a library](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1078) [Now SIMD is actually a library](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1078) [that's separate from Metal and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1080) [is used in many orthogonal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1083) [frameworks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1084) [But it was built with Metal in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1085) [mind.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1087) [SIMD defines vector and matrix](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1088) [types commonly used to implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1090) [graphics algorithms, so this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1093) [includes three and four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1095) [component vector types and three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1096) [by three and four by four matrix](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1097) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1099) [One of the nicest features of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1104) [this library is that you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1104) [it to share code between your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1106) [application code and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1110) [shading language code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1113) [This is really useful because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1115) [you can define the layout of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1117) [data passed from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1118) [application to your shaders with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1119) [structures using these types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1122) [Here's how it works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1124) [You create a structure with data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1125) [you'd like to pass from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1127) [application to your shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1128) [So for instance, if you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1129) [pass down a model view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1131) [projection matrix to the and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1132) [position of the SIMD primary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1135) [light source you can use SIMD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1136) [types in your structure to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1138) [types in your structure to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1138) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1141) [You put the structure's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1141) [definition and a header which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1142) [you would include in both your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1145) [application code and Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1146) [files.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1148) [This way the data layout used by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1149) [your shaders matches what you've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1150) [set in your code because they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1152) [using the same types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1154) [This makes bugs due to layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1156) [mismatches much less common.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1158) [One of the key ways in which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1164) [Metal achieves its efficiency is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1165) [by doing work earlier and less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1167) [frequently.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1170) [So you'll use Xcode to compile](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1171) [Metal shader files when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1173) [build your application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1174) [This runs a front-end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1176) [compilation performing string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1178) [parsing, shader analysis, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1179) [some basic optimizations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1181) [It converts your code into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1183) [binary intermediate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1185) [representation that is usable on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1186) [any hardware.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1188) [Actual GPU machine code isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1190) [built until your app runs on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1192) [user's system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1194) [But this removes half the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1195) [compiled time needed when your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1196) [app runs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1198) [The built intermediate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1199) [The built intermediate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1199) [representation binary is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1202) [archived into a Metal library](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1205) [file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1207) [Xcode will compile all the Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1208) [shader source files into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1210) [default Metal library, placing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1211) [it into your app bundle for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1213) [retrieval at runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1216) [In addition to having Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1217) [built shaders you also can build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1220) [shaders during your app's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1223) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1224) [Some OpenGL apps construct](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1226) [shaders at runtime by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1227) [concatenating strings or running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1228) [a source code generator of some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1230) [kind.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1231) [For those gathering all of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1232) [shaders at build time can be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1233) [challenge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1235) [But for bring up purposes or if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1236) [built time compilation just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1238) [isn't possible for your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1240) [Metal is able to compile shaders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1241) [from source at runtime just like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1243) [OpenGL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1245) [However, there are a number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1246) [disadvantages to this, most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1249) [obviously you give up on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1250) [performance savings of keeping](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1252) [this work off the user's system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1253) [You won't see any shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1256) [compilation errors at built time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1257) [so you'll only find out about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1258) [them when you run your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1259) [them when you run your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1259) [Finally, if you compile at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1261) [runtime you can't include](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1263) [headers in your shaders, so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1264) [can't share types between your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1266) [shaders or your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1267) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1269) [If you use runtime share](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1270) [compilation to get your app up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1272) [and running quickly I strongly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1274) [encourage you to spend some time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1276) [getting your shaders to build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1278) [within Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1279) [This way you can benefit from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1280) [not only the runtime performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1281) [savings but also these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1283) [conveniences in shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1284) [development.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1285) [Let's move onto the steps your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1286) [app will need to take to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1289) [initialize your Metal renderer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1290) [so this includes creating a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1292) [number of objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1293) [I'll start out with the devices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1294) [and command queues and then I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1296) [describe how to create objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1297) [for your assets, including](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1299) [textures, buffers and pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1300) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1302) [So devices and queues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1305) [These are the first objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1307) [you'll create.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1309) [The device is an abstract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1310) [representation of a GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1313) [It's responsible for creating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1316) [objects that are used for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1317) [rendering including these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1318) [textures, buffers and pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1319) [textures, buffers and pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1319) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1320) [In iOS since there's only ever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1322) [one GPU there's only one device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1324) [you can get, but on macOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1326) [systems can have multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1328) [devices since there may be both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1330) [an integrated and discrete GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1332) [and even multiple eGPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1334) [Usually though, getting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1337) [default device is sufficient for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1338) [most applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1340) [And getting this device is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1341) [really simple, you call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1343) [MTLCreateSystem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1345) [DefaultDevice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1346) [One of the first things you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1348) [do with this device is create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1351) [command queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1353) [The queue is used mostly in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1355) [applications render loop to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1357) [obtain command buffers each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1358) [frame, but you want to create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1360) [the command queue at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1361) [initialization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1362) [Typically, a single queue is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1365) [sufficient but more complex apps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1366) [that execute many tasks in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1368) [parallel may need multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1369) [queues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1371) [Creating a queue is also really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1373) [simple, you call newCommandQueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1374) [with the device you just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1376) [created.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1377) [And once you've got your queue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1378) [you can get command buffers for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1380) [your render loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1381) [Let's move on building your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1382) [render objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1386) [I'm going to talk about creating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1388) [three types of objects used for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1390) [rendering, textures, buffers and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1392) [pipelines.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1393) [Let's start with textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1395) [As mentioned earlier, you create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1398) [render objects from a device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1399) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1400) [You'll use a descriptor object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1402) [to create most of these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1403) [Descriptors are really simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1405) [objects without any true](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1406) [methods.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1408) [They only contain properties](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1409) [needed for object setup.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1410) [So for example, to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1413) [texture you'd use a texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1414) [descriptor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1415) [You specify the properties that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1417) [you'd like the created texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1418) [to have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1419) [So things like the type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1420) [texture, 2D, 3D, cubeMap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1421) [The texture's dimensions and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1424) [number of Mipmaps you'd like it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1425) [to have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1426) [And the pixel format of data in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1427) [the texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1430) [Once you've set the desired](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1431) [values for each of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1433) [properties you call a method on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1434) [the device to create a usable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1436) [texture object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1438) [This also allocates the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1440) [backing the texture image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1443) [Once you've created the object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1446) [you no longer need the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1447) [descriptor as it's only used for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1447) [object creation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1449) [And properties you set in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1451) [descriptor are locked and can no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1452) [longer be changed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1453) [However, the contents of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1455) [texture image can be modified.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1457) [So I want to talk about one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1458) [property you'll set in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1461) [texture descriptor and you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1462) [also use when creating a buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1464) [This is called the storage mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1466) [As mentioned, when you create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1469) [texture object Metal allocates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1470) [memory for it right then and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1471) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1473) [The storage mode property tells](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1474) [Metal in which pool memory it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1475) [should be allocated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1476) [The simplest option shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1478) [storage mode gives both the CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1480) [and the GPU access.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1482) [For buffers this means you get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1484) [pointer to the memory backing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1486) [the object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1487) [Protectors, this means you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1488) [call certain easy-to-use methods](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1490) [to set and retrieve data from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1492) [the texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1493) [You can use private storage mode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1494) [which only gives the GPU access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1497) [to the data, this allows the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1498) [to the data, this allows the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1498) [Metal to apply some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1500) [optimizations it would be unable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1501) [to if the CPU also had access to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1503) [that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1505) [But only the GPU can directly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1506) [fill the contents of this type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1508) [of texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1510) [You can indirectly fill data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1512) [from the CPU using a blit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1514) [encoder to copy from a second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1515) [intermediate resource using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1518) [shared storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1519) [On devices with dedicated video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1522) [memory setting the resource to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1523) [use private storage allocates it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1525) [in video memory only.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1527) [Finally, on macOS you can use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1530) [third storage mode called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1532) [managed storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1534) [This allows both the GPU and CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1535) [to access the object data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1537) [And on systems with dedicated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1539) [video memory Metal may create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1540) [mirrored memory backing for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1543) [efficient access by both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1544) [processors.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1546) [Because of this, explicit calls](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1547) [are necessary to ensure data is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1549) [synchronized for GPU and CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1551) [access.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1553) [Here's an example of creating a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1558) [texture object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1559) [texture object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1559) [First you create a texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1560) [descriptor and set a number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1564) [properties in it, including the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1566) [storage mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1567) [And then we create a texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1569) [using the device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1573) [To fill a texture's image data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1575) [we calculate the bytes per row](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1577) [and just like with GLText](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1579) [[inaudible] we specify a region](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1581) [to load.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1583) [And then we call the texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1586) [object's replace region method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1587) [which copies the data into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1589) [texture from a pointer we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1591) [supply.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1592) [Now there are a few notable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1597) [differences between OpenGL and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1598) [Metal texture objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1599) [While OpenGL does have a sampler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1600) [object they are optional.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1602) [Wrap modes and filters can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1604) [set in the texture's object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1605) [itself in OpenGL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1606) [In Metal you need to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1608) [separate sampler object or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1609) [specify sampler parameters in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1611) [your shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1614) [Texture image data is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1615) [flipped in Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1617) [OpenGL uses a bottom-left origin](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1618) [OpenGL uses a bottom-left origin](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1618) [while Metal uses a top-left](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1621) [origin.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1622) [So make sure you're aware of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1623) [difference when loading your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1624) [textures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1625) [Desktop OpenGL also performs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1626) [conversions when the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1629) [supplied is in a different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1630) [format than the internal format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1633) [However Metal similar to OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1636) [ES does not, so you'll need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1638) [make sure your assets are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1640) [already in the proper format or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1641) [implement paths to perform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1643) [conversions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1645) [Let's move on to buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1649) [Metal uses buffers for all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1652) [unstructured data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1654) [They're really similar to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1661) [OpenGL's vertex, element and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1662) [uniform buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1664) [So if you're already using these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1665) [buffers in OpenGL you'll have an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1667) [easier time with your port.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1668) [Creating a buffer is pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1671) [simple with a device you call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1672) [newBufferWithLength specifying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1674) [the size of the buffer you want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1675) [You also specify a storage mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1677) [You load a buffer through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1680) [contents property, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1682) [simply a void pointer to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1683) [memory backing the buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1685) [To Metal's core the data is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1687) [completely unstructured, so it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1688) [up to you to define the layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1690) [in your application and share](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1692) [your code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1694) [Here we're casting the contents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1695) [pointer to a structure which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1696) [uses some of the SIMD types I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1698) [mentioned earlier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1700) [We set the members of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1701) [structure which fills in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1703) [buffer's data using the layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1705) [or application as is defined](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1706) [with the structure's definition.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1708) [As mentioned earlier, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1711) [share a structure's definition](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1712) [between your application and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1714) [share code which ensures the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1715) [layouts match between these two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1716) [components.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1718) [A common mistake is a mismatch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1719) [between buffer data and how it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1724) [interpreted in the shader due to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1726) [an assumption or due to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1728) [assumptions about alignment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1729) [For instance, you might assume](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1732) [that the shading language's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1733) [float3 type consumes only 12](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1734) [bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1737) [Three 4 byte components is 12](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1738) [Three 4 byte components is 12](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1738) [bytes right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1740) [Well if you pack your data that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1741) [way you'll run into trouble](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1743) [because the shading language](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1745) [actually interprets a float3 as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1746) [consuming 16 bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1748) [That's because the types are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1750) [kept as stricter alignments for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1751) [CPU and GPU optimal CPU and GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1752) [usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1756) [Similar problems often occur](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1758) [with three by three matrices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1759) [If you really want to tack, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1762) [you really want to pack data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1763) [tightly there are pack types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1766) [available in the Metal shading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1768) [language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1770) [After passing a pack data in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1771) [buffer your shader code would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1773) [need to pack data, would you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1774) [need to pass that packed data to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1777) [a regular vector before it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1778) [perform operations on that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1780) [So when you're bringing up your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1783) [application I recommend using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1785) [the most convenient storage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1788) [modes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1789) [This makes it more easy to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1791) [access the data in those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1793) [resources.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1795) [So in iOS create all textures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1797) [and buffers with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1798) [StorageModeShared.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1800) [On macOS you can't use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1802) [StorageModeShared with textures,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1803) [but StorageModeManaged does make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1805) [image data access easier,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1807) [although private storage is most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1808) [optimal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1810) [You can use StorageModeShared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1816) [with buffers on macOS, but be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1816) [careful with this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1819) [If you mix data that both the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1820) [CPU and GPU needs access to with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1822) [data only the GPU needs access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1826) [to it can be difficult to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1828) [detangle these two types of data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1829) [later on and put them in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1831) [separate memory pools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1833) [Now that I've described a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1834) [bit about creating textures and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1837) [buffer objects directly I'd like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1839) [to mention the MetalKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1841) [framework which can easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1842) [create textures and vertex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1843) [buffers from common file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1844) [formats.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1846) [There's a texture loading class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1847) [and some functionality to create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1848) [Metal buffer backed meshes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1850) [loaded by Model I/O.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1852) [Let's talk about shaders and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1858) [render pipeline objects that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1859) [render pipeline objects that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1859) [contain them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1860) [You create one of these pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1862) [state objects using a render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1864) [pipeline descriptor object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1865) [The object contains a vertex and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1868) [fragment shader pair.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1870) [It also specifies the layout of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1872) [vertices feeding the vertex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1873) [shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1876) [And also blend state and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1877) [pixel formats of render targets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1879) [that the fragment and shader can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1881) [render to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1883) [Just like with the texture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1885) [object you call method on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1887) [device which will produce an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1888) [immutable render state pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1890) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1891) [And also like a texture object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1893) [you only need the descriptor to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1895) [create that object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1896) [Here's some code showing how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1898) [build these pipeline state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1900) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1901) [Before you create the pipeline,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1903) [you'll need to get the shaders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1905) [out of a Metal library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1907) [This line here loads the default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1909) [Metal library that we built in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1911) [Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1914) [For this library you can obtain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1914) [your vertex and fragment shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1916) [using their function names.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1919) [using their function names.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1919) [You create a render pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1921) [descriptor object where you set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1923) [these shading functions and also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1925) [specify render target pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1926) [formats.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1928) [Finally, you use the device with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1930) [the descriptor object we've set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1932) [up to produce a pipeline state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1933) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1936) [The most significant difference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1938) [between the OpenGL and Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1939) [graphics pipelines is that while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1941) [an OpenGL program object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1945) [contains just a vertex and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1946) [fragment shader pair Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1948) [pipeline objects also include a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1949) [vertex layout, blend state, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1951) [render target pixel format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1953) [So you need to know all of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1955) [things before you build a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1956) [pipeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1959) [Having these extra pieces of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1960) [state in the pipeline enables](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1961) [Metal to fully compile shaders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1963) [into GPU machine code upon](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1964) [object creation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1966) [This is something that's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1968) [possible with OpenGL's program](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1969) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1970) [Now you'll need to build a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1971) [system that allows you to create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1972) [pipelines when you initialize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1974) [your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1975) [It helps if you can choose a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1977) [canonical vertex layout and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1978) [limited set of render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1979) [limited set of render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1979) [This reduces the combinations of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1982) [state your app uses and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1983) [number of pipeline objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1985) [needed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1987) [However, not everyone knows up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1988) [front which pipelines their app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1990) [will need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1992) [A common first step in porting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1993) [an app to Metal is to keep a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1994) [dictionary of pipelines you've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1996) [already made.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1997) [As your app encounters new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1999) [combinations of state it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2000) [build and store pipelines using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2002) [the descriptors as keys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2003) [Keep in mind this solution I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2006) [mentioned is kind of a hack and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2008) [you want to avoid shipping your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2010) [app with it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2011) [This is because creating any of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2012) [these objects is expensive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2013) [When you create a pipeline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2016) [object the GPU compiler kicks in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2017) [and translates and optimizes the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2019) [shader's binary intermediate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2021) [representation to machine code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2022) [If your app creates these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2025) [just-in-time during its render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2026) [loop you're likely to see stalls](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2027) [and a reduced frame rate for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2031) [short period of time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2033) [Allocating memory for textures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2035) [and buffers is also an expensive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2037) [operation, that's not even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2038) [operation, that's not even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2038) [accounting for the processing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2040) [required to fill in these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2041) [resources with data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2042) [However, once you've created](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2044) [these objects using them in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2046) [render loop requires very little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2047) [CPU over [inaudible] since so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2049) [much is done up front.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2051) [With that I'd like to hand it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2054) [over to Sukanya who will talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2055) [about porting your render loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2056) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2058) [&gt;&gt; Good evening everyone, I am](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2063) [Sukanya Sudugu, GPU software](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2064) [engineer at Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2065) [I am super excited to share some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2067) [of our porting experience with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2069) [you, so let's continue porting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2071) [Dan already talked about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2075) [application setup, so by now you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2077) [would have built all your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2079) [shaders and also created all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2080) [persistent objects needed for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2083) [frame generation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2085) [So now let's dive into your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2087) [application's render loop which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2088) [is the code that runs for every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2090) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2092) [With Metal you will explicitly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2093) [manage the asynchronous nature](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2095) [of GPU's execution in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2097) [render loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2099) [render loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2099) [So this includes obtaining and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2100) [submitting command buffers to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2103) [GPU with the list of GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2104) [commands.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2106) [And updating your resources in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2106) [such a way that allows the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2110) [to asynchronously read from it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2112) [which you have written in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2114) [render loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2116) [And encoding render passes by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2117) [creating render command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2119) [encoders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2120) [And finally, presenting your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2121) [frames to the display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2124) [So let's first talk about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2125) [command buffer object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2129) [One of the key changes from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2132) [OpenGL is that Metal provides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2134) [explicit control over command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2136) [buffers, which means it's up to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2138) [you to create these command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2140) [buffers and you can decide when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2142) [to commit them to GPU for its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2144) [execution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2145) [So the straightforward thing to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2147) [do is to create one command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2149) [buffer which will render your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2151) [whole frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2152) [And once your application is up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2153) [and running and if you perhaps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2155) [see some idle time on GPU, then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2157) [you might want to consider](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2159) [you might want to consider](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2159) [splitting your frame across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2162) [multiple command buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2163) [And then the GPU can get started](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2165) [executing one command buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2168) [while CPU is encoding the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2170) [others.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2171) [Alternatively, splitting your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2173) [frame encoding across multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2175) [threads requires you to create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2177) [one command buffer per thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2179) [But keep in mind that there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2180) [some additional CPU cost](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2183) [associated with each command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2185) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2186) [So you should be using as few as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2187) [possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2189) [Metal also provides an API to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2192) [register a completion callback,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2194) [which will be involved when GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2197) [completes executing this command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2198) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2201) [So let me show you all these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2201) [APIs in action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2203) [So you will have created command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2205) [queue in your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2208) [initialization method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2209) [Now in render loop you will use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2211) [it to obtain command buffer by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2213) [calling its command buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2215) [method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2216) [Now you will encode commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2217) [Now you will encode commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2217) [into this command buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2220) [I'll talk more about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2221) [encoder shortly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2223) [But when you are finished](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2225) [encoding you will call commit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2226) [method so that this command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2228) [buffer will be submitted to GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2231) [for its execution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2233) [Now you have two options for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2234) [what to do while this command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2237) [buffer is being executed on GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2239) [You can wait by calling this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2242) [waitUntilCompleted method which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2245) [is similar to glFinish in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2247) [OpenGL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2249) [This method will synchronously](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2250) [wait and only returns when all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2253) [the commands in the command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2255) [buffer has been executed by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2256) [GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2258) [Alternatively, before you commit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2260) [this command buffer to GPU you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2264) [can add a completion handler,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2266) [which will be invoked when GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2269) [is done executing this command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2271) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2272) [This allows CPU and GPU to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2273) [execute in parallel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2276) [Also this allows us to track and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2278) [Also this allows us to track and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2278) [efficiently update shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2280) [resources whose data is changing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2282) [every frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2284) [Since we are here let's talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2285) [more about these resource](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2288) [updates and see how we can make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2289) [them efficient using this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2292) [completion handler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2293) [So almost all applications will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2294) [be pushing new data to GPU every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2298) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2301) [For example, new shaded uniforms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2301) [needed for animations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2304) [In Metal CPU can write to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2306) [shared resources anytime even if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2309) [GP is accessing the same memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2311) [at the same time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2315) [Metal does not protect you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2317) [against these data-races.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2318) [This compares to OpenGL which by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2321) [default prevents these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2324) [data-races either by waiting for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2325) [the GPU workloads to finish or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2328) [by doing extra copies, which may](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2330) [not be optimal for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2333) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2334) [With Metal you can implement any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2336) [optimal synchronization strategy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2338) [optimal synchronization strategy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2338) [which suits best for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2341) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2342) [So in most cases, best approach](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2344) [is to multi-buffer your shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2347) [resources so that CPU and GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2348) [are never trying to access the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2351) [same buffer simultaneously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2353) [So let's see an example, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2357) [have an OpenGL application and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2359) [you just ported it to Metal and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2362) [it is using single buffer for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2364) [these dynamic data updates and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2366) [you did not implement any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2368) [synchronization method yet in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2370) [your application, then here's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2372) [what will happen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2374) [Your application will write to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2376) [that buffer while generating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2378) [commands for the first frame and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2379) [then submits this command buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2381) [to GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2383) [Then GPU when it is executing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2385) [this command buffer will try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2387) [read from this buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2388) [And while you're updating the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2390) [same buffer for the next frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2393) [GPU is still reading from this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2395) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2397) [So this is clearly a race](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2398) [So this is clearly a race](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2398) [condition and the results are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2401) [undefined.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2403) [There are a few potential fixes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2403) [which you can implement in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2407) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2409) [The simplest is to call the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2410) [command buffer's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2413) [waitUntilCompleted method after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2414) [every frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2416) [But this waits for the GPU to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2418) [finish reading before you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2422) [override this buffer for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2424) [next frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2425) [But as you can see, here this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2427) [a very poor utilization of both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2430) [CPU and GPU, so this is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2433) [something you want to do in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2435) [shipping code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2437) [But it is very useful to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2438) [your Metal application up and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2440) [running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2442) [And even to detect that if your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2443) [application really indeed has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2445) [these kind of data conflicts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2447) [The efficient way to synchronize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2451) [your resource updates is to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2454) [multiple buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2455) [So in this case we will use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2457) [three buffers to triple buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2458) [three buffers to triple buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2458) [our dynamic data updates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2460) [So in frame 1 we will write to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2462) [buffer and then the GPU will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2464) [read from it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2466) [And in frame 2 we will write to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2468) [another buffer avoiding this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2470) [race condition.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2471) [Similarly, in frame 3 we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2473) [write the third buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2475) [But now we have used up all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2478) [three buffers and exhausted our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2480) [buffer pool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2481) [We need to wait for the GPU to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2483) [finish the frame 1 so that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2485) [can reuse it for frame 4.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2487) [Now this completion handler will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2489) [come handy, it will let us know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2493) [when GPU has done executing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2495) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2498) [So when frame 1 is done we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2499) [reuse its buffer for frame 4 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2501) [so on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2504) [So let's look at a sample.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2504) [For triple buffer implementation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2509) [outside your render loop first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2513) [we will create a FIFO queue of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2515) [three buffers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2517) [And we also need a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2518) [And we also need a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2518) [frameBoundarySemaphore which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2521) [initialized to start value as 3.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2522) [So this says semaphore will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2525) [signaled at each frame boundary,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2526) [that is when GPU finishes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2529) [executing a frame allowing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2531) [CPU to reuse its buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2534) [Also initialize buffer index to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2537) [point to the current frame's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2539) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2543) [And in our render loop before we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2543) [write to a buffer we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2546) [first ensure that its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2548) [corresponding frame has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2550) [completed its execution on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2551) [GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2553) [So at the beginning of the frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2554) [we wait on our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2556) [frameBoundarySemaphore.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2557) [Once the semaphore is signaled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2559) [indicating that the current](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2561) [frame has completed its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2562) [execution on GPU now it's safe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2564) [to grab its buffer and reuse for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2567) [new frame data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2570) [And we will now encode some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2572) [commands to bind this buffer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2575) [GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2578) [And before we commit this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2579) [And before we commit this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2579) [command buffer to GPU we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2581) [add a completion handler to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2583) [command buffer for this frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2585) [After adding completion handler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2587) [we will commit this command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2590) [buffer to GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2591) [Now once GPU finishes executing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2592) [this frame our completion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2596) [handler will be invoked which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2597) [will then signal this frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2599) [semaphore.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2601) [This allows CPU to reuse its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2603) [buffer for new frame encoding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2606) [So this was a simple triple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2608) [buffer implementation which you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2610) [can adopt for handling any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2612) [dynamic data resource updates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2613) [Now that we have our command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2616) [buffer and also, we have handled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2619) [our resource updates let's talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2621) [more about render pass encoders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2624) [which you will use to encode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2626) [your draw calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2628) [As Dan mentioned earlier,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2630) [command encoders translate API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2632) [calls into GPU hardware commands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2637) [in a command buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2639) [I will be talking about render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2639) [I will be talking about render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2639) [command encoders which provides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2642) [APIs for typical graphics,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2644) [operations like setting your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2646) [pipelines, texture buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2648) [objects, and also issuing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2650) [draw calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2651) [So when creating your encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2652) [you need to first set the render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2656) [targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2658) [So here is a render pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2658) [descriptor where you will set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2660) [the render targets and then ask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2662) [the command buffer to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2664) [new encoder for this render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2666) [pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2668) [And now you can use this encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2669) [to encode your draw calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2671) [One key change from OpenGL is in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2675) [Metal once the encoder is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2678) [created you cannot change its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2680) [render targets because GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2682) [performs much better when it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2685) [sees a largest span of draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2687) [calls which are rendering to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2689) [same set of render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2691) [So Metal API reflects this by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2694) [giving an explicit start and end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2697) [to a render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2699) [to a render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2699) [Now all the draws issued by this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2701) [encoder will be rendering to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2703) [these render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2705) [When you want to draw to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2708) [different set of render targets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2709) [then you end this render pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2711) [and start a new one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2713) [And here is where we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2714) [creating a render pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2718) [descriptor and binding color and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2720) [depth attachments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2722) [Now you can use that descriptor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2725) [and create a render command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2727) [encoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2729) [Now all the draws issued by this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2730) [encoder will be rendering to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2733) [these targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2734) [Additionally, in Metal you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2737) [also provide load and store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2739) [actions for these attachments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2741) [for optional GPU bandwidth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2743) [usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2745) [So these load and store actions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2748) [allow you to control how the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2750) [texture contents will be handled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2752) [before and after a rendered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2753) [pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2755) [So here we have color and depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2756) [attachments for a render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2759) [attachments for a render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2759) [If it specified the load action](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2762) [as clear for both of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2763) [render targets the GPU will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2765) [first clear their contents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2768) [Then the GPU will execute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2770) [commands in this encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2773) [rendering to these render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2774) [targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2775) [Now you can specify the store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2776) [actions to be performed at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2779) [end of the render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2781) [Here for the color buffer since](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2782) [the store action is store it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2784) [will preserve the contents of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2785) [this color buffer at the end of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2788) [the render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2790) [And for the depth attachment,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2791) [since we said store action as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2793) [don't care it will discard its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2795) [contents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2797) [So these texture load and stores](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2799) [are expensive GPU operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2800) [that consumes memory bandwidth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2802) [So choose clear and don't care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2804) [wherever possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2807) [And here is how you set your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2808) [action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2811) [In this example we specify clear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2812) [as a load action and set the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2814) [clear color.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2817) [And here we specify store action](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2819) [And here we specify store action](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2819) [as store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2820) [Similarly, you can specify load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2821) [and store action for each of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2823) [render targets you set in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2825) [render pass descriptor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2827) [So that's how we configured our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2828) [render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2831) [Now you can create the encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2832) [from this descriptor and we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2836) [start encoding draw calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2839) [But before that I want to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2841) [you some OpenGL commands and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2843) [they will show you their Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2845) [equivalents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2847) [So this is a typical OpenGL draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2848) [sequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2851) [In this segment first we bind a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2853) [frame buffer which will set all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2856) [the render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2858) [Then we bind our program which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2861) [contains vertex and fragment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2862) [shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2865) [And we bind vertex buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2866) [containing vertex data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2868) [And then we bind another buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2870) [containing all the uniforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2873) [And then we'll set a texture to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2875) [sample from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2877) [And finally, we draw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2879) [And finally, we draw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2879) [So here is the Metal equivalent,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2881) [it's a few more lines of code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2884) [since it's explicit but it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2885) [actually very similar to OpenGL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2887) [First, we create a render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2890) [command encoder using render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2891) [pass descriptor which has our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2893) [render targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2895) [Then we set a pipeline object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2897) [which has our shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2899) [Then we set a buffer for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2901) [accessing our vertex shader and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2904) [this happens to contain the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2906) [vertices we will draw with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2907) [Note that the Metal doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2910) [distinguish between buffers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2912) [containing uniforms or those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2913) [containing vertices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2916) [So we will use the same API to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2917) [set uniform buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2920) [So here the first call will give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2921) [buffer access to vertex shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2924) [while the second call will give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2926) [access to the fragment shader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2927) [Next, we set a texture for our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2929) [fragment shader to sample from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2932) [And then we draw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2934) [And once we are done encoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2937) [commands we will indicate this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2939) [commands we will indicate this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2939) [to Metal by calling endEncoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2941) [on the encoder object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2943) [So this was a simple example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2946) [a metal render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2947) [Now that we have a complete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2949) [render pass let's see how to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2952) [these renderings onto the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2954) [display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2956) [With OpenGL you present your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2957) [rendered frame onto the screen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2961) [but you don't explicitly manage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2963) [the system's render buffers also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2965) [known as drawables.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2967) [But with Metal to get your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2970) [content displayed on the screen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2972) [first you need to obtain the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2974) [special textures called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2976) [drawables from the system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2977) [So you can use a MetalKit view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2979) [which will provide you a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2981) [drawable texture for each frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2982) [And once you obtain this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2985) [drawable you can encode render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2986) [passes and render to these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2989) [drawables just like you would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2991) [render to any other texture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2993) [However, unlike other textures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2995) [now you can present this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2997) [drawable to your view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2999) [So let me show you a code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3000) [sample.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3002) [First, I want to mention that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3003) [these drawables are limited](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3006) [shade system resources, so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3008) [should hold on to them as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3010) [briefly as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3012) [This means that you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3014) [encode all your offscreen render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3015) [passes before you acquire a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3018) [drawable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3020) [Then you can create a MetalKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3021) [view for either a fully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3023) [populated render pass descriptor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3026) [which you can directly use to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3029) [create encoders, which is what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3030) [you see here or you can ask for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3033) [a specific texture using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3036) [view.currentDrawable property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3037) [And then you can build your own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3041) [render pass descriptor around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3042) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3045) [Once you are finished encoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3047) [your frame you can call the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3048) [command buffer's present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3050) [drawable method which puts your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3051) [drawable onto the screen when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3053) [GPU finishes executing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3055) [command buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3057) [So now once GPU is done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3058) [So now once GPU is done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3058) [executing this frame you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3060) [see your frame on the display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3062) [So that was our quick tour to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3064) [get your renderings onto the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3067) [display with Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3069) [But I have a few more tips to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3071) [share.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3073) [It is possible to port one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3075) [render pass at a time into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3077) [Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3079) [The IOSurface and CVPixelBuffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3079) [APIs can be used to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3081) [texture which can be shared](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3085) [between OpenGL and Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3087) [This will allow you to render to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3090) [a texture in OpenGL and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3092) [read from it in Metal or vice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3094) [versa.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3096) [So some of the applications can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3096) [leverage this to port](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3099) [incrementally, especially with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3101) [plugin architectures which are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3103) [built around OpenGL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3105) [So there is a sample code linked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3107) [to this session showing exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3109) [on how to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3111) [Now that you have a Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3115) [application you can adopt all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3116) [new Metal features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3118) [If your application is CPU bound](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3121) [then multithreading your CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3123) [encoding work can help.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3125) [You can encode multiple command](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3127) [buffers simultaneously on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3129) [separate threads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3131) [You can even split single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3132) [command buffer encoding across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3134) [multiple threads using parallel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3136) [render command encoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3138) [Also, GPUs compute by planned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3145) [processing APIs is built right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3146) [into Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3149) [You can use GPU in whole new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3150) [ways.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3152) [To start with instead of CPU you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3154) [can leverage compute pipeline to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3156) [generate graphics GPU data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3158) [By letting GPU to generate its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3161) [own data you're not only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3163) [reducing the CPU utilization and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3165) [synchronization points now you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3167) [are freeing up the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3169) [bandwidth to GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3170) [Now with this high bandwidth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3173) [compute processor you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3175) [implement many more complex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3176) [algorithms like these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3178) [Metal supports many more great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3183) [features which you can adopt in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3185) [your application to improve its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3187) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3188) [In addition, as part of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3190) [porting process we highly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3193) [encourage to use our Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3195) [powerful debugging and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3197) [optimization tools which are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3199) [integrated right into Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3201) [So Metal has a great API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3204) [validation layer that will print](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3206) [detailed information about any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3208) [improper API usage and also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3210) [suggests some potential fixes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3213) [This is a GPU debugger which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3216) [gives you a capability to step](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3218) [through your Metal calls and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3220) [view how your frame is being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3222) [rendered step-by-step.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3224) [You can view all the resources](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3226) [associated with your frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3228) [It also provides the GPU expert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3230) [tips based on your resource](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3233) [usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3234) [For this year we have also added](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3235) [shader debugging capability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3238) [shader debugging capability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3238) [where you can debug your shader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3240) [functions just like other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3242) [functions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3243) [We also added a shader profiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3244) [which showing a rich set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3247) [performance metrics related to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3249) [your shaders.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3251) [And also, a dependency viewer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3252) [which allows you to evaluate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3255) [dependencies between the render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3257) [passes and you can potentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3258) [merge any redundant render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3262) [passes to improve your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3264) [application's performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3266) [And finally, the Metal system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3270) [trace tool in instruments will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3272) [give you a complete view of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3273) [application's behavior and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3276) [performance so we highly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3278) [recommend using these tools to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3280) [ease your porting effort.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3282) [Wrapping it up, OpenGL and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3285) [OpenCL are deprecated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3287) [They are still around but we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3289) [discouraging their future use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3292) [It is time to adopt Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3294) [We have full suite of developer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3297) [tools, a lot of experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3299) [tools, a lot of experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3299) [helping many teams successfully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3300) [go through this effort and come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3302) [out with substantially improved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3304) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3306) [I'm hoping the information we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3307) [shared today will give you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3309) [smooth porting experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3310) [And we are very happy to talk to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3312) [you about your applications and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3315) [how to get them up and running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3317) [with Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3318) [So we will be available tomorrow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3320) [afternoon at OpenGL to Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3321) [porting lab and there are many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3323) [upcoming sessions on Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3325) [I recommend attending these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3328) [sessions to learn more about how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3329) [to debug and optimize your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3331) [applications with Metal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3333) [With that I thank you all for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3336) [attending and I hope you enjoy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3337) [the rest of your week.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3339) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3341)