# Metal for OpenGL Developers

## Summary
Metal is the foundation for accelerated graphics and compute on Apple platforms, enabling your apps and games to tap into the incredible power of the GPU. Get introduced to essential Metal capabilities and understand the recommended approach for transitioning OpenGL-based apps onto the Metal API.

## Info
* Graphics and Games
* WWDC 2018 - Session 604 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=7) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=21) [&gt;&gt; 谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=28) [我叫 Dan Omachi](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=29) [我是 Apple Metal Ecosystem 团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=30) [现在我在团队内的主要工作是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=33) [帮助开发者们学习 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=35) [以及获得很好的使用体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=37) [但是在这之前很多年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=39) [我都致力于 Apple 的 OpenGL 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=41) [OpenGL ES 框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=43) [在我加入 Apple 以前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=45) [我曾参与实现其他几个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=46) [OpenGL 应用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=47) [所以我非常骄傲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=50) [我过去几年在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=53) [OpenGL 上的成就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=55) [但是对于 Metal 带领我们的方向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=57) [我也非常激动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=59) [我也非常激动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=59) [今天我和我的同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=62) [Sukanya Sudugu](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=64) [将会向你们简略地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=65) [介绍 Metal 同时对于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=67) [如何轻松地移植你们的 OpenGL App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=70) [提供一些建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=72) [今年尤其的重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=75) [因为 就像昨天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=76) [在 union OpenGL 上说的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=79) [OpenGL ES 和 OpenCL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=80) [是不被允许的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=83) [现在和即将发布的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=86) [App 仍可在 tvOS 和 iOS 12 上使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=88) [OpenGL ES 以及在 macOS 10.14 Mojave 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=90) [使用 OpenGL and OpenCL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=95) [而且这将持续一段时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=100) [但是 新项目应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=105) [从开始就面向 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=108) [所以如果你还不熟悉 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=111) [那么 你应该开始熟悉一下它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=111) [在你把所有 OpenGL 代码都销毁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=115) [并开始把所有东西 都转移到 Metal 之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=116) [你还有几个选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=118) [可以考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=119) [可以考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=119) [Apple 提供了很多高层面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=121) [的渲染框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=123) [不同种类的渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=125) [适用于 2D 游戏的 SpriteKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=126) [适用于 3D 游戏的 SceneKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=128) [能有很棒效果的 Core Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=130) [另外 每个主要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=133) [第三方游戏引擎已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=135) [使用 Metal 作为他们的主要渲染器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=137) [但你或许会认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=140) [这些方法不适合你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=142) [你也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=144) [自己在 Metal 里实现这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=145) [这就是我们今天要讨论的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=148) [所以我们从 Metal 的设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=150) [和一些基本概念说起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=151) [OpenGL 最开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=155) [是 25 年前开发的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=157) [它的核心是反映了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=159) [3D 图像的硬件加速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=161) [所以新版本的更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=164) [和拓展确实为我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=166) [探索新的 GPU 特性和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=168) [性能技术提供了服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=169) [但是 仍旧有一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=172) [基础设计决策](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=174) [不再适用于现在的硬件设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=176) [OpenGL 管道你曾是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=180) [完全固定的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=182) [虽然现在 OpenGL 提供可编程的管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=183) [但是它并不完全匹配当代 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=187) [另外 异步处理不再是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=193) [API 的核心特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=195) [还有很多其他功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=197) [暗示 GPU 会与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=198) [你的 App 同时工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=199) [但大多数都是隐式的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=200) [25 年前 只有最贵的工作站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=203) [和服务器是多核的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=207) [所以 设计一个高效的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=209) [多线模型 不是最优选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=210) [所以在 2014 年的时候很明显](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=213) [设计新的 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=217) [App 接口是必要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=219) [很明显我们需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=221) [一个可以高效利用 GPU 能力的接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=222) [要做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=226) [App 需要 CPU 让道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=228) [才能让 GPU 可以做他的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=229) [但是当 App 需要 CPU 做渲染时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=232) [它又可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=233) [调用所有的 CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=234) [包括它的多核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=236) [如果接口需要预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=239) [如果接口需要预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=239) [去避免开发者陷入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=241) [API 的隐藏陷阱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=244) [那么每一个调用需要有明显的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=248) [并且最好不要有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=249) [隐式的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=252) [这种预测的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=254) [需要去控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=256) [资源分布和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=257) [什么时候需要同步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=259) [我们想要这个接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=267) [是可触及的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=269) [它需要正确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=271) [平衡低层次控制和明确的用量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=272) [因为当你了解一个东西以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=274) [你能更高效和有效的使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=276) [当然 我们设计 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=281) [是为了更好地映射到各种当代 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=283) [特别是我们知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=286) [管道中的硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=289) [需要软件去推动它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=290) [这就包括了 Apple 设计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=293) [所有 A11 仿生 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=295) [所以为什么 Metal 不同于 OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=299) [所以为什么 Metal 不同于 OpenGL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=299) [你会更少地去进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=302) [昂贵的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=303) [对象的设计是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=307) [API 的状态可以被转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=308) [并且在创建时被预包装进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=309) [GPU 命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=312) [这样做会在真正渲染时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=315) [最大程度减少成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=317) [拥有 Vertex 和片段着色器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=320) [图形管道也](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=321) [反映了当代 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=323) [所以这会降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=325) [将 API 设置转换到 GP 命令的成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=327) [这并不表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=331) [管道是截然不同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=332) [或者说需要一个全新的方式去考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=334) [Metal 最大的区别是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=336) [将管道的各个阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=338) [分组成对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=339) [是更高效的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=341) [并不是管道本身改变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=343) [Metal 为了执行多线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=346) [还有一个清晰的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=349) [有很多种不同的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=351) [让 App 在不同线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=352) [去驱动 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=353) [但是对于每一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=356) [都有明确但不受限的规则去实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=357) [此外最常用的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=361) [像纹理 缓冲和着色器 可以安全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=362) [并有效地在不同线程中使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=365) [Metal 并不需要去实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=368) [昂贵的内部日志操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=370) [去防止这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=371) [对象进入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=373) [无效状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=374) [最后 它的执行模式反映了软件与 GPU 之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=377) [真正发生的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=381) [很多通过 OpenGL 展现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=383) [的隐性操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=385) [通过 Metal 在 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=386) [被明显地展示出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=388) [这就让你可以对于什么时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=390) [和怎样在 App 中使用 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=391) [做出明智的决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=393) [这还代表着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=396) [你的 App 和 GPU 之间将有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=397) [更少的软件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=399) [大多数的 Metal 调用直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=401) [指向 GPU 驱动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=403) [这样驱动也需要做更少的处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=405) [去将 API 调用转换为 GPU 命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=406) [所以让我们来跟深入地看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=411) [它是怎么工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=412) [所有的 GL 调用都在 OpenGL 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=413) [展现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=416) [这个内容就包含了很多东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=417) [它追踪 API 的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=419) [它追踪 API 的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=419) [它管理 OpenGL 对象和其它内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=422) [同时还转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=423) [并递交 GPU 命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=425) [Metal 将所有这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=427) [OpenGL 内容的工作分成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=429) [很多个小对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=430) [第一个被创建的对象就是 Metal 设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=434) [它是一个物理 GPU 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=438) [抽象表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=440) [这个设备创建对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=442) [比如说纹理 缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=446) [和包含着色器的管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=447) [它还创建了一个关键对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=451) [叫做 Metal 命令队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=453) [这个命令队列只有一个工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=455) [就是去创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=457) [一系列的命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=459) [这里我们已经创建了一个命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=461) [并且这个命令缓存是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=463) [一系列 GPU 命令的简单列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=464) [你的 App 将填写这个列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=466) [并且发送给 GPU 去执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=468) [通常你的 App 要在每一帧去创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=471) [单独的命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=472) [但是有些情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=475) [它也会觉得需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=475) [在一帧里创建两三个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=477) [在一帧里创建两三个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=477) [但是 App 本身并不会直接写这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=481) [命令到命令缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=482) [它是创建了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=483) [Metal 命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=485) [这个命令编码器将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=487) [API 调用转换成 GPU 指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=489) [并将它们写入命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=491) [在一系列命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=494) [被编码以后 App 就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=495) [结束编码 并且释放编码对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=497) [事实上有不同的编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=500) [你的 App 可以从命令缓存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=502) [创建新的编码器 去编码更多的指令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=504) [特别注意一点是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=511) [直到现在在这流程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=512) [GPU 还什么都没做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=514) [Metal 创建了对象和编码命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=517) [都是基于 CPU 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=520) [只有在你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=521) [完成编码命令和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=523) [提交命令缓存以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=525) [GPU 才会开始工作并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=527) [执行那些命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=529) [你也可以将这些命令编译成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=532) [多个并行的命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=534) [到分开的线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=536) [现在我已经谈到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=538) [现在我已经谈到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=538) [命令队列是如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=542) [产生一个命令缓存的序列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=543) [并且你能从命令缓存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=546) [创建一个命令编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=547) [让我们更细致地看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=550) [这些用来写入命令缓存的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=551) [编码器对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=553) [它们有三种主要类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=555) [Render Command Encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=558) [它的命令类似于 OpenGL 命令字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=558) [对于这些命令你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=560) [设置状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=562) [绑定对象和发出绘图申请](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=563) [还有一个是 Blit Command Encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=566) [基于它你可以发出纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=567) [和缓存拷贝操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=569) [你也可以用它来生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=571) [用于纹理和从缓存中 转移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=572) [像素数据的 Mipmap 就类似于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=574) [glReadPixels 如何对 OpenGL 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=576) [像素缓存对象操作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=578) [最后是 Compute Command Encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=580) [它让你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=583) [分派内核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=586) [Render Command Encoder 可能将会是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=589) [你最熟悉的编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=590) [因为它负责](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=591) [大部分基于图形的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=594) [需要的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=596) [这一组命令编译进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=599) [这一组命令编译进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=599) [Render Command Encoder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=600) [通常被称为 Render Pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=602) [在 Render Pass 中你可以设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=605) [为图形管道建立的渲染对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=606) [和发出与这些对象一起的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=608) [绘图命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=610) [这就包括了一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=612) [类似于 glDrawArrays 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=613) [glDrawElements 和其他一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=615) [OpenGL 绘图命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=618) [每个 Render Command Encoder 都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=621) [紧密地与一系列渲染对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=622) [联系在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=624) [渲染目标就是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=626) [可以绘制的简单纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=628) [它包括了颜色 深度和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=630) [模板纹理以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=632) [多样本纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=634) [你可以指定一系列渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=636) [在你从命令缓存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=637) [创建渲染命令编码器的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=638) [所有绘图命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=642) [都在编码器的寿命内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=643) [指向这些目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=645) [如果想要导向 一个命令去新的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=648) [你可以通过当前的渲染命令编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=649) [结束编码过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=651) [然后去和新的对象去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=653) [创建新的编译器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=655) [这就明确地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=657) [区分了导向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=658) [区分了导向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=658) [不同渲染对象的命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=661) [我们再说一说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=664) [你们在渲染过程中要用到的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=666) [Metal 有很多类似于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=669) [OpenGL 的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=670) [包括纹理 缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=671) [采样器和管道状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=675) [这些对象类似于 OpenGL 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=677) [程序对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=679) [还有深度模板状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=682) [它们并不真的存在于 OpenGL 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=683) [而只是 OpenGL 有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=685) [有相同深度和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=686) [模板状态的容器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=688) [一个区别 OpenGL 和 Metal 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=691) [的重要不同是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=693) [它们怎么被创建的和管理的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=695) [这些对象都是通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=699) [设备对象创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=700) [所以它们只与单个 GPU 相关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=701) [你设置大部分对象状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=704) [是你通过指定属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=706) [在描述符对象中创建它的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=708) [所有状态都是在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=711) [对象被创建的时候设置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=713) [这些状态是固定的 并且不可改变的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=715) [虽然这个纹理和缓存的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=716) [是在创建时就被固定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=718) [但是这些对象包含的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=719) [但是这些对象包含的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=719) [是可以被改变的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=722) [Metal 可以为这些对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=724) [创建新的编码器 当它被创建的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=727) [OpenGL 的可变模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=730) [完全可能让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=732) [你的 App 在触碰到一小块状态的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=733) [这个对象会重新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=735) [开始编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=738) [即便你的 App 没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=739) [改变对象的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=741) [OpenGL 也会需要检查标记的层次结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=743) [这样做是为了在绘图之前确认无误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=745) [所以通过这个不可改变的模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=748) [Metal 永远不需要检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=750) [对象状态的改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=752) [这就使绘图调用快很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=754) [另外 对象能在跨线程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=757) [更高效的被利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=759) [Metal 永远不用锁定一个对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=761) [只是因为避免它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=762) [在转换到其他线程的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=763) [陷入无效状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=765) [那么我们再来谈谈移植](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=771) [这是一个典型的阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=772) [这些是一些经典的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=777) [渲染 App 的阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=779) [渲染 App 的阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=779) [你搭建一个 App 去编译资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=781) [和捆绑资产](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=782) [开始并初始化它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=784) [加载这些资产](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=786) [初始化将会一直](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=787) [出现在你 App 里的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=789) [然后你不断地重复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=793) [渲染设定状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=795) [发布多个绘图需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=796) [然后一帧一帧地展现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=799) [我将会谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=800) [在早期阶段 App 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=803) [Metal 开发过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=805) [包括着色器的离线创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=808) [创建对象的初始化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=809) [之后 Sukanya 会解释如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=813) [移植每一帧的渲染代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=814) [所以让我们从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=818) [App 的创建时间开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=819) [就是着色器被编译的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=821) [我们将从着色语言开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=824) [Metal 的着色语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=827) [是基于 C++ 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=829) [所以就像你创建 C++ 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=830) [类 模板 结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=833) [定义 名称空间 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=835) [比如说 GLSL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=838) [比如说 GLSL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=838) [我们有内置的向量和矩阵类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=840) [也有很多的内置方法和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=842) [图形处理常用的运算符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=844) [也有一些类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=846) [指定采样器的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=849) [并在纹理上执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=851) [描述这个语言最好的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=852) [刚才已经展示给你们了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=853) [所以这是顶点和片段着色器对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=855) [顶部方法中的顶点关键字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=859) [说明了它是一个顶点着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=860) [同样适用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=864) [底部方法的片段关键字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=865) [注意它们有自定义的名字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=869) [这一点不像 GLSL 一样每个着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=871) [就只是被叫做 main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=873) [这非常的关键 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=874) [它允许你去构建一个大型的库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=875) [库里的每一个着色器都用名字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=877) [去表明它们的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=879) [每一个从你的 App 传出的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=881) [都是这些其中一个着色器的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=884) [并且它不像 GLSL 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=888) [会在方法外有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=889) [松散变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=890) [就像你看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=892) [这些参数旁边会有括号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=893) [它们是属性说明符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=896) [这是从 C++ 里拓展来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=898) [为了表示特殊的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=899) [为了表示特殊的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=899) [所以这个顶点 ID 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=903) [表明了这个 VID 参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=905) [应该在顶点被执行时包括](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=907) [当前顶点的索引值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=908) [在这两个地方我们会用到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=913) [去将索引值放置到顶点数组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=914) [这些带有缓存属性的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=918) [参数说明符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=920) [表明了这些变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=922) [被 Metal API 里设定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=924) [缓存对象所填满](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=926) [我一会将会多说一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=927) [Metal API 是怎么与这些有关联的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=929) [但是首先我们先来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=932) [这里用到的一些类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=933) [现在这些都是你可以定义的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=936) [自定义类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=938) [这里的顶点参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=940) [被定义为指向顶点类型的指针](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=941) [这就是它的定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=943) [这个结构包括两个成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=946) [一个是模型位置成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=948) [另一个是纹理坐标成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=950) [它在顶点数组里定义了 每一个顶点的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=952) [布局和内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=954) [这个数据会被传递到这个顶点的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=956) [我们再来看看这个顶点的输出类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=959) [我们再来看看这个顶点的输出类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=959) [它是从顶点着色器里返回的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=961) [它这里的定义指定了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=963) [什么被传递下去用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=966) [光栈化阶段并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=967) [最终用于分片程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=969) [包含了四个部分的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=971) [浮动点成员被称为 clipPos](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=973) [clipPos 在他的旁边有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=975) [位置属性说明符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=977) [这就表明了这个成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=979) [会作为一个顶点着色器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=980) [位置输出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=982) [这个 texCoord 成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=985) [并不带有默认为变量的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=986) [属性说明符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=987) [它会和其他顶点的纹理坐标值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=990) [一起被插入去定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=991) [光栅化三角形](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=996) [这就跟 GLSL 很不一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=998) [我们再来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1001) [我们分片着色器的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1002) [所以我们会用到这个 vertexOutput 结构体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1005) [我们刚刚看过的这个结构体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1006) [会作为我们分片着色器的输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1009) [同时它给了我们插入的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1012) [纹理坐标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1014) [这个坐标我们已经在顶点着色器里构造了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1015) [我们这里用它来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1018) [我们这里用它来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1018) [从纹理中取样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1020) [在我们写好的 Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1023) [App 代码中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1024) [我们用 Render Command Encoder 去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1026) [将对象映射到着色器参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1028) [这个带有请求的索引参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1032) [非常类似于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1035) [OpenGL 的属性索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1036) [顶点属性索引和纹理单元](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1038) [它们指定了哪一个索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1041) [映射到了我们着色器参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1043) [所以通过请求编译器的含有三个索引值的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1047) [集合片段缓存方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1049) [我们可以将我的标准缓存对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1050) [映射到我们的着色器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1053) [标准编码器参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1057) [我们进行类似的请求去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1059) [设置我们的纹理和采样器对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1062) [现在我们来多说一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1070) [着色器开发里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1072) [特别有用的一个库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1074) [它叫 SIMD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1077) [现在 SIMD 实际上是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1078) [现在 SIMD 实际上是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1078) [分离于 Metal 的库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1080) [经常用于许多正交框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1083) [但是它在思想上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1085) [跟 Metal 很相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1087) [SIMD 定义了常用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1088) [向量和矩阵类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1090) [去实现图形化算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1093) [所以它包括了三四个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1095) [向量类型和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1096) [三乘三和四乘四 矩阵类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1097) [这个库最棒的特性之一是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1104) [你能用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1104) [在你的 App 代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1106) [和着色语言代码之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1110) [分享代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1113) [这真的很有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1115) [因为你可以定义数据的布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1117) [这些数据和结构就是通过这些类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1118) [从你的 App 传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1119) [到你的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1122) [它怎么工作的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1124) [你先创建一个带有数据的结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1125) [这些数据是你想要从你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1127) [传递到你的着色器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1128) [所以举例来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1129) [如果你想传递一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1131) [模型视图投影矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1132) [和这个 SIMD 的首要光源位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1135) [你就可以在你的结构中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1136) [通过 SIMD 类型去实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1138) [通过 SIMD 类型去实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1138) [你将结构的定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1141) [和头文件都包含在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1142) [你的 App 代码和 Metal 文件里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1145) [这样的话你着色器里用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1149) [数据布局就能与你的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1150) [匹配上 因为它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1152) [使用了相同的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1154) [这样布局不匹配的问题就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1156) [出现的更少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1158) [Metal 实现高效的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1164) [一个关键因素是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1165) [更早地开始工作并且频率更低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1167) [所以你将需要在建立 App 的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1171) [用 Xcode 去编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1173) [Metal 着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1174) [这运行了一个前端编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1176) [来执行字符串解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1178) [着色器分析和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1179) [一些基本的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1181) [它将你的代码转换成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1183) [一个二进制的中间表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1185) [它在任何硬件上都能使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1186) [实际的 GPU 机器代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1190) [直到你的代码在用户系统上运行以前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1192) [都不会被构建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1194) [但是这在你的代码运行的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1195) [移除了一半的编译时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1196) [这个搭建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1199) [这个搭建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1199) [二进制中间表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1202) [是通过 Metal 库文件实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1205) [Xcode 会将所有 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1208) [着色器源文件编译进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1210) [一个默认的 Metal 库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1211) [为了运行时检索](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1213) [将他放进你的 App 包中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1216) [除了有 Xcode 建立的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1217) [你也可以在 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1220) [运行过程中创建着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1223) [一些 OpenGL App 在运行过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1226) [创建着色器是通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1227) [连接字符串或者运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1228) [源代码生成器实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1230) [要在构建期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1232) [获取所有着色器会非常有挑战性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1233) [但是为了特定的目的或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1236) [如果构建时间编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1238) [在你的 App 里并不可能实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1240) [那么 Metal 是可以像 OpenGL 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1241) [在运行期间通过源文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1243) [编译着色器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1245) [然而 这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1246) [会有很多不好的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1249) [最明显的是你会放弃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1250) [节约性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1252) [因为这在用户系统之外工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1253) [你不会在构建期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1256) [看见任何的着色器编译错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1257) [所以你只能在你运行代码的时候才发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1258) [所以你只能在你运行代码的时候才发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1258) [最后 如果你是在运行时编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1261) [你就不能在着色器中包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1263) [头文件 所以你就不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1264) [在你的 App 代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1266) [和着色器代码之间分享代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1267) [如果你在运行期间通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1270) [分享编译来使你的 App 工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1272) [那我强烈地建议你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1274) [花点时间让你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1276) [着色器在 Xcode 里边编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1278) [这样做你可以获得很多好处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1280) [比如说节约运行时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1281) [和更为方便](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1283) [你的着色器开发](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1284) [我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1286) [你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1289) [初始化你的 Metal 渲染器 的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1290) [这要创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1292) [很多对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1293) [我将从设备入手](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1294) [然后是命令队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1296) [之后我会描述怎样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1297) [建立对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1299) [包括纹理 缓存器和管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1300) [所以设备和队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1305) [是你要创建的第一个对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1307) [设备是 GPU 的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1310) [抽象表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1313) [它负责创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1316) [用于渲染的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1317) [它们包括](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1318) [纹理 缓存和管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1319) [纹理 缓存和管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1319) [在 iOS 还只有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1322) [GPU 的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1324) [你只能有一个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1326) [但是在 macOS 系统上可以有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1328) [多个设备因为它们可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1330) [都集成在了分散的 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1332) [或多个 eGPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1334) [虽然通常情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1337) [用默认的设备对于大多数 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1338) [都足够了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1340) [而且获取这个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1341) [是很简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1343) [你调用 MTLCreateSystem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1345) [DefaultDevice 即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1346) [对于这个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1348) [你要做的第一件事就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1351) [创建一个命令队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1353) [这个队列主要用于你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1355) [App 渲染循环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1357) [去在每一帧里获取命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1358) [但是你需要在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1360) [初始化的时候创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1361) [命令队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1362) [通常情况下 单个队列就足够了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1365) [但是更复杂的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1366) [会在多个队列中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1368) [同时被执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1369) [创建一个队列也是非常简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1373) [你可以调用 newCommandQueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1374) [和刚才你创建好的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1376) [一旦你获取了你的队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1378) [你就可以得到渲染循环的命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1380) [我们继续来看一看创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1382) [渲染对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1386) [我将会说一说创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1388) [三种类型的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1390) [它们用于渲染 纹理 缓存和管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1392) [我们先从纹理开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1395) [就像之前所提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1398) [你通过设备对象 创建渲染对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1399) [你大部分情况下 将会用到描述符对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1402) [去创造这些对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1403) [描述符是非常简单的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1405) [它没有任何真方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1406) [它们只包含用于对象建立的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1409) [举个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1413) [你会需要一个纹理描述符去创建纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1414) [你可以指定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1417) [你想要创建的纹理的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1418) [比如说纹理的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1420) [2D 3D 和 cubeMap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1421) [纹理的维度和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1424) [它所需要的 Mipmap 的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1425) [还有纹理中包含的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1427) [数据像素格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1430) [一旦你设定好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1431) [每一个属性需要的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1433) [你就可以在设备上调用方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1434) [去创建可用的纹理对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1436) [这也需要为返回纹理图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1440) [分配内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1443) [一旦你创建了对象 你就不再需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1446) [描述符了 因为它只是用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1447) [创建对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1449) [然后你设置在描述符中的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1451) [就会被锁定并且不能再改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1452) [然后 纹理图像的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1455) [是可以修改的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1457) [所以我会再说一下一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1458) [你将设定在纹理描述符中的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1461) [同时你也能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1462) [在创建缓存的时候使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1464) [这被称为存储模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1466) [就像之前提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1469) [在你创建纹理的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1470) [Metal 会为它分配内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1471) [存储模式属性告诉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1474) [Metal 要在哪一个内存池中去分配内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1475) [最简单的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1478) [去共享存储模式就是同时给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1480) [CPU 和 GPU 访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1482) [对于缓存来说这就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1484) [你为指向对象的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1486) [获取了一个指针](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1487) [Protector 代表着你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1488) [调用简易的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1490) [从纹理中去设定和获取数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1492) [你可以用私有存储模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1494) [这种模式只给了 GPU 访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1497) [数据的权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1498) [数据的权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1498) [这就允许了 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1500) [去执行优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1501) [不然可能在 CPU 有访问数据权限的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1503) [是无法达成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1505) [但是只有 GPU 可以直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1506) [填写这种纹理类型的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1508) [你也可以间接的通过 CPU 去填写数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1512) [这可以通过使用 blit 编码器让 CPU 实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1514) [blit 通过共享的存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1515) [从第二中间资源去拷贝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1518) [在具有专用视频内存的设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1522) [设定这个资源去使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1523) [私有存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1525) [将它分配成仅用于视频存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1527) [最后 在 macOS 上你可以使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1530) [第三种存储模式 托管存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1532) [这种模式允许 GPU 和 CPU 一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1535) [访问对象数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1537) [而且对于有专用视频内存的系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1539) [Metal 会建立一个镜像内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1540) [反向用于两个处理器的高效访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1543) [正因为这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1547) [显性的调用对于确认](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1549) [数据在 CPU GPU 上的同步访问是很有必要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1551) [这里是一个创建纹理对象的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1558) [这里是一个创建纹理对象的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1558) [首先你创建一个纹理描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1560) [以及内部的一系列属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1564) [包括存储模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1566) [然后我们通过这个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1569) [去创建一个纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1573) [为了去填充纹理的图像数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1575) [我们计算每一行的字节数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1577) [这就像用 GLText 一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1579) [[ 音质不清晰 ] 我们指定一个区域去加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1581) [然后我们调用纹理对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1586) [替换区域方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1587) [它从我们提供的指针中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1589) [复制数据到纹理中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1591) [这里是一些值得注意的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1597) [OpenGL 和 Metal 纹理对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1598) [之间的一些区别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1599) [虽然 OpenGL 确实有采样器对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1600) [但是他们是可选的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1602) [在 OpenGL 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1604) [包装模式和过滤器可以被设定在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1605) [纹理对象中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1606) [在 Metal 里你需要在着色器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1608) [去创建单独的采样器对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1609) [或者是指定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1611) [采样器参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1614) [在 Metal 里纹理图像数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1615) [是不可被翻转的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1617) [OpenGL 使用的是左下角原点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1618) [OpenGL 使用的是左下角原点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1618) [但是 Metal 用的是左上角原点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1621) [所以在你加载纹理的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1623) [你要留意这些区别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1624) [桌面版 OpenGL 同时也执行转化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1626) [当提供的数据是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1629) [不同的格式而不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1630) [内部格式的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1633) [但是 Metal 和 OpenGL ES 很类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1636) [所以你需要确认](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1638) [你的数据都已经被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1640) [设定成了合适的格式或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1641) [执行路径去进行转化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1643) [我们再来看看缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1649) [Metal 对于所有非结构体数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1652) [都是用的缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1654) [它们非常类似于 OpenGL 的顶点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1661) [元素和标准缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1662) [所以如果你已经在 OpenGL 中用了这些缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1665) [你在处理你的端口的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1667) [就会更容易一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1668) [通过设备你能很轻易地创建缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1671) [这个设备是你通过 newBufferWithLength](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1672) [调用的 它指定了你想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1674) [多大的缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1675) [你也可以指定存储模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1677) [你通过内容属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1680) [去加载缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1682) [这个属性是一个没有返回值的指针](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1683) [指向返回缓存器的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1685) [对于 Metal 的核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1687) [这个数据是完全没有结构的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1688) [所以这就取决于你要怎么去定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1690) [你 App 的布局和怎样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1692) [去分享你的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1694) [这里我们分配一个内容指针](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1695) [指向一个使用了一些 SIMD 类型的结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1696) [这个在之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1698) [我已经提到过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1700) [我们设置一系列结构体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1701) [这些结构体填充缓存区的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1703) [这是通过使用已经通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1705) [结构体的定义 定义过的布局或 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1706) [来实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1708) [就像之前提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1711) [你可以在你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1712) [之间分享你的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1714) [这就确定了你的布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1715) [在这两个部件之间可以匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1716) [一个很常见的错误是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1719) [缓存数据和它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1724) [如何在着色器中被翻译不匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1726) [这是因为一个关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1728) [校准的假设](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1729) [举个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1732) [你可能会假设着色器的语言是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1733) [flout3 的类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1734) [它只消耗 12 个字节的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1737) [三个 4 字节的部件就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1738) [三个 4 字节的部件就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1738) [12 个字节对吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1740) [那么如果你将你的数据这样打包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1741) [你就会有麻烦的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1743) [因为你的着色器语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1745) [实际上将 float3 类型解释为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1746) [会消耗 16 个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1748) [这是因为类型被更严格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1750) [地定义了对准方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1751) [这是为了 CPU 和 GPU 的优化以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1752) [CPU 和 GPU 的用量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1756) [类似的错误还经常发生在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1758) [三乘三的矩阵中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1759) [如果你真的想追踪它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1762) [如果你真的想紧密地包装数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1763) [我们在 Metal 着色器语言中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1766) [提供了包装类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1768) [在你将打包好的数据传进缓存以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1771) [你的着色器代码将会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1773) [去包装数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1774) [在你处理这些数据以前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1777) [你需要将这些包装好的数据传递给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1778) [一个规则向量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1780) [所以在你发布你的 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1783) [我建议你使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1785) [最方便的存储模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1788) [这使得你在那些资源中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1791) [访问数据变得更简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1793) [所以在 iOS 系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1797) [我们通过 StorageModeShared 创建所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1798) [纹理和缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1800) [在 macOS 系统上 你就不能用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1802) [StorageModeShared 处理纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1803) [但是 StorageModeManaged 会让你访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1805) [图像数据变得更容易一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1807) [虽然私有存储是最优选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1808) [你可以在 macOS 上使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1816) [StorageModeShared 和缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1816) [但你需要特别的小心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1819) [如果你混合了 CPU 和 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1820) [都需要访问的数据和只有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1822) [GPU 需要访问的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1826) [你可能在之后会很难去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1828) [分开这两种类型的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1829) [再把它们放到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1831) [单独的内存池中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1833) [现在我已经说了一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1834) [关于创建纹理和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1837) [缓存对象的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1839) [我会再提一下 MetalKit 框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1841) [它是用来更简单地去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1842) [通过常用文件格式去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1843) [创建纹理和顶点的框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1844) [这里面包含了纹理加载类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1847) [和一些功能去创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1848) [Metal 缓存支持的网格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1850) [这些网格是通过 Model I/O 加载的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1852) [现在我们来说一说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1858) [包含它们的着色器和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1859) [包含它们的着色器和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1859) [渲染管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1860) [你可以通过渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1862) [管道描述符对象创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1864) [管道状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1865) [这个对象包含了顶点和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1868) [分片着色器对它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1870) [也指定了提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1872) [顶点着色器的顶点布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1873) [你也能混合状态和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1877) [渲染目标的像素格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1879) [这里的渲染目标是分片和着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1881) [可以渲染到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1883) [就像用纹理对象一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1885) [你在设备上调用方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1887) [这会产生一个不可改变的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1888) [渲染状态管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1890) [也就像纹理对象一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1893) [你只需要使用描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1895) [去创建这些对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1896) [这里是一些代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1898) [展现了怎样去搭建这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1900) [管道状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1901) [在你创建管道以前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1903) [你需要从 Metal 库中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1905) [获取着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1907) [这一行代码加载了我们在 Xcode 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1909) [搭建的默认的 Metal 库文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1911) [对于这个库你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1914) [通过他们的函数名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1916) [获取你的顶点和分片着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1919) [获取你的顶点和分片着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1919) [你创建一个渲染管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1921) [描述符对象在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1923) [你设定这些着色函数的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1925) [同时还有指定渲染目标像素格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1926) [最后你用设备和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1930) [我们已经设定好的描述符对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1932) [来生成管道状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1933) [OpenGL 和 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1938) [图形化管道之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1939) [最大的区别就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1941) [OpenGL 编写的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1945) [只包含顶点和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1946) [分片着色对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1948) [但是 Metal 管道对象还包括了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1949) [顶点布局 混合状态和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1951) [渲染目标像素格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1953) [所以你需要在你搭建管道之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1955) [知道所有这些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1956) [这些管道状态中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1960) [额外部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1961) [使得 Metal 可以在对象建立中完](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1963) [全将着色器编译进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1964) [GPU 机器语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1966) [这是在 OpenGL 编程对象中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1968) [根本不可能实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1969) [现在你就需要去建立一个系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1971) [这个系统允许你在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1972) [初始化你的 app 的时候去创建管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1974) [它可以很有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1977) [如果你选择一个规范的顶点布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1978) [和有限的渲染目标集合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1979) [和有限的渲染目标集合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1979) [这就减少了你 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1982) [的状态组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1983) [和需要的管道对象的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1985) [然而不是所有人都知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1988) [他们的 App 会需要哪些管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1990) [一般情况下移植](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1993) [App 到 Metal 的第一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1994) [是持有一个管道词典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1996) [这个词典是之前就已经建立好了的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1997) [介于你的 App 会遇到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=1999) [新的状态组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2000) [它可以将描述符看作是钥匙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2002) [去建立和存储管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2003) [一定要记得我刚才说到的这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2006) [是一种破解方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2008) [同时你也会想要你的 App 避免](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2010) [通过这种方法被传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2011) [这是因为创建这些对象中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2012) [任何一个都是很昂贵的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2013) [当你想要创建管道对象的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2016) [GPU 编译器会起到作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2017) [并且翻译和优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2019) [着色器的二进制中间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2021) [表示到机器代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2022) [如果你的 App 在你的渲染器循环中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2025) [及时地创建了这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2026) [你就很有可能会看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2027) [短时间内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2031) [减少帧率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2033) [给纹理和缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2035) [分配内存也是很昂贵的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2037) [这甚至不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2038) [这甚至不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2038) [要考虑将数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2040) [填充到这些资源中的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2041) [然而一旦你创建了这些对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2044) [在你在渲染循环中使用它们的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2046) [就只需要非常小的 CPU 了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2047) [[ 音质不清晰 ] 因为这在之前的操作中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2049) [已经做得够多了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2051) [现在我们交给 Sukanya 去解释](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2054) [他会告诉你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2055) [如何移植你的渲染循环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2056) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2058) [&gt;&gt; 晚上好各位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2063) [我是 Sukanya Sudugu](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2064) [是 Apple 的 GPU 软件工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2065) [我真的超级兴奋去跟你们分享一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2067) [我们在移植上的经验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2069) [所以我们来继续看看移植问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2071) [Dan 已经说了很多关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2075) [App 的建立 所以目前为止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2077) [你已经建立了所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2079) [着色器同时也创建了所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2080) [帧分片所需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2083) [持久对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2085) [那么现在我们来深入了解一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2087) [你的 App 的渲染循环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2088) [它是在每一帧里都会执行的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2090) [通过 Metal 你会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2093) [在你的渲染循环里明确地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2095) [管理 GPU 执行的异步性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2097) [管理 GPU 执行的异步性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2097) [所以这包括了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2100) [和 GPU 命令一起获取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2103) [和提交命令缓存到 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2104) [同时以这样的方式 更新你的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2106) [使得你的 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2110) [可以异步地从它里边读取信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2112) [这些资源是你之前 就已经写好在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2114) [渲染循环里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2116) [然后通过创建渲染命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2117) [来编码渲染通行证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2119) [最后将你的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2121) [展现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2124) [所以我们先来说一说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2125) [命令缓存对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2129) [与 OpenGL 最大的不同点之一就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2132) [Metal 通过命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2134) [提供了准确的控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2136) [这表示着创建这些命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2138) [完全是取决于你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2140) [同时你也能决定什么时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2142) [去将这些执行提交给 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2144) [一种直接的实现方法就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2147) [创建一个命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2149) [它可以渲染你的整个帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2151) [然后一旦你的 App 准备好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2153) [并且可以跑了并且如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2155) [你在 GPU 上看到一些空余时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2157) [这样的话你就可以去考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2159) [这样的话你就可以去考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2159) [将你的帧分开到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2162) [多个命令缓存内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2163) [然后 GPU 就可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2165) [CPU 编译其他命令缓存的时候开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2168) [执行一个命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2170) [或者将你的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2173) [分割编译进多个线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2175) [这就需要你去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2177) [在每一帧里都创建一个命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2179) [但是一定要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2180) [每一个命令缓存都会需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2183) [额外的 CPU 消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2185) [所以你最好尽可能的少用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2187) [Metal 也提供 API 来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2192) [注册一个完整的回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2194) [它会在 GPU 完成执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2197) [这些命令缓存的时候被涉及到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2198) [让我来给你们展现一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2201) [这些 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2203) [你将会在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2205) [App 初始化方法里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2208) [创建命令队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2209) [现在 在渲染循环里你将会用到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2211) [去获取命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2213) [这是通过调用它的命令缓存方法来实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2215) [现在你要把这些命令编译进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2217) [现在你要把这些命令编译进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2217) [这个命令缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2220) [我将会简短地说一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2221) [这个编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2223) [当你完成编码以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2225) [你需要调用提交方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2226) [来让这个命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2228) [被提交到 GPU 里执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2231) [现在你有两个选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2234) [去决定在这个命令缓存在 GPU 上被执行的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2237) [应该去做点什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2239) [你可以通过调用这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2242) [waitUntilCompleted 方法来等待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2245) [这就像 OpenGL 里边的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2247) [glFinish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2249) [这个方法会同步等待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2250) [并且只在所有命令缓存里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2253) [命令被 GPU 执行完以后才会返回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2255) [或者在你提交这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2260) [命令缓存给 GPU 以前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2264) [你可以添加一个完成处理器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2266) [这个处理器会在 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2269) [完成执行以后被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2271) [这就允许 CPU 和 GPU 去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2273) [并行执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2276) [同时这样就允许我们去追踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2278) [同时这样就允许我们去追踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2278) [和有效地更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2280) [在每一帧里都被改变的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2282) [分享的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2284) [既然我们到了这里 我们再来说一说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2285) [这些资源的更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2288) [和看一看我们如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2289) [通过完成处理器来让它们更高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2292) [几乎所有的 App 都会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2294) [每一帧将新的数据推送给 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2298) [举个例子比如说动画里需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2301) [新的渲染单元](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2304) [在 Metal 里 CPU 可以在任意时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2306) [写入这些共享资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2309) [即使 GPU 是在同一时刻访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2311) [同一内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2315) [Metal 并不能保护你不被这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2317) [数据竞争影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2318) [相比之下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2321) [OpenGL 默认地会避免这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2324) [数据竞争](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2325) [要么是等待 GPU 完成工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2328) [要么是制作额外的副本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2330) [这样对你的 App 而言 可能并不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2333) [最优选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2334) [通过 Metal 你可以实现任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2336) [最适合你 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2338) [最适合你 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2338) [优化同步策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2341) [所以在很多情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2344) [最好的方法是 你分享资源使用的多个缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2347) [这样的话 CPU 和 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2348) [就永远不会同时试图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2351) [访问同一个缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2353) [让我们来看一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2357) [你有一个 OpenGL App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2359) [并且你刚刚把它移植到 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2362) [这个 App 使用的是单个缓存去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2364) [更新这些数据并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2366) [你还没有在 App 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2368) [实现任何同步方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2370) [那么 可能发生的事情是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2372) [你的 App 会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2376) [生成第一个帧的命令的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2378) [写进那个缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2379) [然后将这个命令缓存提交给 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2381) [然后当你的 GPU 在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2385) [执行这个命令缓存的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2387) [会尝试从缓存里读取信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2388) [并且当你在为下一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2390) [更新同一个缓存的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2393) [GPU 依旧会从这个缓存里读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2395) [所以这很明显是个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2398) [所以这很明显是个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2398) [竞争条件并且结果还是未知的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2401) [有一些潜在的修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2403) [你可以在你的 App 中实现它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2407) [最简单的方法是在每一帧之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2410) [调用命令缓存里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2413) [waitUntilCompleted 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2414) [但是这样的话需要等到 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2418) [在你为了下一帧重写这一缓存之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2422) [完成读取工作之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2424) [不过就像你看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2427) [这里 CPU 和 GPU 的利用率都很差](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2430) [所以这并不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2433) [你想要完成的传输代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2435) [但是如果你想要你的 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2438) [App 设置好并跑起来它还是很有用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2440) [甚至如果你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2443) [真的有这样的数据冲突](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2445) [它是能检测出来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2447) [一个高效的方法去同步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2451) [你的资源更新是使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2454) [多个缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2455) [所以在这种情况下我们会用到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2457) [三个缓存去更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2458) [三个缓存去更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2458) [我们的动态数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2460) [我们在第一帧里写进缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2462) [然后之后 GPU 会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2464) [从中读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2466) [然后在第二帧里我们为了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2468) [避免竞争的情况我们写进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2470) [第二个缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2471) [类似的我们在第三帧里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2473) [写第三个缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2475) [但是现在我们已经用完了所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2478) [三个缓存并且用尽了我们的缓存池](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2480) [我们需要等到 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2483) [完成第一帧这样我们才能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2485) [在第四帧重复使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2487) [现在这个完成处理器就变得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2489) [得心应手了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2493) [它会让我们知道什么时候 GPU 完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2495) [这一帧的执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2498) [所以当第一帧完成以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2499) [我们可以在第四帧里重新使用它的缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2501) [以此类推 所以我们现在来看一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2504) [对于你渲染循环外的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2509) [三个缓存实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2513) [第一件事是我们会为三个缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2515) [创建一个 FIFO 队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2517) [同时我们还需要一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2518) [同时我们还需要一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2518) [frameBoundarySemaphore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2521) [它在初始化的时候被设置成了 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2522) [所以这就表明信号量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2525) [会在每一帧的边缘被测到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2526) [就是在 GPU 完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2529) [执行一帧的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2531) [这允许 CPU 去重复使用它的缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2534) [同样 初始化缓存索引去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2537) [指向当前帧的缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2539) [而且在你的渲染循环里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2543) [在你写进缓存之前我们需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2546) [先确定它的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2548) [响应帧已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2550) [在 GPU 上完成了执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2551) [所以在帧的一开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2554) [我们等待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2556) [frameBoundarySemaphore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2557) [一旦信号量被检测到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2559) [这就表明当前帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2561) [已经完成了它的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2562) [GPU 上的执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2564) [所以为了新的一帧的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2567) [去重复利用缓存是安全的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2570) [而且现在我们会编码一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2572) [命令去绑定这个缓存和 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2575) [在我们提交这个命令缓存给 GPU 之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2579) [在我们提交这个命令缓存给 GPU 之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2579) [我们会给这一帧添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2581) [一个完成处理器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2583) [到命令缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2585) [在添加完 完成处理器之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2587) [我们会提交这个命令缓存给 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2590) [现在一旦 GPU 完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2592) [执行这一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2596) [我们的完成处理器就会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2597) [处理器之后就会在这一帧发出信号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2599) [这就允许 CPU 去重复使用它的缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2603) [给新的帧编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2606) [所以这是一个简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2608) [三缓存实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2610) [你可以用它来执行任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2612) [动态数据的资源更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2613) [现在我们有了命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2616) [同时我们还处理了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2619) [资源更新现在我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2621) [来多说一点关于渲染通行编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2624) [它是你将会在你的绘图请求中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2626) [用到的编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2628) [就像 Dan 之前提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2630) [命令编码器在命令缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2632) [将 API 请求转换成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2637) [GPU 硬件命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2639) [我将会谈到渲染命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2639) [我将会谈到渲染命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2639) [它提供了一些针对典型图形的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2642) [一些操作 如设定管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2646) [纹理缓存对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2648) [还有绘图请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2650) [所以当你们创建编码器时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2652) [你需要先去设定渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2656) [所以这是个渲染通行描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2658) [这里你将会设置你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2660) [渲染目标并且在之后请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2662) [命令缓存为了这个渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2664) [去创建一个新的编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2666) [现在你就可以用这个编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2669) [去编码你的绘图请求了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2671) [跟 OpenGL 不一样的一个地方是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2675) [在 Metal 里一旦编码器被创建了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2678) [你不能再更改它的渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2680) [因为 GPU 如果看见了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2682) [巨大的绘图请求跨度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2685) [它会表现得好很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2687) [这些请求是去渲染同一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2689) [渲染目标集合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2691) [所以 Metal API 通过给渲染通行一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2694) [明确的开始和结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2697) [来反映这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2699) [来反映这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2699) [现在这个编码器给出的所有绘图请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2701) [会渲染进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2703) [这些渲染目标里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2705) [当你想要向不同的渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2708) [绘图的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2709) [你可以结束这个渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2711) [然后开启一个新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2713) [这就是我们创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2714) [一个渲染通行描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2718) [并且绑定颜色和深度关系的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2720) [现在你可以使用那个描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2725) [并且创建一个渲染命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2727) [现在所有由这个编码器发出的图画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2730) [都会被渲染到这些目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2733) [另外在 Metal 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2737) [你也可以为这些附件提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2739) [加载和存储行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2741) [这是为了优化 GPU 的带宽用量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2743) [所以这些加载和存储的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2748) [允许你去控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2750) [纹理内容会在渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2752) [之前和之后被怎样处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2753) [现在我们有了为渲染通行产生的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2756) [颜色和深度附属品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2759) [颜色和深度附属品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2759) [如果它清晰地为两个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2762) [渲染目标指定了加载行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2763) [GPU 就会首先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2765) [清除它们的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2768) [之后 GPU 会在这个编码器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2770) [执行命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2773) [来渲染这些渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2774) [现在你可以指定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2776) [在渲染通行的末尾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2779) [进行的存储行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2781) [这里对于颜色缓存来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2782) [介于存储行为被存储起来了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2784) [它会在渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2785) [的最后保留颜色缓存的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2788) [然后对于深度附件来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2791) [因为我们说了存储行为是不关心的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2793) [所以它会放弃它的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2795) [所以这些纹理加载和存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2799) [是非常昂贵的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2800) [消耗内存带宽的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2802) [所以慎重地选择并且不要关心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2804) [是不是可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2807) [那么这就是你怎么设定你行为的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2808) [在这个例子里我们指定了清除为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2812) [加载行为并且设定了清除颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2814) [然后这里我们指定了存储行为为存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2819) [然后这里我们指定了存储行为为存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2819) [相似的你可以为每一个渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2821) [指定加载和存储行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2823) [这些渲染目标是你设定在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2825) [渲染通行描述符里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2827) [所以这就是我们如何配置我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2828) [渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2831) [现在你可以从这个描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2832) [创建编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2836) [然后我们就可以开始编码绘图请求了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2839) [但是在这之前我想给你们展现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2841) [一些 OpenGL 命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2843) [然后它们会向你们展现它们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2845) [Metal 等价表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2847) [这就是典型 OpenGL 绘图序列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2848) [在这个分片里我们先绑定一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2853) [会设定所有渲染目标的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2856) [帧缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2858) [然后我们绑定我们的程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2861) [程序内包含了顶点和分片着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2862) [然后我们绑定带有顶点数据的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2866) [顶点缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2868) [之后我们再绑定另一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2870) [含有所有标准数据的缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2873) [再然后我们就会设定一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2875) [被采样的纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2877) [最后绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2879) [最后绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2879) [所以这就是 Metal 的等价操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2881) [这会稍微多出几行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2884) [因为它是明确的但是它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2885) [和 OpenGL 非常类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2887) [首先我们用渲染通行描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2890) [创建一个渲染命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2891) [这个描述符含有我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2893) [渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2895) [然后我们设定含有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2897) [着色器的管道对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2899) [然后我们再去设定缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2901) [去访问顶点着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2904) [同时它还含有我们要画的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2906) [图像的顶点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2907) [值得注意的是 Metal 并不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2910) [区别包含标准数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2912) [的缓存器和那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2913) [包含顶点的缓存器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2916) [所以我们会用相同的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2917) [去设置标准缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2920) [所以这里第一个请求会给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2921) [缓存器访问顶点着色器的权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2924) [第二个请求会给出访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2926) [分片着色器的权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2927) [接下来我们为要去采样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2929) [分片着色器设定纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2932) [然后绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2934) [一旦我们完成了编码命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2937) [我们会通过在编码对象上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2939) [我们会通过在编码对象上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2939) [调用 endEncoding 向 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2941) [指出这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2943) [所以这就是一个简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2946) [Metal 渲染通行的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2947) [现在我们已经有了一个完整的渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2949) [我们再来看看怎样去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2952) [让这些渲染表现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2954) [通过 OpenGl 你将你的渲染帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2957) [展现到屏幕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2961) [但是你并没有明确地管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2963) [系统的渲染缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2965) [依旧被设定为 drawable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2967) [但是要是通过 Metal 将你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2970) [内容显示在屏幕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2972) [首先你需要确认包含特殊的纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2974) [这种特殊纹理在系统里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2976) [被称为 drawable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2977) [所以你可以使用 MetalKit 视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2979) [MetalKit 视图提供了每一帧中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2981) [drawable 纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2982) [然后一旦你获得这个 drawable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2985) [你就可以编码渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2986) [并且渲染到这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2989) [drawable 就像你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2991) [渲染到任意其他一个纹理一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2993) [然而并不像其他纹理一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2995) [现在你可以将这个 drawable 展现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=2997) [那么让我来给你们展示一下代码例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3000) [首先我需要说一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3003) [这些 drawable 受限于你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3006) [着色器系统资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3008) [所以你应该尽可能简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3010) [地处理他们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3012) [这代表着你应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3014) [在你获取 drawable 以前编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3015) [所有的离线渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3018) [之后你可以创建一个 MetalKit 视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3021) [不但可以去看一个完整的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3023) [填充渲染通行描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3026) [这个描述符你可以直接用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3029) [创建编码器 就是这里你们看到的这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3030) [同时你还可以通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3033) [view.currentDrawable 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3036) [请求指定的纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3037) [之后你可以围绕它创建你自己的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3041) [渲染通行描述符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3042) [一旦你完成了编码你的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3047) [你可以调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3048) [现有的命令缓存中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3050) [drawable 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3051) [这在 GPU 完成执行命令换内存后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3053) [将你的 drawable 输出到屏幕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3055) [所以一旦 GPU 完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3058) [所以一旦 GPU 完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3058) [执行这一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3060) [你就可以在显示上看到这一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3062) [这样的话通过 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3064) [将你的渲染展现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3067) [就变得相当的快了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3069) [但是我还有几个小建议与你们分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3071) [将一个渲染器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3075) [传递到 Metal 是可行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3077) [IOSurface 和 CVPixelBuffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3079) [API 可以被用来创建纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3081) [这个纹理可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3085) [OpenGL 和 Metal 之间共享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3087) [这就允许你在 OpenGL 里面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3090) [渲染一个纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3092) [然后从 Metal 里读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3094) [反之亦然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3096) [所以一些 App 可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3096) [利用这一点去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3099) [逐步移植](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3101) [特别是当存在搭建在 OpenGL 里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3103) [插件结构的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3105) [所以这里有一个关联到这个会话的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3107) [示例代码准确地展现了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3109) [如何做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3111) [现在你已经有了一个 Metal App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3115) [你可以采用所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3116) [新的 Metal 特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3118) [如果你的 App 是与 CPU 绑定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3121) [那么使你的 CPU 编码多线程工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3123) [会很有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3125) [你可以在不同线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3127) [同时编码多个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3129) [命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3131) [你甚至可以将一个单独的命令缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3132) [拆分编码到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3134) [多个线程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3136) [这是通过使用并行渲染命令编码器实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3138) [同样的通过计划处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3145) [API 来做的 GPU 计算内置于 Metal 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3146) [你可以用全新的方法去使用 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3150) [不用 CPU 去开始的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3154) [你可以利用计算管道来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3156) [生成图像的 GPU 数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3158) [通过让 GPU 去生成它自己的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3161) [你不但可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3163) [减少 CPU 的利用率和同步率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3165) [同时你还可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3167) [自由地决定数据对于 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3169) [所需的带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3170) [现在通过这个高带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3173) [计算处理器你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3175) [实现更多更复杂的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3176) [算法 就像这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3178) [Metal 支持很多很强大的特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3183) [这些功能你可以用到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3185) [你的 App 里来提高其自身的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3187) [此外作为你移植过程的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3190) [我们强烈地鼓励你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3193) [去使用我们的 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3195) [的极其强大的调试和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3197) [优化工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3199) [它们都被集合在了 Xcode 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3201) [所以 Metal 有一个很强大的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3204) [验证层来表明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3206) [任何不正常的 API 用量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3208) [的细节信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3210) [同时也会给出一些可能的修复策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3213) [这是一个可以让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3216) [一步一步进行 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3218) [的调用和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3220) [一步一步看到你的帧是如何被渲染的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3222) [GPU 调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3224) [你可以看到和你的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3226) [一起出现的所有资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3228) [它也基于资源的用量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3230) [给 GPU 提供了专业的建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3233) [今年我们还添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3235) [着色器调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3238) [着色器调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3238) [这样你可以调试你的着色器方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3240) [就像其他的函数一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3242) [我们还添加了着色器分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3244) [它会显示一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3247) [与你的着色器有关的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3249) [性能矩阵集合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3251) [同时还有一个依赖观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3252) [让你能评判](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3255) [渲染通行的依赖关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3257) [你也可以潜在的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3258) [合并任何多余的渲染通行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3262) [以此来提高你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3264) [App 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3266) [最后 在instruments 里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3270) [Metal 系统追踪工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3272) [会给你展现一个完整的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3273) [App 表现和性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3276) [所以我们强烈建议你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3278) [使用这些工具去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3280) [简化你的移植工作量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3282) [将它打包起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3285) [OpenGL 和 OpenCL 已经被放弃了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3287) [但是它们依旧在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3289) [我们很担忧它们的未来使用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3292) [现在是时候接受 Metal 了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3294) [我们有一整套的开发者工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3297) [很多经验来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3299) [很多经验来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3299) [帮助开发团队成功地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3300) [完成了这项工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3302) [并且大幅提高了性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3304) [我希望我今天分享的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3307) [可以给予你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3309) [顺利移植地经验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3310) [同时我们也很愿意与你们沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3312) [谈一谈你们的 App 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3315) [你们如何通过 Metal 让他们运行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3317) [所以明天下午我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3320) [在 OpenGL 到 Metal 移植实验室里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3321) [介时会有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3323) [关于 Metal 的会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3325) [我建议你们来参加这些会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3328) [可以学到很多关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3329) [如何利用 Metal 去调试和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3331) [优化你的 App 的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3333) [在此感谢大家参与这次会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3336) [希望你们能享受这一周](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3337) [剩下的时光](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3339) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/604/?time=3341)