# Introducing Network.framework: A modern alternative to Sockets

## Summary
The new Network.framework API gives you direct access to the same high-performance user-space networking stack used by URLSession. If you're considering using Berkeley Sockets in your app or library, learn what better options are available to you.

## Info
* Frameworks
* WWDC 2018 - Session 715 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=17) [&gt;&gt; Good morning.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=21) [My name is Josh Graessley, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=23) [am really excited to be here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=24) [this morning to tell you about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=25) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=27) [Network.framework is a modern](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=30) [alternative to sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=32) [Today, we're going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=34) [modernization transport APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=35) [This will help give you some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=37) [context to understand what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=38) [Network.framework is and how it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=40) [fits into the system and whether](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=42) [or not it's the right thing for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=43) [your application to be using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=44) [We'll introduce you to the API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=47) [by walking you through making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=48) [your first connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=49) [We'll talk about how you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=52) [this API to really optimize your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=53) [data transfers and go way beyond](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=55) [the performance of anything you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=57) [can do with sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=59) [can do with sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=59) [We'll talk about how this API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=61) [can help you handle some complex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=62) [mobility challenges, and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=64) [wrap up with information on how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=65) [you can get involved and start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=67) [adopting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=68) [First, I'd like to spend a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=70) [little bit of time talking about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=71) [modernizing transport APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=73) [Now when I say transport API,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=75) [I'm talking about any API that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=76) [lets you send and receive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=79) [arbitrary data between two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=80) [endpoints on a network, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=81) [that's a pretty broad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=83) [definition, and there are a lot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=84) [of APIs that could fall under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=85) [this category.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=87) [Perhaps the most ubiquitous is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=90) [sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=92) [Sockets has been within us for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=92) [over 30 years, and I don't think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=94) [it's an exaggeration to say that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=96) [sockets has changed the world,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=97) [but the world has kept changing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=99) [And as a consequence, using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=101) [sockets to write apps for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=103) [today's internet is really hard.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=104) [There are three primary areas in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=107) [which it's very difficult to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=109) [sockets well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=110) [The first one is Connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=112) [Establishment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=114) [There's a whole host of reasons](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=115) [that establishing connections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=117) [can be really difficult with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=119) [can be really difficult with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=119) [sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=120) [For starters, sockets connect to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=121) [addresses, so you have to, most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=123) [of the time you have a host](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=125) [name, so you're going to have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=126) [resolve that host name to an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=127) [address.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=128) [When you do that, you often end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=130) [up with way more than one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=131) [address.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=133) [You'll have some IPv4 addresses,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=133) [some IPv6 addresses, and now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=135) [you've got this challenge, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=138) [address should you try and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=139) [connect to, in what order?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=140) [How long do you wait before you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=142) [try the next one?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=143) [You can spend years trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=144) [perfect this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=145) [I know because we have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=146) [Once you get past the dual stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=150) [host problems, you run into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=151) [whole bunch of other issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=153) [There are some networks that use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=155) [something called Proxy Automatic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=156) [Configuration or PAC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=158) [On these networks, there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=160) [JavaScript that you get, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=161) [have to pass a URL into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=162) [JavaScript, and the JavaScript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=164) [runs and spits out an answer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=165) [that says either you can go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=167) [direct or you have to use this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=169) [SOCKS proxy over here or that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=171) [HTTP connect proxy over there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=172) [And now your app has to support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=174) [SOCKS proxies and HTTP connect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=176) [proxies, and this can be really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=178) [proxies, and this can be really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=178) [difficult to do well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=180) [And the most difficult thing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=181) [that you may not have one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=183) [these networks to test on, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=184) [you may get a bug report from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=185) [one of your customers, and they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=187) [may complain that it's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=189) [working well on their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=190) [environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=191) [And you may want to add code to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=192) [fix the problem, but that once](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=193) [you've got it in there, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=196) [really don't have a good way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=197) [test it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=197) [You have to end up building the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=198) [whole environment to reproduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=199) [the same environment they have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=200) [It can be a real challenge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=202) [So connecting with sockets is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=204) [really hard.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=206) [The second thing that becomes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=208) [challenges with sockets is data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=210) [transfers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=211) [There's a lot of reasons that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=213) [transferring data with sockets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=214) [can be really difficult.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=215) [The primary problem is the read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=216) [and write model itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=219) [If you're using blocking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=222) [sockets, it pretty simple, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=223) [you're tying up a thread, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=225) [it's really not a great idea to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=227) [be tying up a thread while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=228) [you're waiting to read or write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=229) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=230) [You can switch to nonblocking,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=232) [but then you end up with a whole](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=233) [lot of other challenges that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=234) [run into.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=235) [When you're using nonblocking,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=237) [you may tell the kernel I'd like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=238) [100 bytes, and the kernel will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=239) [100 bytes, and the kernel will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=239) [come back and say, I've got 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=241) [bytes for you, why don't you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=242) [come back later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=243) [And now you have to build a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=244) [state machine to keep track of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=245) [how many bytes you read versus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=246) [how many bytes you want to read.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=247) [This can be a lot of work, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=249) [getting it to perform well can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=250) [be a real challenge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=252) [On top of all of that, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=253) [really shouldn't be reading and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=256) [writing to sockets directly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=256) [because you should be using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=258) [something like transport layer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=258) [security or TLS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=259) [Sockets don't support TLS, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=264) [you're probably using some other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=266) [library that is handling TLS for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=267) [you and reading and writing to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=270) [the sockets on your behalf, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=271) [you're writing the glue code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=273) [between that library and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=274) [sockets, and you have to figure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=275) [out how to get all this to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=276) [with all the crazy connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=277) [logic that you put in ahead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=278) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=279) [There's a lot here that can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=280) [really difficult.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=282) [Finally, mobility can be really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=285) [challenges with sockets for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=287) [variety of reasons.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=288) [I think a lot of this boils down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=290) [to the fact that when sockets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=293) [came out, a lot of the devices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=294) [required more than a single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=296) [person to move them, and they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=297) [were connected with a single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=298) [wire, and they had a static IP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=299) [wire, and they had a static IP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=299) [address, and everything was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=301) [stable and simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=302) [And today, we have these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=304) [incredibly powerful devices in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=305) [our pocket with multiple radios](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=307) [that may be on at the same time,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=309) [and some of them are moving from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=312) [network to network, and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=313) [application has to handle all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=314) [these transitions well to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=316) [provide a seamless experience to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=317) [your customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=318) [Sockets does nothing to help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=321) [with this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=324) [You can use routing sockets, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=325) [it's really, really difficult.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=326) [We think a transport API should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=328) [do better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=330) [Fortunately, on our platform as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=332) [an application developer you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=334) [have a great API in URLSession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=335) [URLSession handles all of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=339) [problems for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=341) [It's really focused on HTTP, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=343) [it also has stream task that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=345) [gives you raw access to TCP and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=346) [TLS connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=348) [Now you might be looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=350) [this, and you may not have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=352) [cheated by looking at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=353) [description in the WWDC app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=354) [You might think that URLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=356) [is built on the same primitives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=358) [is built on the same primitives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=358) [that you would use yourself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=360) [But it turns out that's not the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=363) [case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=364) [URLSession is built on top of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=366) [something we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=367) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=368) [URLSession really focuses on all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=370) [of the HTTP bits, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=371) [offloads a lot of the transport](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=374) [functionality to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=375) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=376) [Network.framework is something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=381) [we've been working on for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=382) [number of years, and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=383) [supporting URLSession, we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=384) [learned a lot, and we've taken a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=385) [lot of those lessons to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=387) [IETF.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=388) [A number of our engineers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=389) [regularly participate in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=390) [IETF and meet with engineers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=392) [from other companies, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=393) [they've been discussing a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=395) [what we've learned in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=396) [transport services working](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=397) [group.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=398) [And in those discussions, we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=399) [got some great feedback, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=400) [we've brought that back in and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=401) [improved Network.framework based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=402) [on that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=404) [We are really excited to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=405) [announce this year that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=406) [applications can take advantage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=408) [of this same library directly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=410) [now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=411) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=412) [Now we know that one of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=418) [things people love about sockets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=419) [things people love about sockets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=419) [is that it gives them very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=421) [fine-grain control over just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=422) [about everything, and they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=423) [really loathe to give that up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=425) [So as we developed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=427) [Network.framework, we wanted to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=428) [make sure that it did the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=429) [thing by default in the way that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=430) [sockets doesn't, but it gave you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=432) [all the knobs that sockets does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=434) [And it's kind of got this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=436) [gradient, so the more knobs you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=437) [turn, the more complex it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=439) [becomes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=441) [It gives you all the power you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=442) [need, but you don't have to pay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=443) [for the complexity unless you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=444) [actually need some of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=446) [Network.framework has incredibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=450) [smart connection establishment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=452) [It handles the dual stack cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=454) [It handles IPv6 only networks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=456) [It handles PAC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=458) [It handles proxies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=459) [It will help you connect on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=461) [networks that are otherwise very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=463) [difficult to deal with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=465) [It has an incredibly optimized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=467) [data transfer path that lets you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=468) [go way beyond the performance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=470) [anything you can do with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=472) [sockets, and Tommy will cover](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=472) [that in a little bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=474) [It has support for built-in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=475) [security.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=477) [It supports TLS and DTLS by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=478) [It supports TLS and DTLS by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=478) [default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=480) [It's really simple to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=481) [It has great support for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=484) [mobility.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=485) [It provides notifications about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=486) [network changes that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=487) [relevant to the connections that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=488) [your application is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=490) [establishing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=491) [It's available on iOS, macOS,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=492) [and tvOS as a CAPI with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=497) [automatic reference counting, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=499) [it's easy to use from Objective](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=500) [C, and it has an incredible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=501) [Swift API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=503) [With that, I'd like to turn it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=505) [over to Tommy Pauly, to walk you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=508) [through making your first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=509) [connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=510) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=511) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=512) [&gt;&gt; All right, hello everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=518) [My name is Tommy Pauly, and I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=520) [on the networking team here at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=521) [Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=523) [And so I'm sure a lot of you are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=524) [really excited to start seeing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=526) [how you can start adopting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=528) [Network.framework in your apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=530) [And the best place to start and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=533) [just dive right in is by making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=535) [your first connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=536) [And you're going to be making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=537) [your connection from your local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=539) [your connection from your local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=539) [device, to your server, or to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=540) [some other peer device that's on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=543) [your local network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=544) [But you may be wondering, what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=546) [kind of connections are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=549) [appropriate to use with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=550) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=551) [What are the use cases?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=552) [And so let's explore first some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=554) [scenarios of apps that may be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=556) [using sockets today and would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=558) [really benefit a lot by taking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=561) [advantage of Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=562) [going forward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=564) [So the first one of these I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=565) [to highlight is gaming apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=568) [Gaming apps often use UDP to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=571) [send real-time data about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=573) [game state between one device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=575) [and another.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=577) [And they really care about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=579) [optimizing for latency and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=580) [making sure there's no lag or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=582) [anything being dropped there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=583) [If you have an app like this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=586) [you're going to love how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=588) [Network.framework allows you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=589) [really optimize your UDP,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=590) [sending and receiving to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=592) [faster than ever before with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=595) [least latency possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=597) [Another type of app that would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=598) [Another type of app that would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=598) [take a lot of advantage from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=602) [Network.framework is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=603) [live-streaming apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=605) [So live streaming often will use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=606) [a combination of UDP and TCP in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=608) [their apps, but the key point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=611) [here is that it's generating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=614) [data on the fly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=615) [If you have new video frames or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=617) [audio frames, you need to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=619) [sure that those are paced well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=621) [and you're not incurring a lot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=622) [of buffering on the device or on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=624) [the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=626) [The asynchronous model for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=628) [reading and writing in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=630) [Network.framework is going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=632) [perfect for making sure you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=633) [reduce that buffering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=634) [And the last case I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=636) [highlight are mail and messaging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=639) [apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=641) [So these are going to be using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=643) [lot more traditional protocols,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=644) [just TLS over TCP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=646) [However, it's really critical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=649) [for apps like this to handle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=650) [network transitions really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=651) [gracefully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=652) [Oftentimes if you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=655) [messaging app, your user is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=656) [going to be using your app as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=657) [they're walking out of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=659) [they're walking out of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=659) [building, texting their friend](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=660) [to let them know that they're on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=661) [their way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=662) [And you want to make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=663) [you're handling that transition](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=664) [from the WiFi network in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=666) [building to the cell network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=667) [that they're going onto and that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=668) [you don't hand a long time for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=670) [that message to actually get to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=671) [their friend.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=673) [And these are just three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=674) [examples of the types of apps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=676) [that may use low-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=678) [networking like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=679) [There are many other types of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=681) [apps that could take advantage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=682) [of this, so if you have an app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=684) [like one of these or some other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=685) [use case that currently uses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=687) [sockets, I invite you to follow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=688) [along and see how your app can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=690) [benefit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=693) [So to get started, I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=693) [focus on that last case, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=696) [simplest case of mail and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=697) [messaging apps and looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=699) [how they establish connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=701) [So when you want to establish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=703) [your connection to a server,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=706) [let's say it's for a mail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=707) [connection, iMap with security,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=709) [with TLS, you start with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=711) [hostname, mail.example.com.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=714) [You have a port you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=717) [connect to, port 993, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=718) [connect to, port 993, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=718) [want to be using TLS as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=720) [TCP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=724) [So how would this look in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=725) [sockets traditionally?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=726) [Something like this to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=728) [started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=729) [You would take your host name.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=730) [You would call some DNS API to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=732) [resolve that host name.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=733) [Let's say this is getaddrinfo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=735) [You'll get back one or more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=737) [addresses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=738) [You'll have to decide which one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=739) [you want to connect to first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=740) [You'll call socket with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=742) [appropriate address family.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=744) [You will set a series of socket](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=746) [options.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=748) [Let's say you want to make your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=749) [socket nonblocking like Josh](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=750) [mentioned before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=752) [Then you call connect to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=754) [TCP, and then you wait for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=756) [writable event.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=758) [And this is before you do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=760) [anything with TLS, and that's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=761) [whole host of other problems.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=762) [So how does this look in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=764) [Network.framework?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=767) [And we hope that it looks very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=768) [familiar to you but a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=770) [simpler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=772) [So the first thing you do is you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=773) [create a connect a connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=774) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=775) [And a connection object is based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=776) [on two things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=777) [You have an endpoint, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=779) [You have an endpoint, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=779) [defines the destination you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=780) [to get to, and this could be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=781) [address, the IP address that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=783) [had before, but usually, like in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=785) [this example, we have a host](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=787) [name and a port, and so our end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=789) [point can just be that host name](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=790) [and port.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=792) [It could also be a bonjour](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=793) [service that I want to connect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=794) [to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=795) [And then I also have parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=797) [Parameters define what protocols](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=799) [I want to use, TLS, DTLS, UDP,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=801) [TCP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=804) [It defines the protocol options](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=804) [that I want as well as which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=807) [paths I want to use to connect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=809) [over.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=811) [Do I want to just connect over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=811) [anything, or do I only want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=812) [use WiFi?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=815) [Once you've configured your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=816) [connection, you simply call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=817) [start to get things going, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=819) [then you wait for the connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=821) [to move into the ready state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=822) [And that's all you need to do to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=824) [bring up a full TLS connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=825) [to your server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=827) [And I think you're going to love](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=828) [how this looks in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=829) [So here's what you do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=832) [You first import the network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=833) [module.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=835) [Then, you create an NWConnection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=837) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=839) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=839) [So an NWConnection in either](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=840) [Swift or in C is the fundamental](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=842) [object for reading and writing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=845) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=846) [In this case, we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=848) [convenience that initializes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=849) [your endpoint with a host in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=850) [port, so I give it my hostname,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=852) [male.example.com, and the port.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=854) [And in this case, it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=857) [well-known port.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=858) [It's imaps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=860) [So I can just put that in Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=861) [very easy, but I could also put](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=863) [any other numeric literal there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=864) [And then to define what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=867) [protocols I want to use, I pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=869) [parameters, and since this is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=871) [client connection, I only want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=873) [default, TLS, and TCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=875) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=876) [It can be as simple as just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=878) [writing dot TLS, and now I have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=879) [a fully-fledged TLS connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=881) [The next thing I do is I said](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=884) [estate update handler to handle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=886) [all the transitions that my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=888) [connection might go through.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=889) [The first state and the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=891) [important one that you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=892) [handle is the ready state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=893) [Ready means that your app is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=895) [ready to read and write data on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=897) [this connection, it's totally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=899) [this connection, it's totally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=899) [established, and if you're using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=900) [TCP and TLS, this means that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=903) [TLS handshake is finished.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=905) [We also though let you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=908) [about the waiting state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=909) [So last year in URLSession, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=911) [introduced waits for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=914) [connectivity, and the waiting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=915) [state of an NWConnection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=917) [exactly the same thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=919) [And this is on always by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=920) [default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=921) [So when you create your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=922) [connection and when you start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=923) [it, if there is no network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=924) [available, we won't fail, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=925) [just tell you we're waiting for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=928) [a network to be available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=929) [We'll give you a helpful reason](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=930) [code, but you don't have to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=932) [anything more to watch network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=934) [transitions yourself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=935) [Mobility is an essential,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=937) [critical part of this API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=938) [And we'll also let you know if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=940) [there's a fatal error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=943) [Let's say we had to reset from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=944) [the server or TLS failed, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=946) [we'll give you that as a failed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=947) [event.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=949) [So once you've set this up, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=950) [simply call start and provide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=952) [the dispatch queue upon which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=954) [you want to receive callbacks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=956) [So I want to dig into what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=958) [So I want to dig into what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=958) [happens when you call start.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=961) [What's actually going on?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=963) [So here's a little state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=964) [machine, the innards of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=966) [NWConnection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=968) [When we begin at the setup state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=969) [and we call start, we move into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=970) [the preparing state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=973) [So the preparing state does a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=976) [lot more than just calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=979) [connect on a TCP socket.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=980) [For TCP socket, that would just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=983) [send out a SYN packet across to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=985) [the server that you're trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=987) [reach.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=989) [But when you call start on an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=990) [NWConnection, it actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=992) [handles all of the things that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=993) [Josh was mentioning earlier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=994) [It evaluates the network you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=997) [on and tries to make the fastest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=998) [connection possible for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1001) [I want to dig into that a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1002) [bit more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1004) [So this is what we call Smart](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1005) [Connection Establishment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1007) [So the very first thing that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1008) [do when you call start is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1011) [we take your endpoint, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1014) [we evaluate what are all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1016) [networks that are currently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1017) [available to me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1018) [In this case, we have WiFi and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1019) [In this case, we have WiFi and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1019) [cellular.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1021) [And generally we prefer the WiFi](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1023) [network because it has less cost](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1024) [to the user.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1026) [So we'll look at that one first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1028) [Then we check, are there any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1030) [special configurations on this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1032) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1034) [Is there a VPN?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1034) [Is there a proxy?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1035) [And we'll evaluate that for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1036) [In this case, let's say that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1039) [there is a proxy configured with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1041) [an automatic configuration file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1043) [that also lets you go direct if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1045) [the proxy doesn't apply to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1048) [connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1049) [So we'll evaluate both of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1050) [options.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1052) [We'll check if we need to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1053) [the proxy, go ahead and connect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1054) [to it, create a TCP connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1056) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1058) [But if we don't need it, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1059) [do DNS on your behalf going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1061) [directly, get back all of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1064) [DNS IP address answers, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1066) [connect to them one after the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1068) [other, leaving them going in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1071) [parallel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1072) [We're racing them to get you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1073) [fastest connection possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1074) [And then, if something goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1079) [And then, if something goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1079) [wrong with WiFi, let's say the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1080) [WiFi radio quality goes really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1081) [bad because you're walking away](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1083) [from the building, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1085) [actually take advantage of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1087) [feature called WiFi assist and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1089) [fall back seamlessly to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1091) [cellular network, do DNS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1093) [resolution there, and try the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1095) [connections one after the other.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1097) [So this way your connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1099) [establishment is very resilient,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1102) [handles VPNs, handles proxies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1104) [for you, and gets you the best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1106) [connection possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1109) [Now, of course, you may not want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1109) [to try all of these options.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1114) [You may want to restrict what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1115) [the connection establishment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1117) [does, and so we have many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1118) [different knobs and controls to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1120) [let you do that, and I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1122) [highlight just three of them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1123) [today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1125) [The first is you may not want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1126) [use expensive networks, like a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1128) [cellular network, because this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1130) [connection is only appropriate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1132) [to use over WiFi.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1134) [So within the parameters for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1136) [your connection, there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1137) [options to control the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1139) [options to control the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1139) [interfaces that you use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1140) [So if you don't want to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1143) [cellular, simply add cellular to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1143) [the list of prohibited interface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1146) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1148) [It's even better, actually to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1149) [also prohibit expensive networks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1152) [in general because this will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1154) [also block the usage of personal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1156) [hotspots on a Mac let's say.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1158) [Another way that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1163) [restrict your connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1163) [establishment is by choosing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1165) [specifically the IP address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1166) [family that you want to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1168) [So let's say that you really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1170) [love IPv6 because it's faster](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1171) [and it's the future.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1173) [You don't want to use IPv4 at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1174) [all on your connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1175) [And you can do this by going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1177) [your parameters, digging down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1179) [into the IP-specific options,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1180) [and here you'll have options](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1182) [that you'll find familiar from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1184) [your socket options on a socket](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1185) [today, and you can also define](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1187) [specifically which IP version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1189) [you want to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1191) [And this will impact your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1192) [connection as well as your DNS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1193) [resolution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1195) [And lastly, you may not want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1196) [use a proxy on your given](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1199) [use a proxy on your given](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1199) [connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1200) [Maybe it's not appropriate for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1201) [your connection to go through a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1202) [SOCKS proxy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1204) [In that case, you can simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1205) [prohibit the use of proxies as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1207) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1208) [So that's what happens in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1209) [preparing state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1212) [I mentioned before that things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1214) [can go wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1216) [You can have no network when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1217) [try to establish, and what we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1218) [do after going to preparing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1220) [if we find there are no good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1222) [options, DNS failed, there was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1223) [no network, maybe you're in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1225) [airplane mode, we'll move into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1227) [the waiting state and let you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1228) [know the reason for that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1229) [And we'll keep going back into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1231) [preparing every time the network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1232) [changes and the system thinks,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1234) [yeah, there's a good chance that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1236) [your connection will become](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1238) [established now, and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1239) [handle all that for you and let](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1240) [you know every time that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1242) [reattempting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1243) [Eventually, hopefully your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1246) [connection does get established.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1248) [At this point, we'll move into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1249) [the ready state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1251) [And the ready state, as I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1252) [mentioned before, is when your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1254) [connection is fully established.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1256) [So this is all of the protocols](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1257) [in your stack up to TLS, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1259) [in your stack up to TLS, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1259) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1262) [At this point, you can read and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1263) [write, and this is also where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1264) [give you callbacks about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1267) [network transitions that you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1270) [going through.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1271) [So if your connection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1272) [established and then you change](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1274) [networks, we'll give you updates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1275) [about that so you can handle the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1277) [mobility gracefully, and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1278) [be talking about this later on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1280) [in the talk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1281) [If there's an error on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1284) [connection, either during the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1285) [connection establishment or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1287) [after you've already connected,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1288) [we'll give you the failed state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1290) [with an error, and then once](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1291) [you're totally done with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1293) [connection, let's say you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1294) [already closed it or you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1295) [received a close from the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1296) [side, and you want to just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1297) [invalidate the connection, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1299) [call cancel, and we move into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1300) [the cancelled state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1302) [And this is guaranteed to be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1303) [very last event that we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1305) [deliver to your object so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1307) [can clean up any memory that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1309) [have associated and move on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1310) [So that's it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1313) [That's an overview of the basic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1314) [lifetime of a connection object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1316) [in Network.framework, and to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1318) [show you how you can use this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1319) [show you how you can use this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1319) [build a simple app, I'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1321) [invite Eric up to the stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1323) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1325) [&gt;&gt; Thanks Tommy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1333) [I'm Eric Kinnear, also from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1334) [networking team here at Apple,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1336) [and I'm really excited to build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1337) [with you an example application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1339) [using Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1340) [We're going to use the live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1343) [streaming example that Tommy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1344) [mentioned earlier to build an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1345) [application that can take the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1347) [camera input on one device and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1349) [send it over a network to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1351) [displayed on another device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1352) [Because we're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1355) [continuously generating live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1356) [video frames, we're going to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1357) [UDP to send those packets across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1360) [the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1361) [So how do we do this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1363) [Well, first, we need a capture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1366) [session with the camera so that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1368) [we can receive the video frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1369) [from the image sensor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1371) [For the sake of this example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1373) [we're not going to use any video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1374) [codecs or other compression.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1375) [We're simply going to take the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1377) [raw bytes from the camera, ship](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1378) [raw bytes from the camera, ship](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1378) [them across the network, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1380) [display them on the other side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1381) [In order to make this happen, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1383) [need to divvy those frames up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1385) [into smaller chunks that we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1387) [send in UDP packets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1389) [Of course, to send those UDP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1391) [packets on the network, we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1393) [a connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1395) [Switching over to the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1396) [device, we need a listener that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1397) [can receive that incoming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1399) [connection and read the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1401) [packets off the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1403) [From there, we simply reverse](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1405) [the earlier process,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1406) [reassembling the video frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1407) [and sending them to the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1409) [so that we can see them on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1410) [screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1411) [To keep things simple, we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1412) [already abstracted out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1415) [camera and the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1416) [functionalities so that we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1417) [focus just on the parts that use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1419) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1421) [There's one piece we haven't yet](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1423) [covered here, and that's the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1424) [listener.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1426) [So we're going to take a minute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1426) [to do that now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1427) [Listener functionality is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1430) [provided by the NWListener](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1431) [class, which you can create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1433) [using the same parameters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1434) [objects that you used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1436) [configure connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1437) [It's really easy to set up a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1439) [It's really easy to set up a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1439) [listener to advertise a bonjour](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1441) [service.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1443) [In this case, we'll use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1444) [camera.udp.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1445) [When a new connection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1446) [received by a listener, it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1450) [pass that connection to a block](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1451) [that you provide as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1453) [newConnectionHandler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1454) [This is your opportunity to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1456) [perform any configuration that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1457) [you choose on that connection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1459) [and then you need to call start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1461) [to let that connection know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1462) [it's time to get going.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1464) [Similarly, you need to call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1466) [start on your listener, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1468) [again, just like with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1469) [connections, you provide a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1470) [dispatch queue where you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1471) [these callbacks to be scheduled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1473) [So that's listeners.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1474) [If you think about it, we just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1477) [implemented the equivalent of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1478) [calling listen on a UDP socket.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1479) [Except listen doesn't actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1482) [work on UDP sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1485) [Now we're ready to build our app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1487) [in Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1488) [So here we've got our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1490) [application, and we've got a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1491) [bunch of files over here that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1493) [already handle the camera and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1494) [the display functionality, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1495) [we're going to focus just on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1497) [UDPClient class and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1499) [UDPClient class and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1499) [UDPServer class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1501) [The UDPClient is going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1503) [responsible for creating the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1505) [connection to the other side and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1506) [sending the frames across.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1507) [Likewise, the server is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1510) [responsible for creating the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1511) [listener, accepting incoming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1512) [connections, reading the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1514) [off those connections, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1516) [sending them up to the screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1517) [Let's start with the client.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1519) [My client class has an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1522) [initializer that takes a name,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1523) [which is a string describing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1525) [bonjour name that we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1528) [connect to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1530) [I'll create my connection by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1531) [simply calling NWConnection and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1533) [passing in a service endpoint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1535) [Using the name that I was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1538) [provided and camera.udp as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1539) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1543) [We also passed the default UDP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1543) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1545) [As Tommy mentioned, we can use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1546) [state update handler to check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1549) [for the ready and the failed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1553) [states.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1554) [Here, when our connection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1556) [ready, we'll call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1557) [sendInitialFrame, which we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1558) [sendInitialFrame, which we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1558) [implement in a minute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1560) [Because we're using UDP and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1562) [there's no other handshake,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1564) [we're going to take some data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1565) [and send it across to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1567) [network to the other device and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1568) [wait for it to be echoed back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1571) [before we start generating lots](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1572) [of video frames and dumping them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1573) [on the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1575) [We need to remember to call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1579) [start on our connection, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1580) [provide the queue that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1582) [created up above.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1583) [Let's implement send initial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1586) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1587) [Here we're going to take the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1592) [literal bytes hello and create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1593) [data object using them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1595) [To send content on a connection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1598) [we can call connection.send and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1600) [provide that data object as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1602) [content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1604) [We provide a completion handler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1605) [in which we can check for any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1607) [errors that may have been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1608) [encountered while sending.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1609) [Since we expect this content to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1611) [be immediately echoed back, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1614) [turn right around and call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1616) [connection.receive to read the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1617) [incoming data off of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1619) [incoming data off of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1619) [connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1620) [In that completion handler, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1621) [validate that the content is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1623) [present, and if so, we let the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1624) [rest of the application know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1626) [that we're connected, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1627) [should bring up the camera](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1628) [hardware and start generating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1629) [frames.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1631) [When those frames are generated,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1632) [the rest of the application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1635) [knows to call send on our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1636) [UDPClient class and pass it an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1638) [array of data objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1643) [representing the video frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1644) [that we're trying to send.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1646) [Because we're going to be doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1649) [a lot of send operations in very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1650) [quick succession, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1651) [do them within a block that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1652) [passed in connection.batch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1654) [Within this block we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1657) [go through every frame in that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1659) [array of data objects and pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1661) [each one to connection.send.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1663) [Similarly to above, we use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1665) [completion handler to check for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1667) [any errors that were encountered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1668) [while sending.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1670) [And that's it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1672) [We've got our UDPClient class,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1673) [and we're ready to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1674) [Let's look at the server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1675) [On the server side, we need a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1679) [On the server side, we need a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1679) [listener that can accept the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1681) [incoming connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1682) [We need to respond to that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1684) [handshake that we just sent from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1685) [the client, and we need to read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1686) [data off the network so that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1688) [can push it up to the display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1689) [Starting with the listener, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1691) [simply create an NWListener](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1695) [using the default UDP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1698) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1699) [If I wanted to, this is also my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1700) [opportunity to use those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1702) [parameters to tell the listener](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1703) [to listen on a specific local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1705) [port.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1706) [But since we're using a bonjour](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1707) [service, we don't need to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1708) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1709) [To set up that service, I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1713) [going to set the service](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1715) [property on the listener to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1716) [service object of type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1718) [camera.udp.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1719) [Notice that I don't pass the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1721) [name here because I want the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1722) [system to provide the default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1723) [device name for me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1725) [I also provide a block to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1727) [serviceRegistration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1729) [UpdateHandler, which is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1730) [be called anytime the set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1732) [endpoints advertised by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1734) [system changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1735) [Here, I'm interested in the case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1737) [where an endpoint is added, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1739) [where an endpoint is added, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1739) [if it's of service type, I tell](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1741) [the rest of the application the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1743) [name that is being advertised,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1745) [that default device name that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1746) [ask the system to provide so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1747) [that I can display it in the UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1748) [and have my users type it in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1750) [somewhere else.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1751) [I'm going to set a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1760) [connection handler on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1760) [listener, which will be called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1762) [every time the listener receives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1763) [a new incoming connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1765) [I could do some configuration on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1766) [these connections, but the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1768) [default settings are fine here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1769) [so I simply call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1771) [connection.start and pass it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1771) [queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1776) [Here, I notify the rest of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1776) [application that I've received](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1778) [an incoming connection, so it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1779) [can start warming up the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1781) [pipeline and become ready to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1782) [display the video frames.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1783) [I'll also call receive on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1786) [myself, which we'll implement in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1787) [a minute, to start reading that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1789) [data off of the network and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1790) [shipping it up to the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1792) [pipeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1792) [Just like with connections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1793) [listeners have state update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1797) [listeners have state update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1797) [handlers, which I'll use to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1801) [check for the ready and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1803) [failed states.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1804) [I need to not forget to start my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1807) [listener, which I do by calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1808) [listener.start and passing it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1810) [that queue we created up above.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1812) [So I've got my listener ready, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1815) [just need to read data off the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1817) [network and implement this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1818) [receive function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1819) [Here, we start by calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1824) [connection.receive and passing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1826) [it into completion handler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1828) [When data comes in off of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1829) [connection, we'll see if we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1830) [not yet connected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1832) [If we weren't connected, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1833) [probably that handshake that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1835) [client is starting by sending.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1837) [We'll simply turn right around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1840) [and call connection.send,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1841) [passing that same content back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1843) [so it will be echoed over to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1845) [client.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1846) [We then remember that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1847) [connected, and on all subsequent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1848) [received callbacks, we will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1850) [simply tell the rest of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1852) [application that we received](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1853) [this frame, and it should send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1855) [it up to the display pipeline so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1857) [that we can see it on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1858) [that we can see it on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1858) [screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1861) [Finally, if there were no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1861) [errors, we call receive again so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1863) [that we receive subsequent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1865) [frames and send them up to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1866) [display to book together a video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1868) [from each of these individual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1869) [images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1871) [So that's it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1872) [We've got our UDPClient, we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1873) [got our UDPServer, let's try it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1875) [out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1877) [I'm going to run the client on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1880) [my phone here, and I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1882) [run the server on my Mac so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1884) [can see it on the big screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1885) [Here, the server just came up,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1887) [and we see that it's advertising](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1890) [as Demo Mac, which is where I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1892) [told the rest of the system to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1894) [just give me the name.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1896) [That's on my phone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1898) [If I tap connect, all of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1899) [sudden, I can see video frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1901) [being streamed across the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1904) [network over UDP Live.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1905) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1908) [So here we just saw how quickly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1918) [So here we just saw how quickly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1918) [I was able to bring up a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1920) [UDPClient that could connect to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1921) [a bonjour service, it can send a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1923) [handshake, wait for that to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1926) [processed, take the video frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1928) [coming from the camera, and ship](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1930) [them across the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1931) [The server side brought up a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1934) [bonjour listener.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1936) [It advertised a service, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1939) [received incoming connections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1940) [responded to the handshake, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1942) [sent them all to the display so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1943) [that we could see them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1945) [And now to take you through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1947) [optimizing that data transfer in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1948) [a little more detail, I'd like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1949) [to invite Tommy back up to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1950) [stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1952) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1953) [&gt;&gt; Thank you, Eric.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1958) [It was a really cool demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1960) [It's super easy to get this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1962) [going, and so now we've covered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1963) [the basics, and we know how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1964) [establish connections outbound,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1966) [how to receive connections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1968) [inbound, but the real key part](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1969) [of Network.framework that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1972) [going to be the killer feature](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1973) [here is the way that it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1974) [optimize your performance and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1976) [that we can go beyond what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1977) [sockets was able to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1978) [sockets was able to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1978) [And I want to start with the way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1980) [that you in your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1983) [interact with your networking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1985) [connections in the most basic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1986) [way, which is just sending and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1988) [receiving data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1990) [And these calls are very simple,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1992) [but the nuances about how you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1995) [handle sending and receiving and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1997) [really make a huge difference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1998) [for the responsiveness of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2000) [app and how much buffering there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2002) [is going on on the device and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2003) [the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2005) [So the first example I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2006) [walk through is when we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2009) [sending data, in the application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2010) [very much like what Eric just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2012) [showed you, something that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2014) [live streaming, something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2015) [is generating data on the fly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2016) [But in this case, let's talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2019) [about when we're sending it over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2020) [a TCP stream, a TCP stream that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2022) [can back up on the network, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2024) [has a certain window that it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2026) [send.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2027) [So how do we handle this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2028) [So here's a function to send a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2031) [single frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2033) [This is some frame of data that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2034) [your application has generated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2036) [And the way that you send it on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2038) [And the way that you send it on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2038) [the connection is you simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2040) [call connection.send and pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2041) [that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2044) [Now if you're used to using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2045) [sockets to send on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2046) [connections, you either are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2049) [using a blocking socket, in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2051) [which case if you have a hundred](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2053) [bytes of data to send, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2055) [there's not room in the send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2057) [buffer, it'll actually block up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2058) [your thread and wait for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2060) [network connection to drain out,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2062) [or if you're using a nonblocking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2065) [socket, that send may actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2067) [not send your complete data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2070) [It'll say, oh, I only sent 50](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2071) [bytes of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2073) [Come back some other time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2073) [send the next 50 bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2074) [This requires you and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2076) [application to handle a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2077) [state about how much you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2078) [actually done of sending your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2080) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2083) [So the great thing about a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2084) [network connection is you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2085) [simply send all of your data at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2086) [once, and you don't have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2088) [worry about this, and it doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2089) [block anything.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2091) [But then, of course, you have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2093) [handle what happens if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2094) [connection is backing up,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2095) [because we don't want to just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2097) [send a ton of data unnecessarily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2098) [send a ton of data unnecessarily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2098) [into this connection if you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2100) [a really responsive, live stream](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2102) [of data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2104) [And the key here is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2106) [callback block that we give you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2108) [It's called contentProcessed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2110) [And we'll invoke it whenever the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2112) [network stack consumes your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2115) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2117) [So this doesn't mean that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2117) [data has necessarily been sent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2118) [out or acknowledged by the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2120) [side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2121) [It's exactly equivalent to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2122) [time in which a blocking socket](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2123) [call would return to you, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2125) [when the nonblocking socket call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2127) [was able to consume all of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2129) [bytes that you sent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2130) [And in this completion handler,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2132) [there are two things you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2135) [check for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2136) [First, you can check for an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2137) [error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2139) [If there is an error, that means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2139) [something went wrong while we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2141) [were trying to send your data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2142) [generally it indicates a overall](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2143) [connection failure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2145) [Then, if there wasn't and error,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2147) [this is the perfect opportunity](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2149) [to go and see if there's more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2152) [data from your application to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2153) [generate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2155) [So if you're generating live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2156) [data frames, go and fetch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2158) [data frames, go and fetch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2158) [another frame from the video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2160) [stream, because now is the time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2161) [when you can actually enqueue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2162) [the next packets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2163) [This allows you to pace all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2165) [your data out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2166) [And so as you see here, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2168) [essentially form a loop of using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2170) [this asynchronous send callback](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2172) [to continue to drain data out of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2174) [our connection and handle it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2177) [really elegantly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2178) [The other thing I want to point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2182) [out about sending is the trick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2183) [that Eric showed earlier that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2185) [great for UDP applications that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2187) [are sending multiple datagrams](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2189) [all at one time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2191) [So if you have a whole bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2193) [little tiny pieces of data that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2195) [you need to send out or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2196) [essentially individual packets,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2197) [you can use something that we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2200) [added called connection.batch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2201) [So a UDP socket previously could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2203) [only send one packet at a time,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2206) [and this could be very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2208) [inefficient because if I have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2209) [send a hundred UDP packets,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2211) [these are each a different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2213) [system call, a different copy,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2214) [and a context switch down into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2216) [the kernel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2217) [But if you call batch within](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2219) [But if you call batch within](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2219) [that block, you can call send or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2221) [actually receive as many times](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2223) [as you want, and the connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2225) [will hold off processing any of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2226) [the data until you finish the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2228) [batch block and will try to send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2230) [all of those datagrams all as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2232) [one single batch down into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2234) [system, ideally have just one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2236) [context switch down into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2239) [kernel, and send out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2240) [interface.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2242) [This allows you to be very, very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2243) [efficient.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2244) [So that's sending.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2245) [Receiving, like sending, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2248) [asynchronous, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2251) [asynchronous nature gives you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2252) [the back pressure that allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2254) [you to pace your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2255) [So in this case, I have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2258) [TCP-based protocol, and it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2260) [very common for apps when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2263) [they're reading to essentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2264) [want to be reading some type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2266) [record format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2268) [Let's say that your protocol has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2269) [a header of 10 bytes that tells](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2272) [you some information about what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2275) [you're about to receive, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2276) [the length of the body that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2277) [you're about to receive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2278) [And so you want to read that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2280) [header first and then read the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2281) [rest of your content, and maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2283) [your content's quite long.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2284) [It's a couple megabytes let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2285) [say.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2287) [Traditionally with a socket, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2289) [may try to read 10 bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2290) [You may get 10 bytes, you may](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2292) [get less.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2293) [You have to keep reading until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2294) [you get exactly 10 bytes to read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2295) [your header.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2296) [And then you have to read a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2298) [couple megabytes, and you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2299) [read some, and you'll get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2301) [whole bunch of different read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2301) [calls and essentially go back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2302) [and forth between your app and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2304) [the stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2305) [With an NWConnection, when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2308) [call receive, you provide the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2310) [minimum data that you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2314) [receive and the maximum data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2315) [So you could actually specify if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2317) [you want to receive exactly 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2318) [bytes because that's your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2320) [protocol, you can just say, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2321) [want a minimum of 10 and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2323) [maximum of 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2324) [Give me exactly 10 bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2325) [And we will only call you back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2327) [when either there was an error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2329) [in reading on the connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2330) [overall or we read exactly those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2331) [10 bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2334) [Then you can easily just read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2335) [out whatever content you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2337) [for your header, read out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2339) [for your header, read out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2339) [length, and then let's say you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2340) [want to read a couple megabytes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2342) [and you essentially do the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2344) [thing to read your body, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2345) [just pass, well I want to read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2348) [exactly this amount for my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2349) [connection, and this allows you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2351) [to not go back and forth between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2352) [the stack and your app but just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2353) [have a single callback of when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2355) [all of your data is ready to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2357) [So it's a really great way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2359) [optimize the interactions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2361) [Beyond sending and receiving,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2363) [there are a couple of advanced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2366) [options that I'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2367) [highlight in your network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2368) [parameters that allow you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2370) [configure your connection to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2372) [very good startup time as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2374) [as behavior on the network when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2377) [you're actually sending and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2378) [receiving.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2379) [So the first one is one that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2381) [we've talked about many times](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2382) [here at WWDC, which is ECN.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2383) [This is explicit congestion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2386) [notification.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2388) [It gives you a way to smooth out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2390) [your connection by having the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2392) [network let the end host know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2394) [when there's congestion on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2398) [network so we can pace things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2399) [network so we can pace things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2399) [out very well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2400) [The great thing is that ECN is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2402) [enabled by default on all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2404) [your TCP connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2406) [You don't have to do anything.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2407) [But it's been very difficult in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2409) [the past to use ECN with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2410) [UDP-based protocols.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2413) [And so I'd like to show you how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2415) [you can do that here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2416) [The first thing you do is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2419) [you create an ipMetadata object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2420) [ECN is controlled by flags that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2423) [go in an IP packet, and so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2426) [have this ipMmetadata object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2428) [that allows you to set various](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2429) [flags on a per-packet basis, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2431) [you can wrap this up into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2434) [context object, which describes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2435) [all of the options for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2438) [various protocols that you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2439) [to associate with a single send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2440) [as well as the relative priority](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2443) [of that particular message.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2445) [And then you use this context as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2448) [an extra parameter into the send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2450) [call besides just your content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2452) [So now when you send this, any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2455) [packet that's going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2457) [generated by this content will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2458) [generated by this content will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2458) [have all the flags that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2460) [wanted marked.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2462) [So it's really easy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2463) [And you can also get these same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2465) [flags whenever you're receiving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2467) [on a connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2468) [You'll have the same context](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2469) [object associated with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2470) [receives, and you'll be able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2471) [read out the specific low-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2473) [flags that you want to get out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2475) [Similar, we have service class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2479) [This is a property that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2482) [available also in URLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2484) [that defines the relative](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2487) [priority of your traffic, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2488) [this affects the way that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2491) [traffic is queued on the local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2493) [interfaces when we're sending as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2494) [well as how the traffic works on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2496) [Cisco Fastlane networks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2498) [So you can mark your service](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2499) [class as a property on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2503) [entire connection by using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2504) [service class parameter in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2507) [parameter's object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2509) [In this case, we show how to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2511) [the background service class,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2513) [and this is a great way to mark](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2515) [that your connection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2517) [relatively low priority.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2518) [We don't want it to get in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2520) [way of user interactive data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2521) [So we really encourage you if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2524) [you have background transfers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2525) [mark them as a background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2526) [service class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2528) [But you can also mark service](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2530) [class on a per packet basis for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2532) [those UDP connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2534) [Let's say that you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2536) [connection in which you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2537) [both voice and signaling data on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2540) [the same UDP flow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2542) [In this case, you can create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2544) [that same IP metadata object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2546) [that we introduced before, mark](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2548) [your service class now instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2550) [of the ECN flags, attach it to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2552) [context, and send it out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2554) [And now you're marking the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2556) [priority on a per-packet basis.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2557) [The other way that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2560) [optimize your connections is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2563) [reduce the number of round trips](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2566) [that it takes to establish them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2567) [So here I want to highlight two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2570) [approaches to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2571) [One is enabling fast open on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2573) [your connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2575) [So TCP fast open allows you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2576) [send initial data in the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2579) [send initial data in the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2579) [packet that TCP sends out, in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2582) [the SYN, so that you don't have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2583) [to wait for a whole handshake to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2585) [start sending your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2587) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2589) [Now in order to do this, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2590) [need to enter into a contract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2591) [from your application with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2593) [connection saying that you will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2595) [be providing this initial data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2597) [to send out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2599) [So to enable this, you mark](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2600) [allow fast open on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2602) [parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2603) [You then create your connection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2604) [and then before you can call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2607) [start, you can actually call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2608) [send and get your initial data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2610) [sent out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2613) [Now I want to point out here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2613) [that the completion handler here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2616) [is replaced by a marker that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2618) [this data is item potent, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2619) [item potent means that the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2621) [is safe to be replayed because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2623) [initial data may get resent over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2624) [the network, and so you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2626) [want it to have side effects if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2628) [it gets resent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2629) [Then, you simply call start, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2632) [as we're doing the connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2635) [bring up, all the attempts that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2636) [we mentioned before, we will use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2638) [that initial data if we can to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2639) [that initial data if we can to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2639) [send in TCP Fast Open.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2641) [There is one other way I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2644) [point out to use TCP Fast Open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2646) [that doesn't require your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2649) [application to send it's own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2650) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2652) [If you're using TLS on top of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2654) [TCP, the first message from TLS,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2656) [the client hello, can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2660) [be used as the TCP Fast Open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2661) [initial data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2664) [If you want to just enable this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2665) [and not provide your own Fast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2667) [Open data, simply go into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2669) [TCP-specific options and mark](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2672) [that you want to enable Fast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2674) [Open there, and it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2675) [automatically grab the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2677) [message from TLS to send out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2679) [during connection establishment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2681) [There's another thing that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2686) [can do to optimize your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2687) [connection establishment and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2689) [save a roundtrip, and this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2690) [something that Stuart mentioned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2692) [in the previous session, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2693) [we're calling Optimistic DNS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2695) [This allows you to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2698) [This allows you to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2698) [previously expired DNS answers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2700) [that may have had a very short](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2702) [time to live, and try connecting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2704) [to them while we do a new DNS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2707) [query in parallel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2710) [So if the addresses that you had](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2713) [previously received that did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2716) [expire are still valid, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2718) [mark the expired DNS behavior to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2721) [be allow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2723) [When you call start, we'll try](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2724) [connecting to those addresses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2726) [first and not have to wait for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2727) [the new DNS query to finish.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2729) [This can shave off a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2731) [set-up time from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2733) [connection, but if your server](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2734) [has indeed moved addresses,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2737) [because we're trying multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2739) [different connection options, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2740) [that first one doesn't work, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2743) [will gracefully wait for the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2744) [DNS query to come back and try](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2747) [those addresses as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2748) [So this is a very simple way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2751) [that if it's appropriate for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2753) [your server configuration, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2754) [can get a much faster connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2756) [establishment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2757) [The next area I want to talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2761) [about for performance is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2763) [something that you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2764) [actually need to do anything in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2765) [your app to get.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2766) [This is something that you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2768) [totally for free whenever you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2769) [use URLSession or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2771) [Network.framework connections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2773) [and this is user-space](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2774) [networking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2776) [So this is something that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2777) [introduced last year here at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2778) [WWDC, and it's enabled on iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2780) [and tvOS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2783) [This is where we're avoiding the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2784) [socket layer entirely, and we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2787) [moved the transport stack into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2788) [your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2791) [So to give you an idea of what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2792) [this is doing, I want to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2793) [with what the legacy model of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2795) [the stack generally is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2797) [So let's say that you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2799) [receiving a packet off the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2800) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2802) [It's the WiFi interface.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2802) [That packet will come into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2804) [driver, will be sent into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2805) [TCP receive buffer within the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2808) [kernel, and then when your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2810) [application reads on a socket,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2813) [that's going to do a context](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2816) [switch and copy the data up from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2817) [the kernel into your app, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2819) [the kernel into your app, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2819) [then generally if you're doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2821) [TLS, it will have to get another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2822) [transformation to decrypt that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2824) [data before you can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2825) [send it up to the application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2827) [So how does this look when we do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2829) [user space networking?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2832) [So as you can see, the main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2833) [change is that we've moved the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2837) [transport stack, TCP and UDP, up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2839) [into your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2841) [So what does this give us?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2843) [Now, when a packet comes in off](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2845) [the network, comes into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2846) [driver like before, but we move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2847) [it into a memory mapped region](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2849) [that your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2852) [automatically can scoop packets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2854) [out of without doing a copy,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2856) [without doing extra contexts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2858) [switch, and start processing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2859) [packets automatically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2861) [This way the only transformation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2862) [we're doing is the decryption](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2864) [that we have to do anyway for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2865) [TLS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2868) [This really can reduce the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2869) [amount of CPU time that it takes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2870) [to send and receive packets,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2873) [especially for protocols like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2875) [UDP in which you're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2876) [sending a lot of packets back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2878) [and forth directly from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2879) [and forth directly from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2879) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2881) [So to show how this works and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2882) [the effect it can have, I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2884) [to show you a video that was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2885) [taken using the same app that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2888) [Eric showed you earlier to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2891) [demonstrate UDP performance with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2892) [user space networking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2894) [So in this example, we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2896) [to have two videos running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2898) [simultaneously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2900) [The device on the left is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2901) [receiving a video stream from an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2905) [application that was written](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2908) [using sockets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2910) [And the device on the right is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2912) [going to be receiving exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2913) [the same video stream from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2915) [device that has an app written](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2917) [using Network.framework so it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2920) [can take advantage of the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2922) [space networking stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2923) [And in this case, we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2925) [streaming the video.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2927) [It's just raw frames.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2929) [It's not compressed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2930) [It's not great quality or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2931) [anything, but there's a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2932) [packets going back and forth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2933) [And we chose specifically for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2935) [this demonstration to not lower](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2937) [this demonstration to not lower](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2937) [the quality when we hit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2940) [contention or when we couldn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2941) [send packets fast enough or to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2943) [not drop anything but just to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2944) [slow down if we had to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2946) [Now this is probably not what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2948) [your app would do in real life,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2949) [but it highlights exactly the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2950) [difference in the performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2951) [between these two stacks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2953) [So let's see it right now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2956) [So there's exactly the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2962) [data, exactly the same frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2963) [being sent over as fast as they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2965) [possibly can, across this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2966) [network, and we see the one on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2968) [the right is pretty easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2972) [outstripping the one on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2973) [left.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2975) [And in fact, if you look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2976) [difference, it's 30 percent less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2978) [overhead that we're viewing on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2980) [the receiver side only.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2981) [And this is due to the huge](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2984) [difference that we see in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2985) [CPU percentage that it takes to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2987) [send and receive UDP packets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2990) [when you compare sockets and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2992) [user space networking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2993) [Now, of course this is just one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2995) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2996) [This is not going to be what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2996) [every app is going to be like,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2998) [because you're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2999) [because you're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2999) [compressing differently.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3000) [You're going to be already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3001) [trying to make your connections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3002) [more efficient.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3003) [But if you have an app that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3005) [generating live data, especially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3006) [if you're using UDP to send and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3008) [receive a lot of packets, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3010) [invite you to try using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3011) [Network.framework within your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3013) [app and run it through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3015) [instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3016) [Measure the difference in CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3017) [usage that you have when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3019) [using Network.framework versus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3021) [sockets, and I think you'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3022) [really happy with what you see.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3023) [So the last topic we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3030) [talk about today is how we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3031) [solve the problems around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3034) [network mobility, and this is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3035) [key area that we're trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3037) [solve with Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3038) [And the first step of this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3042) [just making sure that we start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3045) [connections gracefully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3046) [So we already mentioned this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3048) [but I want to recap a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3049) [bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3050) [The waiting state is the key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3051) [thing to handle network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3054) [transitions when your connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3055) [is first coming up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3058) [It will indicate that there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3059) [It will indicate that there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3059) [lack of connectivity or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3060) [connectivity changed while you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3062) [were in the middle of doing DNS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3064) [or TCP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3065) [We really encourage you please](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3066) [avoid using APIs like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3068) [reachability to check the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3071) [network state before you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3073) [establish your connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3074) [That will lead to race](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3076) [conditions and may not provide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3077) [an accurate picture of what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3079) [actually happening in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3080) [connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3081) [And if you need to make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3082) [that your connection does not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3085) [establish over a cellular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3086) [network, don't check up front is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3087) [the device currently on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3091) [cellular network, because that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3092) [could change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3093) [Simply restrict the interface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3095) [types that you want to use using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3096) [the NWParameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3098) [So once you've started your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3101) [connection and you're in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3102) [ready state, there are a series](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3104) [of events that we will give you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3105) [to let you know when the network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3107) [has changed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3109) [The first one is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3111) [connection viability.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3113) [So viability means that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3115) [connection is able to send and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3118) [receive data out the interface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3119) [receive data out the interface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3119) [it has a valid route.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3122) [So to give a demonstration of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3124) [this, let's say that you started](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3126) [your connection when the device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3128) [was associated with a WiFi](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3130) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3131) [Then, your user walks into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3133) [elevator, they don't have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3136) [signal anymore.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3137) [At this point, we will give you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3139) [an event, letting you know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3140) [your connection is no longer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3143) [viable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3144) [So what should you do at this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3145) [point?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3147) [Two things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3148) [We recommend that if it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3150) [appropriate for your app, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3151) [can let the user know that they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3152) [currently have no connectivity.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3154) [If they're trying to send and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3156) [receive data, it's not going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3157) [work right now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3158) [But, don't necessarily tear down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3161) [your connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3163) [At this point, you don't have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3164) [any better interface that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3166) [could use anyway, and that first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3167) [WiFi interface may come back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3169) [Oftentimes, if you walk back out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3171) [of an elevator onto the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3173) [WiFi network, your connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3174) [can resume right where you left](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3176) [off.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3177) [So the other event that we give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3178) [So the other event that we give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3178) [you is the better path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3181) [notification.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3183) [So let's take that same scenario](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3185) [in which you connected over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3187) [WiFi network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3188) [You walk out of a building let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3190) [say, and now you no longer have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3192) [WiFi, but you do have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3194) [cellular network available to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3195) [you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3196) [At this point, we'll let you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3197) [know two things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3198) [First, that your connection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3200) [not viable like before, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3201) [we'll also let you know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3203) [there is now a better path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3205) [available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3206) [If you connected again, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3207) [would be able to use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3209) [cellular network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3210) [And the advice here is to, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3211) [it's appropriate for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3215) [connection, attempt to migrate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3216) [to a new connection, if you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3218) [resume the work that you were](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3220) [doing before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3222) [But only close the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3224) [connection once that new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3225) [connection is fully ready.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3227) [Again, the WiFi network may come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3228) [back, or the connection over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3230) [cellular may fail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3232) [And the last case I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3234) [highlight here is a case in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3237) [which you connect initially over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3239) [which you connect initially over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3239) [the cellular network, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3241) [the user walks into a building](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3242) [and now they have WiFi access.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3244) [In this case, your connection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3247) [the original one, is totally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3248) [fine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3249) [You're still viable, but you now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3250) [also have a better path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3252) [available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3253) [In this case, again, if you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3254) [migrate your connection, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3257) [probably a good time to try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3259) [establish a new connection and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3261) [move your data over.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3263) [That will save the user their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3264) [data bill.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3266) [But, continue to use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3268) [original connection until you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3270) [have the new one fully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3271) [established.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3272) [Just to show how this looks in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3274) [code, we have the viability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3275) [update handler that you can set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3277) [in your connection, we'll give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3279) [you a boolean back to let you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3280) [know whenever you're viable or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3281) [not, and a better path update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3282) [handler to let you know when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3285) [there's a better path available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3287) [or is no longer available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3289) [And now the better solution to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3293) [all of this to handle network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3295) [mobility is something that we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3296) [talked about in previous years,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3298) [which is multipath connections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3300) [Multipath TCP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3302) [So if you were able to on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3304) [server enable Multipath TCP and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3305) [you can enable it on the client](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3307) [side with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3310) [multipathServiceType in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3311) [parameters, then your connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3313) [will automatically migrate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3315) [between networks as they come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3316) [and go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3318) [It's a great seamless experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3319) [that doesn't require any work in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3320) [your application to handle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3322) [And this is also the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3324) [service type that's available in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3326) [URLSession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3327) [A couple points I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3329) [highlight here, specific to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3331) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3333) [If you restrict the interface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3335) [types that you allow to be used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3337) [with your NWParameters that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3339) [apply to MPTCP, so you can still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3341) [not want to use the cellular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3343) [network with a multipath](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3345) [connection, and instead we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3346) [just seamlessly migrate between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3348) [different WiFi networks as they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3350) [become available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3351) [Also, the connection viability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3354) [handler that I mentioned before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3356) [is slightly different from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3358) [Multipath TCP because whenever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3359) [Multipath TCP because whenever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3359) [we change a network, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3361) [automatically move for you, your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3362) [connection is only not viable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3365) [when you have no network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3366) [available to you at all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3367) [So between waiting for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3373) [connectivity, viability, better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3375) [path, MPTCP, we really hope that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3379) [all of the use cases in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3382) [apps for using tools like SC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3383) [Network Reachability to check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3385) [network changes manually have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3388) [been replaced.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3390) [However, we do recognize that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3391) [there are some scenarios in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3393) [which you still want to know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3395) [what's the available network,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3397) [when does it change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3398) [For that Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3400) [offers a new API called the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3402) [NWPathMonitor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3404) [So the Path Monitor instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3407) [watching the reachability and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3410) [trying to predict the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3411) [reachability of a given host](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3412) [simply lets you know what is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3414) [current state of the interfaces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3415) [on your device and when do they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3417) [change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3419) [It allows you to iterate all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3421) [the interfaces that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3422) [connect over in case you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3424) [make a connection over each one,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3426) [and it will let you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3428) [whenever those networks do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3430) [change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3431) [So this can be very useful if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3433) [you want to update your UI to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3434) [let the user know, are they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3436) [connected at all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3437) [And as Stuart mentioned in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3438) [previous session, there could be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3441) [scenarios in which the user has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3442) [a long form to fill out and they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3445) [don't necessarily want to go and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3447) [fill out something just to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3448) [realize that there's no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3449) [connectivity anyway.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3450) [So use Network Path Monitor in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3452) [any of these scenarios in which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3454) [just having a waiting connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3457) [is not enough.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3458) [So between all of these things,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3459) [we'd really like to see people](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3461) [move off of reachability and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3462) [handle network transitions more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3464) [gracefully than ever before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3466) [So with that, I'd like to invite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3468) [Josh back up to the state to let](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3472) [you know how you can get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3473) [involved and start adopting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3474) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3476) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3477) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3477) [&gt;&gt; Thank you, Tommy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3482) [So I've got a great new API for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3483) [you that we think you're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3485) [to love.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3486) [We'd like to talk about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3488) [things that you can do to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3489) [using it today, but first I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3490) [to talk about a few things that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3492) [we'd like you to stop doing so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3493) [we can really take advantage of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3494) [the new technologies like user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3496) [space networking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3497) [If you're on macOS, and you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3499) [a Network Kernel Extension, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3501) [there's something you're doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3502) [in that Network Kernel Extension](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3503) [that you can't do any other way,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3504) [please get in touch with us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3506) [right away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3507) [We need to provide you a better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3508) [alternative because Network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3509) [Kernel Extensions are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3510) [compatible with User Space](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3511) [Networking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3513) [We wanted to give you a heads-up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3514) [that with URLSession, FTP and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3516) [file URLs are no longer going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3519) [be supported for Proxy Automatic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3520) [Configuration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3522) [Going forward, the only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3523) [supported URL schemes will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3524) [HTTP and HTTPS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3526) [There are a number of APIs at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3527) [the CoreFoundation layer that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3530) [would like you to stop using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3532) [They will be deprecated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3534) [eventually.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3534) [They are not yet marked as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3535) [deprecated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3536) [These are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3538) [CFStreamCreatePairWith, anything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3539) [CFStreamCreatePairWith, anything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3539) [related to sockets as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3541) [CFSocket.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3543) [These cannot take advantage of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3544) [lot of the connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3546) [establishment that we've put in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3547) [there with the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3548) [Network.framework, and they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3549) [can't take advantage of the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3550) [User Space Networking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3551) [So we really want you to move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3552) [off of these to take advantage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3554) [of the incredibly robust](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3555) [connectivity improvements that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3557) [you'll get with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3558) [Network.framework and URLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3559) [and the improved performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3561) [There are some foundation APIs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3563) [as well that we'd like you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3565) [move away from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3566) [If you're using any of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3567) [NSStream, NSNetService, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3569) [NSSocket for APIs, please move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3571) [to Network.framework or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3574) [URLSession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3575) [Finally, if you're using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3577) [SCNetworkReachability, we feel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3578) [that the Wait for Connectivity](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3580) [model is a much better model, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3581) [we'd really like you to move to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3583) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3585) [And for those few cases where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3586) [Wait for Connectivity isn't the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3587) [right answer, NWPathMonitor is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3588) [much better solution going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3590) [forward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3591) [So now that we've talked about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3592) [some things we'd like you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3594) [stop doing, I want to focus on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3595) [the things we really want to see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3596) [you do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3597) [Going forward, the preferred](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3598) [Going forward, the preferred](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3598) [APIs on our platforms for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3600) [networking are URLSession and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3601) [Network.framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3603) [URLSession is really focused on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3604) [HTTP, but Stream Task provides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3606) [pretty simple access to TCP and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3609) [TLS connections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3611) [If you need something more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3613) [advanced, Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3614) [gives you great support for TCP,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3616) [TLS, UDP, DTLS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3618) [It handles listening for inbound](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3621) [connections as well as outbound](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3622) [connections, and we've got Path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3623) [Monitor to handle some of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3625) [mobility stuff.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3626) [Next steps, we really want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3628) [see you adopt these, adopt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3630) [Network.framework and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3632) [URLSession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3633) [Your customers are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3635) [appreciate how much better your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3635) [connections, how much more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3637) [reliable your connections are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3638) [established, and they'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3639) [appreciate the longer battery](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3640) [life from the better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3642) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3642) [While you're working on these,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3645) [focus on how you're handling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3646) [your sending and receiving to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3648) [really optimize that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3650) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3650) [And take a lot of time to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3652) [that support for the viability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3653) [and better route changes in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3655) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3657) [It can make all the difference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3657) [for providing a seamless](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3659) [for providing a seamless](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3659) [networking experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3660) [Now we know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3662) [Network.framework doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3663) [support UDP Multicast yet, so if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3664) [you're doing UDP Multicast, we'd](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3666) [really like to understand your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3667) [use cases so we can take those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3668) [into account going forward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3670) [In addition, if you have any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3672) [other questions or enhancement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3673) [requests, we'd love to hear from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3674) [you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3676) [Contact developer support or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3677) [better yet, meet us in one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3678) [the labs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3680) [We have a lab after lunch at 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3680) [p.m. and another one tomorrow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3682) [morning at 9 a.m. For more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3683) [information, see this URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3686) [Don't forget the labs tomorrow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3689) [morning and after lunch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3690) [Thank you so much and have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3691) [great WWDC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3693) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3694)