# Introducing Network.framework: A modern alternative to Sockets

## Summary
The new Network.framework API gives you direct access to the same high-performance user-space networking stack used by URLSession. If you're considering using Berkeley Sockets in your app or library, learn what better options are available to you.

## Info
* Frameworks
* WWDC 2018 - Session 715 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/

## Text
 [（Network.framework简介
套接字的现代替代品）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=17) [（演讲715）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=19) [早上好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=20) [我叫Josh Graessley](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=22) [我很高兴今天早上能来到这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=24) [向你介绍
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=26) [Network.framework
是套接字的现代替代品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=30) [今天我们将讨论现代化传输API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=33) [这将提供一些背景知识以便你理解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=37) [Network.framework是什么
以及它如何结合到系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=39) [以及你的app是否应该使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=43) [我们将通过引导你完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=47) [第一次连接来向你介绍其API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=48) [我们将讨论如何使用此API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=52) [来真正优化你的数据传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=54) [并提供远超套接字所能提供的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=56) [并提供远超套接字所能提供的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=56) [我们将讨论这个API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=61) [如何帮助你应对
一些复杂的移动性挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=62) [最后我们将提供一些
关于你如何参与进来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=65) [并开始使用的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=68) [首先…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=70) [我想花一点时间谈论
现代化传输API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=71) [当我说传输API时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=75) [我在谈论这样的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=77) [即它可以让你在网络上两个端点之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=79) [发送和接收任意数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=81) [这是一个相当广泛的定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=83) [有很多API可能属于此类别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=85) [也许其中应用最广泛的就是套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=90) [我们使用套接字已经有30多年了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=92) [而且我认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=95) [说套接字改变了世界并不夸张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=96) [但世界一直在变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=99) [其结果是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=101) [使用套接字为今天的互联网
编写app真的很难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=102) [在三个主要领域中
若想很好地使用套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=107) [非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=110) [第一个是建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=113) [有很多原因导致使用套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=115) [来建立连接非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=119) [来建立连接非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=119) [首先 套接字连接到地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=121) [所以大多数时候你需要有一个主机名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=124) [并且你必须将该主机名
解析为一个地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=126) [当你这样做时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=130) [你通常会得到多个地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=131) [你会得到一些IPv4地址
一些IPv6地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=133) [现在你遇到了这个挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=138) [你应该尝试连接哪个地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=139) [以什么顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=141) [你在尝试下一个之前等待多久](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=142) [你可以花费数年时间来完善这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=144) [我知道
因为我们就是这样做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=146) [一旦你解决了双协议栈主机问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=150) [你还会遇到更多其它问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=153) [有些网络使用一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=155) [叫做代理自动配置或PAC的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=157) [在这些网络上
你会得到一个JavaScript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=160) [并且你必须将一个URL
传递给JavaScript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=162) [然后JavaScript
将运行并返回一结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=165) [其中说明你可以直接连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=167) [或是你必须使用这个SOCKS代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=170) [或者那个HTTP连接代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=172) [这样你的app就必须
支持SOCKS代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=174) [和HTTP连接代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=177) [这真的很难做好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=179) [这真的很难做好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=179) [最困难的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=181) [是你可能没有其中一个网络以供测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=183) [所以你可能会收到
一位客户的错误报告](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=185) [他们可能会抱怨它在他们的环境下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=188) [无法正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=190) [你可能想要添加代码来解决问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=192) [但…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=194) [尽管你修改了代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=195) [你却无法测试它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=196) [你最终必须构建整个环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=198) [来重现其所在的相同环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=200) [这是一个真正的挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=202) [所以用套接字连接真的很难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=204) [使用套接字的第二个挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=208) [是数据传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=211) [使用套接字传输数据非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=212) [这有很多原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=215) [主要的问题是读写模型本身](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=217) [如果你使用阻塞套接字
那很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=222) [但是你要绑定一个线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=225) [而在等待读取或写入数据时
绑定一个线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=227) [真的不是一个好主意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=229) [你可以切换到非阻塞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=232) [但最终你会遇到更多其它挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=234) [当你使用非阻塞时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=237) [你可能告诉内核
我想要100个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=238) [你可能告诉内核
我想要100个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=238) [而内核可能会回答说
我现在只有10个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=240) [你为何不稍后再回来呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=243) [你必须建立一个状态机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=244) [以跟踪你读取的字节数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=246) [与你想要读取的字节数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=247) [这个工作量可能会很大
而且要想使其表现良好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=249) [可能是一个真正的挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=251) [最重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=254) [你真的不应该直接读写套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=255) [因为你应该使用安全传输层协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=258) [即TLS之类的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=260) [套接字不支持TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=264) [所以你可能正在使用其它一些库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=265) [它们会为你处理TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=268) [并替你读取和写入套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=271) [或者你也可以编写
该库和套接字之间的胶水代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=273) [而且你必须弄清楚如何预先放入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=276) [那些复杂的连接逻辑
并让所有这些正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=277) [这里有很多东西可能非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=281) [最后 使用套接字对移动性
带来极大的挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=285) [这有多种原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=288) [我认为这很大程度上归结于
当套接字刚出现时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=291) [许多设备需要不止一个人来移动它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=296) [而且它们只用一根网线连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=298) [而且它们只用一根网线连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=298) [并且它们只有一个静态IP地址
一切都很稳定和简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=300) [而今天我们的口袋里
装有这些功能强大的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=304) [其可能同时开启多射频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=308) [并且其中一些正在从一个网络
迁移到另一个网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=311) [而你的app必须很好地处理
所有这些转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=314) [来为你的客户提供无缝体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=317) [套接字无法帮你解决此问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=322) [你可以使用路由套接字
但这非常非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=325) [我们认为传输API可以做得更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=328) [幸运的是 在我们的平台上
作为app开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=332) [你在URLSession中
有一个很棒的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=335) [URLSession
为你处理所有这些问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=339) [它真正专注于HTTP
但它也有流任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=343) [它能为你提供
对TCP和TLS连接的原始访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=346) [现在你可能正在看这幅图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=351) [并且如果你没有通过查看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=352) [WWDC app中的描述而作弊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=355) [你可能认为URLSession
是基于与你自己使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=356) [你可能认为URLSession
是基于与你自己使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=356) [相同的原语所构建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=360) [但事实并非如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=363) [URLSession建立在我们称之为
Network.framework的基础之上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=365) [URLSession
关注的是所有的HTTP内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=370) [它将很多传输功能委托给
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=373) [我们研发
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=380) [已经有许多年了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=382) [在支持URLSession方面
我们学到了很多东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=384) [并且我们把很多这些经验
带到了IETF](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=386) [我们的许多工程师经常参加IETF](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=389) [并与其它公司的工程师见面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=393) [他们讨论了许多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=395) [我们在传输服务工作组中
学到的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=396) [在这些讨论中
我们得到了一些很好的反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=399) [我们研究这些反馈
并基于此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=401) [改进
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=403) [我们很高兴地宣布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=405) [今年你的app
现在可以直接利用这个库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=407) [我们知道人们喜欢套接字的原因之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=418) [我们知道人们喜欢套接字的原因之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=418) [是它给予人们
对几乎所有东西的精细控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=421) [而他们真的不想失去这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=425) [因此我们在开发
Network.framework时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=427) [我们希望确保默认情况下
它能做正确的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=428) [而套接字不会这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=432) [但同时它也给了你
套接字的所有功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=433) [并且它是以一种渐进的方式
即你转动的旋钮越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=436) [它变得越复杂](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=440) [它为你提供所需的所有功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=442) [但你不必为复杂性付出代价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=444) [除非你真的需要它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=445) [Network.framework
具有令人难以置信的智能连接搭建过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=450) [它能处理双协议栈用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=454) [它能处理仅IPv6网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=456) [它能处理PAC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=458) [它也能处理代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=459) [它会…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=461) [帮助你连接在不使用它的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=462) [很难处理的网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=465) [它具有令人难以置信的
优化数据传输路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=467) [其性能要远远超过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=470) [套接字可以达到的效果
稍后Tommy会介绍一下这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=472) [它支持内置安全性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=476) [它默认支持TLS和DTLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=478) [它默认支持TLS和DTLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=478) [它使用起来非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=481) [它对移动性有很好的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=484) [它提供有关网络更改的通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=486) [其与你的app正在建立的连接相关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=488) [它可以在iOS、macOS
和tvOS上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=494) [作为带有自动引用计数的
C API使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=499) [它很容易在Objective C中使用
且它还有令人难以置信的Swift API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=500) [我想把话筒交给
Tommy Pauly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=506) [他会引导你完成你的第一次连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=509) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=511) [好的 大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=518) [我叫Tommy Pauly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=520) [我在Apple的网络团队工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=521) [我相信很多人都很高兴能够看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=524) [如何开始在你的app中
使用Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=528) [开始学习并立即尝试的最好方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=533) [就是尝试建立你的第一个连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=535) [你将从本地设备建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=538) [你将从本地设备建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=538) [到你的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=541) [或本地网络上的其它对等设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=542) [但你可能在想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=547) [哪种连接适合使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=548) [Network.framework呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=551) [有什么用例？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=552) [让我们首先探讨一些可能正在使用
套接字的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=554) [它们若能在以后利用
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=560) [将会大有裨益](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=563) [我要强调的第一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=566) [是游戏app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=569) [游戏app通常使用UDP
在两台设备间实时发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=570) [关于游戏状态的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=575) [它们非常重视优化延迟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=579) [并确保没有任何滞后
或任何被丢弃的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=582) [如果你有这样的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=585) [你会爱上
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=588) [因为它允许你真正优化UDP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=590) [发送和接收比以往更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=592) [以及具有尽可能短的延迟时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=596) [另一种能够得益于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=600) [Network.framework的
app类别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=602) [是直播app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=604) [直播app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=606) [通常在app中结合使用UDP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=608) [和TCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=610) [但这里的关键点是
它正在实时地生成数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=613) [如果你有新的视频帧或音频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=617) [你需要确保它们步调一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=620) [而且你不会在设备或网络上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=623) [造成很多缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=625) [Network.framework中
用于读写的异步模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=628) [可以完美的应用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=631) [确保你能够减少这种缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=634) [我要强调的最后一个用例
是邮件和消息app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=638) [这些app将使用更传统的协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=642) [即TCP上的TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=645) [然而优雅地处理网络转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=648) [对于像这样的app来说非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=651) [通常 如果你有一个消息传递app
你的用户会在他走出大楼时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=655) [使用你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=659) [使用你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=659) [给他的朋友发消息让他们知道
他正在路上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=660) [你想确保你能够处理这种转变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=663) [从大楼内的Wi-Fi网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=666) [切换到他即将进入的蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=667) [并且你没有用很长时间来将消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=670) [送到他的朋友那里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=672) [这些只是可能会使用
像这样的低级网络的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=675) [三种类型的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=678) [还有许多其它类型的app
可以利用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=681) [所以如果你有一个这些类型的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=684) [或当前使用套接字的其它一些用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=686) [我邀请你继续跟随我
并了解你的app可以如何受益](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=689) [首先我想专注于最后一个用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=694) [最简单的邮件和消息app用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=697) [并看下他们如何建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=700) [当你想建立与服务器的连接时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=704) [假设这是一个邮件连接 即带有
TLS安全功能的iMap协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=707) [你从主机名
mail.example.com开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=713) [你有一个要连接的端口
即端口993](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=717) [你有一个要连接的端口
即端口993](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=717) [并且你希望使用TLS
以及TCP协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=720) [那么传统的套接字是如何做的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=725) [这样的事情开始了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=728) [你得到该主机名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=730) [你会调用一些DNS API
来解析该主机名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=731) [若它是getaddrinfo()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=735) [你将得到一个或多个地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=737) [你必须决定要先连接哪一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=739) [你将调用socket()
附带适当的地址族](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=742) [你将设置一系列套接字选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=746) [假设你希望使用非阻塞套接字
像Josh之前提到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=749) [调用connect()启动TCP
然后等待可写事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=754) [而且这是在你使用TLS
做任何事情之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=759) [那又是一大堆其它问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=762) [这在Network.framework中
看起来如何呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=766) [我们希望它看起来很熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=768) [但更简单一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=771) [所以你做的第一件事
就是创建一个连接对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=773) [连接对象基于两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=776) [第一个是端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=779) [它定义了你要访问的目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=780) [这可能是像以前那样的IP地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=782) [但通常 就像在这个例子中
我们有一个主机名和一个端口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=786) [所以我们的端点
可以只包含主机名和端口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=790) [这也可能是
我想连接的Bonjour服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=793) [接下来是参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=797) [参数定义了我想要使用的协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=799) [TLS、DTLS、UDP、TCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=802) [它定义了我想要用的协议选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=805) [以及我想用来连接的路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=808) [即我是想使用任何东西连接呢
还是只想使用Wi-Fi呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=811) [一旦你配置好连接后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=816) [你只需要调用start()
来开始连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=818) [然后等待连接进入就绪状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=821) [这就是为了建立完整TLS连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=824) [你需要做的所有事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=825) [而且我认为你会喜欢
这在Swift中的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=828) [这就是你所要做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=832) [你首先导入Network模块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=833) [然后你创建一个
NWConnection对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=837) [然后你创建一个
NWConnection对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=837) [所以一个NWConnection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=840) [无论是在Swift还是C中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=842) [都是读取和写入数据的基本对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=844) [在这个例子中
我们可以方便地使用主机和端口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=848) [来初始化你的端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=851) [所以我给它我的主机名
mail.example.com](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=853) [以及端口 在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=856) [这是一个众所周知的端口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=858) [即iMaps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=860) [所以我可以把它放在Swift中
非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=861) [但我也可以在那里输入
任何其它数值文字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=863) [然后我通过传入参数来定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=868) [我想要使用的协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=870) [由于这是客户端连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=872) [我只想要默认 TLS和TCP参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=874) [只需要输入.tls
就这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=878) [现在我有了一个完整的TLS连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=880) [我做的下一件事就是设置
stateUpdateHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=885) [来处理我的连接可能经历的所有切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=887) [你要处理的第一个
并且是最重要的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=891) [就是就绪状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=894) [就绪意味着你的app已准备好
在此连接上读取和写入数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=895) [连接已经完全建立](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=900) [如果你使用的是TCP和TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=901) [这意味着TLS握手已完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=904) [我们也会告知你等待状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=908) [去年在URLSession中
我们引入了waitsForConnectivity](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=911) [而NWConnection的
等待状态与之完全相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=916) [而且默认情况下它始终处于启用状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=920) [因此当你创建连接并启动它时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=922) [如果没有可用的网络
我们不会失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=924) [我们只是告诉你
我们正在等待网络变为可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=928) [我们会给你一个有用的原因代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=930) [但你不必再做任何其它事情
来自己处理网络切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=933) [移动性是此API的重要组成部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=937) [如果出现严重错误 我们也会通知你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=941) [假设我们必须从服务器重置
或TLS失败了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=944) [我们会将其作为失败事件告知你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=947) [一旦你设置好了这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=950) [只需调用start()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=952) [并提供你希望接收回调的调度队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=953) [我想深入探讨一下
当调用start()时会发生什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=960) [实际发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=963) [NWConnection的
内部结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=965) [是一个小状态机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=967) [当我们从设置状态开始
并调用start()时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=969) [我们进入准备状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=972) [（连接生命周期）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=974) [准备状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=976) [它不仅仅是在TCP套接字上
调用connect()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=978) [对于TCP套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=983) [这会将SYN数据包发送到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=985) [想要连接的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=988) [但当你在NWConnection上
调用start()时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=990) [它实际上处理了
Josh之前提到的所有事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=992) [它会评估你所在的网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=997) [并尝试为你提供最快的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=999) [我想继续深入讨论一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1002) [所以这就是我们所说的
智能连接搭建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1004) [当你调用start()时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1009) [我们所做的第一件事是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1012) [我们获取你的端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1013) [然后我们评估当前可用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1015) [所有网络是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1017) [在这个例子中
我们有Wi-Fi和蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1019) [在这个例子中
我们有Wi-Fi和蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1019) [通常我们更喜欢Wi-Fi网络
因为它对用户来说成本更低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1023) [所以我们先看看那个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1028) [然后我们检查一下
该网络上是否有任何特殊配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1030) [有VPN吗？有代理吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1034) [我们将为你评估](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1036) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1039) [假设有一个配置了
自动配置文件的代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1040) [如果代理不适用于你的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1045) [它也可以直连](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1048) [所以我们将评估这两个选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1050) [我们将检查是否需要使用代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1053) [继续并连接到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1055) [在那里创建一个TCP连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1057) [但如果我们不需要它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1059) [我们将替你执行DNS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1061) [直接连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1063) [取回所有回复的DNS IP地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1065) [并连接到它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1068) [一个接一个地让它们并行执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1070) [我们比较它们的速度
来为你提供最快的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1073) [然后 如果Wi-Fi出现问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1079) [然后 如果Wi-Fi出现问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1079) [假设Wi-Fi信号质量非常糟糕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1081) [因为你离开了大楼](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1084) [我们实际上可以利用
称为Wi-Fi协助的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1087) [并无缝回退到蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1090) [在那里进行DNS解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1094) [并一个接一个地尝试连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1096) [所以这样你的连接搭建非常有弹性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1100) [处理VPN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1104) [为你处理代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1106) [并为你提供可能的最佳连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1107) [现在 当然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1111) [你可能不想尝试所有这些选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1113) [你可能希望限制连接搭建的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1115) [所以我们有许多不同的旋钮
和控件让你这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1119) [我今天要强调其中的三个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1122) [首先 你可能不想使用昂贵的网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1126) [比如蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1130) [因为此连接仅适合使用Wi-Fi](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1131) [所以在连接的参数中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1136) [具有控制你所使用接口的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1139) [具有控制你所使用接口的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1139) [所以如果你不想使用蜂窝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1143) [只需将cellular添加到
prohibitedInterfaceTypes中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1144) [实际上将一般的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1150) [昂贵网络都禁止掉甚至要更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1152) [因为这也会屏蔽掉 比如说
Mac上个人热点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1155) [另一种限制连接搭建的方法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1162) [明确指定你想要使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1165) [IP地址系列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1168) [假设你非常喜欢IPv6
因为它更快 而且它是未来的趋势](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1170) [你根本不想在连接上使用IPv4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1174) [为此你可以使用参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1177) [找到其中针对IP的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1179) [并且在这里你可以看到
该选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1182) [与你在当前套接字中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1185) [套接字选项相类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1187) [你还可以明确指定要使用的IP版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1188) [这会影响你的连接以及DNS解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1192) [最后 你可能不想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1197) [最后 你可能不想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1197) [在你的连接上使用代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1200) [也许你的连接不适合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1201) [使用SOCKS代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1203) [在这种情况下
你也可以简单地禁止使用代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1205) [这就是准备状态中所发生的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1210) [我之前提到过
事情可能会出错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1214) [在尝试建立连接时
你可能没有可用的网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1217) [我们在进入准备状态之后所做的是
如果我们发现没有好的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1220) [DNS失败 没有网络
也许你处于飞行模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1224) [我们将进入等待状态
并让你知道其原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1227) [并且每次网络发生变化时
我们都会回到准备状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1231) [这时系统认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1235) [“现在你的连接说不定
能建立成功了呢”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1238) [我们将为你处理所有这些事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1240) [并且每次我们重新尝试时都会通知你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1242) [最终你会有希望成功建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1246) [此时我们将进入就绪状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1249) [就像我之前提到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1253) [就绪状态是你的连接完全建立的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1255) [此时已准备好了你的协议栈中
一直到上层的协议 例如TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1257) [此时已准备好了你的协议栈中
一直到上层的协议 例如TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1257) [此时你可以读和写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1263) [这也是我们对你所经历的网络切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1265) [进行回调的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1268) [因此如果你的连接已建立
然后你更改了网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1272) [我们会为你提供相应的更新
以便你可以优雅地处理移动性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1275) [我们稍后再继续讨论这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1280) [如果连接出错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1284) [无论是在连接建立期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1285) [还是已经连接后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1288) [你会得到一个错误并进入失败状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1289) [然后一旦你用完了连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1292) [假设你已经把它关闭了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1294) [或者你从另一端收到了关闭请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1296) [并且你想要使连接无效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1298) [你可以调用cancel()
我们就会进入取消状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1300) [这必定是我们将传递给
你的对象的最后事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1303) [以便你可以清理所使用的任何内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1306) [并继续进行下一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1310) [就是这样 这是对
Network.framework中连接对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1313) [基本生命周期的概述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1317) [为了向你展示如何使用它
来构建一个简单的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1319) [为了向你展示如何使用它
来构建一个简单的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1319) [我想邀请Eric上台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1322) [谢谢Tommy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1333) [我是Eric Kinnear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1334) [我也来自Apple的网络团队](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1335) [我非常高兴能与你一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1337) [使用Network.framework
构建一个示例app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1340) [我们将使用Tommy先前提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1342) [视频直播用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1345) [构建一个可以在一台设备上
使用来自摄像头的输入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1346) [并通过网络发送
以便在另一台设备上显示的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1350) [由于我们将持续生成实时视频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1355) [我们将使用UDP通过网络
发送这些数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1358) [那我们该怎么做呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1363) [首先…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1366) [我们需要与相机进行捕捉会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1367) [以便我们可以从图像传感器
接收视频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1369) [为了这个例子 我们不打算使用
任何视频编解码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1373) [或其它压缩算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1376) [我们只是从相机中取出原始字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1377) [我们只是从相机中取出原始字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1377) [通过网络发送它们
并在另一端进行显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1380) [为此我们需要将这些帧分割成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1384) [我们可以用UDP数据
发送的较小块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1387) [当然 要想在网络上发送
这些UDP数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1391) [我们需要一个连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1394) [对于另一台设备
我们需要一个监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1396) [它可以接收传入的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1399) [并从网络上读取数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1402) [此后我们只是逆转了之前的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1405) [重新组装视频帧并将其发送到显示器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1407) [以便我们能在屏幕上看到它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1410) [为了简单起见
我们已经抽象出了相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1414) [和显示功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1417) [这样我们就可以专注于使用
Network.framework的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1418) [这里有一个我们尚未涉及的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1423) [它就是监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1425) [所以我们现在花点时间来了解它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1426) [监听器功能
由NWListener类提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1430) [你可以使用与你用于配置连接的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1433) [相同的参数对象来创建它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1436) [设置一个监听器来发布
一项Bonjour服务非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1439) [设置一个监听器来发布
一项Bonjour服务非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1439) [在这个例子中
我们将使用_camera._udp](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1444) [当监听器收到新连接时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1448) [它会将该连接传递给你提供的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1451) [newConnectionHandler块中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1454) [这是你执行针对该连接的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1456) [所选配置的机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1459) [然后你需要调用start()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1460) [来让这个连接知道是时候开始了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1462) [同样你也需在你的监听器上
调用start()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1466) [也像连接一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1469) [你需要提供一个调度队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1471) [即你希望在哪里调度这些回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1472) [这就是监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1475) [如果你仔细想想 我们刚实现了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1476) [相当于在UDP套接字上
调用listen()的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1478) [除了listen()
无法在UDP套接字上工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1482) [我们已准备好在Xcode中
构建app了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1487) [这是我们的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1490) [我们这里有一堆文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1492) [它们已经处理了相机和显示功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1494) [所以我们将只关注
UDPClient类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1497) [所以我们将只关注
UDPClient类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1497) [和UDPServer类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1500) [UDPClient](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1503) [将负责创建与另一端的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1504) [并发送帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1507) [同样的 服务器负责创建监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1510) [接受传入的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1513) [从该连接中读取数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1515) [并将其发送到屏幕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1517) [让我们从客户端开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1519) [我的客户端类有个接收一个名字的
初始化函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1522) [它是描述我们要连接的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1525) [Bonjour服务名称的字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1528) [我通过调用
NWConnection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1531) [并传入服务端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1533) [来创建我的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1535) [使用提供给我的名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1538) [并将_camera._udp
作为类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1540) [我们还传递了默认的UDP参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1543) [正如Tommy所说我们可以使用
stateUpdateHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1547) [来检查就绪状态和失败状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1552) [这里 当我们的连接就绪
我们将调用sendInitialFrame()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1555) [我们稍后再实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1560) [因为我们使用的是UDP
并且没有其它握手过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1562) [我们将一些数据通过网络发送到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1565) [其它设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1569) [并在我们开始生成大量视频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1570) [并将其放到网络中之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1572) [等待它的回应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1574) [我们需要记住在我们的连接上
调用start()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1579) [并且传入上面创建的队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1582) [让我们实现
sendInitialFrame()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1586) [这里我们使用
文字字节“hello”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1592) [创建一个数据对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1595) [要在连接上发送内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1598) [我们可以调用
connection.send()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1600) [并提供该数据对象作为内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1601) [我们提供了一个完成处理程序
以便检查发送过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1605) [可能遇到的错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1609) [由于我们预期该内容可以
立即得到回应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1613) [我们马上调用
connection.receive()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1615) [来从连接中读取传入的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1618) [来从连接中读取传入的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1618) [在该完成处理程序中
我们验证该内容是否存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1621) [如果存在
我们让app的其它部分知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1624) [我们已经连接上了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1627) [它应该调出相机硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1628) [并开始生成帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1630) [生成这些帧时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1633) [app的其余部分知道
在UDPClient类上调用send()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1635) [并向其传递一个表示
我们想要发送的视频帧的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1642) [数据对象数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1646) [由于我们要在很短的时间内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1649) [进行大量发送操作
我们将在一个我们传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1651) [connection.batch
的块内做这件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1654) [在这个块中 我们将遍历该
数据对象数组的每一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1657) [并将每个数据对象都传递给
connection.send()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1660) [与上面类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1665) [我们使用完成处理程序来检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1667) [发送时遇到的任何错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1669) [就是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1671) [我们已经有了UDPClient类
并且我们已经准备好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1673) [让我们来看看服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1677) [在服务器端 我们需要一个监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1679) [在服务器端 我们需要一个监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1679) [它可以接收传入的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1682) [我们需要回应
我们刚从客户端发出的握手请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1684) [我们需要从网络上读取数据
以便我们可以将其推送到显示器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1687) [从监听器开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1691) [我们只是使用默认的UDP参数
创建一个NWListener](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1696) [如果我愿意的话 这也是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1701) [使用这些参数告诉监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1703) [监听特定的本地端口的时机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1705) [但由于我们用Bonjour服务
我们不需要这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1707) [为了设置该服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1713) [我将listener的
服务属性设置为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1714) [_camera._udp类型的
服务对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1718) [注意我没有在此处传递名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1721) [因为我希望系统为我提供
默认的设备名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1723) [我还为serviceRegistration
UpdateHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1727) [提供了一个块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1729) [它将在系统发布的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1732) [端点集发生改变时被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1733) [这里 我对添加端点的情况感兴趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1737) [这里 我对添加端点的情况感兴趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1737) [如果它是服务类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1740) [我将告诉app的其余部分
它所发布的名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1743) [即我要求系统提供的默认设备名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1746) [以便我可以在UI中显示它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1749) [并让我的用户在其它地方输入它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1750) [我要在监听器上设置一个新的
连接处理程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1759) [它在每次监听器收到新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1762) [传入连接时都会被调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1764) [我可以对这些连接进行一些配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1767) [但这里使用默认配置就够了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1769) [因此我只需调用connection.start()
并传入一个队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1771) [我在这里通知app的其余部分
我已收到传入连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1776) [以便它可以开始预热显示管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1780) [并准备好显示视频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1782) [我也会调用自身receive()
我稍后再实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1786) [来开始从网络中读取该数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1789) [并将其发送到显示管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1791) [就像连接一样 监听器也有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1795) [stateUpdateHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1800) [我将用它来检查就绪状态和失败状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1802) [别忘了启动我的监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1807) [为此我调用
listener.start()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1809) [并传入我们在上面创建的队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1811) [现在我准备好了监听器
我只需要从网络上读取数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1815) [并实现该receive函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1819) [我们在这里首先调用
connection.receive()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1824) [并传入完成处理程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1827) [当数据进入该连接时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1829) [我们将检查我们是否尚未连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1831) [如果我们没有连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1833) [这可能是客户端通过发送
所启动的握手过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1835) [我们只需调用
connection.send()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1840) [并将相同的内容传回去
以便它回显给客户端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1843) [然后我们记录下连接已经建立](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1847) [在此后的
所有receive()回调中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1849) [我们将告诉app的其余部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1852) [我们收到了这个帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1854) [它应该将其发送到显示管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1856) [以便我们能在屏幕上看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1858) [以便我们能在屏幕上看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1858) [最后 如果没有错误
我们再次调用receive()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1861) [以便我们接收后续帧
并将其发送到显示器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1865) [并将这些独立的图像拼接成视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1868) [就是这样
我们有了UDPClient](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1873) [也有了UDPServer
让我们试一试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1875) [我将在我的手机上运行客户端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1880) [并在Mac上运行服务器
以便我们可以在大屏幕上看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1883) [这里 服务器刚刚启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1888) [我们看到它正作为
Demo Mac进行公布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1890) [这是我让系统其余部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1893) [给我这个名称的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1895) [在我的手机上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1898) [如果我点击连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1899) [一瞬间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1901) [我就可以通过UDP Live看到
通过网络流式传输的视频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1902) [我们刚才看到了我能够多么快地
启动一个UDPClient](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1918) [我们刚才看到了我能够多么快地
启动一个UDPClient](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1918) [并连接到Bonjour服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1922) [它可以发送握手](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1925) [等待其被处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1927) [获取来自相机的视频帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1929) [并通过网络发送它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1931) [服务器端启动了
一个Bonjour监听器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1934) [它公布了一项服务
并接收传入的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1938) [然后对握手进行回应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1942) [并将它们全部发送到显示器
以便我们可以看到它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1943) [现在为了更详细的介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1947) [优化该数据传输过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1949) [我想邀请Tommy回到舞台上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1950) [谢谢 Eric](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1958) [这是一个非常酷的演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1960) [它很容易实现
现在我们已经介绍了基础知识](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1962) [我们知道如何建立出站连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1965) [如何接收入站连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1968) [但Network.framework的
真正关键部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1970) [也是这里的杀手级特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1973) [是其优化性能的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1974) [我们将超越套接字所能够做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1977) [我们将超越套接字所能够做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1977) [我想先谈谈
你在app中与网络连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1981) [进行交互的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1985) [最基本的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1987) [即发送和接收数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1989) [这些调用非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1992) [但是关于你如何处理
发送和接收的细微差别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1995) [将对app的响应能力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=1998) [以及设备和网络上正在进行多少缓冲
有着巨大影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2002) [所以我想介绍的第一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2007) [是当我们在app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2009) [发送数据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2011) [就像Eric刚向你展示的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2012) [一些正在直播的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2015) [一些动态生成数据的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2016) [但在这个例子中 让我们谈谈
使用TCP流来发送的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2019) [即可以在网络上恢复的TCP流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2023) [它具有可以发送的特定时间窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2026) [我们该如何处理该情况呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2028) [这是一个发送单帧的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2031) [这是你的app生成的某些数据帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2034) [你在连接上发送它的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2039) [你在连接上发送它的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2039) [是通过调用
connection.send()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2041) [并传入该数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2043) [如果你习惯在连接上
使用套接字发送数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2045) [你要么使用阻塞套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2050) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2053) [如果你要发送100个字节的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2055) [如果发送缓冲区中没有空间
它实际上会阻塞你的线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2057) [并等待网络连接消耗掉这些数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2061) [或者 如果你使用的是非阻塞套接字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2065) [该发送过程实际上可能
不会发送你的全部数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2068) [它会说
“哦 我先只发送50个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2071) [过一段时间再发送剩下的50字节”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2073) [这要求你和你的app需要处理很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2076) [关于你实际发送了多少数据的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2079) [所以NWConnection
的好处在于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2084) [你可以一次发送所有数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2086) [你不必担心这些问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2088) [并且它不会阻塞任何东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2090) [然而你必须处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2093) [如果连接正在恢复该怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2095) [因为我们不想不必要地
将大量数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2097) [因为我们不想不必要地
将大量数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2097) [发送到此连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2100) [如果你想要一个响应性强的
实时数据流的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2101) [这里的关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2106) [是我们提供给你的回调块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2107) [它被称为
contentProcessed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2110) [每当网络栈消耗你的数据时
我们都会调用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2112) [这并不意味着必须发送数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2117) [或另一方进行确认](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2120) [它完全等同于阻塞套接字的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2122) [返回的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2126) [或非阻塞套接字
能够消耗你发送的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2127) [所有字节的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2131) [在此完成处理程序中
你可以检查两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2133) [首先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2137) [你可以检查错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2138) [如果有错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2139) [这意味着在我们尝试发送你的数据时
出现了问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2140) [这通常表示整体连接失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2143) [然后 如果没有错误
这是一个绝佳的机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2147) [来查看你的app中
是否有更多数据要生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2152) [所以如果你正在生成实时数据帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2156) [你应该发送它并从视频流中
获取另一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2159) [你应该发送它并从视频流中
获取另一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2159) [因为现在正是你将下一个数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2161) [放入队列的时机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2163) [这使你可以一步一步地发送所有数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2164) [正如你在这里看到的
我们实际上使用此异步发送回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2168) [形成了一个循环
从而持续从我们的连接中消耗数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2171) [并非常优雅地处理它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2176) [关于发送我想指出的另一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2182) [是Eric之前展示的
对UDP app很有效的技巧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2185) [这类app需要一次发送多个数据报](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2189) [如果你需要发送一大堆很小的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2193) [或独立数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2196) [你可以使用我们添加的
称为connection.batch的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2200) [UDP套接字以前一次只能发送
一个数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2203) [这可能效率很低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2208) [因为如果我需要发送
100个UDP数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2210) [它们每个都是不同的系统调用
不同的副本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2213) [并且导致内核中大量的上下文切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2216) [但如果你在那个块中调用batch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2219) [但如果你在那个块中调用batch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2219) [你想调用send或receive
多少次都可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2222) [并且连接将停止处理任何数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2225) [直到你完成此batch块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2229) [并尝试将所有这些数据报](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2231) [作为单个批次传入系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2234) [理想情况下
只有一个上下文切换到内核中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2237) [并最终从接口发送出去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2241) [这使你非常非常有效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2243) [以上就是发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2247) [接收与发送一样是异步的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2248) [而异步性质则会给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2252) [能够让你调整app的背压](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2255) [在这个例子中
我有一个基于TCP的协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2258) [并且app想要读取某种类型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2262) [记录格式非常常见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2265) [假设你的协议有一个10字节的头部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2270) [它告诉你有关你将要收到的
内容的一些信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2274) [比如你将要接收的主体长度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2277) [因此你想首先读取该头部
然后读取你的其它内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2280) [也许你的内容很长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2284) [假设有几兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2285) [使用传统的套接字时
你可能会尝试读取10个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2288) [你可能得到10个字节或更少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2292) [你须继续读取
直到获得正好10个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2294) [从而读取头部信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2296) [然后你还要读取几兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2297) [你会读取一些数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2300) [进行一大堆不同的read调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2301) [并且需要在你的app
和堆栈之间来回切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2303) [使用NWConnection的情况下
当你调用receive()时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2308) [你可以提供你想要接收的最小数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2312) [和最大数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2315) [所以你实际上可以指定
如果你想要接收正好10字节的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2317) [因为那是你的协议所规定的
你可以说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2320) [“我想要最小10字节
最大10字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2323) [即给我正好10个字节”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2325) [而我们只会在以下情况发生时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2327) [才对你进行回调
即要么从连接读取数据发生错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2329) [要么我们正好读了10个字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2332) [然后你就可以读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2335) [头部中你需要的内容 比如长度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2338) [头部中你需要的内容 比如长度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2338) [然后假设你想继续读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2341) [几兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2343) [你基本上只需做同样的事情
来读取你的主体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2344) [你只需传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2347) [你想要从连接中读取的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2348) [这可以让你不必](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2351) [在堆和app之间来回切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2353) [这是通过在所有数据准备好时
只进行一次回调来做到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2355) [所以这是一种优化交互的好方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2359) [除了发送和接收](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2364) [我还想强调一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2366) [你的网络参数中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2368) [几个高级选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2370) [它们允许你配置连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2371) [从而当你实际发送和接收数据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2373) [具有合适的启动时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2376) [以及网络上的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2378) [第一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2381) [是我们在WWDC中多次讨论的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2382) [它是ECN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2385) [即显式拥塞通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2386) [它为你提供了一种平滑连接的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2389) [即让终端主机知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2394) [何时发生了网络拥塞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2398) [从而使我们可以很好地调整速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2399) [从而使我们可以很好地调整速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2399) [最棒的是默认情况下
所有的TCP连接都会启用ECN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2402) [你无需做任何事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2407) [但过去在基于UDP的协议上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2409) [使用ECN非常困难](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2413) [所以我想在这里向你展示
如何做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2415) [你要做的第一件事是
创建一个ipMetadata对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2419) [ECN由IP数据包中的标志控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2423) [所以这个ipMetadata对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2428) [允许你在每个数据包上设置各种标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2429) [并且你可以把它包装成
一个context对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2434) [它描述了你想与某次send调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2437) [相关联的若干协议的所有选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2440) [以及该特定消息的相对优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2442) [然后使用
此context作为额外参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2448) [传入send调用中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2451) [就在你的content参数后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2453) [所以现在当你发送它时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2455) [由此内容生成的任何数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2457) [由此内容生成的任何数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2457) [都将包含你想要标记的所有标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2460) [所以这很容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2463) [而且你也可以在收到连接时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2465) [获取这些相同的标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2467) [你将在收到的数据包中得到
与其关联同样的context对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2469) [你将能够读出你想得到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2472) [特定的低级标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2475) [类似地 我们也有服务类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2479) [这是一个在URLSession中
也存在的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2482) [它定义你的流量的相对优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2487) [这会影响我们在发送数据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2491) [流量在本地接口上排队的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2494) [及在Cisco Fastlane
网络上流量的工作方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2496) [你可以通过使用参数对象中的
serviceClass参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2501) [来将服务类标记为整个连接上的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2506) [在这个例子中 我们展示了
如何使用后台服务类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2511) [这是将你的连接标记为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2515) [较低优先级的好方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2518) [较低优先级的好方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2518) [我们不希望它妨碍用户交互式数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2520) [所以如果你需要后台数据传输
我们真的很鼓励你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2523) [将它们标记为后台服务类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2526) [但你也可以对那些UDP连接
在每个数据包的基础上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2530) [标记服务类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2534) [假设你有一个连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2536) [其中在同一个UDP流上包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2538) [语音和信号数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2542) [在这种情况下
你可以创建我之前介绍的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2544) [ipMetadata对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2548) [在这里标记你的服务类
而不是之前的ECN标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2550) [将其附加到context上
然后将其发送出去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2554) [这样你就在每个数据包的基础上
标记了优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2556) [你可以优化连接的另一种方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2563) [是减少为了建立它们所需的往返次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2565) [所以在这里我想强调
两种方法来做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2570) [第一种是在你的连接上启用快速打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2573) [TCP快速打开允许你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2576) [在TCP发出的第一个数据包中
发送初始数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2579) [在TCP发出的第一个数据包中
发送初始数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2579) [即在SYN包中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2583) [这样你就不必等待整个握手过程完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2584) [才开始发送你的app数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2586) [为此 你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2590) [需要与连接达成协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2593) [并说明你将提供此初始数据
以发送出去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2595) [为了启用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2600) [你需要在参数上
标记allowFastOpen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2601) [然后创建连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2604) [在你调用start()之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2607) [你实际上可以调用send()
并将你的初始数据发送出去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2609) [现在我想指出
这里的完成处理程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2615) [被替换为该数据为幂等的标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2618) [幂等意味着可以安全地重新发送数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2621) [因为初始数据可能会
通过网络重新发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2624) [因此如果重新发送的话
你不希望它有任何副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2627) [然后你只需调用start()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2633) [当我们正在启动连接时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2634) [我们之前提到过的所有尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2637) [如果可以的话 我们将使用
该初始数据在TCP快速打开中发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2639) [如果可以的话 我们将使用
该初始数据在TCP快速打开中发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2639) [我还想指出使用TCP快速打开的
另一种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2645) [它不要求你的app发送自己的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2649) [如果你在TCP之上使用TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2654) [来自TLS的第一条消息
即客户端hello](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2657) [实际上可以用作
TCP快速打开的初始数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2661) [如果你只想启用此功能
而不提供自己的快速打开数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2665) [只需找到针对TCP的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2671) [并在那里标记你想要
启用快速打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2674) [它会在连接建立期间自动将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2677) [来自TLS的第一条消息发送出去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2680) [你还可以做另外一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2687) [来优化你的连接建立过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2688) [并节省一次往返](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2690) [这是Stuart](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2691) [在前一个演讲中提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2693) [我们称之为乐观DNS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2695) [这允许你使用以前过期的DNS回复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2698) [这允许你使用以前过期的DNS回复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2698) [其生存时间可能很短](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2702) [并尝试连接到它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2706) [同时我们并行执行一个
新的DNS查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2708) [所以…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2713) [如果你之前收到的地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2714) [虽然过期但却仍然有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2718) [并且你将expiredDNSBehavior
标记为allow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2721) [当你调用start()时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2724) [我们将首先尝试连接这些地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2726) [而不必等待新的DNS查询完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2728) [这可以减少大量的连接建立时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2731) [但如果你的服务器的确改变了地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2735) [因为我们正在尝试
多种不同的连接选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2739) [如果第一个不起作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2742) [我们会优雅地等待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2744) [新的DNS查询返回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2746) [并再次尝试这些地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2748) [所以这是一种非常简单的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2751) [如果它适合你的服务器配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2753) [你就可以更快地建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2756) [我想谈的关于性能的下一个领域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2761) [你实际上并不需要在app中
执行任何操作就可以得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2764) [这是你在使用URLSession
或Network.framework连接时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2768) [自动得到的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2772) [这就是用户态网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2775) [这是我们去年在WWDC上
介绍的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2777) [并在iOS和tvOS上都启用了它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2782) [我们在这里完全避开了套接字层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2786) [我们将传输栈移到你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2788) [为了让你知道它是做什么的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2792) [我想先介绍一下通常的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2795) [传统栈模型是什么样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2796) [假设你正在通过网络接收数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2800) [这里是Wi-Fi接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2802) [该数据包先进入驱动程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2804) [然后被发送到内核中的
TCP接收缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2806) [然后当你的app读取套接字时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2812) [将进行一次上下文切换
并将数据从内核复制到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2816) [你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2819) [你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2819) [接着一般情况下如果你使用了TLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2821) [它必须进行另一次转换来解密该数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2823) [然后才能将其发送到app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2826) [那么当我们进行用户态网络时
这看起来如何呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2830) [你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2836) [主要的变化是我们将传输栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2837) [即TCP和UDP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2839) [向上移到你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2841) [这有什么好处呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2842) [现在当一个数据包从网络进入时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2844) [像以前一样先进入驱动程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2847) [但我们将其移动到一块内存映射区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2849) [你的app可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2852) [自动从中获取这些数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2854) [不需要复制
也没有做额外的上下文切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2856) [并自动开始处理数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2860) [这样我们需要做的唯一转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2862) [就是我们为TLS无论如何
都要做的解密](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2864) [这确实可以减少用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2869) [发送和接收数据包的CPU时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2872) [特别是对于UDP这类协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2874) [你需要直接在你的app中使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2877) [你需要直接在你的app中使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2877) [来回发送大量数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2880) [为了说明这是如何工作的
及它可以产生的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2883) [我想给你看一个视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2885) [它是使用Eric之前向你展示的
那个app拍摄的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2887) [并通过用户态网络
来演示UDP的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2892) [在这个例子中
我们将会有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2897) [两个视频同时播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2899) [左侧的设备正在接收一个视频流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2902) [其来自…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2907) [使用套接字编写的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2908) [右边的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2912) [将接收完全相同的视频流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2913) [其来自一个设备上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2917) [一个app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2918) [该app使用
Network.framework编写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2920) [因此它可以利用用户态网络栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2921) [在这个例子中
我们将视频以流式传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2926) [它只是原始帧 并没有被压缩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2928) [它没很好质量或其它东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2931) [但是有大量数据包来回传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2932) [在此演示中 我们不会降低视频质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2935) [无论是在我们遇到争用时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2938) [无论是在我们遇到争用时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2938) [还是当我们无法足够快的
发送数据包时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2942) [或是不丢弃任何东西时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2944) [而是在必要时放慢速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2945) [你的app可能在实际中不会这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2948) [但它突出了这两种栈之间的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2950) [性能区别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2953) [现在让我们看看吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2956) [它们使用的数据完全相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2961) [以它们各自尽可能快的速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2964) [在网络上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2966) [发送完全相同的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2968) [我们看到右边的那个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2971) [很容易就超过了左边的那个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2972) [事实上 如果你看看其差异](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2977) [我们仅在接收端就看到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2978) [30%的开销削减](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2980) [这是因为在比较套接字
和用户态网络时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2984) [我们看到它们发送和接收
UDP数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2989) [所需的CPU百分比存在巨大差异](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2992) [这只是一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2995) [这不会是每个app的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2997) [因为你将以不同方式进行压缩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2999) [因为你将以不同方式进行压缩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=2999) [你将会尝试提高连接的效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3001) [但如果你有一个
生成实时数据的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3005) [尤其是如果你使用UDP
来发送和接收大量数据包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3008) [我邀请你尝试在你的app中
使用Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3011) [并在工具软件中运行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3015) [测量当你使用Network.framework
与套接字时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3017) [它们各自的CPU使用量的差异](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3020) [我认为你会对所看到的结果感到满意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3023) [我们今天要讨论的最后一个话题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3030) [是解决网络移动性问题的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3033) [这是我们使用
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3036) [尝试解决的关键领域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3040) [它的第一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3042) [只是确保我们能够优雅地开始连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3045) [我们已经提到了这一点
但我想稍微回顾一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3048) [等待状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3051) [是在你的连接刚建立时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3053) [处理网络切换的关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3057) [当你正在做DNS或TCP时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3059) [当你正在做DNS或TCP时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3059) [它会指出当前无连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3062) [或连接已更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3063) [我们鼓励你避免使用
可达性之类的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3067) [来在建立连接之前检查网络状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3072) [这将导致竞争条件
并可能无法提供准确的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3076) [来描述连接中实际发生的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3079) [如果你需要确保你的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3083) [不会通过蜂窝网络建立](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3085) [不要…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3089) [预先检查设备当前是否运行在
蜂窝网络上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3090) [因为那可能会改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3093) [只需使用
NWParameters来限制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3095) [你要使用的接口类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3098) [一旦你启动了你的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3101) [并处于就绪状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3103) [我们会为你提供一系列事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3104) [来让你知道网络何时发生变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3107) [第一个被称为连接可行性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3111) [可行性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3115) [表示你的连接能够通过该接口
发送和接收数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3117) [表示你的连接能够通过该接口
发送和接收数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3117) [即它有一个有效的路由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3121) [为了演示这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3125) [若当设备连到Wi-Fi网络时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3127) [你开始建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3129) [然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3133) [你的用户走进电梯](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3134) [他们失去了信号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3137) [此时我们将会给你一个事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3139) [让你知道连接不再可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3141) [那么这时你应该怎么做呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3145) [两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3149) [我们建议 如果这对你的app来说
合适的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3150) [你可以让用户知道他们目前没有连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3152) [如果他们试图发送和接收数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3156) [现在这将无法正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3158) [但是 你不一定要拆掉该连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3161) [反正此时你也没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3164) [可用的更好的接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3167) [并且之前的Wi-Fi接口
可能会回来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3168) [通常 如果你走出电梯](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3171) [并回到同一个Wi-Fi网络范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3174) [你的连接立即可以在断开的地方恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3175) [我们给你的另一个事件
是更优路径通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3180) [我们还是使用刚才的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3185) [即你通过Wi-Fi网络连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3187) [假设你走出一幢建筑
现在失去了Wi-Fi信号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3190) [但你现在可以使用蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3194) [此时我们会让你知道两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3197) [首先 你的连接不再像之前一样可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3200) [但我们也会告诉你
现在有一条更优的路径可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3203) [如果你再次连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3207) [你就能够使用蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3209) [这里的建议是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3212) [如果这对你的连接合适的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3214) [尝试迁移到新连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3217) [如果你能恢复刚才正在进行的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3219) [但只有在新连接完全就绪后
才应该关闭原始连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3224) [同样 Wi-Fi网络可能会回来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3228) [或蜂窝网络连接可能会失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3231) [我想在这里强调的最后一种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3236) [是用户最初通过蜂窝网络连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3239) [是用户最初通过蜂窝网络连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3239) [然后用户走进建筑物
现在他们可以访问Wi-Fi网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3242) [在这种情况下 你的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3247) [即原来的那个完全没问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3248) [它仍然可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3250) [但你现在也有更优的路径可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3251) [同样的 在这种情况下
如果你可以迁移你的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3255) [这可能是尝试建立新连接并使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3258) [来发送数据的好时机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3262) [这将为用户节省流量账单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3264) [但请继续使用原始连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3268) [直到你完全建立新的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3271) [我们来看下代码的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3274) [你可以在连接上设置一个
viabilityUpdateHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3276) [它会返回一个布尔值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3278) [来让你知道当时连接是否可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3281) [以及一个betterPathUpdateHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3283) [它告诉你何时有更优的路径可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3286) [或不再可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3289) [现在 处理网络移动性的
更好解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3293) [是我们前几年所谈到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3297) [多路径连接 多路径TCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3300) [如果你能够在服务器上
启用多路径TCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3304) [并且在客户端启用参数中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3308) [multipathServiceType](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3312) [那么你的连接将随着网络的变换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3314) [而在它们之间自动迁移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3316) [这是一种非常棒的无缝体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3318) [你的app不需要处理任何工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3322) [这也是URLSession中
可用的相同服务类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3324) [关于Network.framework
我想在此强调几点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3330) [若你在NWParameters中
限制可以使用的接口类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3335) [这将适用于MPTCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3339) [所以在使用多路径连接时
你仍然可以选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3342) [不使用蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3346) [这样我们只会在可用的
不同Wi-Fi网络之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3347) [进行无缝迁移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3351) [此外 之前我提到的
连接可行性处理程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3354) [与多路径TCP略有不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3358) [与多路径TCP略有不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3358) [因为每当我们更改网络时
我们都会自动为你迁移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3361) [你的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3364) [只有在你完全没有可用的网络时
才是不可用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3366) [因此在等待连接之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3373) [可用性 更优路径 MPTCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3377) [我们真的希望你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3381) [所有这些使用
SCNetworkReachability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3384) [来手动检查网络更改的用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3387) [都能被替换掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3389) [然而我们的确意识到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3391) [在有些情况下你仍然想知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3393) [有哪些可用的网络
以及它什么时候改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3397) [为此Network.framework提供了
一个新的名为NWPathMonitor的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3400) [这个PathMonitor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3407) [并不监视可达性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3409) [或尝试预测给定主机的可达性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3411) [而只是让你知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3414) [你的设备上接口的当前状态是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3415) [以及它们何时改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3417) [它允许你遍历](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3421) [你可以连接的所有接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3423) [以备你想要在其中每个上面
都建立连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3425) [并且只要这些网络发生变化
它就会通知你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3429) [这可能非常有用
如果你想要更新UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3433) [来让用户知道他们是否已连接的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3436) [如Stuart在上次演讲中提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3439) [可能有这样的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3442) [其中用户需要填写一个很长的表格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3443) [但他们可不想在填完的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3446) [才意识到他们没有连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3449) [因此在这些情况下使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3452) [只是等待连接的
NWPathMonitor是不够的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3456) [所以在所有这些情况下
我们真的希望看到人们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3459) [不再使用可达性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3463) [并比以往更优雅地处理网络转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3464) [接下来 我想邀请Josh](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3470) [回到舞台上来并告诉你如何参与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3472) [并开始使用
Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3475) [谢谢 Tommy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3482) [我们有一个很棒的新API
我们认为你会爱上它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3483) [我想谈谈为了立即开始使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3488) [你可以做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3490) [但首先我要谈一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3491) [我们希望你不要做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3493) [以便我们可以真正利用这些新技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3494) [比如用户态网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3496) [若你使用的是macOS
并且有一个网络内核扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3499) [而且你正在该网络内核扩展中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3502) [执行某些用其它方法实现不了的操作
请立即与我们联系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3504) [我们会为你提供更好的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3508) [因为网络内核扩展不兼容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3510) [用户态网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3512) [你需要注意
对于URLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3515) [代理自动配置将不再支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3518) [FTP和文件URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3521) [以后唯一支持的URL方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3522) [将是HTTP和HTTPS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3525) [我们希望你停止使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3529) [Core Foundation层
的许多API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3532) [它们最终会被弃用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3533) [虽然它们尚未标记为已弃用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3535) [它们是CFStreamCreatePairWith
开头的任何与套接字相关的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3537) [它们是CFStreamCreatePairWith
开头的任何与套接字相关的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3537) [以及CFSocket](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3542) [它们不能很好利用我们通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3544) [Network.framework
引入的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3547) [许多关于连接建立的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3548) [并且也无法利用新的用户态网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3550) [我们真的希望你能摆脱它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3552) [以利用Network.framework
和URLSession带来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3554) [强大的连接性改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3558) [和性能改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3561) [还有一些Foundation API
我们也希望你不再使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3564) [如果你使用NSStream、NSNetService
或NSSocketPort这些API中的任意一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3567) [请改为使用Network.framework
或URLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3573) [最后 如果你使用的是
SCNetworkReachability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3577) [我们觉得等待连接模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3580) [是一个更好的模型
所以我们真的希望你改为使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3582) [对于那些等待连接并不合适的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3586) [少数情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3588) [以后NWPathMonitor
是一个更好的解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3589) [我们已经说了一些不希望你做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3593) [现在我想专注于
我们真的希望你做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3595) [从此以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3598) [我们平台上的网络首选API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3599) [我们平台上的网络首选API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3599) [是URLSession
和Network.framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3602) [URLSession
主要针对HTTP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3604) [但流任务提供了非常简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3607) [TCP和TLS连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3611) [如果你需要更先进的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3613) [Network.framework
为你提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3615) [对TCP、TLS
UDP、DTLS的更好支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3617) [它处理监听入站连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3621) [以及出站连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3623) [并且我们用PathMonitor
来处理一些移动性问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3624) [下一步 我们真的希望看到你采用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3629) [Network.framework
和URLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3632) [你的客户将会赞赏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3635) [你建立的连接有多么可靠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3638) [并赞赏更好的性能所带来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3640) [更长的电池续航时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3642) [当你做这些事时 请关注于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3645) [你如何处理发送和接收](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3648) [来真正优化其性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3649) [并多花些时间来获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3652) [对可行性和更优路径变化的支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3654) [它对于提供无缝的网络体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3657) [至关重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3659) [至关重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3659) [现在我们知道Network.framework
还不支持UDP组播](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3662) [所以若你正使用UDP组播](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3666) [我们真的很想了解你的用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3667) [以便以后我们可以将这些考虑在内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3669) [此外 如果你有任何其它问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3672) [或增强请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3674) [我们很乐意听取你的意见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3675) [请联系开发人员支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3677) [或到访我们的实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3679) [午饭后两点我们有一个实验室
并在明天上午九点还有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3680) [更多详细信息 请参阅此URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3685) [别忘了明天早上和午餐后的实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3688) [非常感谢
祝你们度过愉快的WWDC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/715/?time=3691)