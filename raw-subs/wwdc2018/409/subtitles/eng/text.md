# What's New in LLVM

## Summary
The LLVM suite of compiler tools in Xcode 10 have new language features, improved diagnostics, and more powerful optimizations. Find out about improvements to ARC for Objective-C, keep up with the newest additions to C++, get an overview of new and improved diagnostics and static analyzer checks, and learn about how LLVM compiler technology is delivering faster build times and better runtime performance for your apps.

## Info
* Developer Tools
* WWDC 2018 - Session 409 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=21) [&gt;&gt; Good morning, welcome to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=28) [What's New in LLVM.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=29) [I'm Jim Grosbach, your friendly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=31) [neighborhood pointy hair boss.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=32) [I'm here to tell you a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=34) [bit of background about the LLVM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=35) [project before we dive into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=37) [deep technical details of all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=40) [the exciting new things that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=41) [have for you today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=43) [Start off, LLVM is more than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=45) [just the compiler, it is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=48) [background for the Clang](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=50) [compiler, for the C family of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=52) [languages that we all use every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=54) [day, but it also powers the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=55) [Static Analyzer, the sanitizers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=57) [Static Analyzer, the sanitizers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=57) [the LLDB debugger, and is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=60) [optimization code generation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=63) [framework underneath the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=64) [shader compilers for all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=66) [Apple's mobile platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=68) [In addition to this, it also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=72) [powers one additional little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=73) [project that you may have heard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=75) [of from time to time called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=77) [Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=79) [And like Swift LLVM is an open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=81) [source project.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=83) [We all operate under the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=86) [watchful eye of our LLVM wyvern](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=87) [here, he's normally a very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=90) [friendly fellow, though I do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=91) [have to caution you he gets a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=93) [little bit cranky if you call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=94) [him a dragon so don't do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=96) [As an open source project LLVM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=99) [is a partnership, we work with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=102) [industry partners, academics,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=104) [researchers and hobbyists from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=107) [all over the world and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=109) [different parts of the industry](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=111) [and many more all over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=113) [place.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=115) [This is really fantastic, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=116) [work together to build the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=118) [greatest tools that we possibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=119) [greatest tools that we possibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=119) [can to move technology forward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=121) [And if you ever have a compiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=124) [itch that you would like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=127) [scratch we would like to invite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=128) [you to participate with us and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=130) [go to the LLVM website here at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=133) [llvm.org or you can come talk to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=135) [us later today later today in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=137) [the LLVM labs and many of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=139) [compiler engineers from Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=141) [will be there and I'm sure will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=143) [be more than happy to talk your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=145) [ear off about anything and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=147) [everything compiler related](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=148) [you've ever wanted to know.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=150) [So for today we have a great set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=152) [of things that we want to share](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=156) [with you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=157) [We have updates on automated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=157) [reference counting that makes it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=159) [even easier for the compiler to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=160) [help you with your memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=162) [management.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=163) [We have new diagnostics in Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=164) [10 and new checks in the Static](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=167) [Analyzer to help catch bugs in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=169) [your project sooner at build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=171) [time to improve the quality of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=173) [your code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=175) [We have compiler features that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=176) [improve security, both of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=178) [Apple's platforms and of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=179) [Apple's platforms and of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=179) [apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=181) [And new features to allow you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=182) [take advantage of all of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=184) [really great new things on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=186) [hardware architectures to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=188) [the performance that we all want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=189) [out of our platforms and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=192) [architectures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=193) [So with that I would like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=194) [invite my colleague Alex up to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=196) [talk about ARC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=198) [Alex.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=200) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=201) [&gt;&gt; Thank you, Jim.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=208) [Automatic reference counting has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=209) [greatly simplified Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=211) [program since we introduced it a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=213) [couple of years ago.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=216) [A couple of restrictions made it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=218) [harder to migrate from the old](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=220) [manual retain release mode over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=222) [to ARC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=224) [I'm happy to say that we've now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=225) [lifted one such restriction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=226) [Xcode 10 has support for ARC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=229) [object pointer fields in C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=230) [structures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=231) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=232) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=232) [Let's take a look at an example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=241) [let's say we'd like to write a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=242) [food ordering app and we'd like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=243) [to create a data structure which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=245) [represents a menu item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=247) [In Xcode 9 and earlier it would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=249) [have been impossible for us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=253) [actually use a C structure with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=254) [ARC object pointer fields, so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=257) [would have had to use a C, an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=259) [Objective-C class here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=261) [Xcode 10 now allows us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=264) [actually create a C structure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=266) [that has ARC object pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=267) [fields.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=269) [Let's keep going and keep](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=275) [writing our food ordering app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=275) [Let's create a function that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=278) [orders free food for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=279) [In the function let's create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=281) [variable item of type menu item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=283) [with a price of zero.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=285) [Then let's pass this item into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=288) [another function that actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=290) [orders the food for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=292) [When the item is created the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=294) [compiler has to synthesize code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=297) [which retains the ARC object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=300) [pointer fields in the item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=302) [The code comments on the slide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=305) [demonstrate the code that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=307) [compiler synthesizes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=308) [This code ensures the name and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=311) [the price of the item are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=313) [released prematurely before the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=315) [item is actually used.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=317) [Now at the end of the function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=318) [item goes out of scope and is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=323) [deallocated from the stack so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=325) [the compiler has to synthesize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=327) [code which releases the ARC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=330) [object pointer fields in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=332) [item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=334) [This ensures that the name and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=335) [the price are not leaked when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=337) [the item is released.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=339) [Previously it was possible to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=342) [use Objective-C object pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=344) [fields when using manual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=346) [retained release mode, but you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=348) [had to write the retains and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=351) [releases yourself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=353) [With ARC the compiler hides all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=355) [of this complexity for you and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=357) [synthesizes code that retains](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=359) [synthesizes code that retains](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=359) [and releases the fields.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=361) [So the compiler is really your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=363) [friend here and it does the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=364) [correct job of managing memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=367) [for variables on the stack and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=369) [also for fields in other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=372) [structures, and also instance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=373) [variables inside Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=376) [classes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=377) [But there is one place we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=379) [to put in a little bit of extra](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=381) [work to support structures with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=383) [ARC object pointer fields and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=385) [that place is heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=387) [Let's go back to our structure,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=390) [let's say you would like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=392) [allocate an array of menu items](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=393) [on the heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=395) [Now if this was an Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=396) [interface we could have used an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=398) [NSArray here, but it's not so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=400) [let's use malloc and free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=403) [Now this code actually has two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=406) [issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=408) [First issue, the memory is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=409) [zero initialized when it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=412) [allocated, which means that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=413) [their pointers will be invalid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=416) [which will cause undesired](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=418) [which will cause undesired](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=418) [runtime behavior for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=420) [program at runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=422) [The second issue is that the ARC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=424) [object pointer fields are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=427) [cleared before the memory is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=429) [deallocated which will cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=431) [runtime memory leaks in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=434) [program.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=436) [Now to fix the first issue you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=437) [can replace the call to malloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=441) [with a call to calloc.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=443) [This will ensure that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=445) [memory is zero initialized,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=447) [which will remove all of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=450) [nasty unexpected runtime issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=452) [To fix the second issue you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=455) [write a loop before it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=458) [allocated in your memory to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=460) [clear out all of the ARC object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=462) [pointer fields in your items.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=464) [This will ensure that the name](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=466) [and the price in the items are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=468) [not leaked when the items are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=470) [freed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=471) [Now this is an exciting new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=476) [feature and if any of you were](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=477) [feature and if any of you were](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=477) [put off from migrates over to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=480) [ARC because of lack of features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=482) [like that I hope that support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=485) [from ARC object pointer fields](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=487) [in Xcode 10 will help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=489) [reconsider your choice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=491) [Now let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=494) [Objective-C pointers and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=496) [structures in general and see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=497) [where and how can the structures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=499) [be used in different language](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=502) [modes in Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=505) [So in Xcode 10 you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=507) [structures that have Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=511) [object pointer fields across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=513) [different language modes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=515) [For example, you can use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=516) [same structure in C Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=518) [or even Objective-C++.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=521) [And it will work correctly even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=524) [when you're compiling your code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=527) [in ARC or in the manual retain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=529) [release mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=531) [In Xcode 10 we actually unified](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=534) [the Objective-C++ ABI between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=536) [calls to functions that took in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=539) [calls to functions that took in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=539) [or returned structures that had](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=542) [ARC object pointer fields in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=545) [Objective-C++.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=546) [And this was done through an ABI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=548) [change in Xcode 10 and ABI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=551) [change affects functions in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=554) [Objective C++ which return or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=556) [take in a structure by value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=559) [that has ARC object pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=561) [fields and no special member](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=563) [functions like constructors or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=566) [destructors.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=567) [Now if you are not sure what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=570) [this means for you or whether](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=571) [your code is affected by this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=573) [ABI change please take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=575) [Xcode's release notes where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=578) [describe in more details the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=580) [effects and the impact of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=582) [ABI change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=584) [Now there is one caveat when it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=589) [comes to the ARC object pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=590) [fields and C structures, they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=593) [not supported in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=595) [So if you try to use a structure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=597) [that has ARC object pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=600) [fields from Swift you will just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=601) [get a compilation error because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=603) [the structure will not be found.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=605) [In addition to new features like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=614) [support for ARC object pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=616) [fields Xcode 10 comes with a lot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=618) [of new compiler diagnostics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=622) [We actually have over a hundred](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=624) [new warnings in Xcode 10 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=626) [today I'd like to talk about two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=628) [of them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=630) [The first warning might be of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=631) [interest to those of you who](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=633) [have mixed Swift and Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=636) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=638) [So as you know Swift code can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=639) [imported into Objective-C and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=642) [Xcode allows you to do that by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=646) [generating a header file that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=648) [describes the Swift interface](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=650) [using Objective-C declarations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=653) [And you can import this header](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=655) [file into your own Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=657) [code to get access to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=659) [code to get access to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=659) [underlying Swift declarations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=661) [Now let's get more specific and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=664) [let's talk about how Swift's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=666) [closure parameters are important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=668) [to Objective-C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=670) [So right now on the screen you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=672) [see an example of a Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=674) [protocol called Executor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=676) [This protocol defines a function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=678) [member called performOperation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=680) [which takes in a closure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=682) [parameter called handler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=684) [Now in Swift closure parameters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=687) [are non-escaping by default,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=689) [which means that they should not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=691) [be retained or called after the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=693) [function returns.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=695) [Now it can be easy for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=698) [program and to forget that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=700) [contract exists when conforming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=702) [to the executive protocol in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=704) [Objective-C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=706) [For example, as you see right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=708) [now on the slide we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=710) [dispatch Executor interface in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=712) [Objective-C and conforms to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=714) [Executor protocol, so it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=716) [provides the performOperation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=718) [provides the performOperation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=718) [method which takes in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=720) [handler block parameter that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=722) [corresponds to Swift's handler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=723) [closure parameter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=725) [But just by looking at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=727) [Objective-C code we have no way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=728) [of knowing whether the handler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=731) [parameter can escape or not.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=732) [Xcode 10 now provides a warning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=735) [that helps us to remember that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=739) [this parameter is actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=741) [non-escaping.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=743) [To fix this this warning you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=745) [annotate your block parameter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=749) [with the NS NOESCAPE annotation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=751) [You should also annotate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=754) [implementation of the method or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=756) [the parameter in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=758) [implementation of the method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=759) [with NS NOESCAPE annotation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=760) [Now the NS NOESCAPE annotation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=764) [is simply a reminder for you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=766) [programmer to ensure that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=768) [don't store or call the handler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=771) [block after they perform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=774) [operation method returns.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=775) [So it's there for you to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=778) [So it's there for you to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=778) [you remember that there is this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=781) [contract that exists between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=783) [your Swift and Objective-C code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=785) [Now the second warning might be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=790) [of interest to those of you who](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=791) [work with more low-level code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=794) [and who care about the way that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=796) [structures are laid out in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=798) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=800) [Let's take a look at one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=801) [structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=802) [So in C structures have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=803) [follow strict layout and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=805) [alignment rules.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=807) [In this particular structure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=809) [that you see right now on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=811) [slide the compiler has to insert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=812) [a 2-byte pattern between the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=814) [second and the third field of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=816) [the structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=818) [Sometimes you might want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=820) [relax these rules and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=822) [compiler provides a pragma pack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=824) [directive that you can use to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=827) [control the layout and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=828) [alignment of your structures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=830) [Now in this example we use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=834) [pragma pack push, 1 directive to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=836) [remove this fixated layout and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=839) [remove this fixated layout and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=839) [to ensure that our structure is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=843) [tightly packed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=845) [This can be useful when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=847) [serializing your structures or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=849) [when transferring your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=851) [structures over the network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=852) [Now pragma pack is typically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=854) [used with a push and a pop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=856) [directive, but it can be easy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=859) [for the programmer to forget to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=861) [insert the pop into the code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=863) [Xcode 10 will now warn about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=867) [code that doesn't have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=869) [corresponding pragma pack pop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=871) [directive and to point you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=873) [the location of the push.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=876) [So to fix this warning you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=878) [should take a look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=881) [location of your push directive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=882) [and insert the pop directive at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=885) [the corresponding location in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=887) [your code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=889) [So in our case we can insert the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=891) [pop directly after the packed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=893) [structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=895) [Once we do that the new layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=897) [Once we do that the new layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=897) [rules will apply only to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=900) [packed structure so they won't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=902) [affect any other structures in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=905) [our program.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=906) [These two new warnings that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=912) [mentioned are enabled by default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=913) [in Xcode 10 and they are there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=916) [to help you write more correct](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=918) [and more robust code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=921) [And to talk more about more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=923) [correct and more robust code I'd](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=924) [like to invite George up on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=927) [stage who will talk about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=928) [new static analyzing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=930) [improvements in Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=931) [George.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=933) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=934) [&gt;&gt; Thanks Alex, so I would like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=942) [to tell you about some of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=943) [improvements we have done for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=944) [Xcode 10 for the Clang Static](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=946) [Analyzer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=948) [So the Clang Static Analyzer is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=950) [a great tool for finding HK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=952) [hard-to-reproduce bugs in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=953) [program.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=955) [And not only the Static Analyzer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=956) [finds the bug for you it also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=958) [finds the bug for you it also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=958) [displays the visualization in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=960) [Xcode of the paths which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=962) [[inaudible] the bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=964) [So here nil is added to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=965) [NSMutableArray which can cause a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=967) [crash later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=969) [And Static Analyzer shows you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=970) [the path for this crash so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=972) [can see how the application can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=974) [be fixed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=976) [And I would like to tell you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=977) [about three of the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=979) [improvements we have done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=980) [Firstly, we have a new check for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=982) [detecting Grand Central Dispatch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=985) [anti-patterning, which can cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=987) [poor performance and hangs of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=989) [your replication.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=990) [Secondly, we have a new check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=992) [for detecting a misuse of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=994) [autoreleasing variables inside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=996) [autorelease pools which can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=998) [cause crashes with [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=999) [And finally, we have improved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1001) [performance and visualizations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1004) [for the Clang Static Analyzer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1006) [So let's start with a new check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1009) [for detecting Grand Central](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1011) [Dispatch anti-pattern.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1012) [So many APIs on our platforms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1014) [are asynchronous, but sometimes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1017) [are asynchronous, but sometimes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1017) [developers would like to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1020) [them in a synchronous way for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1021) [one reason or another.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1023) [Maybe because their code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1025) [already running on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1026) [background queue or maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1027) [because the function cannot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1029) [proceed at all until the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1031) [required value is available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1032) [And the tempting solution there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1034) [is to use a semaphore to ensure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1036) [synchronization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1038) [So that's what's happening in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1040) [this example, so here there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1041) [an SXPC object self.connection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1044) [and we use its property](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1047) [remoteObjectProxy to call, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1049) [get the current task name](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1052) [asynchronously from a different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1053) [process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1055) [And then we wait on a semaphore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1057) [which is signal to inside the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1060) [callback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1061) [And that helps to ensure that by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1063) [the time the function returns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1065) [the task name is available.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1067) [So this approach works but has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1069) [known performance implications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1071) [So the main problem here is when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1074) [you wait using a semaphore on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1076) [some asynchronous process you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1078) [some asynchronous process you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1078) [might be waiting on a queue with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1081) [a much lower priority than yours](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1082) [costing prior inversion which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1085) [[inaudible] performance and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1087) [cause hangs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1088) [And moreover using a semaphore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1089) [in such a way also spawns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1092) [useless threads which further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1094) [degrades the performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1096) [And to help you address this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1098) [issue now Static Analyzer warns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1100) [on such cases helping to see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1103) [where the issue occurs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1107) [Now let's see how the issue can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1109) [be fixed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1112) [In the best-case scenario there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1114) [is a synchronous API available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1115) [which can be used in stat.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1118) [So for an SXPC connection there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1120) [is an [inaudible] API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1122) [synchronousRemoteObjectProxy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1124) [which when used in start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1127) [eliminates the need for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1129) [semaphore and runs much foster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1130) [Alternatively, if no such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1135) [synchronous API is available you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1137) [could restructure your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1139) [could restructure your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1139) [application to use continuations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1140) [in stat and just calls the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1142) [required function inside the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1144) [callback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1145) [So this check is not enabled by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1148) [default but we encourage you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1150) [enable it in build settings in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1152) [order to make sure no such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1154) [problem securing your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1156) [application and it runs as fast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1157) [as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1158) [Now let's talk about the second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1159) [check for detecting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1163) [autoreleasing variables](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1164) [outliving the lifetime of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1165) [autorelease pool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1167) [So the autoreleasing qualifier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1169) [specifies that the value has to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1172) [be released once the control](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1174) [exits the autorelease pool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1176) [So here we have an example where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1178) [we create an error variable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1181) [inside the autorelease pool and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1183) [once the control is outside of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1184) [the autorelease pool the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1186) [variable is released and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1187) [subsequently destroyed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1189) [And autoreleasing pools are a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1191) [useful feature of Objective-C to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1193) [help contain the big memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1195) [footprint of your applications](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1196) [and to ensure that thumbprints](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1198) [are destroyed where necessary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1199) [are destroyed where necessary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1199) [However, it can cause unexpected](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1202) [crashes and they're even more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1205) [unexpected because you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1208) [even need to write the word](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1210) [autoreleasing in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1211) [application to have those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1212) [crashes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1214) [So for instance, there is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1215) [validation function here and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1216) [takes in out parameter NSError.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1219) [And out parameters are actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1222) [autoreleasing in Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1224) [under ARC by default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1225) [So when we write to this out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1228) [parameter inside the autorelease](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1230) [pool and then the function exits](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1232) [the error value is actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1237) [released.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1238) [And then if the caller tries to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1239) [read the value of this error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1241) [variable they might crash with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1242) [use-after-free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1245) [That pattern is already hard to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1251) [detect, but it actually gets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1253) [even worse when you don't even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1254) [control the part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1256) [application which has the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1257) [autorelease pool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1259) [autorelease pool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1259) [So here is a similar function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1260) [which [inaudible] and out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1262) [parameter error and then it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1264) [calls an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1266) [enumerateObjectsUsingBlock which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1267) [is a popular foundation API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1270) [which calls a block on every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1272) [element of a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1274) [However](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1276) [enumerateObjectsUsingBlock](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1277) [actually calls [inaudible] given](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1279) [block inside the autorelease](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1281) [pool of return.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1282) [So a similar problem occurs here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1284) [that when we create an error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1286) [value inside the block and write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1288) [it to the out parameter it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1290) [actually get released by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1292) [time the control reaches out of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1294) [enumerateObjectsUsingBlock.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1296) [And then when the caller tries](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1299) [to read it they also can crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1301) [with the use-after-free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1304) [And previously we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1305) [introduced the compiler warning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1309) [which warns when an implicitly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1311) [autoreleasing out parameter is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1313) [captured in the block.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1315) [And the compiler warning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1317) [suggested to make such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1318) [parameters explicitly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1319) [parameters explicitly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1319) [autoreleasing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1320) [But we have noticed that such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1322) [issue kept occurring, so in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1323) [Xcode 10 we introduced a more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1326) [powerful Clang Static Analyzer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1328) [warning which knows which APIs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1330) [call the provided block inside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1334) [the autorelease pool and warns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1336) [about such cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1338) [So now let's see how this issue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1344) [can be fixed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1344) [And the simplest fix here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1346) [just to introduce a strong local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1348) [variable and then when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1349) [inside the block write a value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1352) [into the strong variable in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1354) [stat.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1356) [And then only copy to the out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1357) [parameter once the control is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1359) [outside of the block and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1361) [know it's not inside the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1363) [autorelease pool and it's safe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1364) [to write into the autoreleasing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1366) [variable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1367) [And finally, we also have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1373) [improved performance and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1375) [visualizations of the Clang](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1376) [Static Analyzer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1377) [So in Xcode 10 we have improved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1379) [So in Xcode 10 we have improved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1379) [the analyzer to explore your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1382) [program in a more efficient way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1383) [so now it finds up to 15% more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1385) [bugs during the same analysis](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1389) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1390) [And not only it finds more bugs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1391) [the bug report it now generates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1394) [tend to be smaller and more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1397) [understandable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1399) [And what I mean by that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1400) [sometimes in Xcode 10 you would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1402) [get examples which have a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1405) [steps and a lot of arrows and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1406) [which would be somewhat hard to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1408) [comprehend.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1410) [And in many of those examples in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1411) [your version of Xcode we give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1413) [you a much smaller error path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1416) [which is much easier to see and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1418) [you can see the issue much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1420) [faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1421) [So in order to use Static](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1423) [Analyzer on your projects you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1425) [can use Product, Analyze or you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1427) [can even enable Analyze During](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1431) [Build to make sure no analyzer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1433) [issue gets unnoticed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1435) [So I encourage you to use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1436) [Static Analyzer, it's a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1438) [Static Analyzer, it's a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1438) [tool to find your bugs before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1440) [users do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1441) [And now my colleague Ahmed will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1442) [talk about low-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1444) [improvements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1446) [&gt;&gt; Thank you George.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1447) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1451) [So as Alex and George told you,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1455) [we have lots of warnings and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1456) [Static Analyzer checks in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1458) [compiler, but you also have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1460) [sanitizer and all of these tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1462) [help you find lots of bugs,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1464) [including security bugs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1465) [So I'm sure you all have lots of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1467) [tests and use all these great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1469) [tools to find all the bugs in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1470) [these tests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1473) [But for some of the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1475) [egregious security bugs we want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1476) [to make sure that they don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1478) [happen in release builds if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1479) [somehow they snuck past all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1481) [testing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1483) [So for those we have mitigations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1484) [in the code generator that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1488) [always emitted even in release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1489) [builds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1490) [So I'm Ahmed, I work on the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1492) [generator and today I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1494) [tell you about a new mitigation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1495) [in Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1497) [So to see how that works we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1498) [So to see how that works we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1498) [to understand how the stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1501) [works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1502) [So here I have a simple C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1503) [function called dlog and I use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1506) [it to print a string that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1509) [passed into a dlog bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1511) [So in this case it's called with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1514) [a string hello.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1516) [And the way this works is we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1517) [need to allocate some memory to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1520) [keep track of this call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1522) [So we allocate that into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1525) [region called the stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1527) [So the stack grows down towards](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1529) [the null pointer or address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1531) [zero.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1533) [So when we do our dlog hello](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1534) [call this allocates what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1537) [called the stack frame and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1539) [stack frame contains things like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1541) [the return address so that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1543) [know to go back to main.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1544) [But it also contains other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1547) [things like parameters and local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1548) [variables.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1550) [So for instance if I have a log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1551) [file [inaudible] local variable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1553) [that lives in the stack frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1556) [So now if I try to make another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1558) [So now if I try to make another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1558) [function call to this dlog file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1561) [function that in turn will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1563) [allocate its own stack frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1566) [And when it's done it's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1568) [deallocate the stack frame and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1571) [return back to the caller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1572) [So now let's look at this stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1574) [frame in more details.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1578) [So let's say I change my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1581) [function to have a local buffer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1583) [so it's a 4 bytes character](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1585) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1587) [And I'm trying to prepare my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1589) [debug string by first doing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1591) [strcpy of the string that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1594) [passed into that buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1595) [So this does the obvious copy by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1598) [[inaudible], so it does H-E-L-L.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1600) [But then there's a problem at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1604) [this point we already wrote 4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1607) [bytes and that we already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1608) [exhausted all 4 bytes available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1610) [in our buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1612) [So if we keep going which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1614) [what strcpy will do then we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1616) [going to override the return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1617) [address and this is a big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1619) [address and this is a big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1619) [security problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1621) [So if an attacker controls the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1622) [string that I'm copying which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1624) [not that hard, then it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1626) [control the return address.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1628) [If it can control the return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1630) [address then they control](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1631) [basically what the program does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1632) [next, so it's a big security](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1633) [problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1634) [So if you had a test that caught](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1639) [this and you ran the address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1641) [sanitizer, then you will have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1643) [had an easy way to fix this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1646) [And really what I should have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1648) [done here is strncpy that knows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1649) [about the size or even better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1652) [use a higher-level API like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1654) [NSString or [inaudible] string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1655) [But still sometimes these bugs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1657) [can survive into release builds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1660) [and we avoid these by using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1663) [what's called the Stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1666) [Protector.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1669) [So the Stack Protector changes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1669) [the layout of the stack frame to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1671) [add a new field the canary so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1672) [that when we do our write we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1675) [have a little bit of code right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1678) [have a little bit of code right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1678) [before the return of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1680) [function that checks whether the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1681) [canary is still valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1682) [So if we keep writing in strcpy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1685) [we're going to override the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1687) [canary first and then we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1688) [going to check the canary first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1692) [before returning and that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1694) [going to abort.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1696) [So we turned ad potentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1697) [exploitable security](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1699) [vulnerability into a reliable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1700) [crash and that's not good for an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1702) [attacker.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1704) [So this is what's called the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1705) [Stack Protector.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1707) [It defects certain kinds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1713) [stack buffer overflows, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1714) [the attack that we just saw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1716) [And it's already enabled by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1717) [default in many versions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1719) [Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1721) [So next I'm going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1721) [a trickier case where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1725) [introduced a new mitigation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1727) [So let's say I took my function,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1728) [again my dlog function and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1732) [changed the buffer so that now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1735) [it's a variable length array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1736) [And the length comes from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1738) [And the length comes from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1738) [parameter called len.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1740) [So let's say len in a specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1743) [call is something big like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1747) [15,000, so now the stack frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1749) [has to be at least 15,000 bytes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1752) [long.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1753) [But memory is not all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1756) [immediately available, so memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1758) [is split into pages and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1760) [stack grows only when necessary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1763) [So for instance, when we try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1766) [access by 10,000 of the buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1768) [that's in the next page of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1770) [stack that's not yet available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1772) [so it's going to do a page fault](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1775) [in the CPU that talks to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1776) [opening system, the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1777) [system sees that we have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1779) [right to grow the stack, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1780) [grows it and we can continue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1782) [writing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1783) [So this all happens under the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1784) [hood.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1788) [But say an attacker controls the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1789) [length and it makes it huge, big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1791) [enough that it spans many pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1794) [So now there's a new problem,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1797) [the memory is not infinite so if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1799) [the memory is not infinite so if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1799) [we keep allocating in this stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1802) [eventually we'll hit another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1804) [region of memory that's already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1805) [allocated and usually that's the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1807) [heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1810) [And when we do that then we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1810) [going to clash with the heap,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1812) [with whatever is already used in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1813) [there, so that's usually things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1815) [like malloc and new.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1816) [So if we try to see what would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1820) [happen with our strcpy example](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1822) [then we will try to write the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1824) [bytes one by one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1826) [So we do H-E-L, etcetera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1828) [And from the standpoint of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1832) [CPU, the code that's generated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1834) [and the operating system this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1837) [all fine because we're just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1838) [writing into a page that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1839) [already available and allocated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1841) [But it really isn't because this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1844) [is part of the heap, this is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1847) [part of our local stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1848) [allocated array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1850) [So when we do our writes we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1851) [actually overriding some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1852) [completely unrelated piece of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1853) [information like I don't know a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1855) [Boolean that checks whether we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1857) [should check a password.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1858) [So this is another important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1860) [security flaw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1861) [So this is something that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1867) [mitigated with a new feature and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1868) [the future works by emitting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1871) [some new codes at the entry of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1873) [the function that checks whether](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1875) [it's okay to have the stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1877) [frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1880) [So it asks the operating system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1881) [above the maximum size of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1882) [stack and if you try to make an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1883) [allocation that's bigger than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1886) [that then it actually aborts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1887) [And again, this turns a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1889) [potentially exploitable security](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1893) [bug into a reliable crash and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1894) [that's no good for an attacker.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1897) [So this is Stack Checking, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1901) [detects something that you might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1903) [have heard of called Stack Clash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1904) [and it's enabled by default in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1906) [Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1908) [So next I want to talk about a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1913) [new set of features we added in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1915) [Xcode 10 and that's support for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1916) [new extension, sect extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1918) [new extension, sect extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1918) [So as you all know we have lots](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1921) [of great Apple devices and one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1924) [of the great things about Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1927) [is that with just a few build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1928) [settings you can target your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1930) [code for each of these devices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1931) [And so under the hood in macOS,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1933) [iOS, watchOS, etcetera we tweak](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1937) [every OS so that it uses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1940) [everything that's available on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1942) [specific piece of hardware.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1944) [So it guarantees maximum](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1946) [performance no matter where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1947) [run.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1949) [And so if you an app with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1949) [extremely high-performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1953) [requirements that's something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1954) [that you might want to do as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1955) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1957) [So we have three features to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1959) [talk about that are available in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1961) [the iMac Pro and the iPhone 8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1962) [Plus and X.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1964) [And let's start with the iMac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1966) [Pro.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1970) [So the iMac Pro has the Intel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1971) [Xeon CPU which has a set of new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1973) [features called AVX-512.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1978) [So AVX-512 is a set of new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1979) [So AVX-512 is a set of new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1979) [instructions with vector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1983) [registers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1985) [And these provide benefits over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1988) [X86-64, so in X86-64 we can only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1992) [assume that we have 128-bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1996) [vectors available, so that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=1998) [guaranteed on any Mac ever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2000) [that's Intel powered.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2002) [Now it happens that any new Mac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2005) [today has more than that, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2006) [the iMac Pro is the first that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2008) [has 512-bit registers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2010) [And with the Auto-Vectorizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2015) [that's enabled in the Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2017) [Clang this is great because it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2019) [means that we can have many more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2021) [elements in the vector.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2023) [So this can greatly improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2026) [throughputs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2027) [But there are other benefits](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2028) [with AVX-512, so for instance we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2032) [not only have bigger vectors we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2035) [also have more of them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2038) [So on X86-64 we only have 16 now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2039) [So on X86-64 we only have 16 now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2039) [we have 32, so this is a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2042) [data to process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2044) [And even if for some reason the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2047) [auto-vectorizer is not able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2049) [make use of these vectors then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2051) [we still have ore skill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2053) [registers or even for code that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2055) [just does float or double.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2057) [There are lots of performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2059) [benefits in AVX-512.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2061) [So let's look at how we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2063) [exploit it in my compute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2066) [[inaudible] expensive function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2068) [So the first thing I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2070) [do is to keep around my existing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2072) [function because that's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2075) [be the fallback that I have that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2076) [runs on all Macs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2078) [Next, I can try to specialize my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2080) [function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2083) [So one way to do that is using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2084) [the target attributes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2085) [And that tells the compiler that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2087) [it's okay to assume that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2090) [function has AVX-512, so it only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2092) [runs on an iMac Pro.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2094) [So if you use simd.h, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2097) [instance the simd float4 128-bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2098) [instance the simd float4 128-bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2098) [vector type then now we might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2101) [have better performance than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2103) [AVX-512 version using the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2104) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2106) [And if you use the even larger](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2107) [vector types, so for instance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2110) [simd float16, then now you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2112) [much better performance than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2114) [AVX-512 version where the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2115) [512-bit vector is actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2117) [native.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2119) [And if you go all the way down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2121) [to X86 intrinsics, then now you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2123) [can start using the new AVX-512](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2125) [variance, as well as the M512](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2127) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2130) [So if you want to specialize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2132) [larger units of codes, so not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2134) [just individual functions but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2135) [files, targets, libraries, then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2137) [you can use the new AVX-512](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2140) [value of the additional vector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2142) [extensions build setting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2145) [So when you do that there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2146) [some things to keep in mind and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2150) [if you're familiar with AVX-1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2152) [and AVX-2 these are very similar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2153) [issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2156) [So you can only pass large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2158) [So you can only pass large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2158) [vectors, so 256 bits and up from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2160) [and to AVX-512 functions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2163) [So the ABI is different from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2165) [generic and a specialized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2167) [variance, so you cannot pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2169) [them between those.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2170) [Additionally, these vectors are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2174) [large and they're large enough](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2176) [that their natural alignment is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2178) [too big for what's guaranteed by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2180) [things like malloc.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2181) [So you have to take that into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2182) [account when allocating these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2184) [anywhere other than the stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2186) [And so in general all of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2190) [things are things that we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2191) [already go through lots of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2193) [things in the opening system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2194) [So for instance, if you can at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2196) [all use accelerate.framework and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2197) [it's much easier to do so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2200) [because we already specialized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2201) [all the functions for every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2202) [single microarchitecture.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2204) [So this is AVX-512.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2206) [Now we also have new features on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2210) [the iPhone 8, 8 Plus and X.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2213) [So one of the first feature is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2219) [So one of the first feature is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2219) [ARM v8.1 Atomics and that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2222) [thanks to one of the great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2225) [things about the iPhone X and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2227) [that's the A11 Bionic chip.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2229) [So the A11 Bionic chip has one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2236) [great new feature compared to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2240) [the A10 which is its support for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2242) [six CPUs, six cores running all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2244) [at the same time and that's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2247) [first in iOS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2249) [And since you have more cores](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2252) [than you probably have more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2254) [threads all at the same time and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2255) [with more threads you might need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2257) [more synchronization to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2258) [these threads cooperate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2260) [And that's implemented using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2262) [atomics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2263) [So the A11 chip also introduces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2265) [a new family of atomic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2267) [instructions that are better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2268) [optimized for the new extra](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2271) [cores.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2274) [So let's look at how that works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2275) [So the way atomics work is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2278) [So the way atomics work is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2278) [through a small sequence of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2283) [codes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2284) [So suppose I have a thread and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2285) [it's trying to access main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2288) [memory, so it has an atomic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2289) [shared variable in there and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2291) [it's just trying to increment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2293) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2295) [So under the hood the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2297) [generator will emit a small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2298) [sequence of codes that first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2300) [takes exclusive excess of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2303) [cache line and that's a small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2304) [region of memory that contains](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2306) [completely this atomic variable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2308) [Now that we have exclusive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2311) [access we can load from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2314) [variable, then we can do our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2316) [increment on the temporary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2318) [loaded value and store the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2319) [result back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2321) [And we know that this is safe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2324) [because we have exclusive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2326) [access, so no other thread could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2327) [have changed the value while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2328) [we're computing our temporary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2330) [results.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2331) [But now suppose another thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2333) [does access either the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2335) [variable or another variable in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2337) [the same cache line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2338) [the same cache line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2338) [So both are going to try to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2342) [exclusive access over this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2344) [variable and that is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2346) [possible, that's what it means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2348) [to be exclusive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2349) [So both of them are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2352) [fail their exclusive access and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2354) [they're going to have to try](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2356) [again until one of them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2357) [succeeds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2358) [And this is not ideal for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2359) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2363) [So in ARM v8.1 which is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2364) [architecture in the A10 CPU we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2368) [have new instructions that do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2371) [this all in a single step and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2372) [some cases, that can greatly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2374) [improve performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2375) [So again, this is something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2377) [you can specialize code for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2379) [using the per function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2381) [specialization or for entire](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2383) [targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2385) [And this is something that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2386) [only really useful when you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2388) [your own C11 or C++ 11 atomics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2389) [So in general, it's much easier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2393) [to use the higher-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2394) [libraries like GCD or PThread or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2396) [os unfair lock, etcetera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2398) [So these are already tweaked for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2399) [So these are already tweaked for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2399) [ARM v8.1, but they also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2402) [cooperate to the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2403) [system to have even better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2404) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2406) [So another feature in the A11](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2411) [CPU is 16-bit floating points.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2413) [So you are all familiar with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2416) [two standard floating point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2418) [types, so we have double which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2420) [is 64 bits and float which is 32](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2421) [bits.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2424) [So on A11 we also have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2426) [16-bit float16, this has much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2427) [less range and precision so it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2431) [not as useful for as many cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2434) [But in some cases like machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2437) [learning or when you're trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2439) [to talk to GPU via Metal this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2439) [great because it's smaller and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2441) [it's faster to compute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2443) [And that's even more true if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2445) [put them in vectors where you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2446) [can put more of them in the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2448) [ARM vector.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2449) [So this is also something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2451) [you can specialize code for and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2454) [in general something to keep in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2456) [mind with all of these features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2458) [is that they're not available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2460) [everywhere.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2461) [So when you want to use them you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2463) [have to always make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2465) [they're actually dynamically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2466) [available on the device you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2468) [running and you can do that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2469) [using sysctlbyname.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2471) [And so in general we already do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2472) [all this in system framework, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2475) [it's much easier to just rely on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2476) [those.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2478) [So these are three new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2479) [instruction set extensions, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2482) [have on the iMac Pro AVX-512 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2484) [on iPhone X, 8, and 8 Plus we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2486) [have Atomics and 16-bit floating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2488) [points.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2490) [So that's just part of all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2491) [new features in Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2495) [So from ARC object pointers in C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2497) [Structs to the improved static](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2499) [analyzer there are lots of great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2501) [things in Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2502) [And there are also some things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2504) [that we didn't even talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2505) [like for instance, over a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2507) [hundred new warnings and support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2508) [for C++ 17 standard library](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2510) [function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2513) [So if you want to learn more we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2515) [have the video and the slides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2517) [available on the website soon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2519) [available on the website soon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2519) [And if you're here at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2521) [conference come join us at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2521) [lab this afternoon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2523) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2524) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/409/?time=2525)