# Understanding Crashes and Crash Logs

## Summary
Sudden app crashes are a source of bad user experience and app review rejections. Learn how crash logs can be analyzed, what information they contain and how to diagnose the causes of crashes, including hard-to-reproduce memory corruptions and multithreading issues.

## Info
* Developer Tools
* WWDC 2018 - Session 414 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=7) [&gt;&gt; Oh yeah, good morning, thank](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=19) [you for coming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=22) [I'm going to be joined by some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=26) [very bright people in a minute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=27) [We have some very cool stuff](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=29) [prepared for you today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=30) [So let me start first by saying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=34) [if you never write code that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=37) [crashes this session is not for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=39) [you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=42) [This is a talk for the rest of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=43) [us, for those of us who make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=45) [mistakes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=47) [Today we're going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=49) [the tools and techniques that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=51) [you can use to stay on top of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=53) [your crashes if they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=55) [affecting your users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=56) [In particular I'm going to cover](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=58) [In particular I'm going to cover](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=58) [the fundamentals of crashes, why](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=60) [do they happen, what do they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=62) [look like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=63) [Then I'm going to show you some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=65) [of the tools that we have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=67) [access crash logs when they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=68) [occurring in the wild.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=70) [Then Greg is going to come up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=72) [and give you some more detail on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=73) [how to read the content of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=76) [crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=77) [And then he's going to go in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=78) [depth in how to read a tricky](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=81) [memory issue with a crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=82) [And then Kuba will show you how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=84) [to catch threading races early,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=86) [these threading races lead to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=88) [crashes, and these crashes are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=89) [very hard to reproduce.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=91) [So first we should define it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=93) [what is a crash?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=96) [A crash is a sudden termination](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=98) [of your app when it attempts to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=101) [do something that is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=103) [allowed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=104) [So what's not allowed?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=104) [Well, sometimes it's impossible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=107) [for the CPU to execute code, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=109) [CPU won't divide by zero.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=111) [Or sometimes it's the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=114) [system that's enforcing some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=115) [policy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=117) [The operating system will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=119) [The operating system will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=119) [preserve the user experience by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=120) [killing your app if it's taking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=121) [too long to launch or it's using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=123) [too much memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=125) [Sometimes the programming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=128) [language you're using is trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=129) [to prevent a failure and will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=131) [trigger a crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=133) [A Swift array and NSArray will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=134) [halt your process if you attempt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=136) [to go outside of your array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=138) [bounds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=139) [Or sometimes it's you, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=141) [developer that's trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=142) [prevent a failure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=143) [You may have an API where you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=144) [assert is a parameter is non nil](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=146) [and that's perfectly all right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=148) [So stop me if you've seen this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=152) [before, this is what it looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=153) [like in Xcode in the debugger](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=155) [when the debugger is attached to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=158) [your app and has paused the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=159) [process just before your app is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=161) [terminated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=163) [And let's take a closer look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=164) [this backtrace on the left.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=166) [You can see here how the app was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=168) [started by the operating system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=171) [and while we're paused we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=173) [see how the main function was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=175) [called and functions are calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=176) [other functions within your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=178) [and eventually we get to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=180) [point where we hit a point where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=182) [in your code where the only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=184) [option is to crash, something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=185) [has gone wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=187) [And ultimately the debugger](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=189) [receives a signal that this app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=190) [is about to crash and pauses the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=192) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=196) [Now sometimes you're not always](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=196) [conveniently attached with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=198) [debugger like we are here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=199) [When you're not attached with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=201) [the debugger the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=203) [system will capture this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=204) [backtrace in plaintext and save](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=205) [it out to disk in a human](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=208) [readable crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=209) [Now the truth is one a release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=211) [build of your app crashes the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=214) [log doesn't actually look this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=216) [pretty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=217) [What's actually written out is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=218) [list of binary names and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=219) [addresses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=221) [This is a snippet from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=221) [unsymbolicated crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=223) [Now thankfully Xcode takes care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=226) [of symbolicating crash logs so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=227) [that what you'll see are those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=229) [pretty function names, file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=230) [names and line numbers that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=231) [you're familiar with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=233) [So there are a number of ways to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=234) [access these crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=238) [access these crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=238) [I'd like first to talk about how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=240) [you can access those crash logs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=242) [from your beta testers on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=243) [TestFlight and your customers on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=245) [the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=246) [You can download these crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=248) [logs using a feature in Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=250) [called the Crashes Organizer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=252) [this is what it looks like a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=254) [beautiful dark mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=255) [And let's take a tour through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=258) [this UI.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=259) [On the left, you can see all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=259) [your apps distributed over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=262) [TestFlight and the App Store and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=264) [we support all of our platforms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=266) [including watchOS and app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=267) [extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=269) [On the right, for a given crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=271) [point you can see the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=273) [unique devices affected and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=275) [group crash logs by similar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=278) [issue, by similar crash point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=279) [and we rank them in the source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=282) [list by the number of unique](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=283) [devices affected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=284) [And you can page through a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=286) [sampling of the individual logs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=288) [down below.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=289) [And when you click on this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=291) [button you can open the crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=292) [log in your project, in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=295) [debug navigator and see it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=296) [alongside your source code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=297) [This is very cool if you haven't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=299) [This is very cool if you haven't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=299) [seen it before, we'll see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=300) [in a bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=301) [And in the detailed view of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=303) [course we show you a fully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=304) [symbolicated backtrace with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=305) [crash point highlighted.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=307) [So now that we have the lay of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=309) [the land let's play with it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=310) [So I have Xcode open here and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=313) [I'm going to open up the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=316) [Organizer window and you can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=318) [that I've selected the Crashes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=321) [tab, that's the second tab here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=322) [and I've selected this chocolate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=324) [chip app that Kuba and I are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=326) [working on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=327) [And I've uploaded this build to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=328) [TestFlight and you can see I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=331) [looking at build 5 right now and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=332) [a number of testers are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=335) [reporting crashes, so that's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=336) [too good.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=338) [But I've worked on a couple of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=338) [these crashes you can see, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=339) [this first one I haven't worked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=341) [on yet so let's try to resolve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=342) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=344) [So this is affecting 242 devices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=345) [and I can see the backtrace that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=349) [was captured from the time that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=350) [the app crashed and the crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=351) [point highlighted.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=353) [Now I'm not quite sure what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=355) [going on yet but I bet if I open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=355) [this crash log in our source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=358) [this crash log in our source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=358) [code I can reason about what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=360) [going on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=361) [So I'm going to click the Open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=362) [in Project button, select the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=363) [project that matches build 5 of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=365) [my app and what I do, what you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=367) [can see is that this crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=370) [has opened up in the debug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=372) [navigator as if this app has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=373) [just crashed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=375) [And you can see here that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=376) [stopped on this fatal error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=377) [So a good question to ask myself](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=380) [is, is this a valid use of fatal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=382) [error, I only want to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=383) [crashing if it's absolutely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=385) [necessary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=386) [So I can see that this is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=388) [initializer of an enum from an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=391) [int and that enum can only be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=393) [zero or one, if it's not I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=396) [hit this fatal error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=398) [So I think that this makes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=400) [sense, this should only be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=401) [crashing if there's some kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=402) [misuse by the programmer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=403) [So I can see the caller of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=405) [initializer if I navigate up the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=408) [call stack here and I can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=410) [it's this tableView delegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=413) [method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=414) [This method is asking for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=414) [title for a header in a given](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=416) [section number.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=418) [So it must be that that section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=419) [So it must be that that section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=419) [number is not zero or one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=420) [So I think I have a better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=422) [understanding of what's going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=423) [on, but let's try to reproduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=424) [this issue in the app and see if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=426) [we can learn more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=428) [So I've hit play.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=429) [And Chocolate Chip is a recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=431) [app I store all of my favorite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=433) [recipes and I've been testing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=434) [with this whipped cream recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=437) [and you can see everything's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=439) [fine, I can see my list of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=440) [ingredients, my list of steps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=441) [These are the two recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=442) [sections, that's ingredients](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=443) [that's section zero and steps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=445) [that's section one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=446) [And if I click on another recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=448) [we've hit a crash and what I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=450) [see is that we're stopped on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=453) [same fatal error and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=455) [backtrace looks very similar to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=457) [the crash log that we've been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=459) [looking at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=460) [So that's a very good sign that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=460) [we're looking at the same issue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=461) [So I'm going to clear this crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=463) [log by hitting delete and let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=464) [look at this debug session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=467) [So in this fatal error I can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=470) [that the message is nicely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=472) [printing out that the section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=473) [number is eight.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=475) [So that's the reason we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=476) [crashing it's not zero or one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=476) [And what's occurring to me now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=479) [And what's occurring to me now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=479) [is that this is my fault, when I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=480) [implemented this class I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=482) [implemented another delegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=485) [method called numberOfSections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=486) [And numberOfSections is saying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=488) [how many headers it should look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=490) [for and what I'm returning here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=492) [is the number of ingredients and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=494) [the ingredients count is eight.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=495) [But believe it or not I have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=498) [clever way to solve this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=499) [I know what I want to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=501) [returning is the number of cases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=502) [in this recipe section enum and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=504) [I know that in Swift 4.2 some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=506) [new functionality was added by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=508) [the Swift Open Source Community,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=510) [thank you very much, a protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=512) [called CaseIterable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=513) [If I have my recipe section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=515) [conformed to CaseIterable I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=517) [reimplement this number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=520) [sections to return the count of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=521) [all the cases in that recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=523) [section enum.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=526) [And that way what I'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=527) [returning is two, I'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=529) [returning the number of accurate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=531) [sections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=533) [This is going to work out just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=533) [great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=536) [So now if I check out this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=537) [chocolate chip cookies recipe no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=539) [chocolate chip cookies recipe no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=539) [crash, I see all of my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=540) [ingredients and my steps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=542) [I did a very good job, I'm very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=544) [pleased with myself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=546) [And I can go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=548) [Organizer and mark this issue as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=550) [resolved, step away from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=552) [computer and get back to my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=553) [baking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=555) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=558) [Okay so you've just see how you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=563) [can use the Crashes Organizer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=564) [download crash logs from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=567) [TestFlight, open the log in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=568) [source code, and resolve an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=570) [issue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=572) [So what do you need to do to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=572) [started?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=575) [Very simple, your customers if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=576) [they opt into sharing with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=580) [third-party developers this just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=581) [works, their crash logs are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=582) [uploaded automatically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=583) [All you need to do is sign into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=586) [Xcode with your Apple ID.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=587) [When you upload your app you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=590) [should include symbols so that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=592) [you get server-side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=593) [symbolication of your crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=594) [logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=597) [And open up the Organizer window](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=598) [to the Crashes tab to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=599) [to the Crashes tab to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=599) [viewing those crashes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=601) [Okay so we have covered viewing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=605) [crashes in the Organizer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=607) [But if you're not distributing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=609) [over TestFlight or the App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=610) [there are a couple of other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=612) [options for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=613) [There is the devices window.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=615) [When you have a device connected](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=618) [you can click this View Logs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=620) [button and will show you all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=621) [logs that are saved on that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=623) [device and these logs are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=624) [symbolicated using the local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=625) [symbol information on your Mac.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=627) [When you run your [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=630) [tests with Xcode, Xcode Server](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=631) [or Xcode Build the test results](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=634) [bundle will include any of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=637) [crash logs that come from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=639) [app that are written out during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=640) [the execution of that test run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=642) [and that's very convenient and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=643) [these crash logs are also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=645) [symbolicated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=646) [You can use the Mac Console app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=647) [to view any crash logs from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=650) [Mac or from the Simulator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=653) [And on the device under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=655) [Settings, Privacy, Analytics,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=657) [Analytics Data you can see all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=659) [Analytics Data you can see all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=659) [of the logs that are saved to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=661) [disk and your users can share a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=662) [log directly from this screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=664) [Okay so to ensure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=668) [symbolication just works I have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=671) [three important best practices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=673) [for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=674) [Number one, if you use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=676) [Crashes Organizer upload your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=678) [symbols with your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=680) [This is the default, this will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=682) [ensure that server-side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=683) [symbolication works, it's very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=685) [easy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=687) [Number two, be sure to save your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=688) [app archives.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=691) [Your archive contains a copy of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=693) [your debug symbols, your .](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=694) [Xcode uses Spotlight to find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=697) [these dSYMs and to perform local](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=699) [symbolication when it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=701) [necessary automatically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=702) [And if you upload an app that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=703) [contains bitcode you should use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=707) [the Archives Organizer Download](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=709) [Debug Symbols button to download](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=711) [any dSYMs that come from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=713) [store-side bitcode compilation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=715) [Okay we've covered all the tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=717) [Okay we've covered all the tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=717) [that we offer for accessing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=721) [crash logs when they occur in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=722) [the field.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=724) [Now to give you an in-depth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=725) [guide into reading the content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=726) [of a crash log please give a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=728) [warm welcome to the helping,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=729) [friendly Greg Parker.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=730) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=732) [&gt;&gt; Thank you, Chris.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=738) [So we've just seen how you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=739) [use Xcode to find crashes and to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=740) [examine them in the Xcode tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=743) [in the debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=746) [But the crash log file contains](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=748) [more information, it contains](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=750) [much more information than just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=752) [the stack trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=753) [It is frequently useful to look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=755) [at that extra information in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=757) [order to debug your problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=759) [So how can you get the full text](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=761) [of a crash log?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=763) [Here's our Xcode Organizer, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=765) [we bring up the contextual menu](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=767) [there's a Show In Finder button.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=769) [The Show In Finder button will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=771) [bring up a text file which we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=773) [can open up in the Console app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=774) [or your favorite text editor, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=776) [looks something like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=778) [So what's in this file, let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=780) [take a look.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=782) [The top of the file starts with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=783) [some summary information, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=785) [contains your app name, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=787) [version number, the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=789) [system version it was running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=791) [on, and the date and time of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=793) [crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=794) [Below that we have the reason](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=796) [for the crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=798) [This was the specific error, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=799) [specific signal that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=801) [operating system sent to kill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=803) [the process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=805) [We can also see some logging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=807) [information, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=809) [application-specific information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=810) [section.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=813) [This section will include](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=814) [console logs in some cases, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=815) [you have an unhandled exception](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=818) [it may include the exception](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=819) [backtrace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=821) [This section is not always](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=822) [available, on iOS devices it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=824) [often hidden for personal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=827) [privacy reasons.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=829) [But on Simulator to macOS this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=831) [section can include information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=833) [that is useful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=835) [Below that we have the thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=837) [stacks, these were the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=838) [stacks, these were the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=838) [backtraces of all the threads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=840) [that were running at the time of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=842) [the crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=843) [One of them is marked as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=844) [crash thread and we also have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=845) [whatever other threads were](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=848) [running at the time that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=849) [process died.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=851) [Below that we have some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=853) [low-level information, we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=855) [the register state of the thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=857) [that crashed and we have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=859) [binary images that were loaded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=861) [into the process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=863) [This is the application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=865) [executable and all the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=867) [libraries.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=868) [And Xcode uses this for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=870) [symbolication in order to look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=872) [up the symbols, the files and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=874) [line number information for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=877) [stack traces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=878) [So that's the content of a crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=879) [log file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=882) [So how do we debug this, how do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=884) [we read this, what do we look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=885) [at?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=887) [We start with the crash reason,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=888) [the exception type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=891) [In this case, the exception type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=893) [is an EXC bad instruction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=894) [exception, the SIGILL signal was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=896) [exception, the SIGILL signal was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=896) [the illegal instruction signal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=900) [That means the CPU was trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=903) [execute an instruction that does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=905) [not exist or is invalid for some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=907) [reason and that's why the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=909) [process died.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=910) [We can also look at the thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=912) [that crashed, what code was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=916) [running at the time of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=918) [crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=919) [Here we see the fatal error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=920) [message function in the Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=922) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=925) [No guesses as to what the fatal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=926) [error message function does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=928) [The error message in this case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=930) [is included in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=933) [application-specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=933) [information, so we can see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=935) [the Swift runtime printed as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=937) [process exited.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=939) [So let's take a closer look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=945) [that stack trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=946) [We saw the fatal error message](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=948) [function and that was called by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=950) [a function in our code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=953) [We have a recipe class, an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=955) [function being called and that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=957) [function being called and that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=957) [function in turn called fatal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=961) [error message as a result of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=963) [some error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=964) [Because this is a symbolicated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=966) [stack trace with full debug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=968) [information we have a file and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=970) [line number in our code of what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=972) [the crash was.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=974) [So we can take a look at that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=976) [line, we can open up our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=977) [project, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=979) [RecipeImage.swift, line 26 was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=980) [the one that was marked in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=984) [crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=985) [And those of you who are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=986) [experienced Swift programmers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=987) [will have a pretty good guess as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=989) [to why this line might crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=991) [We have a force unwrap operator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=993) [We have a function, The UIImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=997) [Constructor which returns an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1000) [optional value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1001) [If the optional value is nil the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1003) [force unwrap operator will halt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1005) [the process, generate a crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1008) [log and exit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1010) [If we remember the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1013) [application-specific information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1014) [it included the error message](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1017) [that the Swift runtime prints as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1019) [that the Swift runtime prints as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1019) [this error check fails and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1021) [says, unexpectedly found nil](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1023) [while unwrapping an optional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1025) [value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1026) [So that's good, that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1028) [consistent with the code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1030) [We have a force unwrap operator](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1032) [on line 26, we have an error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1034) [message in the crash log that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1037) [says we were unwrapping an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1039) [optional value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1040) [This all makes sense as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1042) [consistent story for what caused](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1043) [this crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1045) [So a force unwrap failure is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1048) [example of a precondition or an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1052) [assertion in the code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1054) [Preconditions and assertions are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1056) [error checks that deliberately](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1058) [stop the process when an error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1059) [occurs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1061) [Some examples of this are of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1063) [course the force unwrap of an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1065) [optional that we just saw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1067) [The Swift runtime will assert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1068) [that the optional is not nil and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1071) [crash if it is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1073) [We have out-of-bounds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1075) [Swift.Array access is another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1076) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1078) [If you access an array and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1079) [If you access an array and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1079) [index is out-of-bounds the Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1082) [runtime will fail, interim check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1084) [it will fail a precondition and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1086) [halt the process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1087) [Swift arithmetic overflow also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1090) [contains assertions, if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1092) [adding two numbers together and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1094) [the result is too large for an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1095) [integer variable there is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1097) [precondition for that, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1098) [process will halt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1100) [Uncaught exceptions are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1102) [frequently caused by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1104) [preconditions in the code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1106) [There are many error checks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1108) [where if the precondition fails](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1110) [it will throw an exception and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1112) [if the exception is not caught](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1114) [the uncaught exception will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1116) [cause a crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1118) [And of course you can write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1119) [assertions and preconditions in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1122) [your own code if you have errors](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1123) [that you want to crash the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1126) [process and generate a crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1127) [in response.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1129) [Another example of a crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1132) [is a case where the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1134) [system kills your process from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1137) [the outside.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1139) [the outside.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1139) [An example of this are watchdog](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1140) [events, such as timeouts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1143) [If your application takes too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1146) [long to do something the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1147) [operating system may detect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1149) [that, kill the process of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1151) [generate a particular crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1153) [as it does so.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1155) [Environmental conditions can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1157) [also cause the operating system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1158) [to halt the process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1160) [If the device is overheating the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1161) [operating system will kill](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1164) [processes that are using too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1165) [much CPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1166) [If the device is running out of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1168) [memory the operating system will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1169) [kill processes that are using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1171) [lots of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1172) [Another case is an invalid code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1174) [signature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1176) [The operating system enforces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1177) [that code be signed and if a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1179) [signature is invalid or the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1181) [is unsigned the operating system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1183) [will kill the process and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1185) [generate a particular type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1187) [crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1188) [These terminations by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1191) [operating system can be found in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1192) [the Devices window in Xcode,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1193) [they can be found on the macOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1195) [console.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1197) [They do not always appear in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1198) [They do not always appear in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1198) [Xcode Organizer, so be careful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1200) [of that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1202) [In Apple's developer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1204) [documentation we have a technote](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1206) [that describes many different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1209) [signatures and structures of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1211) [crash logs like these particular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1213) [examples, what they look like,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1214) [how you can recognize them, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1216) [it goes into much more detail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1219) [than we have time for here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1220) [But let's look at one example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1223) [here's another crash log file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1225) [and again in order to understand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1227) [the crash log we start with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1229) [crash reason.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1231) [In this case the crash reason is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1232) [in EXC crash exception with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1234) [SIGKILL signal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1237) [The SIGKILL signal is commonly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1239) [used when the operating system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1241) [wants to stop your process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1243) [It sends the SIGKILL signal, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1246) [SIGKILL signal cannot be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1248) [handled, it cannot be caught by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1250) [your process, it will die in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1251) [response to this signal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1253) [We can also see the reason the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1256) [operating system sent the signal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1258) [operating system sent the signal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1258) [in the crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1260) [In this case we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1261) [termination reason with a code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1262) [ate bad food.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1264) [If you look in the developer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1266) [technote I mentioned earlier, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1268) [will describe what ate bad food](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1269) [means.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1271) [And we have a textual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1273) [description that says exhausted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1274) [real clock time allowance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1276) [19.95 seconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1278) [So if we combine this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1280) [information with the information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1282) [in the technote it will tell us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1283) [our application took too long to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1285) [launch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1288) [We had 20 seconds to launch, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1289) [weren't done in that much time,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1291) [the operating system killed the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1293) [process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1294) [Below we can see the crash logs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1296) [at the time the process died.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1299) [It's possible that those crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1301) [logs were the code that took too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1302) [long, maybe were stuck in an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1304) [infinite loop, maybe were stuck](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1305) [waiting for network I/O and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1308) [that's why we took too long to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1309) [launch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1311) [Or on the other hand, maybe this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1312) [code is innocent and there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1314) [something earlier in the launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1315) [process that was too slow and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1317) [that's why the process died.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1319) [that's why the process died.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1319) [So launch timeouts, how can you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1323) [avoid them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1326) [We want you to avoid them,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1327) [launch timeouts are a common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1328) [reason for app rejection during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1330) [Apple's app review.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1333) [So how do you avoid this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1335) [Well test your app of course.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1337) [But there's a catch, the launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1339) [timeout watchdog is disabled in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1343) [the Simulator and it's disabled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1346) [in the debugger so if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1347) [doing all your testing in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1349) [Simulator and the debugger](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1350) [you'll never see watchdog](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1352) [timeouts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1353) [So when you test your app be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1355) [sure to test without the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1357) [debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1359) [If you're a macOS app launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1360) [your app in the Finder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1362) [If you're an iOS app run in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1363) [TestFlight or launch your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1366) [using the iOS App Launcher.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1369) [All of these will run your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1371) [outside the debugger and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1372) [launch timeouts will be enabled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1374) [and enforced.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1376) [When you test, test on a real](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1378) [device of course, test outside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1379) [device of course, test outside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1379) [of Simulators.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1381) [And test your devices with older](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1382) [hardware, whatever's the oldest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1386) [hardware you want your app to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1388) [support.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1389) [If you test only on newer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1391) [hardware you might find that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1392) [your app launches fast enough on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1394) [a faster device, but slower](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1396) [devices might take too much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1398) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1400) [So let's talk about another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1403) [class of errors, let's talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1405) [about memory errors and what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1407) [they look like in crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1408) [When I say memory error I mean](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1412) [cases like reference counting of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1414) [an object being over-released or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1417) [using an object after it has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1420) [been freed or a buffer overflow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1422) [where you have a byte array or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1425) [another C array and you access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1428) [that array out-of-bounds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1430) [So let's look at another crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1433) [log and spoiler alert this one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1435) [is a memory error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1437) [We start again with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1439) [We start again with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1439) [exception type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1441) [This is an EXC bad access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1443) [exception, the SEG violation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1446) [signal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1449) [This is typically caused by a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1450) [memory error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1452) [The bad access exception means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1453) [one of two things, either we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1455) [were writing to memory that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1457) [read-only or we were reading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1459) [from memory that does not exist](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1461) [at all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1463) [Either of those will cause a bad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1464) [access exception and the process](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1465) [will stop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1467) [We see here the address that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1469) [were accessing at the time of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1472) [the crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1475) [We can look at the stack trace,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1476) [this is the function that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1478) [performed the bad access of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1479) [course.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1480) [This is the objc release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1481) [function, it's part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1483) [implementation of reference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1485) [counting in Objective-C and some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1487) [Swift objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1489) [So that again sounds like it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1490) [likely to have been a memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1492) [error that caused the bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1494) [So what code caused objc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1497) [release?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1499) [release?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1499) [We can look at the rest of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1500) [stack trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1501) [We have the object dispose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1503) [function, this is a function in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1505) [the Objective-C runtime that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1507) [used to deallocate objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1509) [The object dispose function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1512) [called a function called ivar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1514) [destroyer on one of our classes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1516) [our LoginViewController class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1518) [The ivar destroyer function is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1521) [part of Swift code, this is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1524) [function that cleans up the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1526) [properties, that cleans up the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1527) [ivar storage of an object as it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1529) [is deallocated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1531) [So that gives us part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1533) [story as to what caused this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1535) [crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1536) [We were deallocating an object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1537) [of our login view controller](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1539) [class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1541) [That class in its d init code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1543) [was trying to clean up its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1546) [properties and its ivars and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1547) [while releasing one of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1549) [properties we crashed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1551) [So that gives us a little bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1553) [detail as to what went wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1555) [Can we do better, is there more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1556) [information in the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1558) [information in the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1558) [that will tell us more about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1560) [what happened?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1561) [We can look at the invalid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1563) [address itself, sometimes the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1565) [actual bad address value will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1568) [contain useful information in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1570) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1573) [And this particular bad address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1573) [I can tell you looks like a use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1576) [after free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1578) [Well how do I know that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1580) [Partly it's just long](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1581) [experience, when you read enough](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1582) [crash logs you start to learn](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1584) [patterns of what the bad values](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1586) [are.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1588) [This particular bad value looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1589) [very much like the address range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1592) [for the malloc memory allocator](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1595) [which we happen to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1598) [available in this crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1599) [So we have the address range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1601) [that was used by the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1603) [allocator and our invalid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1604) [address looks like it's inside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1606) [the malloc range, but it's been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1609) [shifted by 4 bits, it's been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1611) [rotated by 4 bits.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1613) [So it looks like it was a valid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1615) [malloc address rotated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1617) [That is a clue from the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1621) [allocator itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1623) [Let me show you why that is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1625) [Here's what our object looked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1627) [like when it was still valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1628) [An object starts with an isa](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1631) [field, the isa field points to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1633) [the object's class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1635) [This is how Objective-C objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1637) [are laid out, this is how some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1639) [swift objects are laid out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1640) [So what does the objc release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1642) [function do?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1644) [It reads the isa field and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1646) [dreferences the isa field so it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1648) [can get to the class object and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1650) [perform method lookups.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1652) [Ordinarily of course this works,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1655) [this is how it's supposed to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1657) [work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1658) [What happens if our object has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1659) [already been freed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1660) [When the free function deletes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1662) [an object it inserts it into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1666) [free list of other dead objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1669) [And it writes a free list](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1673) [pointer to the next object in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1675) [the list where the isa field](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1677) [used to be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1679) [used to be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1679) [With one slight twist, it does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1681) [not write a pointer into that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1683) [field it writes a rotated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1685) [pointer into that field.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1687) [It wants to make sure that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1689) [value written there is not a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1690) [valid memory address precisely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1693) [so that bad use of the object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1696) [will crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1698) [So when objc release goes to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1699) [read the isa field it instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1702) [gets a rotated free list](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1704) [pointer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1706) [When it dreferences the rotated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1707) [free list pointer it crashes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1709) [The memory allocator did that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1711) [for us, it deliberately rotated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1713) [that pointer to make sure we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1714) [would crash if we tried to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1716) [it again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1718) [So that is the signature we see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1719) [in this crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1722) [We had the invalid address field](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1723) [looks like a pointer in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1726) [malloc region but rotated the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1728) [same way that malloc rotates its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1730) [free list pointers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1732) [So that's a strong sign that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1734) [whatever object we are trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1736) [release at this point in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1738) [release at this point in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1738) [code has already been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1740) [deallocated, that's the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1741) [error that occurred.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1743) [So that's additional detail of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1746) [what our story is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1748) [We have our object being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1749) [deallocated, we're cleaning up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1750) [its ivars, one of those ivars](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1752) [was already a freed object and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1755) [that's what caused our crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1757) [Can we do better?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1759) [Can we figure out which object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1760) [was being released by objc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1763) [release?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1765) [Ordinarily, the function calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1767) [objc release would give us a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1769) [clue as to what that was.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1771) [But the problem with the ivar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1773) [destroyer function is it is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1775) [compiler generated function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1777) [We didn't write a function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1779) [called ivar destroyer, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1781) [means there's no filename or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1782) [line number associated with this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1784) [point in the crash, we don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1786) [know which of our properties was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1788) [being deallocated at that point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1790) [Here's our class, we have three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1793) [properties in this class, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1795) [have a username, a database, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1796) [an array of views.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1798) [And at this point in our story](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1800) [we don't know which of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1802) [objects was the one being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1803) [released, it could've been any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1805) [of them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1806) [Can we do better, can we work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1808) [out which of those objects was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1810) [the one being released from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1813) [information in the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1814) [because of course if we can't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1816) [reproduce it in the debugger the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1818) [crash log is all we have to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1819) [on?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1821) [In this case we can do better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1822) [We can see a +42 where the file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1825) [and line number would've been.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1830) [And the +42 is our clue because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1831) [the +42 is an offset in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1835) [assembly code of the function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1837) [We can disassemble the ivar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1840) [destroyer function, look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1841) [code and work out which property](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1843) [was being accessed at offset 42.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1846) [So how does that work?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1850) [We go into the debugger, into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1851) [the debugger console.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1853) [We can run lldb at a terminal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1855) [We can run lldb in the Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1858) [We can run lldb in the Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1858) [debug terminal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1861) [The debugger has commands to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1864) [import a crash log a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1867) [as if it crashed inside the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1869) [debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1873) [So we run this command to load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1874) [the crash log interpretation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1876) [commands and then we run another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1878) [command to import our crash into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1881) [the debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1883) [So we want three things to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1885) [this work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1887) [We want a copy of our crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1888) [on the Mac, we also want a copy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1890) [of our app, and a copy of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1893) [dSYM file that went with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1896) [app, all of them matching this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1898) [crash log, all the same version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1901) [of our app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1903) [So this is why we want you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1903) [keep your app archives.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1905) [If we have all these files on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1908) [the Mac, we run the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1909) [command, lldb uses Spotlight to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1911) [find the matching executable,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1914) [find the matching symbols, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1916) [load it into the debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1918) [So we see the stack trace of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1920) [crash thread, we see the file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1922) [and line number information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1924) [where available, and now we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1926) [go to work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1927) [Now we can find the address of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1929) [the ivar destroyer function and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1930) [disassemble it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1933) [This shows us the assembly code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1935) [of our function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1937) [Now I don't have time to teach](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1940) [you how to read assembly code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1941) [but luckily for crash logs you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1943) [don't actually have to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1945) [completely fluent in reading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1947) [assembly code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1949) [It often is sufficient to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1950) [able to skim the assembly code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1952) [and get a general idea of what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1953) [is going on, you don't have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1955) [understand every single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1957) [instruction to be able to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1958) [useful information out of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1959) [crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1961) [If we read through this function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1963) [and we know about the call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1966) [instruction and the jump](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1967) [instruction which are how you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1970) [call functions, we can separate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1971) [this code into three blocks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1974) [We have this top section which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1977) [We have this top section which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1977) [is making a function call into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1980) [reference count releasing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1983) [function and this one is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1984) [releasing our username property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1986) [The next region is releasing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1990) [database property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1992) [And the next region is releasing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1994) [the views property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1996) [So we don't understand what all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=1998) [these instructions mean, but we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2001) [have a general sense of what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2002) [each region in the code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2004) [doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2006) [It's a little bit like having a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2006) [line number associated with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2007) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2010) [So now we go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2011) [information in our crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2013) [We had the ivar destroyer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2015) [function +42 calling objc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2017) [release.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2021) [So there is instruction at +42,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2023) [but there is one more catch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2027) [The catch is in a stack trace](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2029) [the assembly level offset of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2032) [most stack frames is the return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2034) [address, it is the instruction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2036) [after the function call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2038) [after the function call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2038) [So the instruction of the called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2040) [objc release was the previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2042) [instruction, it's this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2044) [instruction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2045) [If we read this it's the call of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2046) [objc release which is good,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2049) [that's consistent with what we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2051) [saw in the stack trace in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2053) [crash log which was a call to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2055) [objc release at this offset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2056) [And this release function is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2060) [releasing the database property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2062) [So now we have more detail about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2065) [what our crash is doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2068) [We released the username](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2069) [property and that was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2071) [successful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2072) [We have not yet gotten to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2073) [views property, it might be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2075) [valid, it might be invalid we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2077) [don't know.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2078) [What we do know is we tried to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2079) [release the database property](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2081) [and that object looked like it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2084) [was already freed object based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2086) [on the malloc free list pointer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2089) [signature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2090) [So that gives us a pretty good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2092) [story of what caused this crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2093) [We were freeing a login view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2096) [controller object and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2097) [database property was invalid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2099) [database property was invalid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2099) [So we haven't actually found a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2104) [bug yet, none of this code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2106) [incorrect, the ivar destroyer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2108) [function is not wrong, something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2109) [else was buggy in our code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2111) [But from the crash log we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2114) [been able to narrow down where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2115) [our testing should go, where our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2117) [attempts to reproduce the bug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2120) [should go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2122) [We should be exercising this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2122) [class, we should be exercising](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2124) [the database field, we should be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2126) [reading the code that uses that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2127) [database object and try and find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2130) [the bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2132) [So what have we just done?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2132) [We read a crash log from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2137) [scratch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2138) [We started with the crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2138) [reason, we read the exception](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2140) [type, we understand what the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2142) [exception type means.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2143) [We examined the stack trace of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2145) [the thread that crashed,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2148) [understand what it was doing,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2150) [and what the actual error that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2152) [failed was.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2154) [And we looked for clues](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2155) [elsewhere in the crash log, in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2157) [this case we used the bad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2159) [this case we used the bad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2159) [address of the memory error and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2160) [we used the disassembly of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2163) [crashing function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2165) [So memory errors are a wide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2167) [variety of crashes, there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2172) [many different signatures in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2174) [crash logs that can be caused by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2176) [memory errors.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2178) [Here are some examples for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2179) [Crashes in the Objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2182) [message send function or in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2184) [reference counting machinery or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2186) [deallocation machinery in Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2188) [and Objective-C are very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2191) [commonly caused by memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2192) [errors.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2194) [Another common memory error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2197) [symptom is an unrecognized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2198) [selector exception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2200) [These are often caused when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2203) [have an object of some type, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2205) [code that is using that object,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2207) [and then the object gets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2210) [deallocated and used again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2211) [But instead of getting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2214) [malloc free list signature that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2215) [we saw in that previous crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2217) [log, instead a new object is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2219) [log, instead a new object is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2219) [allocated at the same address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2222) [where the old object used to be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2224) [So when the code tries to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2226) [the old object, call a function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2229) [on the old object, we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2231) [different object of a different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2233) [type at that same address and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2234) [doesn't recognize that function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2237) [at all and we get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2239) [unrecognized selector exception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2240) [One other common symptom of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2244) [memory errors is an abort inside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2247) [the memory allocator itself,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2250) [inside the malloc and free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2251) [functions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2253) [This is an example of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2253) [precondition like we saw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2255) [earlier, this is a precondition](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2257) [inside the memory allocator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2259) [It may be identifying cases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2262) [where the heap data structure of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2264) [the malloc memory itself has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2267) [been corrupted by a memory error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2269) [and it halts the process and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2271) [response.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2272) [Or it may be detecting incorrect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2274) [use of the malloc APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2276) [For example, if you free an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2279) [For example, if you free an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2279) [object twice in a row the malloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2281) [allocator can sometimes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2283) [recognize that as a double free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2284) [and immediately halt the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2287) [process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2288) [So let me give you some final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2291) [tips for analyzing crash logs in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2293) [general and analyzing memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2295) [errors in particular.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2297) [In the crash we just looked at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2300) [we spent most of our time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2302) [looking at the code that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2303) [crashed, the specific lines of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2304) [code that crashed, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2306) [thread that crashed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2307) [It is important to look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2309) [other code in your process](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2311) [related to the code that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2313) [crashed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2315) [For example, in this crash the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2315) [ivar destroyer function is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2319) [wrong, that's not where the bug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2320) [is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2322) [The bug is somewhere else, some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2322) [other code is incorrect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2325) [You should also look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2329) [stack traces in the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2330) [other than the crashed thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2332) [The crash log contains all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2335) [stack traces in the process and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2338) [that can contain useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2339) [that can contain useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2339) [information and clues for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2341) [helping you puzzle out what the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2343) [process was doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2344) [Perhaps the other threads show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2346) [more details about where in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2348) [application it was running,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2350) [maybe it was performing network](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2351) [code and that's visible on one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2353) [of the other stack traces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2354) [Or perhaps there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2357) [multithreading error and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2358) [other threads may provide clues](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2360) [as to what the thread race was.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2362) [You should also look at more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2366) [than one crash log for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2368) [particular crash cause.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2371) [The Xcode Organizer helpfully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2373) [groups your crashes based on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2375) [where in the code they crashed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2377) [And sometimes there will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2380) [multiple crashes at a same crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2383) [point, but some of the logs will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2385) [contain more information than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2387) [others.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2389) [For example, the malloc free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2390) [list signature that we just saw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2392) [that might appear in some crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2394) [logs but not in others.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2396) [So it is useful to browse](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2398) [So it is useful to browse](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2398) [through multiple crashes in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2400) [same crash set to see if some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2402) [them have information that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2404) [more useful than others.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2406) [In addition, the Organizer as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2408) [group crashes together will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2411) [sometimes put crashes with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2413) [different causes together in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2415) [same group.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2418) [There may be other threads or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2419) [the backtrace of a crashed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2421) [thread that identify to you, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2422) [a human eye you will recognize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2426) [that there are multiple causes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2428) [of this group of crashes even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2429) [though the Xcode Organizer put](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2431) [them all together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2433) [If you only looked at one crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2434) [log you might not even know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2436) [that second crash is occurring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2438) [until you fix the first one and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2440) [ship it and start getting crash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2442) [logs from your users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2444) [Once you've done some analysis](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2448) [of your crash, once you've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2450) [narrowed down where in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2451) [process it might be occurring or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2453) [which objects it might've been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2455) [using you can use tools like the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2456) [Address Sanitizer and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2458) [Address Sanitizer and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2458) [Zombies instrument to try and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2460) [reproduce the crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2462) [Because even though we did a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2464) [good job with the malloc free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2465) [list crash log of narrowing down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2467) [what happened it's a lot easier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2469) [to debug crashes when they occur](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2471) [in a debugger, in a test with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2473) [Sanitization error messages](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2476) [telling you what went on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2478) [So a moment ago I mentioned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2480) [looking up multiple stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2483) [traces, multiple thread stacks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2484) [in order to diagnose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2487) [multithreading errors.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2488) [And to talk more about debugging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2490) [multithreading errors let me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2492) [introduce Kuba.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2494) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2495) [&gt;&gt; Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2501) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2503) [As Greg mentioned, some memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2505) [corruptions can be caused by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2507) [multithreading issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2509) [Multithreading bugs are often](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2511) [one of the hardest types of bugs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2512) [to diagnose and reproduce.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2514) [They get especially hard to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2517) [reproduce because they only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2518) [cause crashes once in a while,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2519) [cause crashes once in a while,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2519) [so your code might seem to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2521) [fine in 99% of cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2523) [And these bugs can go unnoticed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2526) [for a very long time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2528) [Often monitoring bugs cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2531) [memory corruptions and what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2533) [you'll see in crash logs looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2534) [just like memory corruptions as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2536) [well and we've seen examples of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2537) [those in the previous section.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2539) [So when you're dealing with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2541) [crashes inside the malloc or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2542) [free or retained counting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2543) [operations those are typical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2545) [symptoms of memory corruptions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2547) [There's specific symptoms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2550) [multithreading bugs as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2551) [The crashing thread often](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2553) [contains, sorry the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2555) [often contains multiple threads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2557) [that are executing related parts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2559) [of your code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2561) [So if a particular class or a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2562) [method shows up in a crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2564) [in multiple threads that's an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2565) [indication of a potential](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2568) [multithreading bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2569) [The memory corruptions that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2571) [caused by multithreading issues](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2573) [are often very random.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2575) [So you might see crashes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2576) [happening at slightly different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2578) [happening at slightly different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2578) [lines of code or slightly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2580) [different addresses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2581) [And as Greg mentioned, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2582) [see those show up as different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2584) [crash points in Xcode even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2587) [though it's the same bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2589) [And also the crashing thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2592) [might not actually be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2593) [culprit of the bug, so it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2594) [important to look at the stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2595) [traces of the other threads in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2598) [crash log.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2599) [So now let's take a closer look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2600) [at an example of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2602) [multithreading bug and I will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2603) [show you how we can diagnose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2604) [such a bug using a tool called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2606) [Thread Sanitizer which is part](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2607) [of Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2609) [So let's take another look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2619) [our cookies recipe app that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2620) [Chris and I made and let's look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2621) [at some more crash logs that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2623) [received from our users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2624) [Let's focus on this second app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2626) [crasher of our app, this one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2629) [This crash log indicates that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2632) [there's something wrong going on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2633) [when we're doing with a class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2634) [called LazyImageView, which is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2636) [class that I wrote and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2638) [look at it in just a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2639) [look at it in just a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2639) [But let's try to understand more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2641) [from the crash logs first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2642) [Let's look at the entire stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2643) [of this thread which I can do by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2647) [clicking this button right here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2648) [that also shows all other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2649) [threads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2651) [And if we focus at the top most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2653) [frames here we'll see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2654) [what's really going on is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2656) [the free function is calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2658) [abort which indicates a heap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2659) [corruption, a type of memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2661) [error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2662) [If we look at the stack traces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2663) [of some other threads, like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2666) [thread 5 here, we'll see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2667) [it's executing also some code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2670) [inside LazyImageView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2671) [Let's look at another crash in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2673) [this group of crashes and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2676) [see that this a common theme in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2679) [all these crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2681) [One thread is reporting a heap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2682) [corruption when the free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2684) [function is calling abort and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2685) [secondary thread is processing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2687) [in a very related part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2690) [code, actually in the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2692) [class, inside LazyImageView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2693) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2695) [That's most likely not a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2695) [coincidence, I highly suspect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2697) [that this is a multithreading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2699) [that this is a multithreading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2699) [issue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2700) [So let's actually take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2701) [our LazyImageView class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2704) [So I'll click this button right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2705) [here to jump straight to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2707) [line of code and open it in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2708) [project.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2710) [And you can see the source of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2711) [LazyImageView right here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2713) [It's a subclass of UIImageView,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2715) [but it has an extra feature](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2717) [because it loads images lazily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2719) [and asynchronously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2721) [And we can the logic for this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2722) [right here in the initializer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2724) [What we do is we dispatch a job](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2725) [to a background queue where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2728) [will create the image on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2730) [background thread and once that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2731) [is done we will dispatch back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2733) [the main queue to actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2735) [display the image on the screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2736) [The crash log points us to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2739) [line of code here where we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2740) [accessing an image cache which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2743) [we are using to make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2745) [we don't unnecessarily create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2747) [the same image multiple times.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2749) [So maybe there is some bug in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2751) [the way my cache is implemented.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2752) [Let's try to avoid guessing,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2754) [instead I'll run the app in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2756) [Simulator and we will try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2758) [reproduce this crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2759) [reproduce this crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2759) [And let me close the crash log](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2760) [session first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2762) [All right, so this is our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2763) [cookies recipe again and you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2765) [notice that if I try to add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2767) [new recipe by clicking this +](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2769) [button right here we get asked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2771) [to select an image for our new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2774) [recipe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2776) [So this controller which is on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2777) [the screen right now displays](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2778) [all these images using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2780) [LazyImageView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2782) [So just showing it up on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2783) [screen and scrolling through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2785) [content already exercises all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2787) [the code inside LazyImageView,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2789) [but I don't see any crashes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2791) [Unfortunately, it's a very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2793) [common problem with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2794) [multithreading bugs, they are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2795) [notoriously hard to reproduce.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2797) [So even when you repeatedly test](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2798) [the code that has such a bug you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2801) [might not actually see a crush.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2803) [Let's try actually doing that,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2805) [let's try closing and opening](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2806) [this controller a couple times](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2808) [and let's see if maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2810) [eventually we will be lucky and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2811) [we will be able to trigger this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2813) [crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2814) [All right here we go, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2820) [debugger has stopped because it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2821) [has crashed, but even when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2824) [actually do catch this crash in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2825) [the debugger it doesn't really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2827) [help us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2828) [All the debugger provides is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2830) [that this is some sort of XC bad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2831) [excess but it does not what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2833) [caused the corruption or why did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2835) [it actually happen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2837) [Luckily Xcode has a tool that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2839) [perfect just for this situation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2841) [and it's called Thread Sanitizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2843) [and that's what I'm going to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2844) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2845) [So let's open up the scheme](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2846) [editor of our project which I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2847) [can do by clicking the name of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2849) [our app here and choosing Edit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2850) [Scheme.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2852) [And if I then switch over to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2853) [tab called Diagnostics you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2855) [see that we have several runtime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2857) [diagnostic tools here, like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2860) [Address Sanitizer which is great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2861) [at finding buffer overflows.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2862) [Let me choose Thread Sanitizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2865) [and I'll also select Pause on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2866) [Issues which means that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2868) [debugger will break every time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2869) [that Sanitizer detects a bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2871) [Let's run the app in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2874) [Simulator with Thread Sanitizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2876) [enabled and let's see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2877) [happens now if I try to add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2878) [happens now if I try to add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2878) [new recipe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2880) [If I click the + button now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2883) [you'll see that he app gets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2885) [immediately stopped because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2886) [Thread Sanitizer found the bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2888) [And notice that I didn't have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2889) [try multiple times, Thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2891) [Sanitizer reproduces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2892) [multithreading issues extremely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2894) [reliably.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2895) [So let's look at some details of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2896) [this bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2898) [We see that it's a Swift access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2900) [race.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2902) [And if we look at the left side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2902) [into the debug navigator we get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2905) [even some more details about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2907) [this bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2908) [We see that there's two accesses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2909) [performed by two different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2911) [threads, here is thread 2 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2913) [thread 4, that are both trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2914) [to access the same memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2917) [location at the same time, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2918) [is not allowed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2920) [So if we take a look at these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2921) [two lines of code that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2924) [forming the race we see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2925) [they are both accessing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2927) [image cache again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2929) [So since this is a data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2931) [structure that is shared between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2932) [multiple threads as we see here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2934) [it needs to be a thread data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2936) [structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2937) [So let's look at how it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2938) [So let's look at how it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2938) [implemented, let's jump to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2940) [storage here which is what we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2941) [using and let's see if it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2943) [actually is thread safe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2944) [So here's the source of image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2946) [cache, right here at the top of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2948) [the file and we can immediately](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2949) [spot what's wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2951) [This is just a plain Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2952) [dictionary so that's not good.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2954) [Swift dictionaries are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2956) [thread safe by default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2957) [So if we want to share a mutable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2959) [Swift dictionary between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2961) [multiple threads we have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2962) [protect it with synchronization,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2965) [which means we have to make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2967) [that only one thread accesses it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2968) [at a time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2970) [So now let's actually work on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2971) [fixing this problem and making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2973) [the class thread safe and I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2974) [do that in two steps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2976) [First, I'll refactor this code a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2977) [little bit so that we have more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2981) [control over storage and then in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2982) [a second step I will use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2984) [dispatch queue to actually make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2986) [this class thread safe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2987) [So first of all what I don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2990) [like here is that storage is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2992) [declared as a public variable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2993) [That means that potentially any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2995) [code inside my app can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2996) [accessing it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2998) [And it will be really hard to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2999) [And it will be really hard to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=2999) [make sure that all the code in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3001) [my app does it correctly, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3002) [let's change it to private](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3004) [instead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3006) [And let me introduce a different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3007) [way of accessing image cache and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3009) [I'll do that by introducing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3011) [subscript.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3013) [That means that users of image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3015) [cache can use brackets to load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3016) [and store data from the cache.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3019) [So subscripting needs a getter,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3021) [like this one and a setter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3025) [And for now let's just implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3028) [these by directly accessing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3030) [underlying storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3031) [And to make the rest of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3034) [file actually build I need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3036) [update the users, so instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3037) [accessing the storage property](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3040) [we should be using brackets and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3042) [index into image cache directly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3043) [like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3046) [So if I hit Build Now you'll see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3047) [that the code will compile fine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3049) [now, but I didn't really fix any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3052) [bugs yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3053) [But I did achieve something, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3055) [now have direct control over all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3056) [the code that can access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3059) [the code that can access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3059) [storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3060) [It's either going to be code in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3061) [this getter or the setter, no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3062) [other code in my app has access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3064) [to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3066) [So I'm in a very good position](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3066) [to actually fix this Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3068) [access race.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3069) [And let me do that by using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3071) [dispatch queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3073) [So let's create a new private](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3074) [variable called queue and let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3075) [assign a new dispatch queue into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3077) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3079) [Dispatch queues are serial by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3081) [default, so this one is also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3083) [serial, which means that it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3084) [only allow one piece of code to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3085) [execute inside that queue at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3088) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3090) [So that's perfect, that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3091) [exactly what we need here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3092) [How do we actually execute code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3094) [inside a dispatch queue?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3096) [We can use queue.sync and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3097) [whatever code I move into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3100) [queue.sync will be executed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3102) [inside that serial queue and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3105) [only one at a time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3107) [And I can return a value here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3108) [because I need to return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3110) [something from the getter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3111) [And I can fix the same thing in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3113) [the setter as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3115) [And if I move this line of code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3116) [into this queue.sync it will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3119) [into this queue.sync it will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3119) [executed as part of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3121) [dispatch queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3122) [So this way the code is now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3123) [thread safe because every single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3126) [line of code that accesses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3128) [storage is always executed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3129) [inside a serial dispatch queue,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3131) [which means it will only be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3133) [executed one at a time and is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3135) [[inaudible] thread safe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3136) [Now it might be tempting to only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3138) [use the synchronization in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3140) [setter where we are modifying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3142) [the storage and avoiding it in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3144) [the getter like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3146) [But that's not correct, that can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3148) [still cause memory corruptions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3149) [and still cause crashes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3151) [Let me actually prove that to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3152) [you by running this version of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3153) [the code in the Simulator and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3155) [let's see if the Sanitizer finds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3157) [this little more subtle bug now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3159) [As I expected it does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3161) [We really have to protect both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3165) [the getter and the setter with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3167) [the synchronization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3169) [So let me run my app one last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3170) [time in the Simulator and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3172) [will see it if I try to a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3173) [recipe this time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3175) [The controller loads up just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3177) [fine and we don't get any more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3178) [warnings because the class is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3179) [warnings because the class is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3179) [now correctly thread safe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3181) [So I can actually go back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3182) [Organizer window and mark this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3184) [crash as resolved because we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3187) [have found, identified, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3188) [fixed this bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3190) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3191) [All right so what we've just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3201) [seen is that I've started with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3203) [set of crash logs that all have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3205) [symptoms of a multithreading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3207) [bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3208) [And then I've used this tool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3209) [called Thread Sanitizer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3210) [identify and eventually fix this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3212) [bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3214) [Thread Sanitizer not only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3215) [detects multithreading issues,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3216) [but it also makes them reproduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3218) [much more reliably.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3220) [Notice that in the demo I didn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3222) [have to invoke the controller](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3223) [multiple times.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3225) [This tool works on macOS and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3227) [the Simulator, but just like all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3229) [other runtime diagnostic tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3231) [it only finds bugs in codes that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3233) [you exercise by actually running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3236) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3237) [So you should keep that in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3238) [So you should keep that in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3238) [and make sure that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3240) [automated or manual testing uses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3241) [Thread Sanitizer, especially on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3243) [any code that is using threading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3245) [or GCD.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3246) [And if you'd like to know more I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3247) [recommend that you watch a video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3250) [from my WWDC 2016 session called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3252) [Thread Sanitizer and Static](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3255) [Analysis where we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3256) [introduced this tool and we also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3258) [talked about how it works under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3260) [the hood.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3261) [As a reminder, Thread Sanitizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3262) [can be found in the Scheme](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3265) [Editor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3266) [So if you go to Product, Scheme](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3267) [and Edit Scheme that will bring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3269) [up the Scheme Editor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3272) [And then we can switch over to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3272) [the Diagnostics tab where you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3274) [can find Thread Sanitizer among](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3276) [the other runtime diagnostic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3277) [tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3279) [I have one more debugging tip](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3281) [that I would like to share with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3283) [you that's useful when dealing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3284) [with multithreading.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3286) [When you are creating dispatch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3288) [queues you can provide a custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3289) [label in the initializer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3291) [You can assign a custom name to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3294) [an operation queue and if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3296) [working with threads you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3298) [working with threads you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3298) [custom names with threads as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3300) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3301) [These names and labels are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3303) [displayed in the debugger but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3304) [they also appear in some types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3305) [of crash logs and that can help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3307) [you often narrow down possible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3309) [causes of multithreading bugs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3311) [Okay so to stay on top of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3315) [crashes I have three takeaway](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3316) [points for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3319) [Number one, always test your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3320) [apps on real devices before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3322) [submitting them to the App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3325) [Store, that will help you avoid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3326) [getting rejected in App Review.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3328) [Number two, when you do get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3331) [crashes from your users you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3333) [should always try to reproduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3335) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3336) [Look at the crash logs and look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3337) [at the stack traces and try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3339) [figure out which parts of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3340) [app do you need to exercise to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3341) [trigger a crash or to try to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3343) [reproduce the crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3345) [And finally, for crashes that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3346) [are hard to reproduce I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3349) [recommend using bug finding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3350) [tools, such as Address Sanitizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3352) [or Thread Sanitizer which work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3354) [for editing memory corruption](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3356) [bugs and multithreading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3358) [problems.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3359) [So now let's recap what we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3360) [learned today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3364) [Chris has showed us how we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3365) [and should use the Organizer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3367) [window in Xcode to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3368) [statistics and also details](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3371) [about crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3372) [Greg showed us how to read and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3374) [analyze the text of crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3375) [In many cases, they can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3378) [reproduced like if you are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3379) [dealing with app lunch timeouts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3381) [Then we've crash log crashes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3384) [that are hard to reproduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3386) [because they happen randomly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3387) [like memory corruptions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3388) [And we have mentioned what signs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3390) [they leave in crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3392) [And finally, I've shown how bug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3394) [finding tools like the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3396) [Sanitizers can help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3397) [reproduce issues that are memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3399) [corruptions and threading issues](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3401) [and I recommend that you use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3403) [these tools as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3404) [For more information please](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3405) [visit our session's webpage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3407) [where we will also include links](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3409) [to the technotes that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3411) [mentioned and also the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3412) [documents that provides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3413) [debugging tips that are helpful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3414) [when dealing with crashes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3416) [And I'd like to remind you that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3417) [there is a crash logs lab](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3418) [there is a crash logs lab](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3418) [starting right after this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3420) [session at 12 p.m. in Technology](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3421) [Lab 8, so please stop by if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3423) [have any questions about crashes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3425) [and crash logs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3426) [And enjoy the rest of WWDC,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3427) [thank you very much.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3429) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/414/?time=3430)