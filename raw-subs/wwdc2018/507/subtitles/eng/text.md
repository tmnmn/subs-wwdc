# AVContentKeySession Best Practices

## Summary
AVContentKeySession allows for the management of FairPlay content decryption keys for HTTP Live Streaming. It offers a simplified key loading process that provides applications with control over the lifecycle of content keys, and features such as dual-expiry keys for offline movie rentals. Learn about best practices and recommended patterns for adopting this API.

## Info
* Media
* WWDC 2018 - Session 507 - iOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=7) [&gt;&gt; Hello, and thanks for tuning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=18) [in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=19) [My name is Anil Katti and I'm an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=20) [AVFoundation Engineer at Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=22) [Today, I'm going to present some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=25) [best practices and recommended](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=27) [patterns for adopting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=29) [AVContentKeySession API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=30) [AVContentKeySession is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=33) [AVFoundation API that enables](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=36) [delivery of FairPlay Streaming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=38) [keys on Apple platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=39) [So, here's what I'll cover in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=43) [the session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=45) [I'll start with an overview of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=46) [FairPlay streaming and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=47) [AVContentKeySession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=49) [I'll then present some ways you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=50) [can optimize playback using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=52) [AVContentKeySession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=55) [I'll, also, cover some common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=56) [pitfalls around FairPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=58) [Streaming key delivery and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=59) [Streaming key delivery and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=59) [answer a few frequently asked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=61) [questions from developers, along](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=64) [the way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=66) [So, let's get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=67) [FairPlay Streaming was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=70) [introduced back in 2015 to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=71) [protect HLS streams delivered to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=74) [our platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=76) [FairPlay Streaming specification](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=78) [specifies a set of steps an app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=80) [needs to follow in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=82) [securely deliver content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=84) [decryption keys so the platform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=85) [could decrypt and play back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=87) [encrypted media.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=89) [While delivering FairPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=92) [Streaming keys your app works as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=93) [a liaison between the platform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=96) [and your key server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=98) [When it receives an on-demand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=101) [key loading request from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=103) [AVFoundation it, in turn,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=104) [requests for an Encrypted Key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=106) [Request, also known as SPC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=108) [The SPC is then sent to the key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=112) [server, which responds back with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=114) [an Encrypted Key Response, also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=118) [an Encrypted Key Response, also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=118) [known as CKC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=120) [Finally, the app provided CKC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=122) [back to AVFoundation so it could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=125) [start decryption and playback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=127) [Until recently, apps used the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=131) [generic AVFoundation API called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=133) [AVAssetResourceLoader to deliver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=136) [content decryption keys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=138) [But last year we introduced the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=140) [new AVFoundation Class called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=143) [AVContentKeySession that was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=145) [designed specifically around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=147) [content decryption keys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=148) [We had two goals in mind for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=151) [AVContentKeySession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=153) [One, to simplify key loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=155) [process and provide applications](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=158) [better control over the life](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=160) [cycle of content decryption](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=162) [keys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=163) [And two, serve as a home for new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=163) [content protection features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=167) [AVContentKeySession adoption has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=171) [been great, so far.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=173) [And already, a majority of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=174) [FairPlay Streaming keys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=176) [delivered on our platforms come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=178) [delivered on our platforms come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=178) [through AVContentKeySession.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=180) [The API has helped developers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=183) [optimize key delivery in their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=185) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=186) [I will present some ways you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=188) [could get more out of the API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=190) [But before that, let's see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=191) [makes AVContentKeySession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=194) [different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=195) [With AVAssetResourceLoader](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=197) [applications could load keys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=199) [only when AVFoundation requires](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=202) [one and sends an on-demand key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=204) [loading request.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=206) [This, typically, happens when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=208) [AVFoundation downloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=210) [playlists, parses them, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=211) [finds out that the content is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=213) [encrypted.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=215) [Further, AVFoundation could send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=216) [these key loading requests at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=218) [any point during playback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=219) [For example, AVFoundation sends](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=221) [new key loading requests if it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=224) [switched to a radian that uses a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=226) [different key in the middle of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=229) [the playback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=230) [AVContentKeySession,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=232) [essentially, changes that model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=233) [It decouples key loading from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=236) [media loading or playback and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=238) [media loading or playback and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=238) [gives applications more control](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=240) [over the timing of key loading.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=242) [AVContentKeySession allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=244) [applications to initiate key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=246) [loading on their own at any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=248) [point in time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=250) [This opens up new use cases,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=252) [allows applications to optimize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=254) [key delivery, and improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=256) [different aspects of playback](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=257) [experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=259) [Playback startup is one such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=262) [thing AVContentKeySession could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=264) [help improve.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=266) [Instead of waiting for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=268) [AVFoundation to send on demand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=270) [key loading requests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=272) [After requesting playback, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=273) [could use AVContentKeySession to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=276) [proactively load keys that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=278) [predict might be required in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=281) [near future based on user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=282) [actions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=284) [You could do all this, even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=286) [before a user picks something to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=288) [play.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=289) [We call this key preloading or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=291) [prewarming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=292) [Further, if you have assets that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=295) [use multiple keys across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=298) [different radians, you could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=299) [different radians, you could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=299) [batch up all key requests before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=301) [even talking to your key server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=303) [This reduces some load on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=305) [key server, and also, eliminates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=308) [round trips for each keys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=310) [You could initiate key loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=314) [process by calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=316) [processContentKeyRequest method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=317) [on an AVContentKeySession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=318) [instance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=320) [Once you call this method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=322) [AVContentKeySession will send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=324) [you an AVContentKeyRequest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=326) [object by invoking the delegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=328) [callback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=329) [AVContentKeySession allows you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=331) [to perform FairPlay Streaming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=333) [specific operations like request](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=335) [encrypted key requests and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=337) [respond with encrypted key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=339) [response.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=341) [Okay. So, now let's say you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=344) [successfully preloaded a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=346) [particular key.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=347) [Is it possible that the key is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=349) [requested again after the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=351) [playback starts?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=352) [Yes, that's possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=354) [The app could receive an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=356) [on-demand key loading request if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=358) [on-demand key loading request if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=358) [the playback route changes, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=360) [instance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=361) [Keep in mind that the user could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=363) [decide to AirPlay the content to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=365) [an Apple TV or plug in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=367) [Lightning to Digital AV adapter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=370) [And in these cases, we need new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=372) [keys for decryption.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=374) [So, the app should always be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=377) [prepared to answer on-demand key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=380) [loading requests, even when it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=382) [preloads keys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=384) [Here's another frequently asked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=388) [question around this topic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=390) [How could the app preload all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=392) [keys that might be required](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=393) [during playback?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=396) [Well, in order to preload a key,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=398) [you need the corresponding key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=400) [identifier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=402) [The one that's specified in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=403) [EXT-X-KEY tag in the HLS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=405) [playlist.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=406) [We recommend that you obtain all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=409) [key identifiers and asset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=411) [[inaudible] from your server in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=414) [an out-of-band fashion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=415) [Another option is to include all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=418) [Another option is to include all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=418) [key identifiers in the master](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=420) [playlist as session keys while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=422) [authoring the content and use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=425) [preloads eligible content keys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=426) [property on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=428) [AVAssetResourceLoader.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=429) [At this point I would like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=432) [point out that we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=434) [dedicated session about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=435) [optimizing HLS performance in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=437) [general, not just key delivery.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=439) [You should definitely check that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=441) [out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=445) [Moving on from preloading,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=446) [AVContentKeySession could also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=448) [help you scale your live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=449) [offering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=451) [Are you wondering how?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=453) [Well, you could use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=455) [AVContentKeySession to disperse](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=456) [key loading requests from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=458) [clients that are streaming your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=460) [live content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=461) [Typically, live streams rotate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=464) [keys periodically in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=466) [add an extra layer of protection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=469) [for the content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=470) [It is easy to imagine that these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=471) [keys appear at the exact same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=475) [time when clients refresh live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=476) [playlists.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=478) [When that happens, millions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=479) [When that happens, millions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=479) [clients request keys, all at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=482) [once, resulting in huge impulse](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=484) [load on the key server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=486) [When you disperse this key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=488) [request event across a small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=491) [time window before they appear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=492) [and before the EXT-X-KEY tag](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=495) [appears in the playlist, you're,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=496) [basically, load balancing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=498) [requests reaching your key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=500) [server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=501) [We covered this use case in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=504) [detail with sample code during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=505) [last year's session on HLS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=508) [So, do check out the sessions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=510) [were recording on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=512) [developerapple.com or WWDC app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=513) [Apart from allowing you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=518) [manage and deliver content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=520) [decryption keys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=522) [AVContentKeySession also serves](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=523) [as a home for new FairPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=525) [Streaming content protection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=527) [features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=528) [We released one such feature](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=530) [last year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=532) [We call it Offline Rentals.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=533) [Offline Rentals is a FairPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=536) [Streaming feature that allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=538) [Streaming feature that allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=538) [you to specify two expiration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=540) [durations on persistent keys;](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=542) [storage and playback duration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=545) [Storage duration specifies for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=548) [how long you wish the key to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=551) [valid while it is sitting in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=553) [your storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=555) [That is, before being used for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=556) [playback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=558) [It is, typically, large, like 30](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=559) [days.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=562) [Playback duration, on the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=564) [hand, specifies how long you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=565) [with the key to be valid after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=568) [it was used for playback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=571) [It is, typically, shorter than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=572) [storage duration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=574) [For example, 24 hours.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=575) [This feature allows you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=578) [specify such expiration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=580) [durations when you create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=582) [persistent keys and the platform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=584) [ensures that the two expiration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=585) [durations are enforced, even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=587) [when the device is offline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=589) [So, you might be wondering how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=591) [and where can you specify these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=593) [two expiration durations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=595) [FairPlay introduced a new TLLV](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=598) [FairPlay introduced a new TLLV](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=598) [called Offline Key TLLV for this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=600) [purpose.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=602) [This has to be signaled in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=604) [CKC that is used while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=606) [requesting persistent key.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=607) [In terms of code, you generate a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=611) [persistent key by calling this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=614) [method on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=616) [AVPersistableContentKeyRequest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=617) [Object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=618) [This returns a persistent key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=620) [data blob that you should save](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=622) [in your app storage and use it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=624) [to answer future key loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=626) [requests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=628) [Note that this key is valid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=630) [until the end of storage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=632) [duration, 30 days from our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=633) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=635) [So, when you use this key to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=637) [start the playback for the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=639) [time you might receive an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=641) [updated persistent key through a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=643) [new delegate callback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=646) [When the delegate callback is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=649) [involved you should discard the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=650) [original persistent key and save](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=652) [this updated persistent key in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=654) [your app storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=656) [You should use this to answer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=658) [You should use this to answer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=658) [future key loading requests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=661) [Note that this updated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=663) [persistent key is valid until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=665) [the end of playback duration, 24](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=667) [hours from our example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=670) [So, with that, let's shift gears](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=673) [and talk about error handling,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=676) [now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=677) [Error handling is one of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=679) [most important topics from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=681) [perspective of improving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=683) [playback experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=685) [Successfully loading keys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=687) [involves a number of steps and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=689) [something is bound to fail at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=691) [some point or another.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=692) [So, when something fails the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=695) [first thing you should do is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=696) [report the failure back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=698) [AVFoundation using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=699) [AVContentKeyRequest or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=701) [AVAssetResourceLoadingRequest.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=702) [Some errors are fatal and some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=705) [are not.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=707) [You should help platform make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=708) [that decision.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=709) [Another thing you should do is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=711) [monitor error logs and access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=712) [logs, investigate the root](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=714) [cause.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=716) [And try to mitigate errors so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=717) [your users can get the best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=718) [your users can get the best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=718) [experience they deserve on our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=720) [platforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=721) [If you haven't already, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=724) [should also check out one of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=725) [recorded sessions from last year](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=727) [to learn more about error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=728) [handling, in general.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=730) [Over the years we've seen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=734) [developers fall into a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=736) [pitfalls around FairPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=737) [Streaming key delivery.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=738) [We have seen apps that hold on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=740) [to key responses for too long.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=743) [When AVFoundation sends you a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=744) [key loading request you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=747) [provide a response as soon as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=749) [possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=751) [Delays in key delivery could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=752) [result in playback timing out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=754) [By the way, you should be able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=757) [to identify and debug timeouts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=758) [by surveying your playerItems](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=761) [accessLogs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=763) [Another pitfall is around HDCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=766) [enforcement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=768) [It is important to keep in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=770) [that HDCP requirement for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=772) [assets is signaled inside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=774) [encrypted key response from your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=776) [key server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=778) [If you wish to enforce different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=781) [HDCP levels for different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=783) [radians, you should specify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=785) [different key identifiers for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=786) [those radians.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=788) [And provide appropriate key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=789) [responses from your key server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=791) [Lastly, you should be careful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=795) [while responding to key loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=797) [requests with persistent keys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=799) [because persistent keys are tied](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=801) [to the device they were](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=804) [generated on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=804) [For example, you should not use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=806) [a persistent key to respond to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=809) [key loading request from an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=810) [AirPlay session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=812) [Doing so will result in playback](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=814) [failure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=816) [We made some API changes in iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=818) [11.2 to help you avoid and catch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=821) [such issues sooner, rather than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=824) [later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=825) [Let me walk you through some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=826) [code snippets to explain.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=828) [If you are using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=832) [AVContentKeySession to deliver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=833) [keys, now you won't even be able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=834) [to RequestPersistableContentKey](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=836) [request object if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=838) [request object if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=838) [AVContentKeyRequest cannot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=840) [accept the persistent key as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=842) [response.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=844) [So, when requesting a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=847) [PersistableContentKeyRequest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=848) [field you should respond with an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=850) [online FairPlay Streaming key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=851) [from your key server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=853) [If you are using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=856) [AVAssetResourceLoader, before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=857) [responding with a persistent key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=859) [data blob you should check if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=861) [persistent key is listed as one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=863) [of the accepted content types in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=864) [the newly introduced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=867) [allowedContentTypes property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=868) [So, I hope this provided some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=871) [overview of AVContentKeySession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=873) [and clarified a few questions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=875) [you might have had.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=876) [To summarize, we covered what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=878) [makes AVContentKeySession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=880) [different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=881) [We saw how this API could be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=882) [used to improve playback startup](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=884) [and scale live streaming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=887) [We spoke a little bit about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=890) [Offline Rentals, what it really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=891) [is, and how to do it the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=892) [way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=894) [We, finally, highlighted best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=896) [practices around handling errors](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=898) [practices around handling errors](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=898) [while delivering FairPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=900) [Streaming keys and common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=901) [pitfalls that you should be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=903) [aware of.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=904) [Thank you, for listening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=908) [And please, visit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=909) [developer.apple.com for more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=910) [information about this session](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=912) [and other related sessions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=913) [Thanks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/507/?time=915)