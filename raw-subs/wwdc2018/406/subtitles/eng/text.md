# Swift Generics (Expanded)

## Summary
Generics are one of the most powerful features of Swift, enabling you to write flexible, reusable components while maintaining static type information. Learn about the design of Swift's generics, including how to generalize protocols, leverage protocol inheritance to express the varying capabilities of related types, build composable generic components with conditional conformances, and reason about the interaction between class inheritance and generics. This expanded version of the WWDC 2018 session includes a brand-new discussion of recursive constraints.

## Info
* Developer Tools
* WWDC 2018 - Session 406 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=27) [Hi, everybody, I'm Ben.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=34) [I work on the Swift standard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=37) [library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=37) [And together with my colleague](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=38) [Doug, from the compiler team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=39) [We're going to talk to you about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=40) [Swift generics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=42) [So the recent releases of Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=43) [have added some important new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=46) [features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=47) [Including conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=48) [conformance and recursive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=49) [protocol constraints.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=51) [And, in fact, with every release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=53) [of Swift, we've been refining](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=55) [the generic system, making it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=56) [more expressive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=58) [And we feel that the 4.2 release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=59) [And we feel that the 4.2 release](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=59) [marks an important point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=61) [It's the point where we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=64) [finally fully implement a number](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=65) [of designs that have always been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=68) [envisioned for the standard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=69) [library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=70) [Something that's critical for us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=70) [in achieving our goal of API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=72) [stability for Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=74) [So, we've given a lot of talks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=76) [about generics in the past, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=78) [we haven't taken a step back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=79) [And talked about generics as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=80) [whole for a while.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=82) [So today, we're going to take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=83) [you through a few different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=84) [features of the generics system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=86) [Both new and old, to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=87) [understand how they fit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=89) [together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=90) [I'm going to briefly recap the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=91) [motivation for generics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=94) [We're going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=97) [designing protocols, given a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=98) [number of concrete types, using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=99) [examples taken from the standard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=101) [library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=102) [We're going to review protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=104) [inheritance, and talk about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=105) [new feature of conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=107) [conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=108) [And how it interacts with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=109) [protocol inheritance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=110) [And finally, we're going to wrap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=111) [up with a discussion of classes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=113) [and generics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=115) [So why are generics such an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=118) [important part of Swift?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=119) [important part of Swift?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=119) [Well one way of seeing their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=121) [impact is by designing a simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=123) [collection, like type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=125) [We'll call it buffer, and it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=128) [going to be similar to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=129) [standard library's array type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=130) [Now, the simplest possible API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=132) [for the reading part of a buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=134) [might include a count of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=135) [number of elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=137) [And a way to fetch each element](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=138) [to the given position in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=140) [index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=141) [But, what do we make of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=142) [return type?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=143) [Now, if we didn't have generics,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=144) [we'd have to make it some kind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=146) [of type that could represent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=148) [anything that we'd want to put](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=149) [inside the buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=150) [You can call that type ID or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=152) [object or void star.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=153) [In Swift we call it Any, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=155) [is a type that can stand in for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=158) [any different kind of type in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=159) [Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=160) [So if you wanted to handle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=164) [anything in the buffer, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=165) [could have subscript return an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=165) [Any.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=167) [But, of course, you probably](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=168) [know that that leads to a really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=169) [unpleasant user experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=170) [At some point, you've got to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=172) [out that type from inside the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=173) [box.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=175) [In order to actually use it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=176) [And this isn't just annoying,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=180) [it's also error-prone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=183) [What if somewhere in your code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=184) [maybe by accident, you put an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=185) [integer into what was supposed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=187) [to be a buffer of strings?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=189) [But it's not just about ease of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=191) [use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=193) [We also want to solve some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=194) [problems relating to how these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=195) [values are represented in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=196) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=198) [Now, the ideal representation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=199) [for a buffer of strings, would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=203) [be a contiguous block of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=204) [With every element held in line](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=207) [next to each other.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=208) [But with an untyped approach,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=210) [this doesn't work out quite so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=213) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=214) [Because the buffer doesn't know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=214) [in advance what kind of type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=215) [it's going to contain.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=217) [And so it has to use a type like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=218) [Any that can account for any of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=220) [the possibilities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=222) [And, there's a lot of overhead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=223) [in tracking, boxing, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=224) [unboxing the types in that Any.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=226) [Here, I might have just wanted a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=230) [buffer of integers, but I have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=232) [no way of expressing that to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=234) [compiler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=235) [And so, I'm paying for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=236) [flexibility, even though I'm not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=237) [interested in it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=239) [interested in it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=239) [What's more, because Any has to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=241) [account for any different kind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=242) [of type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=244) [Including types that are too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=245) [large to fit inside its own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=246) [internal storage, it has to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=248) [sometimes use indirection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=250) [It has to hold a pointer to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=251) [values, and that value could be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=253) [located all over memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=254) [And so we really want to solve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=257) [these problems, not just for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=258) [ease of use and correctness, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=260) [also for performance reasons.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=261) [And, we do it using a technique](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=264) [called parametric polymorphism.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=266) [Which is just another term for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=269) [what we in Swift refer to as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=270) [generics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=272) [With a generic approach, we put](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=274) [more information on the buffer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=276) [to represent the type that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=278) [buffer is going to contain.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=279) [We'll call that type Element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=281) [Element is a generic parameter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=284) [of the type, hence the term of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=285) [parametric polymorphism.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=287) [You can think of it kind of like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=289) [a compile-time argument that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=290) [tells the buffer what it's going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=292) [to contain.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=293) [Now it has a way of referring to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=295) [that element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=296) [It can use it wherever it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=297) [previously using Any.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=299) [previously using Any.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=299) [And, that means that there's no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=303) [need to do conversions when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=304) [you're getting a type out of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=305) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=306) [And if you make an accidental](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=306) [assignment of the wrong kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=309) [type, or some issue similar to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=310) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=312) [The compiler will catch you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=312) [Now, now there's no such type as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=315) [buffer without an associated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=317) [element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=319) [If you try to declare a type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=320) [like that, you'll get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=322) [compilation error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=323) [You might find that slightly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=326) [surprising.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=326) [Because sometimes you'll see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=327) [that you can declare types like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=329) [buffer without any element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=330) [But, that's just because the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=333) [compiler is able to infer what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=333) [the element type ought to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=335) [from the context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=337) [In this case, from the literals](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=338) [on the right-hand side here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=339) [The element is still there, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=341) [just implicit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=343) [This knowledge of exactly what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=346) [type a buff-- a type like buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=348) [contains is carried all the way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=350) [through both compile and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=352) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=354) [And this means that we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=355) [achieve our goal of holding all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=358) [of the elements in a contiguous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=359) [of the elements in a contiguous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=359) [block of memory, with no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=361) [overhead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=362) [Even if those types are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=363) [arbitrarily large.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=365) [And because the compiler has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=368) [direct knowledge at all times of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=370) [exactly what element type the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=372) [buffer contains.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=374) [It has optimization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=375) [opportunities available to it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=376) [that it wouldn't otherwise have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=378) [So, in the case here, where I've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=380) [declared a buffer of integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=381) [A loop like this ought to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=384) [compiled down to just a handful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=385) [of very efficient CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=387) [instructions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=388) [Now, if you were writing a loop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=391) [like this, on a regular basis.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=392) [To sum up a buffer of integers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=396) [it might make sense to extract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=398) [it out into a method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=399) [An extension on buffer that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=400) [more unit-testable, and more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=404) [readable when you actually call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=405) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=407) [But, you probably know that if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=408) [you've written code like this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=409) [you'll get a compilation issue,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=410) [because not all element types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=412) [can be summed up like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=414) [We need to tell the compiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=417) [more about the capabilities the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=419) [more about the capabilities the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=419) [element needs to have, in order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=421) [to make this method available on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=423) [a buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=425) [Now, the easiest way to do that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=427) [is by constraining the element](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=428) [type to be a specific type like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=430) [the Int from our original loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=432) [If you take this easy approach](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=434) [to get up and running with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=438) [extension, it's easy to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=439) [generalize it later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=440) [When you find that you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=442) [do something different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=442) [Like sum up a buffer of doubles,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=443) [or floats.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=445) [Just look at the type that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=446) [you've constrained to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=448) [Look at the protocols it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=449) [conforms to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=451) [And follow them up until you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=451) [the most general protocol that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=453) [gives you everything that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=454) [need to do your work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=455) [In this case, the numeric](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=457) [protocol, which gives us the two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=459) [things we're relying on here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=460) [The ability to create a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=462) [element with a value of zero,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=464) [and the ability to add elements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=466) [to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=468) [Which come as part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=469) [numeric protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=469) [Now, let's talk about that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=473) [process of factoring out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=474) [protocols from various types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=476) [So we've been talking about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=479) [So we've been talking about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=479) [buffer type, and we can make it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=481) [generic across different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=483) [elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=484) [But what about writing generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=484) [code that's generic in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=486) [different direction?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=487) [Or writing code that works on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=489) [any different kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=490) [collection?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=491) [Such as an array that's very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=493) [similar to our buffer type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=494) [But also more varied types, like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=496) [a dictionary that's a collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=498) [of key value pairs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=500) [Or maybe types that aren't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=503) [generic or are the different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=504) [element types, like data or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=505) [string that returns specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=507) [element types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=509) [We want to create a protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=510) [that captures all of their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=513) [common capabilities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=514) [We're going to create a, a cut](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=516) [down, simplified version of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=518) [standard library's own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=520) [collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=521) [So notice that we considered a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=525) [varied number of concrete types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=526) [first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=529) [And now, we're thinking about a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=529) [kind of protocol that could join](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=531) [them all together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=533) [And, it's important to think of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=534) [things as this way around.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=535) [To start with some concrete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=537) [types, and then try and unify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=538) [types, and then try and unify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=538) [them with a protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=540) [What do those types have in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=543) [common?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=544) [What don't they have in common?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=545) [When you're designing a protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=547) [like this, you can think of it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=548) [kind of like a contract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=549) [negotiation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=551) [There's a natural push and pull](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=553) [here, between conforming types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=554) [on the one hand.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=556) [That want as much flexibility as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=557) [possible in fulfilling that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=559) [contract.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=560) [And users of the protocol, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=562) [want a really nice, tight,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=564) [simple protocol in order to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=566) [their extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=568) [That's why it's really important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=570) [to have both a variety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=572) [different possible conforming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=573) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=575) [And a number of different use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=575) [cases in mind when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=577) [designing your protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=578) [Because it's a balancing act.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=580) [So, let's start to flesh out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=583) [collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=585) [So, first we need to represent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=586) [the element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=587) [Now, in protocols, we use an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=589) [associated type for that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=590) [Each conforming type needs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=592) [set element to be something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=594) [appropriate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=595) [In the case of buffer, or array,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=596) [as of Swift 4.2, this happens](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=599) [as of Swift 4.2, this happens](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=599) [automatically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=601) [Because we also named their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=603) [generic parameters to be element](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=604) [as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=606) [This is a nice side benefit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=607) [giving your generic arguments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=609) [meaningful names that follow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=610) [common conventions like the word](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=611) [element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=613) [Rather than giving them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=615) [something arbitrary like T that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=616) [you'd have to separately state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=617) [was the element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=619) [For other data types, you might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=622) [need to do something slightly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=623) [more specific.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=624) [For example, a dictionary needs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=624) [to set the element type to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=626) [the pair of its key and value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=627) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=629) [Next, let's talk about adding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=629) [the subscript operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=633) [Now, if we were talking about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=635) [just a protocol for types like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=637) [array, we might be tempted to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=638) [have subscripts take an Int as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=640) [its argument.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=642) [But making subscript take an Int](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=645) [would imply a very strong](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=647) [contract.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=649) [Every conforming type would have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=650) [to supply the ability to fetch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=652) [an element's given position that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=654) [was represented by an integer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=655) [And, that works great for types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=657) [like array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=660) [It's also definitely easy for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=661) [users of the protocol to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=663) [understand.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=664) [But is it flexible enough for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=666) [slightly more complicated type,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=667) [like a dictionary?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=668) [Now no matter how you model it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=671) [a dictionary's probably going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=673) [be backed by some fairly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=675) [complicated internal data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=676) [structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=677) [That has specific logic for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=678) [moving from one element to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=679) [next.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=681) [For example, it could be backed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=682) [by an internal buffer of some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=684) [kind, and it could use an index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=686) [type that stored an offset into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=689) [that buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=690) [That it could then take as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=691) [argument to subscript in order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=693) [to fetch an element to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=694) [position, using that offset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=695) [But it would be critical that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=698) [the dictionary's index type be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=699) [an opaque type that only the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=701) [dictionary can control.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=703) [You wouldn't want somebody](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=705) [necessarily just adding one to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=705) [your offset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=707) [That wouldn't necessarily move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=708) [to the next element in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=709) [dictionary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=710) [It could move some arbitrary,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=711) [maybe uninitialized part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=712) [dictionary's internal storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=714) [So instead we want the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=716) [dictionary to control moving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=717) [dictionary to control moving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=717) [forward through the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=720) [by advancing the index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=722) [And so to do that, we add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=724) [another method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=725) [That given an index, gives you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=726) [the index that marks the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=728) [position after it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=729) [Once you take this step, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=732) [need a couple more things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=733) [You need a start index property,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=734) [and an end index property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=736) [Because a simple count isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=738) [going to work anymore in order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=739) [to tell us that we've reached](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=740) [the end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=741) [Now that we're not using Ints as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=742) [our index type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=744) [So let's bring those back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=746) [collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=747) [So we've got a subscript that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=750) [takes some index type to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=751) [represent a position, and gives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=753) [you an element there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=754) [And, we've got a way of moving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=755) [that position forward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=756) [But we also need types to supply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=759) [what kind of type they're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=761) [to use for their index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=762) [We do that with another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=763) [associated type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=764) [Conforming types would supply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=767) [the appropriate types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=770) [So an array or a data would give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=770) [an Int as their index type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=773) [Whereas a dictionary would give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=775) [its own custom implementation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=776) [that handles its own internal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=778) [logic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=779) [So let's go back to count that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=784) [we dropped a minute ago in order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=785) [to generalize our indexing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=787) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=789) [It's still a really useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=789) [property to have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=790) [So we probably want to add it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=791) [back as an extension on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=792) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=795) [Something that walks over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=796) [collection, moving the index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=798) [forward, incrementing a counter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=800) [that it then returns.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=802) [Now, if we try and implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=803) [this, we hit another missing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=807) [requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=808) [Since we moved off of Int to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=810) [general index type, we can no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=811) [longer assume that the index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=813) [type was equatable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=815) [Ints are, but arbitrary index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=817) [types aren't necessarily.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=819) [And, we need that in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=820) [know that we've reached the end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=822) [Now, we could solve this in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=825) [same way that we did earlier, of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=827) [constraining our extension.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=829) [Say that it only works when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=830) [index type is equatable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=832) [But, that doesn't feel right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=834) [We want a protocol to be easy to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=837) [use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=839) [And it's going to get really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=839) [And it's going to get really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=839) [irritating, if we have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=841) [always, on every extension we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=842) [write, put this constraint on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=844) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=846) [Because we're nearly always](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=846) [going to need to be able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=847) [compare two indexes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=848) [Instead, it's probably better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=850) [expressed as a requirement of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=851) [the protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=853) [As a constraint on our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=854) [index-associated type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=857) [Putting this constraint on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=860) [protocol means that all types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=861) [that conform to the protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=863) [need to supply an equatable type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=864) [for their index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=866) [That way you don't have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=868) [specify it every time you write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=870) [the extension.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=871) [This is another example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=873) [negotiating the protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=875) [contract.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=876) [Users of the protocol had a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=878) [requirement that they really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=879) [needed to be able to compare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=881) [indexes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=882) [And, conforming types, they did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=883) [a check that they can reasonably](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=885) [accommodate that without giving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=887) [up too much flexibility.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=888) [In this case, they definitely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=890) [can.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=892) [Ints, the data, and array are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=893) [using are already equatable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=894) [And, with Swift 4.2's new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=896) [automatic synthesis of equatable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=897) [conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=899) [conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=899) [It's easy for dictionary to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=901) [its index type equatable as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=902) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=903) [Next, let's talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=907) [optimizing this count operation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=908) [with a customization point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=910) [So, we've written a version of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=914) [count, that calculates the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=916) [number of elements in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=919) [collection by walking over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=919) [entire collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=921) [But, obviously a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=922) [collections can probably do that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=923) [a lot faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=924) [For example, supposing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=925) [dictionary kept internally a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=927) [count of the number of elements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=929) [it held, for its own purposes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=930) [If it has this information, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=933) [can just serve it up in its own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=934) [implementation of count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=936) [That means that when people call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=938) [count on a dictionary, they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=940) [getting fast constant time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=942) [Instead of the linear time that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=944) [our original version that works](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=945) [with any collection takes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=947) [But, when adding optimizations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=949) [like this, there's something you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=951) [need to be aware of.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=952) [Which is the difference between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=952) [fulfilling protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=954) [requirements, and just adding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=955) [lots of overloads onto specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=957) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=959) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=959) [Up until now, this new version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=960) [of count on dictionary is just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=963) [an overload.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=965) [That means that when you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=965) [dictionary, and you know it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=967) [dictionary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=969) [You'll get the newer, better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=970) [version of count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=971) [But, what about calling it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=973) [inside a generic algorithm?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=974) [So supposing we wanted, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=977) [example, to write a version of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=979) [the standard library's map?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=981) [If you're not already familiar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=983) [with it, it's a really useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=984) [operation that transforms each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=985) [element in the collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=988) [And gives it back to you as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=989) [new array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=990) [The implementation's pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=992) [simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=994) [It just creates a new array,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=995) [moves over the collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=997) [transforms each element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=999) [And then appends it to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1000) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1002) [Now, as you append elements to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1002) [an array like this, the array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1004) [automatically grows.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1006) [And, as it grows, it needs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1008) [sometimes to re-allocate its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1010) [internal storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1012) [In order to make more room to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1013) [accommodate the new elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1014) [In a loop like this, it might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1016) [have to do that multiple times](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1017) [over, depending on how big it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1019) [over, depending on how big it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1019) [gets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1020) [And, doing that takes time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1020) [Allocating memory can be fairly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1022) [expensive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1024) [There is a nice optimization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1025) [trick we can do with this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1027) [implementation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1029) [We already know exactly how big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1030) [the final array is going to be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1032) [It's going to be exactly the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1034) [same size as our original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1035) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1036) [So we could reserve exactly the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1038) [right amount of space in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1040) [array up front, before we start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1042) [appending to it, which is a nice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1044) [speed-up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1046) [And to do this, we're calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1046) [count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1049) [But, we're calling count here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1050) [in what's referred to as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1052) [generic context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1054) [That is, a context where the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1055) [collection type is completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1057) [generic, not specific.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1059) [It could be an array, or a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1060) [dictionary, or a link list, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1061) [anything.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1063) [So, we can't know that it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1064) [necessarily has a better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1066) [implementation of count](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1068) [available to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1069) [When the compiler compiles this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1070) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1071) [And so, in this case, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1072) [version of count that's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1075) [be called is actually the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1076) [general version of count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1077) [That works on any collection and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1079) [That works on any collection and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1079) [iterates over the entire](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1081) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1082) [If you called map on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1083) [dictionary, it wouldn't call the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1084) [better version of count that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1086) [we've just written yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1087) [In order for customized method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1091) [or property like this to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1093) [called in a gen-- in a generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1095) [context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1097) [It needs to be declared as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1098) [requirement on the protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1099) [itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1101) [We've established that there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1102) [definitely a way in which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1104) [certain collections could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1106) [provide an optimized version of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1107) [count, so it makes sense to add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1108) [it as a requirement on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1110) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1112) [Now, even though we've made it a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1114) [requirement to implement it, all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1116) [collections don't have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1120) [provide their own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1121) [implementation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1122) [Because we've already provided](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1122) [one via our extension that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1124) [work on any collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1125) [Adding a requirement to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1128) [protocol, and alongside it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1129) [adding a default implementation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1131) [via an extension is what we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1133) [refer to as a customization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1135) [point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1137) [With a customization point, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1138) [With a customization point, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1138) [compiler can know that there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1141) [potentially a better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1143) [implementation of a method or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1144) [property available to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1146) [And so, in a generic context, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1147) [dynamically dispatches to that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1149) [implementation through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1151) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1153) [So now, if you call map on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1155) [dictionary, even though it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1157) [completely generic function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1158) [You will get the better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1160) [implementation of count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1161) [Adding customization points like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1164) [this, alongside default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1166) [implementations through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1167) [extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1168) [Is a really powerful way of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1170) [getting the same kind of benefit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1171) [that you can also get with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1172) [classes, implementation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1174) [inheritance, and method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1175) [overwriting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1177) [But, this technique works on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1178) [structs and enums, as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1179) [classes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1181) [Now, not every method can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1185) [optimized like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1187) [And, customization points have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1189) [small but non-zero impact on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1191) [your binary size, your compiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1193) [runtime performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1195) [So, it only makes sense to add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1196) [customization points when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1197) [there's definitely an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1199) [there's definitely an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1199) [opportunity for customization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1200) [For example, in the map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1202) [operation that we just wrote.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1203) [There's no reasonable way in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1205) [which any different kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1206) [collection could actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1208) [provide a better implementation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1209) [And so, it doesn't make sense to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1212) [add it as a customization point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1213) [It can just stay as an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1214) [extension.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1216) [So, we've created this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1218) [collection type, and it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1219) [actually pretty fully-featured](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1220) [now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1221) [It has lots of different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1222) [conforming types possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1223) [And various different useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1225) [algorithms you can write for it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1226) [But, sometimes you need more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1228) [than just a single protocol in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1230) [order to categorize your family](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1231) [of types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1233) [You need protocol inheritance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1234) [And, to talk to you more about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1236) [that, here's Doug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1237) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1240) [&gt;&gt; Thank you, Ben.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1246) [So, protocol inheritance has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1247) [been around since the beginning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1249) [of Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1250) [And, to think about where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1252) [need protocol inheritance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1253) [Let's go look at this collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1255) [protocol that we've been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1256) [building.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1257) [It's a nice protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1258) [It's well-designed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1259) [It describes a set of conforming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1260) [types, and gives you the ability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1262) [to write interesting generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1263) [algorithms on them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1265) [But, we don't have to reach very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1266) [far to find other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1267) [collection-like algorithms that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1269) [we cannot implement in terms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1270) [the collection protocol thus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1272) [far.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1274) [For example, if we want to find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1275) [the index of the last element in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1276) [a collection, that matches some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1278) [predicate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1280) [The best way to do that would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1280) [to start at the end, and walk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1282) [backwards.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1283) [Collection protocol doesn't let](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1285) [us do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1286) [Or say we want to build a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1287) [shuffle operation to randomly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1289) [shuffle around the elements in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1290) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1291) [Well, that requires mutation,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1292) [and collection doesn't do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1294) [Now it's not that the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1295) [protocol is wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1297) [But it's that we need something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1299) [more to describe these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1301) [additional generic algorithms,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1302) [and that is the point of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1304) [protocol inheritance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1305) [So, here the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1307) [bidirectionalCollection protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1307) [inherits from, or is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1310) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1312) [What that means is that any type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1313) [that conforms to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1315) [bidirectionalCollection protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1316) [also conforms to collection, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1318) [you can use those collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1319) [you can use those collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1319) [algorithms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1320) [But bidirectionalCollection adds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1322) [this additional requirement, of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1323) [being able to step backwards in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1325) [the collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1327) [An important thing to note is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1328) [not every collection can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1330) [actually implement this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1331) [particular requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1332) [Think of a singlyLinkedList,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1333) [where you only have these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1335) [pointers hopping from one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1337) [location to the next.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1338) [There's no efficient way to walk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1340) [backward through this sequence,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1341) [so it cannot be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1342) [bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1344) [So, once we've introduced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1345) [inheritance, you've restricted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1346) [the set of conforming types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1348) [But you've allowed yourself to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1349) [implement more interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1352) [algorithms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1353) [So, here's the code behind this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1354) [last index where operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1355) [It's fairly simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1357) [We're just walking backwards](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1357) [through the collection, using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1359) [this new requirement from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1361) [bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1363) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1364) [Let's look at a more interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1366) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1367) [So here's a shuffle operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1368) [So, it was introduced for, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1370) [collections in Swift 4.2.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1371) [You don't have to implement it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1373) [yourself, but we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1374) [look at the algorithm itself to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1375) [see what kinds of requirements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1376) [it introduces to figure out how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1378) [it introduces to figure out how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1378) [to categorize those into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1380) [protocols meaningfully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1381) [So the Fisher-Yates shuffle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1383) [algorithm's a pretty old](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1384) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1385) [It's also fairly simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1386) [You start with an index to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1387) [first element in the collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1389) [And then, you select randomly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1391) [some other element in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1394) [collection, and swap those two.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1395) [In the next iteration, you move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1398) [the left index forward one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1401) [Randomly select between there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1403) [and the end, swap those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1404) [elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1405) [And so, the algorithm is pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1406) [simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1408) [It's just this linear march](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1408) [through the collection, randomly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1410) [selecting another element to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1412) [swap with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1413) [And, at the end of this, you end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1414) [up with a nicely shuffled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1416) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1417) [So, we can actually look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1419) [code here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1420) [It's a little bit involved.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1421) [Don't worry about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1422) [And, we're going to implement it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1423) [on some kind of collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1424) [So, we'll look at the core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1426) [operations in here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1427) [So, first we need to be able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1428) [grab a random number between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1429) [where we are in the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1431) [and the end of the collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1433) [using this, this random](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1434) [facility.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1435) [But, that's an integer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1436) [And what we need is an index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1437) [into the collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1438) [We know those are different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1439) [We know those are different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1439) [So we need some operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1440) [Let's call it index offsetBy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1442) [To jump from the start index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1444) [quickly over to whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1446) [position we've selected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1447) [The other operation we need is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1450) [the ability to swap two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1451) [elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1453) [Great. We have two operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1454) [that we need to add to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1457) [notion of a collection to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1458) [able to implement shuffle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1459) [Therefore, we have a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1461) [shuffleCollection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1462) [Please don't do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1465) [So this is an anti-pattern that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1468) [we see.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1469) [And the anti-pattern here is we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1470) [had one algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1472) [We found its requirements, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1473) [then we packaged it up into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1474) [protocol that is just that one--](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1476) [just describes that one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1479) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1480) [If you do this, you have lots](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1481) [and lots and lots of protocols](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1482) [around that don't have any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1484) [interesting meaning.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1485) [You're not learning anything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1486) [from those protocols.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1487) [So what you should do is notice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1489) [that we actually have distinct](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1491) [capabilities here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1492) [So shuffle is using random](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1494) [access, and it's using mutation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1495) [But, these are, these are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1497) [separate, and we can categorize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1498) [separate, and we can categorize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1498) [them in separate protocols.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1500) [So, for example, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1502) [randomAccessCollection protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1502) [is something where it allows us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1504) [to jump around the collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1506) [moving indices quickly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1508) [And there are types like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1510) [unsafeBufferPointer that can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1511) [give you random access.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1512) [But, do not allow any mutation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1514) [That's a separate capability.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1516) [So, we also have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1519) [mutableCollection protocol here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1519) [And, we can think of types here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1522) [that allow mutation, but not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1523) [random access, like the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1524) [singlyLinkedList that we talked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1525) [about earlier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1527) [Now, you notice that we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1528) [essentially split the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1529) [inheritance hierarchy here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1530) [We've got the access side for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1533) [random access, bidirectional,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1534) [and so on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1535) [And then, we've got this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1536) [mutation side.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1537) [That's perfectly fine, because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1538) [clients themselves can compose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1539) [multiple protocols to implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1541) [whatever generic algorithm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1543) [they're doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1544) [So, we go back to our shuffle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1545) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1546) [And it can be written as an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1547) [extension on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1549) [randomAccessCollection, with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1550) [self-type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1552) [So this is the type that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1552) [conforms to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1553) [randomAccessCollection also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1554) [conforms to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1556) [mutableCollection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1556) [And now, we've pulled together](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1558) [the capabilities of both of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1559) [the capabilities of both of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1559) [these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1560) [Now, when you have a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1562) [conforming types, and a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1564) [generic algorithms, you tend to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1566) [get protocol hierarchies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1567) [forming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1569) [Now, these hierarchies, they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1570) [shouldn't be too big.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1572) [They should not be too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1573) [fine-grained.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1574) [Because you really want a small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1575) [number of protocols that really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1577) [describe the kinds of types that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1578) [show up in the domain, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1579) [And now, there's things, things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1581) [that you notice when you do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1583) [build these protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1585) [hierarchies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1585) [So, as you go from the bottom of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1586) [the hierarchy to the top, you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1587) [going to protocols that have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1589) [fewer requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1590) [And therefore, there are more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1592) [conforming types that can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1593) [implement those requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1595) [Now, on the other hand, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1597) [you're moving down the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1598) [hierarchy, and combining](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1599) [different protocols from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1601) [hierarchy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1602) [You get to implement more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1603) [intricate, more specialized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1604) [algorithms that require more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1606) [advanced capabilities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1607) [But naturally work with fewer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1608) [conforming types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1610) [Okay. So let's talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1614) [conditional conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1616) [This is, of course, a newer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1617) [feature in, in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1618) [feature in, in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1618) [And, let's start by looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1620) [slices again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1622) [So for any collection that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1623) [have, you can form a slice of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1624) [that collection by subscripting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1627) [with a particular range of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1629) [indices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1632) [And, that slice is essentially a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1633) [view into some part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1634) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1636) [Now these are default type that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1637) [you get from slicing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1640) [collection, is called slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1641) [And slice is a generic adaptor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1644) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1646) [So it is parameterized on a base](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1647) [collection type, and it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1650) [itself a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1652) [So our expectation on a slice is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1653) [that you can do anything to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1656) [slice that you can do to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1657) [underlying collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1658) [It's a reasonable thing to want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1660) [And so, certainly we can go and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1661) [use the forward search](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1663) [operations like indexwhere, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1664) [go find something matching a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1666) [predicate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1667) [And that works on the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1667) [and any slice of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1669) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1670) [So, we'd like to do the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1671) [thing with backwards search, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1672) [here we're going to run into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1674) [problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1675) [So even if the buffer is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1675) [bidirectionalCollection, nothing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1677) [has said that the slice is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1679) [has said that the slice is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1679) [bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1680) [We can fix that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1682) [Let's extend slice to make it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1685) [conform to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1687) [bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1688) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1689) [We need to implement this index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1690) [before operation, which we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1691) [implement in terms of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1693) [underlying base collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1694) [Except the compiler's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1697) [complain here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1698) [The only thing we knew about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1699) [that base collection is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1701) [it's a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1702) [It doesn't have an index before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1703) [operation on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1705) [We know how to fix this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1707) [All we need to do is introduce a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1709) [requirement into this extension](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1711) [to say that well, base needs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1712) [be a bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1713) [This is conditional conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1715) [All it is, is extensions that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1718) [declare conformance to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1720) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1721) [And then the constraints under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1722) [which that conformance actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1724) [makes sense.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1725) [And the wonderful thing about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1726) [conditional conformance, is it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1728) [stacks nicely when you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1729) [these protocol hierarchies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1730) [So we can also state that slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1731) [is a randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1734) [When its underlying base type is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1736) [a randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1738) [Now, notice that I've written](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1740) [two different extensions here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1741) [Now, it's generally good Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1743) [style.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1745) [Write an extension, have it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1746) [conform to one protocol, so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1747) [know what that extension is for,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1748) [you know its meaning.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1750) [It's particularly important with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1751) [conditional requirements,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1753) [conformances, because you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1755) [different requirements on these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1757) [extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1759) [And, this allows for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1760) [composability.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1762) [Whatever the underlying base](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1762) [collection can do, the slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1764) [type can also do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1766) [So let's look at another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1768) [application of conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1771) [conformance, also in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1772) [standard library, and these are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1773) [ranges.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1774) [So, ranges have been around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1775) [forever in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1776) [And, you can form a range with,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1777) [for example, these dot-dot less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1778) [than operations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1780) [And so you can form ranges of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1781) [doubles, you can form ranges of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1783) [integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1784) [But some ranges are more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1785) [powerful than others.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1787) [So, you can iterate over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1788) [elements in a range of integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1789) [Well, why can you do that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1792) [It was because an intRange](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1793) [conforms to collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1795) [Now, if you're actually look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1798) [the type, it's reduced by that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1799) [the type, it's reduced by that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1799) [dot-dot less-than operator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1800) [It is aptly named the range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1802) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1804) [Again, it's generic over the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1805) [underlying bound type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1807) [So in this case, we have a range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1808) [of doubles, and it merely stores](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1809) [the lower and upper bounds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1811) [That's fairly simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1812) [But, prior to Swift 4.2, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1814) [would get from an integer range,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1816) [an actually different type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1818) [This is the countableRange type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1820) [Now, notice it's structurally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1823) [the same as the range type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1824) [It has one type parameter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1826) [It has lower and upperBound.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1827) [But it adds a couple additional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1829) [requirements onto that bound](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1831) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1832) [That the bound be stridable,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1833) [right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1835) [Meaning you can walk through and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1835) [enumerate all the elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1836) [Now that's the ability you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1837) [so that you can make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1839) [countableRange conform to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1840) [randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1841) [That enables the forEach, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1843) [forEach iteration loop, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1845) [other things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1846) [But with conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1848) [conformance, of course, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1848) [do better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1849) [So let's turn the basic range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1851) [type into a collection, when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1853) [bound type conforms this-- has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1857) [these extra stridable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1859) [these extra stridable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1859) [requirements on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1860) [It's a simple application of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1861) [conditional conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1862) [But it makes the range type more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1864) [powerful when used with better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1865) [type parameters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1868) [Now, notice that I'm just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1870) [conforming to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1873) [randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1873) [I have not actually mentioned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1875) [collection or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1877) [bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1878) [With unconditional performances,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1880) [this is okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1881) [Declaring conformance to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1883) [randomAccessCollection implies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1884) [conformances to any protocols](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1886) [that it inherits.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1888) [In this case,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1889) [bidirectionalCollection and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1890) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1891) [However, with conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1892) [conformance, this is actually an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1894) [error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1895) [Now, if you think back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1896) [slice example, we needed to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1897) [different constraints for those,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1899) [for those different levels of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1901) [the hierarchy for collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1903) [Versus bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1904) [versus randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1905) [And so, compiler's enforcing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1907) [that you've thought about this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1909) [and made sure that you have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1910) [right set of constraints for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1912) [conditional conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1913) [In this case, the constraints](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1915) [across the entire hierarchy are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1917) [the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1918) [So, we can just write out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1919) [So, we can just write out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1919) [explicitly collection and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1920) [bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1921) [To assert that this is where all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1923) [these conformances are.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1925) [Or we can do the stylistically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1926) [better thing, and split out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1927) [different conformances.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1929) [Now at this point, our range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1932) [type is pretty powerful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1933) [It does everything the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1935) [countableRange does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1935) [So what should we do with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1937) [countableRange?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1937) [We could throw it away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1939) [In this case we're talking about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1940) [the standard library, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1941) [there's a lot of code that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1943) [actually uses countableRange.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1943) [So we can keep it around as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1945) [generic type alias.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1948) [This is a really nice solution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1950) [So the generic type alias adds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1952) [all of those extra requirements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1954) [you need to make the range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1955) [countable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1957) [The requirements you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1958) [turn it into a collection, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1959) [it's just an alternate name for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1962) [the underlying range type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1963) [Again, this is great for source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1966) [compatibility, because code can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1967) [still use countableRange.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1969) [On the other hand, it's also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1971) [really nice to give a name to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1972) [those ranges that have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1974) [additional capabilities of being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1976) [a randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1977) [In fact, we can use this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1979) [In fact, we can use this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1979) [clean up other code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1981) [To say, well, we know what a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1982) [countableRange is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1983) [It's a range with this extra](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1984) [striding capability, so we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1986) [go extend countableRanges.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1989) [And that is a case in which we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1990) [have randomAccessCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1992) [conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1994) [So, we've introduced this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1996) [Swift 4.2 to help simplify the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1997) [set of types that we're dealing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=1999) [with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2000) [And make the existing core types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2001) [like range more composable and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2002) [more flexible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2004) [&gt;&gt; Recursive constraints](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2007) [describe relationships among](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2008) [protocols and their associated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2010) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2012) [This is a topic that we didn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2013) [cover in the WWDC version of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2014) [this talk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2016) [But it's an important part of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2017) [the standard library's use of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2018) [Swift's generic system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2020) [Let's jump right in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2022) [A recursive constraint is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2023) [nothing more than a constraint](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2025) [within a protocol that mentions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2027) [that same protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2028) [Here, collection has an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2031) [associated type named](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2032) [subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2033) [That is itself a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2035) [Why would you need this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2037) [Well, let's look at a generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2039) [Well, let's look at a generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2039) [algorithm that relies on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2040) [So here, given an already sorted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2043) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2045) [We want to find the index at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2046) [which we should insert a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2047) [value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2049) [To maintain that sort order.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2050) [We're going to compute the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2052) [sorted insertion point for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2053) [value 11.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2054) [When we go ahead and insert 11](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2056) [at that index, the result is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2057) [still a sorted array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2059) [The sorted insertion point of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2062) [function is implemented in terms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2063) [of a binary search.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2065) [Binary search is a classic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2067) [divide-and-conquer algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2068) [Meaning that at each step, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2071) [makes a decision that allows it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2072) [to significantly reduce the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2074) [problem size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2075) [For the next step to consider.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2077) [For binary search, we first look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2078) [at the middle element, 8.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2081) [And compare it against the value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2083) [that we want to insert.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2084) [That's 11.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2085) [And because 11 is greater than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2087) [8, we know that 11 needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2089) [inserted somewhere after the 8.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2091) [In the latter half of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2093) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2094) [So we restrict our search space](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2095) [by half.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2097) [In our next step, we find the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2099) [In our next step, we find the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2099) [new middle, 14, and compare it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2100) [against the value we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2102) [insert.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2103) [Eleven is less than 14, so the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2105) [insertion point has to come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2107) [before the middle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2109) [Divide the remaining collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2111) [in half again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2112) [Continue dividing collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2114) [we're looking at in half.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2115) [Until we're pointing at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2117) [proper insertion point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2118) [That's our solution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2119) [Divide-and-conquer algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2122) [like this are fantastic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2123) [Because they're extremely fast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2125) [Binary search takes logarithmic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2127) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2130) [Which means that doubling your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2130) [input size doesn't make the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2132) [algorithm run twice as slowly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2133) [like it would for a linear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2135) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2136) [With a logarithmic algorithm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2137) [like binary search, it only has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2138) [to perform one additional step](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2140) [to cut the problem size in half](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2143) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2144) [So let's turn that into code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2145) [The first thing we need to do is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2148) [find the index of the middle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2150) [element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2151) [Which we can do using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2152) [randomAccessCollections index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2153) [offset by a function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2155) [Next, we check whether our value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2157) [comes before the middle element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2159) [comes before the middle element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2159) [So we know which half of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2161) [collection contains our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2163) [insertion point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2164) [Now in our example, the value to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2166) [insert is greater than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2168) [middle element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2169) [So we take a slice of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2170) [collection from the index after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2171) [the middle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2173) [All the way until the end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2174) [And recursively call sort and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2176) [insertion point of on that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2178) [slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2179) [This is common of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2180) [divide-and-conquer algorithms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2181) [Where you reduce the problem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2183) [space and then recurse.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2184) [Now to make this work, we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2186) [that slicing syntax.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2188) [Provide a suitable slice of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2190) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2191) [We can do this for all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2193) [collections by introducing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2194) [general operation that takes a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2195) [range of indices and produces a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2197) [slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2200) [Like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2201) [Now remember that the slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2202) [adapter we discussed earlier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2204) [works on any collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2206) [Providing a view of the elements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2208) [of the underlying collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2210) [that is itself a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2211) [This makes our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2214) [divide-and-conquer algorithm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2215) [work for any collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2216) [As well as providing slicing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2218) [syntax to all collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2219) [syntax to all collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2219) [That's great, but there's just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2222) [one problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2223) [Some collections don't want this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2225) [particular slice type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2227) [They really want to provide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2229) [their own slicing operations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2230) [that produce a different type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2232) [String is the most common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2234) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2236) [When you slice a string, you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2237) [back a substring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2239) [And so if you apply our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2241) [divide-and-conquer algorithms to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2242) [the string collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2244) [You really want those to be in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2245) [terms of substring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2246) [Rather than some other type like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2247) [the slice of a string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2249) [Range is another interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2250) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2252) [Because its slicing operation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2253) [returns an instance of the exact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2255) [same range type just with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2257) [new bounds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2259) [So to capture this variation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2261) [among different types that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2263) [conform to collection, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2264) [introduce new requirements into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2266) [the collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2268) [Specifically for slicing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2270) [So here we've pulled the slicing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2272) [subscript into the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2274) [protocol itself as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2275) [requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2277) [Now note that the result type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2279) [Now note that the result type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2279) [this subscript is described by a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2280) [new associated type:](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2282) [subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2284) [Now both string and range meet](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2286) [these new requirements of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2289) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2290) [With string, the subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2291) [type is substring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2293) [For range, the subsequence type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2296) [is going to be the range itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2298) [Now this works well for, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2300) [string and range.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2302) [But for all the other collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2303) [types that don't want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2305) [customize the actual subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2306) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2308) [We can provide default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2309) [limitations of slicing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2310) [So the authors of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2312) [collection type don't actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2313) [have to do any extra work to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2314) [conform to collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2316) [They get all the slicing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2317) [behavior for free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2318) [So we're going to start with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2321) [subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2322) [Associated types themselves can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2324) [have default values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2326) [Written after the equals sign.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2328) [For subsequence, the slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2330) [adaptor type is a perfect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2332) [default because it works for all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2334) [collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2336) [So this default will be used for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2337) [any conforming type that doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2338) [any conforming type that doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2338) [provide its own subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2340) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2342) [This pairs well with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2344) [implementation of the slicing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2345) [subscript we started with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2346) [earlier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2348) [Written in extension on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2349) [collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2351) [And it can act as a default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2352) [implementation, providing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2354) [slicing subscript operation that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2356) [returns a slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2357) [We can even go one step further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2359) [and limit the applicability of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2361) [our default slicing subscript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2363) [implementation to those cases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2365) [where we picked the default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2367) [subsequence type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2369) [So this pattern prevents the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2370) [default implementation from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2372) [showing up as an overload on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2374) [collection types that have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2376) [customized their subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2378) [Like string and range.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2379) [So this is all great for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2381) [conforming types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2382) [They get slicing for free, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2383) [they can customize it if they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2385) [want to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2386) [But remember our goal here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2388) [We're trying to write our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2390) [divide-and-conquer algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2391) [against the collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2392) [So we have to answer one really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2395) [important question.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2397) [What does subsequence do?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2398) [What does subsequence do?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2398) [All we know about subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2401) [right now is that it's the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2402) [result type of the slicing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2404) [subscript operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2405) [But we need more to actually use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2407) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2408) [So to answer this question, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2409) [have to go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2410) [algorithms that we want to write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2411) [in terms of subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2413) [Our algorithm is recursive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2415) [It forms a slice which is now a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2418) [value of the subsequence type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2420) [And then recursively calls sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2422) [insertion point of on that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2424) [slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2426) [Now this only makes sense if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2427) [subsequence type you get back is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2430) [itself a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2432) [Now when it performs that call,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2434) [we're going to pass a value of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2435) [the collection's element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2437) [But the recursive call itself is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2439) [going to expect a value of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2441) [subsequence's element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2443) [The only way this can possibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2445) [make sense is if those element](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2447) [types are identical.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2449) [Now the same issue comes up when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2451) [returning an index from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2454) [recursive call.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2456) [Which is going to be computed in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2457) [terms of the subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2458) [terms of the subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2458) [But that index that's returned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2460) [also needs to be a valid index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2462) [for the current collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2464) [So we can capture all of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2466) [requirements in the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2468) [protocol itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2470) [Now the first thing we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2471) [do is say that the subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2473) [of a collection is itself a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2475) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2477) [This is a so-called recursive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2478) [constraint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2479) [Because the associated type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2480) [conforms to its own enclosing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2481) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2483) [We can then use associated type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2484) [where clauses to further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2487) [constrain our subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2489) [As we talked about earlier, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2491) [has an element type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2493) [And that element type needs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2494) [be the same as that of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2496) [original collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2498) [So we can express that here with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2499) [the same type constraint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2500) [Subsequent element is the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2501) [as element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2503) [We can do exactly the same thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2505) [for the index type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2506) [Now, these cover all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2508) [properties that we discovered by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2509) [looking at the implementation of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2511) [the sorted insertion point of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2513) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2515) [This leads us to an interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2517) [question.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2518) [Can you slice a subsequence?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2519) [Can you slice a subsequence?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2519) [Well, every subsequence is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2522) [collection and every collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2523) [has a slice operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2525) [So of course you can slice a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2527) [subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2528) [And the result is going to be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2529) [subsequence of the subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2531) [Now you can do this again and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2535) [get a subsequence of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2537) [subsequence of a subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2538) [And keep on going on and on and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2540) [on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2542) [Now interestingly, at each point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2544) [we could have a brand-new type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2546) [And so we have this potentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2548) [infinite tower of types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2549) [That's actually okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2551) [Each recursive step in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2553) [generic algorithm could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2555) [conceivably create a new type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2556) [Based on the current collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2559) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2561) [So long as the recursion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2562) [eventually terminates at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2563) [runtime, there's no problem with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2564) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2566) [However, it's often the case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2567) [divide-and-conquer algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2569) [can be implemented more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2570) [efficiently by making them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2571) [nonrecursive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2573) [So here is the nonrecursive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2575) [implementation of the sort and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2578) [insertion point of algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2579) [insertion point of algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2579) [We're going to walk through it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2582) [Because the core algorithm is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2583) [the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2584) [But it's expressed iteratively](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2585) [with this while loop rather than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2587) [recursively.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2589) [So the first thing we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2590) [to do is take a slice of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2591) [whole collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2593) [This slice variable is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2595) [represent the part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2597) [collection that we're looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2598) [in each iteration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2599) [And now we see the familiar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2601) [divide-and-conquer pattern.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2603) [Find the middle of the slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2605) [And then compare the value to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2607) [insert against the middle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2609) [element in the slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2610) [We then narrow the search base](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2612) [by slicing the slice before we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2614) [go in loop again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2617) [However, here we have a problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2619) [We're performing an assignment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2621) [to the slice variable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2623) [Which is of the subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2625) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2626) [On the other hand, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2627) [right-hand side is a slice of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2628) [slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2630) [And as we talked about before,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2631) [this is a subsequence of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2633) [subsequence and could be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2634) [completely different type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2635) [So we're going to get a compiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2637) [error telling us that these two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2638) [types are not necessarily the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2639) [types are not necessarily the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2639) [same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2641) [That's really inconvenient here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2642) [because it prevents us from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2644) [writing this nonrecursive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2645) [algorithm.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2646) [And it doesn't really reflect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2647) [how specific collection types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2649) [behave.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2650) [Think about string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2651) [If you slice a string, you get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2653) [substring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2655) [If you slice a substring, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2656) [don't get a sub-substring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2658) [You just get another instance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2661) [the substring type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2663) [So let's go back to how this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2665) [slice adapter works to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2667) [generalize this notion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2668) [We have a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2670) [We're going to call it Self,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2671) [that we've sliced from I to J.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2672) [Now that's going to build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2675) [something of the type slice of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2676) [Self.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2677) [Which is just a view on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2678) [underlying Self collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2680) [If we then slice the slice, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2682) [get a slice of slice of self.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2685) [Which is a view of a view on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2687) [that same underlying Self](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2690) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2692) [So this is our infinite tower of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2693) [types in practice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2695) [However, it doesn't have to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2697) [this way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2698) [Remember that the slice types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2700) [use the same indices as their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2701) [underlying collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2704) [And they also know about their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2705) [underlying basic collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2707) [So when we slice the slice, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2709) [can take those new indices, I2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2711) [and J2.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2713) [Bring them back to the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2714) [base collection and form the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2716) [slice from there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2718) [And what this does is it means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2719) [that when you slice a slice, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2722) [get something back of the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2723) [slice type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2725) [Effectively tying off the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2726) [recursion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2728) [This is exactly the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2729) [behavior we saw with substring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2731) [And it's completely reasonable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2733) [to expect that all subsequence](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2734) [types behave in this way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2736) [So let's model it as an explicit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2739) [part of the collection's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2741) [protocol requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2742) [So here we're saying that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2744) [subsequence of a subsequence is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2746) [the same type as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2748) [subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2749) [In other words, when you slice a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2751) [slice, you get back the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2752) [slice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2754) [This makes our nonrecursive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2756) [divide-and-conquer algorithm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2757) [work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2759) [And simplifies the use of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2760) [collection protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2761) [There's no more need to reason](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2762) [about infinite tower of types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2764) [Now there's one last issue here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2766) [involving subsequence.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2768) [We've said it's required to be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2770) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2771) [But we need the subsequence type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2772) [to be a random access collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2774) [to perform this index offset by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2776) [operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2778) [To describe this, we can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2780) [protocol where clauses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2782) [So when bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2784) [inherits from collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2786) [It can add a new constraint on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2788) [subsequence, requiring it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2790) [conform to that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2792) [bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2793) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2794) [This again is a recursive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2795) [constraint but now it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2797) [expressed on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2798) [bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2799) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2800) [We can do the exact same thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2800) [for randomAccessCollections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2802) [Such as the subsequence of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2804) [random access collection, itself](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2806) [conforms to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2807) [randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2808) [Note how the constraints on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2810) [subsequence follow the enclosing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2812) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2814) [This might sound a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2815) [familiar.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2817) [Both recursive constraints and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2818) [Both recursive constraints and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2818) [conditional conformance tend to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2820) [track the protocol hierarchy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2822) [like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2823) [And the features support each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2824) [other.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2825) [This is particularly important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2826) [because we want the default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2827) [associated type for subsequence,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2829) [the slice of Self, to work at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2831) [every level of the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2833) [hierarchy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2834) [Slice is always a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2835) [When we go ahead and create the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2838) [bidirectionalCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2839) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2840) [It now requires that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2841) [subsequence type also conform to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2842) [bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2845) [The slice adapter's conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2846) [conformance to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2848) [bidirectionalCollection which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2849) [kicks in anytime itself is known](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2850) [to be a bidirectionalCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2852) [Satisfies that requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2854) [RandomAccessCollection works the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2856) [same way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2858) [Subsequence gains a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2859) [randomAccessCollection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2860) [requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2862) [And slices conditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2863) [conformance to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2864) [randomAccessCollection satisfies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2865) [that requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2867) [Now itself is known to be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2868) [randomAccessCollection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2869) [This behavior where an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2871) [associated type default works](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2873) [for every protocol within the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2874) [hierarchy is a good indicator of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2876) [a cohesive design.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2878) [If you find yourself needing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2880) [different associated type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2882) [defaults at different points in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2883) [the collection hierarchy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2884) [You might have a problem with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2886) [your design.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2887) [Recursive restraints are a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2888) [powerful tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2889) [Used with associated type and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2890) [protocol where clauses, they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2892) [help us write the protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2893) [requirements we need to express](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2894) [divide-and-conquer algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2897) [naturally in generic code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2898) [And now we return to the final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2900) [portion of the WWDC talk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2902) [So, Swift is a multi-paradigm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2905) [language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2906) [We've been talking exclusively](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2907) [about generics right now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2908) [But of course, Swift also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2909) [supports object-oriented](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2910) [programming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2912) [And so, I'd like to take a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2913) [moments to talk about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2914) [interaction between those two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2915) [features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2917) [How they work together in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2918) [Swift language.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2919) [So with class inheritance, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2921) [know how class inheritance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2923) [works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2924) [It's fairly simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2925) [You can declare a superclass,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2926) [like Vehicle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2927) [You can declare some subclasses,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2928) [like Taxi and PoliceCar that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2930) [both inherit from Vehicle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2931) [And, once you do this, you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2933) [this object-oriented hierarchy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2935) [You have some expectations about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2936) [where you can use those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2938) [subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2939) [subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2939) [So if I were to extend Vehicle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2940) [with a new method, to go let it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2942) [drive, I fully expect that I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2944) [call that method on one of my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2947) [subclasses, Taxi.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2948) [So, this is a fundamental aspect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2951) [of object-oriented programming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2953) [And, Barbara Liskov, actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2955) [described this really well in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2957) [lecture back in the '80s.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2958) [Since then, we've referred to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2960) [this as the Liskov substitution](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2961) [principle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2963) [And, the idea's actually fairly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2964) [simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2965) [So, if you have someplace in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2966) [your program that refers to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2968) [supertype, or superclass, like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2970) [Vehicle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2974) [You should be able to take an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2975) [instance of any of its subtypes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2977) [or subclasses, like Taxi or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2979) [PoliceCar, and use that instead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2981) [And the program should still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2984) [continue to type check and run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2985) [correctly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2987) [So, the substitution here is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2988) [instance of a subclass should be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2990) [able to go in anywhere that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2991) [superclass was expected and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2992) [tested.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2993) [And, this is a really simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2994) [principle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2996) [We've all internalized it, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2996) [it's also really powerful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2998) [it's also really powerful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=2998) [If you think about it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3000) [And at any point in your program](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3002) [think well, what happens if I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3003) [get a different subclass, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3004) [a subclass I haven't thought](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3005) [about here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3007) [So, getting back to generics,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3009) [what are our expectations when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3012) [applying Liskov substitution](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3014) [principle to the generic system?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3015) [Well, maybe we add a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3018) [protocol, Drivable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3020) [Whatever. And extend Vehicle to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3021) [make it Drivable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3024) [What do we expect to happen?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3025) [Well, we expect that you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3026) [that protocol, conformance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3029) [Vehicle to Drivable, for some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3030) [its subclasses as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3032) [Say, you add a simple generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3034) [algorithm to the Drivable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3036) [protocol to go for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3038) [sundayDrive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3039) [Well, now you should be able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3040) [use that API on a PoliceCar,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3041) [even if that might not be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3044) [best idea.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3046) [So, the protocol conformance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3048) [here is effectively being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3050) [inherited by subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3052) [And this puts a constraint on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3054) [the conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3055) [The one conformance that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3056) [write, the thing that makes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3058) [Vehicle Drivable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3059) [Vehicle Drivable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3059) [Has to work for all of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3061) [subclasses of Vehicle now and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3062) [anyone that comes up with it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3065) [later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3066) [Most of the time, that just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3067) [works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3069) [However, there are some cases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3071) [where this actually adds new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3072) [requirements on the subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3073) [The most common one is when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3076) [dealing with initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3079) [requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3080) [So, if you've looked at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3082) [decodable protocol, it has one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3082) [interesting requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3085) [Which is the initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3086) [requirement to create a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3087) [instance of the conforming type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3089) [from a decoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3091) [How do we use this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3093) [Well, let's go add a convenience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3095) [method to the decodable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3096) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3097) [It's a static method decode that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3098) [creates a new instance from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3100) [decoder, essentially a wrapper](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3101) [for the initializer, making it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3103) [easier to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3104) [And, there's two interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3105) [things to notice about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3107) [particular method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3109) [First, is it returns Self with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3110) [capital S.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3112) [Remember this is the conforming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3113) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3114) [It's the same type that you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3115) [calling the static method on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3116) [Now, the second interesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3120) [thing is, how are we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3121) [implementing this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3123) [Well, we're calling to that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3123) [initializer above to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3124) [brand-new instance of whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3127) [decodable type we have, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3130) [return it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3132) [Fair enough.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3134) [We can go ahead and make our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3136) [Vehicle type Decodable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3137) [And then, what we expect, when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3139) [applying the Liskov substitution](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3141) [principle, is we can use any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3142) [subclass of Vehicle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3144) [With these new API's that we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3147) [built through the protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3148) [conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3149) [So, we can call Decode on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3149) [Taxi.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3152) [And what we get back is not a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3153) [Vehicle not some arbitrary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3154) [Vehicle instance, but the Taxi,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3155) [an instance of Taxi.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3157) [This is great, but how does it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3160) [work?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3161) [So let's take a look at what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3163) [Taxi might have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3165) [Maybe there's an hourly rate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3166) [here, and when we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3167) [Taxi.decode from, we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3168) [through the protocol, going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3171) [through the protocol initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3172) [requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3173) [There's only one initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3175) [this can actually call, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3176) [that's the initializer that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3178) [declared inside the Vehicle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3179) [declared inside the Vehicle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3179) [class, in the superclass here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3183) [So that initializer, it knows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3186) [how to decode all of the state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3188) [of a Vehicle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3189) [But it knows nothing about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3191) [Taxi subclass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3192) [And so, if we were to use this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3194) [initializer directly, we would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3195) [actually have a problem that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3196) [hourly rate would be completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3198) [uninitialized, which could lead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3199) [to some rather unfortunate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3201) [misunderstandings when you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3202) [your bill at the end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3203) [So, how do we address this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3206) [Well, it turns out Swift doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3207) [let you get into this problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3208) [It's going to diagnose at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3211) [point where you try to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3213) [Vehicle conform to the decodable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3214) [protocol that there's actually a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3216) [problem with this initializer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3217) [It needs to be marked required.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3218) [Now, a required initializer has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3222) [to be implemented in all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3224) [subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3226) [Not just the direct subclasses,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3227) [but any subclasses of those, any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3229) [future subclasses you don't know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3232) [about now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3233) [Now by adding that requirement,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3235) [it means that when Taxi inherits](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3237) [from Vehicle, it also needs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3239) [from Vehicle, it also needs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3239) [introduce an initializer with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3242) [the same name.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3245) [Now, this is important because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3246) [this initializer's responsible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3247) [for decoding the hourly rate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3249) [And then chaining up to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3251) [superclass initializer to decode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3252) [the rest of the Vehicle type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3255) [Okay. Now, if you're reading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3258) [those red boxes really quickly,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3261) [you may have noticed the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3262) [subphrase non-final.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3263) [So, by definition, final classes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3266) [have no subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3269) [So, it essentially exempts them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3270) [from being substituted later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3272) [That means that there's no sense](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3275) [in having a required initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3277) [because you know there are no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3279) [subclasses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3280) [And so final classes are in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3281) [sense a little easier to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3282) [with when dealing with things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3283) [like decodable or other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3284) [initializer requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3285) [Because they're exempt from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3287) [these rules of having required](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3288) [initializers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3289) [So when you're using classes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3291) [for reference semantics,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3293) [consider using final when you no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3296) [longer need to customize your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3297) [class through the inheritance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3299) [class through the inheritance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3299) [mechanism.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3301) [Now, this doesn't mean that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3302) [can't customize your class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3304) [later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3305) [You can still write an extension](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3305) [on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3307) [The same way you can extend a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3307) [struct or an enum.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3308) [You can also add conformances to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3310) [it, to get more dynamic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3311) [dispatch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3313) [But final can simplify the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3314) [interaction with the generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3316) [system, and also unlock](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3317) [optimization opportunities for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3318) [the compiler in runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3319) [So we've talked a bit about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3324) [Swift generics today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3325) [The idea behind Swift generics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3326) [is to provide the ability to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3327) [reuse code while maintaining](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3329) [static type information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3331) [To make it easier to write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3333) [correct programs, and compile](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3334) [those down into efficient,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3336) [efficiently executing programs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3337) [When you're designing protocols,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3339) [let this push and pull between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3341) [the generic algorithms you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3343) [to write against a protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3345) [And the conforming types that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3346) [need to implement that protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3348) [guide your design to meaningful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3349) [extractions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3351) [Introduce protocol inheritance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3353) [when you need some more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3355) [specialized capabilities to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3356) [implement new generic algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3358) [that are only supportable on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3360) [subset of the conforming types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3361) [And, conditional conformance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3364) [when you're writing generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3366) [types, so that they can compose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3367) [nicely, especially when working](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3371) [with protocol hierarchies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3372) [And finally, when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3374) [reasoning about the tricky](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3375) [interaction between class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3376) [inheritance and the generic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3378) [system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3379) [Go back to the Liskov](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3380) [substitution principle, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3381) [think about what happens here if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3383) [I introduce a subclass rather](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3386) [than a superclass at which I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3387) [wrote the conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3389) [Well, thank you very much.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3392) [There's a couple of related](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3394) [sessions on embracing algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3395) [and understanding how they can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3397) [help you build better code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3398) [As well as using Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3399) [collections effectively in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3401) [everyday programming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3403) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3405) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/406/?time=3406)