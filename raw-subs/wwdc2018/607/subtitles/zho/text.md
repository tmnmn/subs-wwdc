# Metal for Game Developers

## Summary
Metal 2 is Apple-designed graphics software that lets developers build console‑style games. Learn key aspects of the Metal architecture that support the techniques for modern high-performance game rendering. See how Metal now enables the GPU to schedule work for itself, allowing complete scenes and compute workloads to be built and executed with little to no CPU interaction. Understand how the seamless integration of Metal 2 with the A11 Bionic chip lets your apps and games realize entirely new levels of performance and capability.

## Info
* Graphics and Games
* WWDC 2018 - Session 607 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=7) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=21) [&gt;&gt; 欢迎大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=26) [去年 我们介绍了第二代](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=28) [Metal 技术 包括了新的用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=30) [图形处理器（GPU）来驱动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=32) [渲染管线的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=34) [今年 我们将带来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=36) [更多新鲜的 激动人心的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=37) [技术来解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=39) [常见的游戏开发中的挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=41) [我叫 Brian Ross](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=43) [我将和我的同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=44) [Michael Imbrogno 一起来展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=46) [一些新的方式来使你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=48) [App 更好 更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=49) [并且更加有效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=52) [但是首先 我想要谈一谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=54) [那些我们试图去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=57) [帮助你们解决的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=58) [现在大家的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=60) [使用了越来越多的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=62) [对象 材质 和光线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=63) [比如说 游戏“深处”（Inside）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=67) [使用了大量的特效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=69) [来捕捉和渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=70) [游戏带来的的情感](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=73) [制作这样能让你全身心沉浸进去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=76) [的游戏是十分有挑战性的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=77) [因为它需要高效的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=79) [图形处理器（GPU）利用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=82) [同时 游戏也需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=83) [越来越多的 CPU 周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=87) [为激动人心的游戏玩法做支撑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=88) [举个例子 游戏古墓丽影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=91) [不仅拥有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=93) [令人惊叹的风景和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=94) [极其细致的地形](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=96) [他们还在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=98) [AI 中管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=100) [复杂的物理仿真](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=101) [这十分具有挑战性因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=104) [预留了更少的 CPU 时间来实现渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=105) [最终 开发者们将把](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=109) [3A 级游戏比如像来自 Epic Games](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=112) [的《堡垒之夜》移植进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=115) [iOS 中 然后你们就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=117) [可以在手中玩游戏机级别的游戏了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=119) [可以在手中玩游戏机级别的游戏了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=119) [这是一个非常惊人的举动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=122) [但是它给我们带来了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=125) [更多的挑战 比如说像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=126) [如何平衡电池的寿命](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=129) [和帧率之间的关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=131) [现在 让我们来看一看 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=132) [是如何帮助我们解决这些挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=134) [今天 我将要展示给你们如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=138) [在中央处理器（CPU）和图形处理器（GPU）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=141) [上利用并行来绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=142) [更复杂的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=145) [我们也将会谈到如何对堆](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=149) [栅栏和事件进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=151) [更加精确的控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=153) [来最优化性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=155) [然后 我将要展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=157) [如何使用我们的最新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=161) [参数缓冲区和间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=163) [来构建图形处理器（GPU）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=164) [驱动的管线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=166) [虽然所有的这些 API 提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=168) [都很关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=169) [但理解支持他们运行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=171) [底层硬件也十分重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=173) [所以接下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=175) [我的同事 Michael 将要给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=177) [你们展示如何针对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=179) [你们展示如何针对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=179) [A11 来进行优化以达到提升性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=181) [延长游戏时间的目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=183) [最后 我很高兴](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=185) [来自 Epic Games 的 Nick Penwarden](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=188) [将会加入我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=189) [他将给我们展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=192) [他们是如何运用 Metal 技术使](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=194) [游戏机级别的游戏可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=195) [我们的设备上运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=197) [让我们开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=199) [利用中央处理器（CPU）和图形处理器（GPU）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=203) [并行可能是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=205) [你可以做到的最重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=207) [也是最简单的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=208) [在单线程上构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=212) [命令流已经不能满足现在的要求了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=213) [最新款的 iPhone 拥有 6 个内核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=216) [而 iMac Pro 拥有多达 18 个内核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=218) [因此 可扩展的多线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=221) [架构是我们所有设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=222) [拥有卓越表现的关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=225) [Metal 技术是为了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=229) [多线程而设计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=231) [我将先向你们展示在中央处理器（CPU）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=231) [进行并行操作的两种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=233) [接下来我将展示 Metal 科技是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=235) [如何在图形处理器（GPU）上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=236) [自动进行并行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=238) [自动进行并行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=238) [作为本节的结尾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=240) [我们来举一个典型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=242) [游戏架构的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=244) [使用经典的单线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=246) [渲染 [ 音质不清晰 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=248) [你会将图形处理器（GPU）命令和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=250) [图形处理器（GPU）执行依次在单个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=253) [命令缓冲区内构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=254) [通常情况下 你将会把这个时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=256) [匹配到适合你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=257) [帧时间当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=258) [而且当然 你将得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=261) [最长的延迟时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=262) [由于整个命令缓冲区必须在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=264) [图形处理器（GPU）可以使用之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=266) [进行编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=268) [显然 有更好的方法可以来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=269) [做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=270) [所以我们要做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=272) [和中央处理器（CPU）一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=274) [进行并行构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=276) [渲染和计算传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=277) [是 Metal 技术中多线程操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=281) [的基本粒度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=283) [所有你需要做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=285) [就是创建多个命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=286) [并在单独的线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=288) [分别对不同的通道进行编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=290) [你可以按照任何你希望的顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=292) [对它们进行编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=295) [最终的执行顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=296) [取决于它们添加到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=297) [命令队列的先后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=299) [命令队列的先后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=299) [所以 现在让我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=301) [在代码中这是多么容易实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=302) [你可以看到这并不需要很多代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=304) [你要做的第一件事是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=310) [从队列中创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=311) [任意数量的命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=313) [接下来 我们将通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=316) [enqueue 接口来提前定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=319) [图形处理器（GPU）的执行顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=321) [这非常棒 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=323) [你可以在不用等待命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=325) [首先 被编码的情况下完成所有操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=327) [最后 我们将为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=329) [每个部分创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=331) [单独的线程和调用编码函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=333) [这就是全部了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=335) [这就是你需要做的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=336) [它非常快速 非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=338) [高效 而且非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=340) [所以现在 让我们回到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=342) [前面的图表 看一下另一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=343) [就像你所看到的 我们能够在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=346) [中央处理器（CPU）上执行很好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=349) [并行操作 但是如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=351) [你有一个非常长的渲染通道呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=354) [在这种情况下 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=358) [在这种情况下 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=358) [使用了一个专用的并行编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=361) [它允许你在多个线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=362) [进行编码 并且无需](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=364) [明确划分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=366) [渲染通道或命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=368) [所以现在 让我们来看一看它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=370) [在你的代码里有多简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=372) [它看起来非常像之前的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=374) [你要做的第一件事就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=377) [创建一个并行编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=378) [并且从这个并行编码器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=381) [创建任意数量的从属编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=383) [很重要的一点是意识到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=385) [这实际上就是你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=387) [定义图形处理器（GPU）执行顺序的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=388) [接下来 我们将创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=392) [单独的线程并单独对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=395) [我们的每个 G 缓冲（G-buffer）函数进行编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=397) [最后 我们会设置一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=400) [通知 当线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=404) [完成时 我们可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=406) [并行编码器上调用结束编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=408) [这就是全部了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=410) [这就是你并行化渲染通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=411) [所需要做的全部内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=412) [它非常快速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=414) [而且非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=415) [现在我已经向你展示了两种在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=416) [中央处理器（CPU）上并行化的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=418) [现在让我们看看 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=420) [如何在图形处理器（GPU）上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=421) [为你进行自动并行化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=422) [所以让我们先从头看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=424) [一个框架示例 然后看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=427) [图形处理器（GPU）如何执行这个框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=430) [基于你平台的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=433) [Metal 技术可以通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=434) [分析数据相关性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=437) [自动提取并行性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=439) [现在让我们看一看这些相关性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=441) [当中的 2 个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=442) [在这个例子中 粒子模拟会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=444) [写入数据 而这些数据稍后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=446) [将会被效果用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=448) [渲染粒子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=450) [类似地 G 缓冲（G-buffer）通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=452) [生成几何图形 稍后将会通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=456) [延迟着色过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=457) [来计算材质的明暗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=458) [所有这些信息都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=463) [允许 Metal 技术自动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=465) [并且便宜地识别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=466) [可以并行运行的整个通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=469) [例如使用异步计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=471) [所以你可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=475) [图形处理器（GPU）上获得免费的并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=477) [图形处理器（GPU）上获得免费的并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=477) [行和异步计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=480) [它是免费的原因是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=481) [Metal 技术不需要你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=482) [做任何特别的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=483) [我认为我们都喜欢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=484) [在图形处理器（GPU）上获得免费优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=487) [但有时候作为一名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=489) [开发人员 你可能需要走得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=490) [更远一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=493) [所以对于你代码中最关键的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=494) [Metal 技术允许你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=496) [逐步控制一些更深层次的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=498) [例如 你可以禁用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=501) [自动引用计数并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=503) [自己执行以节省中央处理器（CPU）时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=505) [你也可以使用 Metal 堆](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=508) [来真正低消耗地严格控制分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=510) [并且 Metal 堆可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=513) [由栅栏和事件补充 这可以让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=516) [明确控制图形处理器（GPU）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=519) [的并行操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=521) [许多游戏使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=524) [大量的资源 这可能需要花费高昂的代价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=526) [分配需要不断和 OS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=529) [进行双向沟通 OS 系统必须映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=531) [并初始化每个请求的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=534) [如果你的游戏使用临时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=536) [渲染目标 这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=538) [分配可能发生在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=539) [分配可能发生在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=539) [你的框架中间 造成卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=540) [资源堆是解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=543) [这个问题的好方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=545) [堆也可以让你提前从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=547) [系统中分配大量内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=549) [然后 你就可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=552) [这些内存上添加或删除纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=553) [和缓冲区 而无需进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=554) [任何昂贵的双向沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=556) [因此 从分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=558) [3 种常规纹理的情况开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=560) [Metal 技术通常将这些放到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=563) [3 个单独的分配中 但是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=565) [将这些全部分配到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=567) [单个堆中可以让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=569) [提前在堆创建时执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=571) [所有的内存分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=574) [那么创建纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=575) [将会变得非常低耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=577) [另外 堆有时可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=580) [通过使分配更紧密](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=582) [来更有效地使用空间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=585) [因此在使用传统模型时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=588) [你将取消分配纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=590) [将页释放回系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=592) [然后重新分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=593) [重新分配将再一次分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=596) [一组新的纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=597) [通过使用堆 你可以取消分配和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=599) [通过使用堆 你可以取消分配和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=599) [重新分配资源 而无需任何昂贵的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=602) [和系统进行的双向沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=604) [最后 堆也可以让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=608) [互相分享不同的内存资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=609) [这在当你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=614) [游戏框架有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=615) [临时渲染目标时非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=616) [没有理由让这些目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=618) [不断地占用不同的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=619) [所以你可以替换入口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=621) [并省下数百兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=623) [现在 在替换入口的方式中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=626) [分配速度更快 但在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=628) [涉及相关性跟踪时 它并不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=630) [完全没有影响的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=631) [让我们回到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=633) [框架示例来进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=634) [更好的解释](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=635) [当使用了堆时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=638) [Metal 技术就看不到单个的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=640) [因此它不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=642) [自动识别通道之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=643) [的读写相关性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=644) [例如示例中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=646) [G 缓冲（G-buffer）和延期着色通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=648) [所以你必须使用栅栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=651) [来明确地标记哪个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=653) [通道产生数据 哪个通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=655) [消耗数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=657) [在这个例子中 G 缓冲（G-buffer）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=658) [在这个例子中 G 缓冲（G-buffer）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=658) [更新了栅栏 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=660) [延迟着色等待着它的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=662) [所以现在 让我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=664) [如何在你的代码中应用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=668) [这些基本概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=669) [我们要做的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=672) [就是将这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=675) [应用到我们的 G 缓冲（G-buffer）和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=676) [延迟着色示例中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=677) [首先 我们将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=679) [从堆中分配我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=681) [临时渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=683) [这看起来非常像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=683) [今天在分配纹理时可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=684) [已经做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=686) [接下来 我们将渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=688) [该临时渲染目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=691) [最后 在分段阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=693) [完成后更新栅栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=696) [这将确保所有数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=698) [在下一个通道使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=699) [之前生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=701) [现在 让我们切换到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=703) [延迟着色过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=705) [我们将使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=708) [这个临时渲染目标来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=709) [计算材质的明暗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=711) [然后 我们将等待栅栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=714) [来确保它在我们使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=716) [之前已经生产完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=718) [最后 资源是可以替换的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=720) [这样我们就可以重新使用它来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=723) [进行其他操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=725) [节省数百兆字节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=726) [现在我们已经讨论了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=728) [如何通过明确的控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=729) [来进行并行化和优化性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=731) [这非常棒 但是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=733) [如果你想让 GPU 更多地进入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=736) [参与这个过程呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=738) [那么接下来我们来讨论一下 GPU 驱动的管线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=740) [你们的游戏正在将越来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=745) [越多的决策逻辑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=747) [转移到 GPU 上 尤其是当在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=750) [处理包含数千个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=752) [对象的超大型数据集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=754) [或场景图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=756) [Metal 二代技术使](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=758) [我们在 GPU 驱动管线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=761) [方面又迈出了重要一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=763) [去年 我们引入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=766) [间接参数缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=767) [这可以进一步降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=769) [CPU 使用率 并将大部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=771) [工作量转移到 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=773) [今年 我们再一次引入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=776) [间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=777) [这将允许你将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=779) [这将允许你将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=779) [整个渲染循环转移到 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=782) [首先 让我们简要回顾一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=786) [参数缓冲区的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=789) [参数缓冲区就是像大屏幕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=791) [呈现的这样一个结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=792) [以前这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=797) [只有常量 但有了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=798) [参数缓冲区 我们可以拥有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=800) [纹理和采样器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=801) [在一切之前 这些必须具有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=803) [独立的着色器绑定点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=804) [但是由于这种结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=807) [你可以在你的处理中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=810) [使用 Metal 着色语言的所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=811) [功能 因此它非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=812) [灵活并且非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=814) [你可以执行像添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=816) [子结构或数组甚至](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=817) [是指向其他参数缓冲区的指针的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=819) [你可以修改纹理和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=823) [采样器 在 GPU 上创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=824) [新材质并且无需 CPU 参与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=826) [或者 你可以制作巨大的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=830) [材质数组 并且使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=832) [单实例绘图调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=834) [来呈现许多具有独特属性的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=836) [参数缓冲区允许你将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=840) [材质管理卸载到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=842) [GPU 上并节省宝贵的 CPU 资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=845) [但今年 我们把它稍微扩展了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=848) [一点 再稍稍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=850) [扩展了一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=851) [我们开始加入 2 个新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=853) [参数类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=855) [它们包括管线状态和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=857) [命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=859) [现在 这些将用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=861) [支持我们全新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=862) [间接命令缓冲区功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=864) [通过间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=866) [你可以在 GPU 上编码整个场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=867) [在 CPU 上 你只有几个线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=871) [可用于渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=873) [但是在 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=874) [你拥有数百甚至](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=875) [数千个可以同时运行的线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=877) [通过间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=881) [你可以充分利用这种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=882) [大规模的并行性质](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=884) [此外 间接命令缓冲区是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=887) [完全可以复用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=889) [因此你可以只花费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=891) [一次编码成本 然后不断重复使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=892) [由于 ICB 是一个可直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=895) [访问的缓冲区 因此你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=897) [访问的缓冲区 因此你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=897) [随时修改它的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=900) [例如更改着色器类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=902) [或相机矩阵 或者其他](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=903) [任何你可能需要更改的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=905) [当然 通过将渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=907) [转移到 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=909) [你可以移除昂贵的 CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=911) [和 GPU 同步点 这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=913) [同步点通常需要提交数据给它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=915) [让我们来看一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=918) [这是一个典型的游戏框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=920) [一般的渲染循环有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=923) [常见的几个阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=924) [首先 你通过浏览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=927) [场景图来确定哪些对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=929) [需要被渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=930) [你可能使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=932) [视锥体剔除来确定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=934) [视锥体内的物体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=936) [你们中的一些人可能会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=938) [使用更加复杂的方法来解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=939) [遮挡问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=941) [此外细节选择的程度自然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=942) [而然地产生在这个阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=945) [只有当你编码并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=947) [提交命令缓冲区后 GPU 才会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=949) [开始使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=951) [越来越多的游戏正在将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=955) [确定可见对象的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=957) [转移到 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=958) [转移到 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=958) [GPU 在处理最近游戏中出现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=961) [越来越复杂的场景方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=963) [做得更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=964) [不幸的是 这会在你的框架中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=966) [创建一个同步点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=969) [而且它使得 CPU 不能对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=972) [绘制调用进行编码直到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=974) [GPU 产生数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=976) [在不浪费宝贵的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=978) [CPU 和 GPU 同步时间的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=979) [完成该任务是极其困难的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=981) [ICB 的好处是巨大的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=985) [你不仅可以将最后的处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=988) [转移到 GPU 上 还可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=990) [自然移除任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=992) [交换数据所需的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=994) [同步点 并且提高 CPU 和 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=995) [的利用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=997) [同时 你可以把](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=999) [CPU 开销降至一个常量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1002) [所以让我们来看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1004) [编码的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1007) [我将首先使用前面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1009) [例子来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1011) [只有 GPU 可以提供的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1013) [大规模并行化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1015) [我们从剔除调度中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1017) [可见对象列表和 LOD 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1019) [可见对象列表和 LOD 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1019) [另外 请记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1023) [我们正在使用参数缓冲区的能力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1025) [所以在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1027) [每个元素都有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1030) [指向实际属性的指针 所以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1032) [我们不需要将所有内容都存储在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1034) [同一个缓冲区内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1035) [这种方式为我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1037) [节省了大量的内存和性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1040) [这是因为我们只构建了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1042) [一小部分信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1043) [实际参数缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1045) [包含几个级别的几何细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1047) [它们包括位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1050) [顶点缓冲区 索引缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1053) [和材质参数缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1055) [关于渲染 我们只选择每个对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1057) [多个 LOD 中的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1059) [实际的编码发生在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1061) [一个计算内核中 我们把它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1065) [编码成一个间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1067) [计算内核的每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1069) [线程都编码一个绘制调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1071) [所以我们读取对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1074) [具有的所有属性 并将它们编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1075) [到 ICB 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1078) [到 ICB 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1078) [这里有一些值得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1081) [注意的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1083) [你可以把 ICB 视为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1084) [一系列渲染命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1086) [一个渲染命令包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1087) [带有着色器的管线对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1089) [任意数量的缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1091) [和绘制调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1092) [然后 ICB 是为并行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1094) [而构建的 因此你可以同时进行编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1096) [并且不用担心顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1098) [最后 我们使 API 保持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1100) [简单 所以以上这些操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1103) [就像你今天在可能在 CPU 上所做的一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1105) [另外 每个命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1108) [可以有不同的属性 甚至不同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1109) [绘制类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1111) [因此 这对于许多人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1112) [可能在其他地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1115) [看到的所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1116) [间接渲染 都是十分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1117) [重要的一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1118) [现在 我们来看看如何在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1120) [代码中执行此操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1122) [编码一个绘图调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1124) [就是这么容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1126) [你要做的第一件事就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1128) [使用你的线程 ID 得到索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1129) [并通过索引来选择渲染命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1131) [然后 我们要设置属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1134) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1137) [我们设置了一个具有管线状态的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1138) [我们设置了一个具有管线状态的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1138) [然后为几何和材质设置了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1140) [单独的缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1143) [最后 这是你编码一个绘图调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1145) [一个绘图调用的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1147) [由于 Metal 着色语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1149) [在 GPU 上编码真的变得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1150) [非常 非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1151) [即使是在计算着色器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1153) [这看起来就像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1155) [就像你今天在可能在 CPU 上所做的事一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1157) [现在 我们再看另一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1158) [这些是创建 编码和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1163) [执行 ICB 所需做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1164) [一些基本工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1166) [你首先填写一个状态描述来创建它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1169) [状态描述包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1173) [绘制类型 继承](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1174) [属性和每层的绑定计数等内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1178) [这描述了间接缓冲区的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1180) [行为方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1182) [在对 ICB 进行编码时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1184) [你只需创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1187) [计算编码器和调用调度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1189) [就像你已经在做的一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1190) [一旦 ICB 被编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1194) [你可以选择是否要优化它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1195) [当你决定优化它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1198) [你会删除所有的冗余状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1199) [你会删除所有的冗余状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1199) [最终的结果是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1201) [一组精简而高效的 GPU 命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1203) [现在 一旦 ICB 被编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1206) [和优化 就可以安排它进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1208) [执行操作了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1210) [你会注意到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1211) [在这里你实际上可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1212) [指定你执行的命令的确切范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1214) [同样在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1217) [我们使用了一个间接缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1218) [它本身就可以用 GPU 编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1221) [所以一旦 ICB 完成编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1225) [它就可以被一次又一次地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1228) [重复使用 并且开销是完全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1229) [可以被忽略不计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1231) [我非常兴奋](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1232) [但我们还要接着往下走](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1233) [我们将一个例子与代码放在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1235) [以便你们可以看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1236) [在屏幕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1239) [你可以看到一些城市中的校车](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1241) [每辆校车由 500,000](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1243) [个多边形和 2000 个独立部分组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1246) [每个部分都需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1250) [一个单独的绘图调用 它自己的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1253) [材质参数缓冲区 索引缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1255) [和顶点缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1256) [正如你想象的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1258) [正如你想象的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1258) [这将会有很多 CPU 上的 API 调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1260) [但是我们在这里使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1262) [间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1264) [所以一切都将在 GPU 上编码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1265) [我们也会选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1269) [合适的的细节级别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1270) [因此 我们可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1272) [呈现多个对象的同时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1273) [也不会增加 CPU 或 GPU 上的花费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1276) [在屏幕左边 你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1279) [常规相机的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1280) [而在屏幕右侧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1282) [我们放大了一辆校车](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1283) [你可以看到细节级别在变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1285) [ICB 使我们能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1289) [推出另一个令人难以置信的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1291) [优化方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1292) [我们能够将几何体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1295) [分成由几百个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1297) [三角形组成的块 并在单独的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1299) [计算内核中分析这些块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1300) [你可以在屏幕上看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1303) [不同颜色的色块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1304) [内核的每个线程都会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1307) [确定三角形是否](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1308) [背对着相机 或者它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1309) [是否被场景中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1311) [其他对象或几何体遮挡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1312) [这是真的非常快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1315) [因为我们只对一个块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1317) [进行计算 而不是每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1318) [进行计算 而不是每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1318) [单独的三角形](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1320) [然后我们告诉 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1323) [只渲染那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1325) [实际可见的块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1326) [再一次 让我们看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1327) [屏幕左右侧的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1331) [左侧是相机视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1333) [右侧是校车的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1334) [另一个​​视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1336) [你可以在右侧看到红色和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1338) [粉红色的色调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1340) [这就是我们的计算着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1341) [所确定的不可见的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1342) [我们从未真正将此场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1345) [发送给 GPU 因此它可以节省 50％](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1347) [或更多的几何渲染成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1350) [这是最后一个视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1355) [它展示了这种技术 可以为你节省多少成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1358) [注意右侧的画面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1361) [许多校车和救护车实际上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1363) [是隐形的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1364) [这实在是太神奇了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1370) [我喜欢这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1372) [所以请尽情地探索代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1373) [我希望我将来会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1375) [一些游戏中看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1377) [这种技术的应用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1378) [我想如果你使用了它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1380) [ICB 可以将你的游戏推向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1382) [更高的水平](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1383) [现在 我很高兴向大家介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1385) [Michael 他将向你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1387) [展示如何针对 A11 进行优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1389) [改善性能并延长游戏时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1391) [十分感谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1393) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1395) [&gt;&gt; 谢谢 Brian](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1400) [Brian 刚刚展示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1402) [所有内容都适用于 iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1403) [tvOS 和 macOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1405) [接下来 我将深入探讨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1407) [Apple 最新的 GPU A11 Bionic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1409) [拥有的 Metal 二代技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1410) [的一些新功能 它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1412) [旨在通过减少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1414) [系统内存带宽和降低功耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1415) [来帮助你最大化游戏性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1417) [并且延长游戏时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1419) [Apple 设计的 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1425) [拥有切片式延迟渲染架构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1426) [这是专为高性能和低功耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1427) [而设计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1429) [这种架构利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1432) [高带宽低延迟的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1433) [内存来消除透支](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1434) [和不必要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1437) [内存流量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1438) [现在 Metal 技术在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1442) [每个渲染通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1443) [加载和存储操作中都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1445) [自动利用 TBDR 架构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1446) [明确了渲染通道的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1448) [内容是如何写入和写出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1450) [Tile 内存的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1451) [但 A11 GPU 进一步利用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1456) [TBDR 架构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1458) [我们在 Tile 的内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1460) [添加了新功能 并且增加了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1461) [全新的可编程阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1463) [这为高级的渲染技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1465) [提供了至关重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1467) [的新的优化机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1468) [例如延迟着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1470) [与顺序无关的透明度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1472) [平铺正向着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1474) [和粒子渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1475) [让我们先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1477) [看一下 A11 GPU 的架构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1479) [好的 在屏幕的左边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1484) [我们有 A11 GPU 的展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1486) [而在屏幕右边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1487) [我们有系统内存的展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1489) [现在 A11 GPU 先处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1491) [所有顶点阶段在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1493) [渲染通道中的几何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1494) [它将你的几何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1497) [变换并弯曲成屏幕对齐](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1498) [变换并弯曲成屏幕对齐](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1498) [的平铺顶点缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1500) [然后这些平铺的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1502) [顶点缓冲区 将会存储在系统内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1503) [现在 每个平铺的顶点缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1507) [将作为碎片阶段的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1508) [在传输时完全处理完](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1510) [这种平铺架构可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1513) [以让你的游戏免费获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1515) [2 个主要优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1516) [首先 GPU 在使用快速的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1519) [用于传输的内存对任何像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1522) [进行着色之前 对所有图元进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1523) [光栅化处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1525) [这消除了内存的透支](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1526) [从而提高了性能并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1528) [降低了功耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1530) [其次 用更大 更灵活的 Tile 内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1532) [来存储着色片段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1536) [混合操作速度很快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1538) [这是是由于所有数据都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1539) [存储在着色核心旁边用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1540) [传输的内存上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1542) [现在 在所有 Tile 内存被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1543) [着色之后 每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1546) [Tile 内存仅被写入系统内存一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1548) [这会降低带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1551) [这同时也会提升你的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1552) [并降低功耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1554) [现在 这些优化发生在一切之下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1556) [你只需在 iOS 上使用 Metal 技术即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1560) [得到它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1561) [但 Metal 技术还可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1563) [通过明确控制 A11 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1564) [Tile 的内存来优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1566) [渲染技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1567) [现在 在 A11 GPU 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1569) [开发过程中 Apple 的硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1572) [和软件团队分析了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1573) [许多重要的现代](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1575) [渲染技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1576) [我们加速了内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1578) [我们注意到了很多共同的主题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1580) [并且我们发现显式控制我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1582) [Tile 内存 可以为所有的这些内存加速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1583) [接下来 我们围绕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1587) [这种显式控制的想法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1588) [开发了硬件和软件功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1589) [那么现在让我们来谈谈这些功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1592) [可编程的混合让你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1601) [可以在着色器中编写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1602) [自定义的混合操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1603) [它也是一个可以用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1605) [合并渲染通道的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1606) [强大工具 实际上它可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1608) [用于所有的 iOS 的 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1609) [图像块（Imageblocks）是 A11 的新增功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1612) [它们通过直接用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1613) [着色语言控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1615) [像素布局 可以让你最大限度地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1616) [利用 Tile 的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1618) [Tile 的着色是我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1619) [Tile 的着色是我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1619) [全新的可编程舞台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1622) [它是专为需要混合图形](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1623) [和计算处理的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1624) [而设计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1625) [持久线程组内存是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1628) [组合渲染和计算的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1629) [重要工具 它允许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1631) [你通过绘制和调度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1632) [进行通信](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1633) [多样本颜色覆盖控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1635) [可以让你使用 Tile 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1638) [着色器直接在 Tile 的内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1640) [执行解析操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1641) [所以我要和你说一说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1645) [所有的这些功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1646) [让我们从可编程混合开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1647) [通过可编程混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1648) [你的片段着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1653) [可以读取和写入像素和 Tile 的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1654) [这可以让你编写自定义的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1656) [混合操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1657) [但是 可编程混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1660) [还可以通过组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1662) [多个读取和写入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1663) [相同内容的渲染通道来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1665) [消除系统内存带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1666) [现在 延迟着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1669) [特别适合于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1670) [应用可编程混合 所以让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1672) [我们仔细看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1673) [延迟着色是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1678) [一种一般使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1679) [一种一般使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1679) [2 遍传递实现的多光技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1680) [在第一遍中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1683) [多个附件填充了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1684) [每个像素可见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1685) [几何属性 例如法线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1687) [反照率和粗糙度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1689) [在第二遍中 通过对那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1692) [G 缓冲的内容进行采样来对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1693) [片段进行着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1694) [现在 G 缓冲先被存储在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1696) [系统内存中 然后再次在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1700) [光照通道中读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1701) [并且从 Tile 的内存到系统内存的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1703) [双向交流和再次回退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1704) [可能使你的游戏进入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1706) [瓶颈 因为 G 缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1708) [轨道消耗了大量的带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1709) [现在 可编程混合可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1711) [让你直接从 Tile 的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1713) [中读取到当前像素的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1715) [数据 从而跳过内存的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1716) [来回沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1718) [这也意味着我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1722) [不再需要 2 次传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1723) [我们 G 缓冲的填充](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1724) [和光照步骤现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1726) [被编码和运行在每个渲染通道中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1728) [这也意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1731) [我们不再需要系统内存中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1732) [G 缓冲内容的副本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1734) [有了内存 Metal 技术的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1736) [无记忆渲染目标功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1739) [无记忆渲染目标功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1739) [对于节省内存来说真的非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1740) [非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1742) [你只需创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1743) [带有无记忆标记的纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1744) [同时 Metal 技术仅允许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1746) [你在没有进行加载或存储操作的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1748) [把它作为附件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1749) [所以 现在让我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1750) [在着色器中使用可编程混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1753) [是多么的容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1754) [好的 这里是你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1756) [光通道的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1760) [片段着色器在可编程混合中的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1761) [当你读取和写入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1764) [你的附件时 可编程混合将被启用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1765) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1767) [我们看到 G 缓冲附件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1769) [既是我们函数的输入 又是函数的输出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1770) [我们首先使用我们的 G 缓冲的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1772) [来计算我们的照明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1776) [正如你在这里看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1778) [我们正在读取我们的附件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1779) [但我们并没有将它们作为纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1781) [进行采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1781) [然后 我们将我们的照明的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1782) [累积结果返回 G 缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1785) [在这一步中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1787) [我们都在读取和写入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1788) [我们的累积结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1789) [这就是最后了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1790) [可编程混合真的非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1792) [只要你有多个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1793) [读取和写入相同附件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1795) [的渲染过程 你就应该在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1796) [那里应用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1798) [所以现在我们来讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1800) [一下图像块（Imageblocks）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1802) [它允许你在更多的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1804) [合并渲染通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1805) [图像块（Imageblocks）可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1812) [让你在 Tile 的内存中完全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1813) [控制你的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1814) [图像块允许你以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1815) [结构体的形式直接用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1817) [着色语言声明像素布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1818) [而不是将像素描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1821) [为 Metal 技术的 API 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1822) [渲染通道内容中的数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1824) [它将新的数据类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1828) [添加到与你已经使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1829) [匹配纹理格式的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1830) [着色语言当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1831) [并且在访问着色器时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1833) [这些类型被透明地打包和解压](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1835) [实际上 你还可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1837) [顶点缓冲区和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1839) [常量缓冲区中使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1840) [这些新的数据类型来更紧密地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1842) [打包所有数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1843) [图像块（Imageblocks）还允许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1846) [你描述更复杂的每个像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1847) [数据结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1849) [你可以使用数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1851) [嵌套结构或其组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1852) [它们都可以正常运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1855) [现在 直接控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1859) [现在 直接控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1859) [像素布局意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1861) [你现在可以在通道内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1862) [更改布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1863) [这使你可以将渲染过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1864) [组合起来 从而消除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1866) [系统内存带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1867) [而这种方式仅凭](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1868) [可编程混合是无法实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1869) [让我们来看一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1871) [在我们之前的例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1875) [我们使用可编程混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1876) [来实现单通延迟着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1878) [你也可以使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1880) [图像块实现单通道延迟着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1881) [图像块只存在于 Tile 内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1885) [所以没有渲染通道附件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1886) [需要处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1887) [这不仅是一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1889) [更加自然的表达算法的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1891) [而且现在你也可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1892) [完成照明后读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1894) [G 缓冲 然后再重新使用 Tile 的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1895) [让我们继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1898) [让我们重复使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1899) [Tile 的内存来添加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1901) [一个称为多层 Alpha 混合的顺序无关的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1903) [透明度技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1904) [多层 Alpha 混合（MLAB）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1911) [可维护每个像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1912) [固定大小的半透明片段数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1915) [每个传入的片段按](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1918) [每个传入的片段按](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1918) [深度排序加到数组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1920) [如果一个片段的深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1922) [超出了数组的最后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1923) [一个元素 那么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1924) [这些元素就会被合并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1926) [所以它实际上是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1927) [一个近似的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1929) [现在 对 MLAB 数组进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1931) [排序速度非常快 因为它存在于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1932) [Tile 的内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1934) [由于额外的带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1935) [和同步开销 在芯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1936) [上做同样的操作会变得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1938) [非常昂贵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1939) [A11 实际上是对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1940) [上一代支持的最大像素尺寸](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1945) [进行了加倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1946) [但这还不足以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1948) [同时包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1950) [G 缓冲和 MLAB 数据结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1951) [幸运的是 你不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1955) [同时使用两者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1957) [图像块（Imageblocks）允许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1958) [你在渲染过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1960) [更改像素布局以符合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1961) [你的当前需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1963) [改变像素布局实际上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1964) [需要 Tile 的着色 所以我们接下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1967) [来讨论一下这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1968) [Tile 着色是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1976) [新的可编程阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1978) [它直接在渲染过程中提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1979) [它直接在渲染过程中提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1979) [计算能力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1981) [这个阶段将会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1982) [每个 Tile 上执行一个可配置的线程组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1984) [举个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1986) [你可以为每个 Tile 启动一个线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1987) [或者也可以为每个像素启动一个线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1989) [Tile 的着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1994) [可以让你交叉使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1995) [对相同数据进行操作的绘制调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1996) [和线程组调度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1997) [Tile 的着色器可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=1999) [以访问所有 Tile 内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2001) [因此它们可以读写图像块的任何像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2003) [那么让我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2006) [Tile 着色如何优化切片正向着色等技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2007) [像延迟着色一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2014) [切片正向着色是一种多层技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2016) [我们通常会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2018) [MSA 非常重要时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2019) [或需要各种材料时使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2021) [并且它对不透明和半透明几何图形](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2023) [同样适用切片正向着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2024) [一般由 3 次传递组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2028) [首先 一个渲染通道生成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2031) [一个场景深度缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2033) [其次 计算通道将会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2035) [生成并计算使用该场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2036) [深度缓冲区的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2038) [深度缓冲区的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2038) [每个 Tile 深度边界和光源列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2040) [最后 另一个渲染通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2043) [将使用相应的光源列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2044) [为每个 Tile 中的像素着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2045) [现在 这种混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2048) [渲染和计算的模式是很常见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2053) [在 A11 之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2054) [这些通道之间的交流需要系统内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2057) [但是使用 Tile 着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2059) [我们可以将计算内联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2061) [所以渲染通道就可以合并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2062) [在这里 深度边界和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2066) [光线剔除步骤被](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2068) [作为 Tile 着色器实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2069) [并内嵌到单个渲染通道中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2071) [深度现在只](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2073) [存储在图像块中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2074) [但却可以在整个过程中被访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2076) [所以现在 Tile 的着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2082) [将帮助你消除大量带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2084) [但这些 Tile 的着色器的输出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2085) [仍然存储在系统内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2087) [Tile 的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2090) [调度与绘制同步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2091) [所以这是完全安全的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2093) [但我认为我们仍然可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2094) [使用我们的下一个功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2095) [持久线程组内存 来使我们做得更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2097) [好的 线程组内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2105) [是 Metal 技术计算的一个众所周知的特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2106) [它使线程组内的线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2108) [可以使用快速的 用于传输的内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2109) [来共享数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2111) [现在 由于 Tile 着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2113) [线程组内存也可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2114) [渲染通道中使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2116) [但渲染通道中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2118) [线程组内存含有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2119) [2 个传统上不可用于计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2120) [的新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2121) [首先 片段着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2123) [现在也可以访问相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2125) [线程组内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2126) [其次 线程组内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2128) [的内容在整个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2129) [Tile 的整个生命周期中都存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2130) [总而言之 这是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2133) [一个强大的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2135) [可以让数据在绘制和调度之间共享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2137) [实际上 我们相信](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2140) [这会非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2141) [因为我们实际上已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2142) [使线程组内存的最大容量翻倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2143) [比起上一代来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2144) [你可以将更多的中间数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2146) [存储在传输过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2147) [好的 现在让我们使用持久线程组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2150) [来进一步优化我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2152) [切片正向着色示例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2154) [因此 有了持久线程组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2155) [因此 有了持久线程组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2155) [Tile 的着色阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2160) [可以将深度边界和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2162) [剔除光线列表写入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2163) [线程组内存中供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2165) [以后使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2166) [这意味着现在我们所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2168) [中间数据都会保留在传输过程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2169) [并且永远不会离开 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2171) [只有最终的图像存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2173) [在系统内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2174) [尽量减少系统内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2176) [的带宽对于游戏的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2177) [性能和游戏时间来说是非常重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2179) [现在 我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2181) [在着色语言中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2184) [使用持久线程组有多容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2185) [好的 所以这里的顶层函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2191) [是我们的 Tile 着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2193) [它将执行我们的光线剔除过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2194) [它将光线与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2195) [Tile 视锥相交以计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2197) [主动的光掩码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2199) [底层函数是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2201) [我们的片段着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2203) [它执行我们的正向着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2204) [它只使用该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2205) [主动光掩码遮住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2206) [与 Tile 相交的灯光](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2208) [现在 在这两个着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2211) [通过使用相同类型和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2213) [绑定点实现跨函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2214) [的共享线程组内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2216) [这就是使用持久线程组有多容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2220) [好吧 现在你已经看到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2225) [Tile 着色和持久线程组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2227) [让我们再次回到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2228) [我们的顺序无关的透明度示例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2230) [好的 你们还记得我说的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2234) [改变图像块布局需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2235) [Tile 着色的吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2237) [这是因为 Tile 着色提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2238) [我们需要的同步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2240) [而这会安全地更改布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2242) [这意味着我们实际上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2244) [必须在照明和 MLAB 步骤之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2246) [插入 Tile 着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2247) [因此在从 G 缓冲转换到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2253) [MLAB 之前 Tile 着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2254) [必须等待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2255) [光照步骤完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2256) [并且它还将把](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2258) [光照步骤累积的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2260) [光照值转移到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2261) [MLAB 步骤中进行最终混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2262) [好吧 现在我们已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2269) [介绍了图像块 图块着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2270) [和持久线程组 现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2272) [是时候继续讨论我们的最终](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2273) [主题 多重采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2274) [抗锯齿和示例覆盖控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2276) [多重采样抗锯齿功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2283) [可通过超取样深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2284) [模板和混合来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2286) [提高图像质量 但每个像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2288) [只能着色一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2290) [多个样本稍后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2291) [将会被简单平均法解析为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2293) [最终图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2294) [现在 多重采样在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2298) [所有 A 系列 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2299) [都是高效的 因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2301) [样本存储在 Tile 内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2303) [从而其中混合和解析可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2304) [快速地访问样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2305) [A11 GPU 通过追踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2309) [每个像素内的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2311) [独特颜色进一步优化了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2313) [多重采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2314) [以前在每个样本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2316) [进行的混合操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2317) [现在仅对每种颜色进行操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2318) [这可能是一个显著的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2321) [优化节约](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2322) [因为每个三角形的内部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2324) [只包含 1 种独特的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2325) [现在 独特颜色与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2329) [样本的映射被称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2330) [颜色覆盖控制 并且](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2333) [这由 GPU 管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2334) [但是 Tile 着色器也可以读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2336) [和修改这种颜色覆盖](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2337) [我们可以使用它来执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2340) [自定义解析和快速的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2342) [Tile 内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2344) [现在 让我们来看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2346) [为什么这是有用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2347) [让我们来看一下渲染粒子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2348) [的多重采样场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2350) [粒子是透明的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2354) [所以我们将在渲染我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2355) [不透明场景几何体之后将它们混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2357) [但是粒子渲染不能从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2359) [多重采样中受益](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2360) [因为它实际上没有任何可见的边缘](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2361) [因此 为了避免](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2364) [无理由地混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2366) [每个样本的额外成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2367) [游戏将使用 2 次传递进行渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2369) [在第一遍中 你的不透明的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2370) [场景几何体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2372) [将使用多重采样来渲染以减少混叠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2373) [然后 你将解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2376) [关于系统内存的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2377) [和深度 并且处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2378) [深度 因为之后它在之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2380) [可以包含粒子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2381) [然后在第二遍中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2383) [使用解析颜色和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2385) [深度来渲染没有多次采样的粒子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2387) [现在 正如你现在可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2391) [猜到的那样 我们的目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2392) [是使用 Tile 着色来消除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2394) [中间传输的系统内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2395) [以便合并这两个传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2396) [但仅仅 Tile 着色是不够的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2401) [我们需要色彩覆盖控制来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2402) [改变多重采样率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2404) [颜色覆盖控制功能非常强大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2407) [并且使用非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2408) [让我们来看一下着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2411) [好的 请记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2416) [我们的目标是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2417) [平均每个像素的样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2419) [然后将该结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2420) [存储回图像块中作为整体像素值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2422) [现在 我们不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2425) [循环每个颜色 循环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2427) [每个样本 而是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2429) [使用 A11 的色差率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2430) [功能 只循环独特的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2432) [为了在所有样本中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2436) [正确地平均](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2438) [我们需要根据与其相关的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2440) [样本数对每种颜色进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2441) [加权 我们通过计算颜色掩码中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2443) [设置的位来实现这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2446) [然后 我们通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2449) [除以总采样数来完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2450) [平均 最后将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2451) [结果写回到图像块中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2454) [输出样本掩码告诉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2457) [Metal 技术将结果应用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2458) [Metal 技术将结果应用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2458) [像素的所有样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2460) [而且 由于所有样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2461) [现在都具有相同的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2463) [因此后面的粒子绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2465) [将按每个像素而不是每个样本进行混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2466) [这就是样本覆盖控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2471) [现在 针对 Apple GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2475) [进行的优化对于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2478) [最大限度地提高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2479) [游戏性能并延长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2480) [游戏时间非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2481) [但是在 iOS 平台上使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2483) [Tile 你需要做更多的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2485) [特别是那些最初为电脑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2487) [和主机设计的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2487) [现在我们将谈论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2489) [这个问题 并将我们刚刚讨论过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2491) [内容付诸实践 我想邀请](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2492) [Epic Games 的 Nick Penwarden 上台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2494) [Nick [ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2496) [&gt;&gt; 谢谢 Michael](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2501) [嗯 我想谈一谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2502) [一些关于我们如何把](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2504) [最初用于电脑和主机平台的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2506) [使用 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2507) [将其引入 iOS 平台的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2510) [我们面临的一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2513) [技术上的挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2516) [堡垒之夜的地图是 1 张地图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2517) [堡垒之夜的地图是 1 张地图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2517) [它大于 6 平方公里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2520) [这意味着它不适合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2522) [全部储存在内存中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2524) [我们也有动态的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2526) [流动和破坏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2527) [玩家可以摧毁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2529) [场景中的任何物体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2530) [玩家也可以建立自己的建筑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2532) [所以地图非常动态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2534) [这意味着我们不能做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2535) [很多预计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2536) [我们在地图上有 100 个玩家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2538) [地图上有超过 50,000](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2541) [个复制角色 这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2544) [复制角色在服务器上模拟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2545) [并复制到客户端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2547) [最后 我们希望支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2549) [主机和电脑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2551) [以及移动设备之间的联机游玩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2553) [这实际上是非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2556) [的一点 因为它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2557) [限制了我们用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2558) [缩减游戏的体量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2559) [的方法来适应​​设备的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2562) [性能限制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2565) [基本上 如果有什么东西影响了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2567) [游戏玩法 我们不能改变它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2568) [所以如果有一个对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2570) [它真的很小 它真的很遥远](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2572) [也许通常情况下你会剔除它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2573) [但在以下这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2575) [我们不能 因为如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2577) [玩家可以躲在它后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2578) [玩家可以躲在它后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2578) [我们就需要渲染它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2580) [所以现在我们来谈一谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2582) [Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2584) [Metal 技术在让我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2585) [能够快速地运行游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2587) [以及让我们能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2589) [实现的游戏品质方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2592) [非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2593) [绘制调用的表现是关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2594) [因为我们有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2595) [一个非常复杂的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2597) [我们需要渲染来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2600) [呈现它 而 Metal 技术给了我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2602) [这样的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2603) [Metal 技术还让我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2604) [能够访问许多硬件功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2606) [例如可编程混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2607) [这些硬件特性使我们重新获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2608) [重要的 GPU 性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2610) [它还具有一套功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2612) [这套功能包含了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2613) [可以让我们将堡垒之夜带到 iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2614) [所需的所有渲染技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2616) [就渲染而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2618) [我们使用可移动的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2620) [定向光来照明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2622) [级联阴影贴图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2623) [我们有一个可移动的天窗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2624) [因为天空整天都在变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2625) [我们使用基于物理的材质](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2627) [我们在 HDR 中进行渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2631) [并在最后进行色调映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2632) [我们允许在 GPU 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2635) [进行粒子模拟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2637) [我们也支持我们所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2638) [开发者自制的材质](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2639) [开发者自制的材质](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2639) [这实际上是非常重要的一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2641) [因为我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2643) [一些材质实际上非常复杂](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2645) [例如 我们用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2648) [高效渲染树木的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2650) [完全是由开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2652) [在 Epic 中使用蓝图和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2653) [材质着色器图形创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2656) [接着我们刚刚说的话题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2662) [这里是堡垒之夜](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2664) [以高可扩展性在 Mac 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2665) [运行的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2667) [这在中等可扩展性下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2670) [运行在 Mac 上的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2671) [这里是在 iPhone 8 Plus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2674) [上运行的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2676) [所以我们能够在 iPhone 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2677) [以我们在中端 Mac 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2678) [呈现的品质完全地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2681) [表现游戏的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2682) [所以我们来谈一谈可扩展性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2684) [我们处理跨平台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2689) [和 iOS 系统的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2690) [可扩展性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2692) [因此 跨平台时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2694) [我们需要在平台上安装这一些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2695) [比如从网格中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2697) [移除永远不会显示的 LOD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2699) [移除永远不会显示的 LOD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2699) [因此我们可以把它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2701) [放入内存或更改我们在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2703) [特定级别上动画的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2706) [角色数量 以降低 CPU 成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2708) [在 iOS 平台内部 我们还定义了 3 个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2712) [可扩展性 - 低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2714) [中 高 - 这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2717) [通常与不同代](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2719) [iPhone 相关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2720) [所以 iPhone 6 使用低端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2721) [iPhone 7 使用中档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2724) [iPhone 8 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2726) [iPhone X 使用高端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2727) [分辨率显然是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2731) [我们拥有的最简单和最佳的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2734) [可扩展性选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2736) [我们最终调整了每个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2737) [我们倾向于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2739) [在可能的情况下 使用后备缓冲分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2741) [这是用户界面呈现的内容所决定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2742) [因为如果我们这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2744) [那么我们不必支付单独的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2745) [上采样成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2747) [但是 我们确实支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2749) [以较低的分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2750) [渲染 3D 分辨率 在某些情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2752) [我们需要一个清晰的用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2754) [但不得不降低 3D 渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2756) [分辨率来适配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2758) [分辨率来适配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2758) [我们的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2760) [以 iPhone 6s 为例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2761) [阴影是可扩展性的另一个轴](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2766) [并且它非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2767) [因为它们同时影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2769) [CPU 和 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2770) [在低端设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2773) [我们不呈现任何阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2775) [在我们的中档设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2776) [我们有 1 个级联 1024 乘 1024 大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2777) [我们将距离设置为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2781) [与近似于建筑物的大小的数值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2782) [因此如果你位于建筑物内部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2784) [则不会看到另一侧的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2785) [光线泄漏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2786) [高端设备增加了第二个级联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2788) [这样可以提供更清晰的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2789) [人物阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2791) [并让我们可以进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2792) [推出阴影距离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2794) [植物是可扩展性的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2797) [另一个轴](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2798) [在低端设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2799) [我们根本不渲染植物](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2801) [在中等设备内 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2802) [呈现了我们在主机上支持的大约](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2803) [30％ 的密度的植物阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2805) [在高端设备上 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2806) [实际上可以实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2807) [我们在主机上支持的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2809) [100％ 的密度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2810) [内存在可扩展性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2813) [方面很有意思](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2815) [因为它并不总是与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2817) [性能相关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2818) [例如 iPhone 8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2819) [例如 iPhone 8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2819) [比 iPhone 7 Plus 快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2820) [但它的物理内存更少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2822) [这意味着当你考虑到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2824) [可扩展性时 你需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2825) [以不同的方式处理内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2826) [我们最终将它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2827) [视为可伸缩性的正交轴](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2829) [并且只有 2 个分类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2832) [分别是低内存和高内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2834) [对于低存储设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2836) [我们禁用了植物和阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2837) [我们还减少了一些内存池](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2839) [因此 例如 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2841) [将 GPU 颗粒限制在总计 16,000 个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2843) [并减少了美化和纹理记忆池](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2845) [的使用量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2847) [但我们仍然需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2849) [进行相当多的内存优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2852) [才能让游戏在该设备上运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2854) [最重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2856) [级别流 基本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2857) [只是确保如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2858) [对象不在玩家身边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2860) [就不占任何内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2861) [在大多数情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2862) [我们还使用 ASTC 纹理压缩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2864) [并倾向于在大小而不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2866) [质量上进行压缩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2868) [而且我们还为我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2870) [开发者提供了很多工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2872) [可以用来制作不同的 LOD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2874) [它们有些不是必须的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2877) [或者有些可以减少每个平台的音频变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2879) [或者有些可以减少每个平台的音频变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2879) [接下来我想谈一下帧速率目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2884) [所以在 iOS 上 我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2887) [可以达到最高的视觉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2888) [保真度 30 fps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2890) [但是 你不能仅仅将设备的性能达到最大化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2892) [如果我们在整个时间内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2894) [最大限度地利用 CPU 和 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2895) [操作系统最终会降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2897) [我们的速度 那么我们就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2899) [不会再达到目标帧速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2901) [我们同时也想要延长电池寿命](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2902) [如果玩家在通勤过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2905) [中连续玩几场比赛 我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2906) [在他们开始玩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2907) [之前帮助他们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2910) [而不是使他们的设备死机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2911) [所以为此 我们决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2913) [做的是针对环境时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2916) [达到每秒 60 帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2918) [但是在垂直同步（VSync）时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2919) [达到 30 帧 这意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2921) [大多数时候当你在堡垒之夜探索地图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2923) [手机将闲置约 50％ 时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2925) [我们利用这段时间来延长电池寿命](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2927) [并保持设备凉爽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2928) [为了确保我们能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2932) [达到这些目标 我们每天跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2933) [帧速率的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2936) [我们每天都有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2937) [一个自动化的通道用来做这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2938) [一个自动化的通道用来做这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2938) [我们看一看地图中的关键位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2940) [并捕捉性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2944) [例如 斜塔小镇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2946) [和矿井以及](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2948) [你在堡垒之夜中所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2949) [熟悉的常见兴趣点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2951) [当超过预算时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2953) [我们需要深入了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2955) [了解性能进展情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2956) [并对它进行优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2957) [我们每天都会有一个 100 人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2958) [的玩家测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2960) [用来捕捉你只能在游戏中看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2962) [帧速率动态表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2963) [我们跟踪比赛时的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2965) [帧速率的关键表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2966) [然后我们可以看一看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2969) [看看它是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2970) [如何寻找连结](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2972) [类似于这样的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2974) [如果出现问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2975) [我们可以从设备中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2977) [取出设备配置文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2979) [查看时间到底去了哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2981) [找出我们需要优化的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2982) [我们也支持重播](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2985) [这是虚幻引擎的一个功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2986) [它允许我们从玩家的角度去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2988) [重放比赛](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2990) [所以我们可以反复播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2991) [分析它 解剖它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2993) [甚至看看优化会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2995) [如何影响客户在游戏中的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2997) [如何影响客户在游戏中的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=2997) [接下来我们专门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3001) [讨论一下 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3003) [我们在大多数设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3005) [都有 2 个核心 是的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3009) [所以我们使用的方式是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3011) [我们有一个传统的游戏主线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3014) [和渲染线程的拆分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3014) [在游戏主线上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3016) [我们正在进行联网 模拟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3017) [动画 物理等等工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3019) [渲染线程执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3021) [所有场景遍历剔除并](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3022) [发布所有 Metal API 调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3025) [我们也有一个异步线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3026) [大多数情况下 它处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3029) [流式传输任务 纹理流式传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3031) [以及级别流式传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3032) [在拥有 2 个快速内核](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3036) [和 4 个高效内核的新设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3037) [我们增加了 3 个任务线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3039) [并启用了虚幻引擎中的一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3041) [并行算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3042) [所以我们采取动画在多帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3044) [CPU 粒子 物理等条件下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3048) [进行模拟 场景剔除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3051) [以及其他一些任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3053) [我之前提到过绘图调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3057) [绘图调用是我们的主要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3059) [绘图调用是我们的主要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3059) [表现瓶颈 而这实际上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3060) [是 Metal 技术真正帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3062) [到我们的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3063) [我们发现使用 Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3065) [比使用 OpenGL 速度要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3067) [快 3 到 4 倍 这使我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3068) [能够在没有进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3070) [大量关于减少绘图调用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3072) [积极工作的情况下进行交流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3074) [我们做了一些工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3076) [来减少绘图调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3077) [主要是在装饰物体上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3079) [剔除距离 并利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3080) [细节系统的层次结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3083) [这里是一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3087) [这是我们一直追踪的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3089) [感兴趣的地点之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3090) [如果你对游戏非常熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3092) [那么这从悬崖上俯视斜塔小镇](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3093) [的视角 也是我们在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3094) [地图上的频繁使用绘图调用的地点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3098) [正如你所看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3101) [它大约需要 1300 次绘制调来渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3102) [这只是主要的传递](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3105) [它不包括阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3106) [用户界面 其他任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3108) [消耗绘图调用时间的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3110) [但在这里使用 Metal 技术 真的可以变得很快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3111) [在 iPhone 8 Plus 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3112) [我们能够在 5 毫秒的时间内完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3113) [我提到了分级 LOD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3118) [这是虚幻引擎中的一项功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3119) [这是虚幻引擎中的一项功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3119) [我们可以进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3121) [多次绘图调用并生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3123) [一个简化版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3124) [简化网格以及材质](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3126) [以便我们可以在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3128) [单个绘图调用中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3129) [渲染该区域的基本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3130) [表示形式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3134) [我们使用它来获取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3135) [我们感兴趣的地点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3138) [生成用于渲染当距离非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3139) [非常遥远的简化版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3140) [例如 在跳伞期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3142) [你可以看到整个地图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3142) [事实上 当你在地图上时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3145) [你可以爬上悬崖](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3146) [或者建造一座非常高的属于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3148) [自己的塔楼 你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3149) [距离自己 2 公里远的风景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3152) [接下来我将深入探讨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3155) [Metal 的其他细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3158) [我想谈一谈一些关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3160) [管线状态对象的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3161) [这是花一点时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3162) [才能进入堡垒之夜的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3163) [内部运输状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3164) [你非常想最小化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3166) [你在框架中模拟游戏时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3168) [创建的管线状态对象数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3170) [如果你创造的太多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3172) [就很容易造成故障](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3173) [并造成糟糕的游戏体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3175) [首先 请遵循最佳](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3177) [实践准则 对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3178) [离线编译你的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3179) [离线编译你的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3179) [离线构建你的函数库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3181) [并将所有函数提取到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3183) [单个函数库中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3184) [但是你实在是想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3185) [确保在加载时创建所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3187) [管线状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3188) [但是如果你不能这样做 你会怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3189) [所以对于我们来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3191) [置换矩阵只是一个疯狂的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3192) [对于我们来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3194) [在加载时 实际创建的方式太多了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3195) [我们有多个开发者创作的着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3198) [数千个着色器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3200) [基于阴影级联数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3202) [的多个照明场景等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3204) [不同渲染目标格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3206) [MSAA](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3208) [名单有很长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3210) [我们尽可能减少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3212) [排列组合的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3213) [这确实有帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3215) [有时候动态分支比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3215) [创建静态排列表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3217) [更好 但有时候就不行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3218) [我们必须要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3222) [决定可能需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3224) [最常见的子集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3225) [并且在载入时创建这些子集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3227) [我们不试图创造一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3229) [我们实现这一目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3231) [的方式是创建了一个自动化的管线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3232) [我们基本上是在环境中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3234) [安装了一台摄像机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3235) [并记录了所有的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3236) [需要实际渲染环境的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3238) [管线状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3239) [然后 在我们的日常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3240) [测试中 我们获得了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3241) [所有未被该自动化管线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3243) [所捕获的管线状态对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3246) [自动化管线也](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3247) [可以捕获像美化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3249) [和发射不同武器的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3252) [等等对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3254) [我们把从自动化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3256) [和游戏测试中获取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3258) [所有这些信息组合成一个列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3259) [这是我们在加载时创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3260) [也是我们随游戏一起运行的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3262) [这并不完美 但我们发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3264) [我们在运行时创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3266) [管线状态对象数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3267) [平均为任何游戏部分创建的个位数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3268) [所以玩家不会遇到任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3271) [生成管线状态对象的麻烦](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3272) [资源分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3277) [所以基本上 创建和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3279) [删除资源是昂贵的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3283) [或可能是昂贵的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3286) [这有点像 想一想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3287) [[ 音质不清晰 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3290) [你非常想尽可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3290) [减少你每帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3291) [制作的 [ 音质不清晰 ] 数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3292) [你非常不想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3293) [动态创建和销毁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3294) [大量资源 但是当你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3295) [动态地在内容中进行流式传输时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3297) [当你有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3298) [当你有很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3298) [可移动的对象时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3300) [有些操作是无法避免的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3302) [所以我们对缓冲区所做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3305) [只是使用缓冲区子分配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3309) [基本上是一种不直接分配的策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3311) [首先 我们分配一个大缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3313) [然后我们将大缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3314) [分成小块并重新分配回引擎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3316) [以回避始终向 Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3319) [请求新的缓冲区的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3320) [而这最终起到了很大的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3323) [我们还利用可编程混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3325) [来减少解析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3327) [和恢复次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3330) [以及我们使用的内存带宽量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3331) [具体来说 我们对此的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3334) [主要使用场景是任何我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3336) [需要访问场景深度的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3338) [例如软粒子混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3340) [或投影贴图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3341) [我们所做的是在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3343) [正向传递期间将线性深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3345) [写入 Alpha 通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3346) [然后 在我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3347) [的贴图和半透明化的过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3349) [我们需要做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3350) [使用可编程混合来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3352) [读取该 Alpha 通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3353) [并且可以使用深度信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3355) [而不必将深度缓冲区解析到主内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3357) [而不必将深度缓冲区解析到主内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3357) [我们也使用它来提高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3361) [MSAA 的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3363) [正如我所提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3364) [我们进行 HDR 渲染 但是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3366) [仅仅是 HDR 的 MSAA 解析仍然会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3368) [导致非常参差的边缘](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3370) [想想你有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3372) [非常非常明亮的天空和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3373) [非常非常黑暗的前视图的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3375) [这时只需要做一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3377) [盒式过滤器就可以了 基本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3379) [是说如果其中一个子样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3382) [非常明亮 其他样本非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3384) [黑暗 那么结果将是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3385) [一个令人难以置信的明亮像素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3387) [当色调映射时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3389) [它会接近白色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3390) [你最终会看到边缘看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3391) [完全没有反锯齿的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3392) [因此 我们的解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3393) [是对所有 MSAA 样本执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3396) [预先的色调映射 然后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3398) [执行正常的 MSAA 分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3401) [然后第一个后处理通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3403) [只是反转之前的预映射图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3404) [我们使用可编程混合进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3407) [预色调贴图过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3409) [否则 我们必须将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3410) [整个 MSAA 颜色缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3411) [解析为内存并将其读回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3413) [这是我们负担不起的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3415) [接下来我将展望一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3418) [接下来我将展望一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3418) [未来我们希望在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3420) [Metal 中进行的一些工作并行渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3421) [所以在 macOS 上 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3424) [确实支持并行地创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3427) [命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3428) [在 iOS 上 我们需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3429) [支持并行命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3432) [的编码器才能使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3433) [我们的很多绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3435) [最终都会发生在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3436) [主要正向传递中 因此将其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3437) [并行化非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3440) [我认为 看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3442) [并行渲染对单片快速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3443) [内核的影响和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3445) [在高端设备高效内核上使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3448) [并行命令编码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3450) [的效果进行比较会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3453) [非常有趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3454) [这可能会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3455) [电池使用方面产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3456) [一些有趣的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3458) [Metal 堆](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3460) [所以我们希望用 Metal 堆](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3461) [来代替我们的缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3462) [子分配 首先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3464) [因为它只是简单的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3466) [其次 因为我们也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3467) [把它用于纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3469) [我们由于纹理流式传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3470) [仍然偶尔会遇到麻烦](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3471) [因为我们会在显式地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3472) [动态地创建和销毁纹理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3474) [就像把纹理不断的在内存里进行读写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3475) [使用堆可以摆脱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3478) [那些困境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3479) [那些困境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3479) [对我们来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3481) [我们面前的工作就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3485) [要在不同的通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3485) [之间设置精确的栅栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3488) [所以我们需要明确地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3490) [知道资源是否被顶点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3493) [或像素着色器在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3494) [不同的过程中读取或写入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3496) [并且这需要我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3498) [对一些渲染器进行一些修改才能实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3499) [当然 也要继续推动 iOS 上的图形学](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3502) [向高端的发展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3505) [去年在 WWDC 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3507) [我们展示了将我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3509) [桌面级正向渲染器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3511) [引入高端 iOS 设备的可能性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3512) [并且我们继续在做这件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3513) [我们希望继续在 iOS 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3515) [推动这一目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3517) [继续为 iOS 带来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3519) [桌面级功能并寻找机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3523) [将我们的桌面渲染器与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3527) [iOS 渲染器统一起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3529) [然后 我要把场地交回给 Michael](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3532) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3537) [&gt;&gt; Metal 技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3540) [的开销很低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3541) [但可以通过多线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3543) [高效地渲染许多对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3545) [Metal 技术是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3546) [为了充分利用我们系统中的所有 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3547) [和所有 CPU 而创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3549) [Metal 技术也是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3551) [真正可访问的 但高级渲染](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3553) [有时需要显式控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3554) [当你需要内存管理和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3556) [GPU 并行性时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3558) [Metal 技术提供了这种控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3559) [我们还引入了间接命令缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3562) [这是我们的全新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3563) [它可以让你将命令](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3565) [生成完全移至 GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3566) [释放 CPU 来执行其他任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3567) [与参数缓冲区一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3571) [这些功能为 GPU 驱动的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3572) [管线提供了完整的解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3573) [最后 Metal 允许你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3577) [利用 A11 GPU 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3579) [高级架构来优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3580) [渲染技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3582) [以实现最佳性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3583) [和更长的游戏时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3584) [想要了解更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3589) [请访问我们的网站 并确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3590) [访问我们明天的实验室 谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3592) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/607/?time=3596)