WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:21:58.346 --> 00:22:01.126 A:middle
我们现在对这个

00:22:01.126 --> 00:22:02.426 A:middle
Markdown 功能非常满意

00:22:02.586 --> 00:22:04.856 A:middle
那么如果我们尝试插入

00:22:04.856 --> 00:22:05.476 A:middle
代码片段呢

00:22:06.756 --> 00:22:07.996 A:middle
在 Markdown 中是这样的

00:22:09.256 --> 00:22:10.516 A:middle
如果我们添加最后一个反引号

00:22:10.636 --> 00:22:12.766 A:middle
我们希望它看起来像一个代码块

00:22:14.136 --> 00:22:15.156 A:middle
它应该有一个背景和

00:22:15.156 --> 00:22:16.346 A:middle
一个表示 Swift Code 的标头

00:22:17.716 --> 00:22:18.906 A:middle
这实际上是一项复杂的任务

00:22:18.906 --> 00:22:22.006 A:middle
所以我们需要两把大锤

00:22:23.386 --> 00:22:25.526 A:middle
第一个是 NSTextStorage 子类

00:22:26.556 --> 00:22:27.946 A:middle
当我们子类化 NSTextStorage 时

00:22:27.946 --> 00:22:30.706 A:middle
我们需要实现四个必要的方法

00:22:31.236 --> 00:22:32.806 A:middle
我们通过对一个可变字符串的

00:22:32.856 --> 00:22:34.946 A:middle
局部实例进行操作来做到这一点

00:22:34.946 --> 00:22:37.996 A:middle
我们需要注意

00:22:37.996 --> 00:22:39.056 A:middle
replaceCharacters() 方法

00:22:39.836 --> 00:22:42.066 A:middle
我们可以将 NSTextBlock 添加

00:22:42.066 --> 00:22:42.876 A:middle
到我们的段落样式中

00:22:43.406 --> 00:22:46.046 A:middle
然后我们将

00:22:46.046 --> 00:22:47.546 A:middle
该段落样式添加到

00:22:47.546 --> 00:22:49.116 A:middle
我们文本存储中

00:22:49.116 --> 00:22:49.496 A:middle
代码块的范围内

00:22:50.256 --> 00:22:51.746 A:middle
现在 NSTextBlock 本身

00:22:51.746 --> 00:22:53.906 A:middle
不会自己做任何自定义绘制

00:22:54.596 --> 00:22:56.766 A:middle
所以我们也需要对它

00:22:57.916 --> 00:22:57.996 A:middle
进行子类化

00:22:58.226 --> 00:23:00.846 A:middle
我们的 NSTextBlock 子类需要

