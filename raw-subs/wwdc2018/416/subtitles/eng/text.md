# iOS Memory Deep Dive

## Summary
Discover how memory graphs can be used to get a close up look at what is contributing to an app's memory footprint. Understand the true memory cost of an image. Learn some tips and tricks for reducing the memory footprint of an app.

## Info
* Developer Tools
* WWDC 2018 - Session 416 - iOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=23) [&gt;&gt; Hi, everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=28) [My name's Kyle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=29) [I'm a software engineer at Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=29) [and today we'd like to take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=30) [deep dive into iOS memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=32) [Now, just as a quick note, even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=34) [though this is focused on iOS, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=35) [lot of what we're covering will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=36) [apply to other platforms as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=38) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=42) [So the first thing we'd want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=43) [talk about is, why reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=44) [memory?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=46) [And when we want to reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=48) [memory, really, we're talking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=50) [about reducing our memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=51) [footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=52) [So we'll talk about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=53) [We have some tools for how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=55) [profile a memory footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=56) [We have some special notes on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=59) [We have some special notes on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=59) [images, optimizing when in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=60) [background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=62) [And then, we'll wrap it all up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=63) [with a nice demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=64) [So why reduce memory?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=66) [The easy answer is users have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=70) [better experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=72) [Not only will your app launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=73) [faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=74) [The system will perform better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=75) [Your app will stay in memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=76) [longer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=78) [Other apps will stay in memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=78) [longer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=79) [Pretty much everything's better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=80) [Now, if you look to your left](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=82) [and look to your right, you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=83) [actually helping those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=84) [developers out as well by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=85) [reducing your memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=86) [Now, we're talking about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=88) [reducing memory, but really,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=90) [it's the memory footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=91) [Not all memory is created equal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=92) [What do I mean by that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=94) [Well, we need to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=96) [pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=97) [Not that type of pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=98) [We're talking about pages of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=100) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=101) [Now, a memory page is given to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=102) [you by the system, and it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=104) [hold multiple objects on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=106) [heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=107) [And some objects can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=108) [span multiple pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=110) [They're typically 16K in size,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=112) [and they can come in clean or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=116) [dirty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=117) [The memory use of your app is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=120) [actually the number of pages](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=121) [multiplied by the page size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=123) [So as an example of clean and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=125) [dirty pages, let's say I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=129) [allocate an array of 20,000](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=130) [integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=133) [The system may give me six](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=134) [pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=136) [Now, these pages are clean when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=138) [I allocate them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=139) [However, when I start writing to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=141) [the data buffers, for example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=142) [if I write to the first place in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=143) [this array, that page has become](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=145) [dirty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=147) [Similarly, if I write to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=148) [last page, that, or the last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=150) [place in the buffer, the last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=153) [page becomes dirty as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=154) [Note that the four pages in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=156) [between are still clean because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=157) [the app has not written to them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=158) [yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=162) [Another interesting thing to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=162) [talk about is memory-mapped](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=163) [files.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=165) [Now, this is files that are on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=165) [disk but loaded in the memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=168) [Now, if you use read-only files,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=170) [these are always going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=171) [clean pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=172) [The kernel actually manages when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=173) [they come in and off of disk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=175) [into RAM.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=176) [So a good example of this would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=177) [So a good example of this would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=177) [be a JPEG.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=180) [If I have a JPEG that's, say, 50](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=181) [kilobytes of size, when it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=183) [memory mapped in, that actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=185) [is mapped into four pages of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=187) [memory, give or take.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=189) [Now, the fourth page is actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=190) [not completely full, so it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=192) [be used for other things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=193) [Memory's a little bit tricky](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=194) [like that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=196) [But those three pages before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=196) [will always be purgeable by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=198) [system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=201) [And when we talk about a typical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=202) [app, their footprint and profile](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=206) [has a dirty, a compressed, and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=208) [clean segment of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=210) [Let's break these down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=212) [So clean memory is data that can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=214) [be paged out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=217) [Now, these are the memory-mapped](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=218) [files we just talked about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=219) [Could be images, data Blobs,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=221) [training models.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=223) [They can also be frameworks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=224) [So every framework has a DATA](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=228) [CONST section.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=230) [Now, this is typically clean,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=232) [but if you do any runtime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=233) [shenanigans like swizzling, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=234) [can actually make it dirty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=235) [can actually make it dirty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=235) [Dirty memory is any memory that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=241) [has been written to by your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=243) [Now, these can be objects,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=245) [anything that has been malloced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=247) [-- strings, arrays, et cetera.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=249) [It can be decoded image buffers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=251) [which we'll talk about in a bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=254) [And it can also be frameworks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=255) [Frameworks have a data section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=259) [and a data dirty section as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=261) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=263) [Now, those are always going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=264) [count towards dirty memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=265) [And if you might have noticed, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=267) [brought up frameworks twice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=269) [Yes, frameworks that you link](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=270) [actually use memory and dirty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=272) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=274) [Now, this is just a necessary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=275) [part of linking frameworks, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=276) [if you maintain your own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=279) [framework, singletons and global](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=279) [initializers are a great way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=281) [reduce the amount of dirty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=283) [memory they use because a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=285) [singleton's always going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=286) [in memory after it's been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=288) [created, and these initializers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=289) [are also run whenever the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=291) [framework is linked or the class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=292) [is loaded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=293) [Now, compressed memory is pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=297) [cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=300) [iOS doesn't have a traditional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=300) [disk swap system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=301) [Instead, it uses a memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=303) [compressor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=305) [This was introduced in iOS 7.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=306) [Now, a memory compressor or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=308) [memory compressor will take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=310) [unaccessed pages and squeeze](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=312) [them down, which can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=313) [create more space.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=314) [But on access, the compressor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=316) [will then decompress them so the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=317) [memory can be read.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=319) [Let's look at an example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=320) [Say I have a dictionary that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=323) [using for caching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=324) [Now, it uses up three pages of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=325) [memory right now, but if I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=327) [haven't accessed this in a while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=329) [and it needs to, the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=331) [needs some space, it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=332) [actually squeeze it down into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=333) [one page.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=334) [Now, this is now compressed, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=335) [I'm actually saving space or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=338) [I've got two extra pages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=340) [So if, some point in the future,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=342) [I access it, it will grow back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=344) [So let's talk about memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=346) [warnings for a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=347) [The app is not always the cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=349) [of a memory warning.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=351) [So if you're on a low-memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=353) [device and you get a phone call,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=354) [that could trigger a memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=357) [warning, and you're out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=358) [So don't necessarily assume that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=359) [So don't necessarily assume that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=359) [a memory warning is your cause.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=360) [So this compressor complicates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=363) [freeing memory because,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=366) [depending on what it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=369) [compressed, you can actually use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=370) [more memory than before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=371) [So instead, we recommend policy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=372) [changes, such as maybe not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=374) [caching anything for a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=375) [bit or kind of throttling some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=377) [of the background work when a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=378) [memory warning occurs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=380) [Now, some of us may have this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=382) [our apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=384) [We get a memory warning, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=385) [decide to remove all objects](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=387) [from our cache.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=388) [Going back to that example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=391) [the compressed dictionary,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=392) [what's going to happen?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=394) [Well, since I'm now accessing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=395) [that dictionary, I'm now using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=397) [up more pages than I was before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=399) [This is not what we want to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=402) [in a memory-constrained](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=403) [environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=405) [And because I'm removing all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=406) [objects, I'm doing a lot of work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=407) [just to get it back down to one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=410) [page, which is what it was when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=411) [it was compressed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=412) [So we really got to be careful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=414) [about memory warnings in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=415) [general.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=417) [Now, this brings up an important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=419) [Now, this brings up an important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=419) [point about caching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=421) [When we cache, we are really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=423) [trying to save the CPU from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=424) [doing repeated work, but if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=425) [cache too much, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=427) [use up all of our memory, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=428) [that can have problems with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=430) [system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=432) [So try and remember that there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=433) [a memory compressor and cache,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=435) [you know, get that balance just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=436) [right on what to cache and what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=437) [to kind of recompute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=439) [One other note is that if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=441) [use an NSCache instead of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=442) [dictionary, that's a threat-safe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=443) [way to store cached objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=445) [And because of the way NSCache](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=448) [allocates its memory, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=450) [actually purgeable, so it works](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=451) [even better in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=452) [memory-constrained environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=453) [Going back to our typical app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=454) [with those three sections, when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=458) [we talk about the app's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=460) [footprint, we're really talking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=461) [about the dirty and compressed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=462) [segments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=464) [Clean memory doesn't really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=465) [count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=466) [Now, every app has a footprint](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=467) [limit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=471) [Now, this limit's fairly high](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=473) [for an app, but keep in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=474) [that, depending on the device,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=476) [your limit will change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=478) [So you won't be able to use as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=479) [So you won't be able to use as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=479) [much memory on a 1-gigabyte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=481) [device as you would on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=482) [4-gigabyte device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=483) [Now, there's also extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=485) [Extensions have a much lower](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=490) [footprint, so you really need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=491) [be even more mindful about that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=493) [when you are using an extension.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=495) [When you exceed the footprint,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=497) [you will get a exception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=499) [Now, these exceptions are the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=502) [EXC RESOURCE EXCEPTION.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=504) [So what I'd like to do now is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=507) [invite up James to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=510) [how we can profile our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=511) [footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=512) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=514) [Thanks, James.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=517) [&gt;&gt; Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=518) [Thanks, Kyle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=520) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=521) [I'm James.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=522) [I'm a software engineer here at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=522) [Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=523) [And I'd like to introduce some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=524) [of the more advanced tools we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=525) [have for profiling and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=526) [investigating your application's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=527) [footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=529) [You're all probably already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=531) [familiar with the Xcode memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=532) [gauge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=533) [It shows up right here in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=534) [debug navigator, and it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=535) [great way for quickly seeing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=537) [memory footprint of your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=539) [memory footprint of your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=539) [In Xcode 10, it now shows you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=540) [the value that the system grades](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=543) [you against, so don't be too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=544) [concerned if this looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=545) [different from Xcode 9.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=546) [So I was running my app in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=549) [Xcode, and I saw that it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=550) [consuming more memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=551) [What tool should I reach for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=553) [next?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=554) [Well, Instruments, obviously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=555) [This provides a number of ways](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=558) [to investigate your app's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=559) [footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=560) [You're probably already familiar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=561) [with Allocations and Leaks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=564) [Allocations profiles the heap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=565) [allocations made by your app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=567) [and Leaks will check for memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=568) [leaks in a process over time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=569) [But you might not be so familiar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=571) [with the VM Tracker and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=572) [Virtual Memory Trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=573) [If you remember back to when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=575) [Kyle was talking about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=577) [primary classes of memory in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=578) [iOS, he was, he talked about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=579) [dirty and compressed memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=581) [Well, the VM Tracker provides a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=582) [great way to profile this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=584) [It has separate tracks for dirty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=587) [and swapped, which, in iOS, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=588) [compressed memory, and tells you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=590) [some information about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=591) [resident size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=592) [I find this really useful for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=593) [investigating the dirty memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=595) [size of my app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=596) [Finally, in Instruments is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=598) [VM Memory Trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=599) [VM Memory Trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=599) [This provides a deep view into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=601) [the virtual memory system's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=603) [performance with regards to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=604) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=605) [I find the By Operation tab](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=608) [really useful here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=610) [It gives you a virtual memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=611) [system profile and will show you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=612) [things like page cache hits and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=614) [page zero fills for the VM.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=616) [Kyle mentioned earlier that if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=621) [you approach the memory limit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=622) [the device, you'll receive an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=623) [EXC resource exception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=625) [Well, if you're running your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=627) [now in Xcode 10, Xcode will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=628) [catch this exception and pause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=631) [your app for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=632) [This means you can start the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=633) [memory debugger and begin your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=634) [investigation right from there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=635) [I think this is really, really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=637) [useful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=638) [The memory debugger for Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=639) [was shipped in Xcode 8, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=642) [helps you track down object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=643) [dependencies, cycles, and leaks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=644) [And in Xcode 10, it's been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=646) [updated with this great new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=648) [layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=649) [It's so good for viewing really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=650) [large Memgraphs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=652) [Under the hood, Xcode uses the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=653) [Memgraph file format to store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=655) [information about the memory use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=657) [of your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=658) [What you may not have known is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=660) [that you can use Memgraphs with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=661) [a number of our command-line](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=663) [tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=664) [First, you need to export a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=666) [Memgraph from Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=667) [This is really simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=668) [You just click the Export](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=670) [Memgraph button in the File menu](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=672) [and save it out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=674) [Then, you can pass that Memgraph](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=675) [to the command-line tool instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=678) [of the target [inaudible] and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=679) [you're good to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=680) [So I was running my app in Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=682) [10, and I received a memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=683) [resource exception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=685) [This isn't cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=686) [I should probably take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=687) [Memgraph and investigate this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=687) [further.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=689) [But what do I do next?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=689) [Well, obviously to the terminal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=691) [The first tool I often reach for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=693) [is vmmap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=695) [It gives you a high-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=696) [breakdown of memory consumption](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=697) [in your app by printing the VM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=698) [regions that are allocated to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=700) [the process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=701) [The summary flag is a great way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=703) [to get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=705) [It prints details of the size in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=706) [memory of the region, the amount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=709) [of the region that's dirty, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=712) [the amount of memory that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=715) [swapped or compressed in iOS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=716) [And remember, it's this dirty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=718) [and swap that's really important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=719) [and swap that's really important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=719) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=720) [One important point of note is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=722) [the swap size gives you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=723) [precompressed size of your data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=725) [not what it compressed down to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=727) [If you really need to dig deeper](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=730) [and you want more information,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=731) [you can just run vmmap against](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=733) [the Memgraph , and you'll get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=734) [contents of all of the regions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=736) [So we'll start by printing you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=737) [the nonwritable region, so,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=739) [like, your program's text or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=740) [executable code, and then the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=742) [writable regions, so the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=744) [sections, for instance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=746) [This is where your process heap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=747) [will be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=749) [One really cool aside to all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=750) [this is that all these tools](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=751) [work really well with standard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=753) [command-line utilities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=754) [So for example, I was profiling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=756) [my app in VM Tracker the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=758) [day, and I saw the, an increase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=759) [in the amount of dirty memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=761) [So I took a Memgraph, and I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=763) [to find out, are any frameworks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=765) [or libraries I'm linking to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=768) [contributing to this dirty data?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=769) [So here I've run vmmap against](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=772) [the Memgraph I took.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=774) [And I've used the pages flag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=776) [This means that vmmap will print](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=778) [This means that vmmap will print](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=778) [out the number of pages instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=780) [of just raw bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=781) [I then piped that into grep,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=782) [where I'm searching for a dylib,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=786) [so I need dynamic library here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=788) [And then, finally, I pipe that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=791) [into a super simple awk script](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=792) [to sum up the dirty column and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=794) [then print it out as the number](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=795) [of dirty pages at the end.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=796) [I think this is super cool, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=799) [I use it all the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=800) [It allows you to compose really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=802) [powerful debugging workflows for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=803) [you and your teams.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=805) [Another command-line utility](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=806) [that macOS developers might be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=810) [familiar with already is leaks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=811) [It tracks objects in the heap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=813) [that aren't rooted anywhere at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=815) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=816) [So remember, if you see an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=817) [object in leaks, it's dirty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=818) [memory that you can never free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=819) [Let's look at a leak in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=821) [memory debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=824) [Here I've got 3 objects, all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=826) [holding strong references to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=828) [each other, creating a classic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=829) [retain cycle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=830) [So let's look at the same leak](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=831) [in the leaks tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=834) [This year, leaks has been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=836) [updated to not only show the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=837) [leaked objects, but also the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=839) [leaked objects, but also the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=839) [retain cycles that they belong](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=842) [to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=845) [And if malloc stack logging was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=845) [enabled on the process, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=847) [even give you a backtrace for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=848) [the root node.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=851) [One question I often ask myself](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=854) [is, where's all my memory going?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=855) [I've looked in vmmap, and I see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=858) [the heap is really large, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=859) [what do I do about it next?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=860) [Well, the heap tool provides all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=862) [sorts of information about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=864) [object allocations in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=865) [process heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=866) [It helps you track down really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=867) [large allocations or just lots](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=868) [of the same kind of object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=870) [So here I've got a Memgraph that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=874) [I took when Xcode caught a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=876) [memory resource exception, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=877) [want to investigate the heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=879) [So I've passed it to heap, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=880) [is giving me information about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=882) [the class name for each of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=883) [objects, the number of them, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=885) [some information about their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=889) [average size and the total size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=890) [for that class of object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=892) [So here I kind of see, like,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=894) [not, lots and lots of small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=896) [objects, but I don't think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=898) [that's the problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=898) [I, that, I don't think that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=899) [I, that, I don't think that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=899) [really the problem here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=901) [By default, heap will sort by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=905) [count.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=907) [But instead, what I want to see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=908) [is the largest objects, not the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=909) [most numerous, so passing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=911) [sortBySize flag to heap will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=912) [cause it to sort by size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=914) [Here I see a few of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=916) [enormous NSConcreteData objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=917) [I should probably attach this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=919) [output and the Memgraph to a bug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=921) [report, but that's not going far](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=922) [enough, really.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=924) [I should figure out where these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=925) [came from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=925) [First, I need to get the address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=927) [for one of these NSConcreteData](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=929) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=930) [The addresses flag in heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=931) [When you pass the addresses flag](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=933) [to heap with the name of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=934) [class, it'll give you an address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=935) [for each instance on the heap.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=936) [So now I have these addresses, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=939) [can find out where one of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=941) [came from.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=942) [This is where malloc stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=943) [logging comes in handy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=944) [When enabled, the system will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=946) [record a backtrace for each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=947) [allocation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=949) [These logs get captured up when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=950) [we record a Memgraph, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=952) [they're used to annotate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=953) [existing output for some of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=954) [tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=955) [You can enable it really easily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=957) [in the scheme editor in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=958) [diagnostics tab.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=959) [diagnostics tab.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=959) [I'd recommend using the live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=961) [allocations option if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=962) [going to use it with a Memgraph.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=963) [So my malloc's, my Memgraph was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=966) [captured in malloc stack](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=968) [logging.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=969) [Now, to find the backtrace for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=970) [the allocation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=972) [This is where malloc history](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=973) [comes in helpful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=974) [You just pass malloc history,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=975) [the Memgraph, and an address for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=977) [an instance in memory, and, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=978) [there was a backtrace captured](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=979) [for it, it'll give it to you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=980) [So here I've taken the address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=984) [for one of those really big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=985) [NSConcreteDatas.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=986) [I've passed it to malloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=987) [history, and I've got a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=988) [backtrace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=990) [And, interestingly, it looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=991) [like my NoirFilter's apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=992) [method here is creating that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=994) [huge NS data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=995) [I should probably attach this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=997) [and the Memgraph to a bug report](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=998) [and get someone else to look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1000) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1003) [These are just a few of the ways](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1003) [you can deeply investigate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1004) [behavior of your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1006) [So when faced with a memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1008) [problem, which tool do you pick?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1009) [Well, there are 3 ways to think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1012) [about this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1013) [Do you want to see object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1013) [creation?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1015) [Do you want to see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1015) [references an object or address](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1016) [in memory?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1018) [Or do you just want to see how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1019) [large an instance is?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1019) [large an instance is?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1019) [If malloc stack logging was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1022) [enabled when you record, when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1023) [you, when your process was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1025) [started, malloc history can help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1026) [you find the backtrace for that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1028) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1029) [If you just want to see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1030) [references an object in memory,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1031) [you can use leaks and a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1033) [options that it has in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1035) [[inaudible] page to help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1036) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1037) [And finally, if you just want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1037) [see how large a region or an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1040) [instance is, vmmap and heap are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1041) [the go-to tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1043) [As a jumping off point, I'd](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1044) [recommend just running vmmap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1046) [with the summary flag against a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1047) [Memgraph taken of your process](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1049) [and then follow the thread down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1050) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1053) [Now, I'd like to hand back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1054) [Kyle, who's going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1054) [what can be some of the largest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1056) [objects in iOS apps, and that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1057) [images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1059) [Kyle?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1060) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1062) [&gt;&gt; Thanks, James.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1066) [So images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1067) [The most important thing about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1070) [images to remember is that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1071) [memory use is related to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1074) [dimensions of the image, not its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1075) [file size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1077) [As an example, I have this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1079) [As an example, I have this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1079) [really beautiful picture that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1081) [want to use as a wallpaper for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1083) [an iPad app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1084) [It measures 2048 by 1536, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1086) [the file on disk is 590](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1090) [kilobytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1092) [But how much memory does it use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1093) [really?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1095) [10 megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1098) [10 megs, that's huge!](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1100) [And the reason why is because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1102) [multiplying the number of pixels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1103) [wide by high, 2048 by 1536, by 4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1105) [bytes per pixel gets you about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1108) [10 megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1110) [So why is it so much larger?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1111) [Well, we have to talk about how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1115) [images work on iOS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1116) [There's a load, a decode, and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1118) [render phase.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1119) [So the load phase takes this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1121) [590-kilobyte JPEG file, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1123) [compressed, loads it into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1125) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1128) [The decode converts that JPEG](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1129) [file into a format that the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1131) [can read.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1134) [Now, this needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1135) [uncompressed, which makes it 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1136) [megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1138) [Once it's been decoded, it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1139) [Once it's been decoded, it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1139) [be rendered at will.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1141) [For more information on images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1143) [and how to kind of optimize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1145) [them, I'd recommend checking out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1146) [the Images and Graphics Best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1148) [Practice session that was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1150) [earlier this week.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1151) [Now, 4 bytes per pixel we got by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1154) [the SRGB format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1156) [This is typically the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1158) [common format that images in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1159) [graphics are.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1161) [It's 8 bits per pixel, so you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1162) [have 1 byte for red, 1 byte for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1166) [green, and 1 byte for blue, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1168) [an alpha component.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1170) [However, we can go larger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1173) [iOS hardware can render wide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1176) [format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1178) [Now, wide format, to get that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1179) [expressive colors, requires 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1180) [bytes per pixel, so we double](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1182) [the size of our image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1184) [Cameras on the iPhone 7, 8, X,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1186) [and the, some of the iPad Pros](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1189) [are great for capturing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1191) [high-fidelity content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1193) [You can also use it for super](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1195) [accurate colors for, like,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1196) [sports logos and such.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1197) [But these are only really useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1200) [on the wide format displays, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1201) [we don't want to use this when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1202) [we don't need to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1203) [On the flip side, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1205) [actually go smaller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1206) [Now, there's a luminance and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1208) [alpha 8 format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1209) [This format stores a grayscale](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1210) [and an alpha value only.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1213) [This is typically used in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1214) [shaders, so like Metal apps and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1216) [stuff.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1218) [Not very common in our usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1219) [We can actually get even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1221) [smaller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1222) [We can go down to what we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1223) [the alpha 8 format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1224) [Now, alpha 8 just has 1 channel,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1226) [1 byte per pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1228) [Very small.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1229) [It's 75% smaller than SRGB.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1230) [Now, this is great for masks or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1233) [text that's monochrome because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1234) [we're using 75% less memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1236) [So if we look at the breakdown,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1239) [we can go from 1 byte per pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1242) [with alpha 8 all the way up to 8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1244) [bytes per pixel with wide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1245) [format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1246) [There's a huge range.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1247) [So what we really need to do is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1248) [know how to pick the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1250) [format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1251) [So how do we pick the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1252) [format?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1253) [The short answer is don't pick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1255) [the format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1257) [Let the format pick you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1258) [If you migrate away from using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1261) [the UIGraphics BeginImageContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1263) [WithOptions API, which has been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1264) [in iOS since it began, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1267) [instead switch to the UIGraphics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1269) [ImageRenderer format, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1270) [save a lot of memory because the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1272) [UIGraphics BeginImageContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1275) [WithOptions is always a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1277) [4-byte-per-pixel format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1279) [It's always SRGB.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1281) [So you don't get the wide format](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1283) [if you want it, and you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1284) [get the 1-byte-per-pixel A8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1285) [format if you need it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1287) [Instead, if you use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1288) [UIGraphics ImageRenderer API,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1289) [which came in iOS 10, as of iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1291) [12, it will automatically pick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1293) [the best graphics format for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1295) [you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1296) [Here's an example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1296) [Say I'm drawing a circle for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1299) [mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1300) [Now, using the old API with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1301) [highlighted code here is my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1303) [drawing code, I'm getting a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1305) [4-byte-per-pixel format just to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1306) [draw a black circle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1308) [If I instead switch to the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1311) [API, I'm using the exact same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1312) [drawing code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1314) [Just using the new API, I'm now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1315) [getting a 1-byte-per-pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1317) [image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1318) [This means that it's 75% less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1319) [This means that it's 75% less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1319) [memory use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1321) [That's a great savings and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1322) [same fidelity.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1324) [As an additional bonus, if I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1325) [want to use this mask over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1330) [again, I can change the tint](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1331) [color on an image view, and that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1333) [will just change it with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1336) [multiply, meaning that I don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1337) [have to allocate any more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1339) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1340) [So I can use this not just as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1341) [black circle, but as a blue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1343) [circle, red circle, green circle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1344) [with no additional memory cost.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1345) [It's really cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1347) [One other thing that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1352) [typically do with images is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1352) [downsample them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1354) [So when we want to make like a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1355) [thumbnail or something, we want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1356) [to scale it down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1358) [What we don't want to do is use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1359) [a UIImage for the downscaling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1361) [If we actually use UIImage to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1362) [draw, it's a little bit less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1364) [performant due to internal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1366) [coordinate space transforms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1367) [And, as we saw earlier, it would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1369) [decompress the entire image in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1370) [the memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1372) [Instead, there's this ImageIO](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1373) [framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1375) [ImageIO can actually downsample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1376) [the image, and it will use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1378) [the image, and it will use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1378) [streaming API such that you only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1380) [pay the dirty memory cost of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1381) [resulting image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1383) [So this will save you a memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1384) [spike.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1385) [As an example, here's some code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1386) [where I get a file on disk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1389) [This could also be a file I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1390) [downloaded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1391) [And I'm using the UIImage to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1392) [draw into a smaller rect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1396) [This is still going to have that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1398) [big spike.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1399) [Now, instead, if I switch to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1401) [ImageIO, I still have to load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1402) [the file from disk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1404) [I set up some parameters because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1405) [it's a lower-level API to say](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1407) [how big I want this image to be,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1409) [and then I just ask it to create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1411) [it with CGImageSource](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1413) [CreateThumbnail AtIndex.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1414) [Now, that CG image I can wrap in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1415) [a UIImage, and I'm good to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1417) [I've got a much smaller image,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1419) [and it's about 50% faster than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1420) [that previous code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1422) [Now, another thing we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1425) [talk about is how to optimize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1427) [when in the background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1428) [Say I have an image in an app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1429) [full screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1433) [It's beautiful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1434) [I'm loving it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1434) [But then, I need to go to my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1435) [Home screen to take care of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1437) [notification or go to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1438) [notification or go to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1438) [different app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1440) [That image is still in memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1441) [So as a good rule of thumb, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1444) [recommend unloading large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1446) [resources you cannot see.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1448) [There are 2 ways to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1450) [The first is the app life cycle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1453) [So if you background your app or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1455) [foreground it, the app life](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1456) [cycle events are great to, are a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1457) [great way to know.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1459) [Now, this applies to mostly the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1461) [on-screen views because those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1462) [don't conform to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1464) [UIViewController appearance life](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1465) [cycle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1466) [UIViewController methods are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1467) [great for, like, tab controllers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1468) [or navigation controllers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1471) [because you're going to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1472) [multiple view controllers, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1473) [only 1 of them is on screen at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1474) [once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1475) [So if you leverage like the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1476) [viewWillAppear and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1477) [viewDidDisappear code or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1478) [callbacks, you can keep your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1480) [memory footprint smaller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1481) [Now, as an example, if I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1484) [register for the notifications](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1486) [for the application entering the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1488) [background, I can unload my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1489) [large assets -- in this case,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1490) [images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1492) [When the app comes back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1493) [foreground, I get a notification](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1494) [for that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1496) [If I reload my images there, I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1497) [saving memory when in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1499) [saving memory when in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1499) [background, and I'm keeping the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1500) [same fidelity when the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1502) [comes back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1503) [It's completely transparent to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1504) [them, but more memory is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1505) [available to the system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1507) [Similarly, if I'm in a nav](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1510) [controller or a tab controller,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1512) [my view controllers can unload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1514) [their images when they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1515) [disappear.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1516) [And before they come back with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1517) [the viewWillAppear method, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1518) [reload them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1521) [So again, the user doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1522) [notice anything's different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1523) [Our apps are just using less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1524) [memory, which is great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1525) [And now, I'd like to invite up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1527) [Kris to kind of bring this all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1531) [together in a nice demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1532) [Kris?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1534) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1535) [&gt;&gt; Okay. I'm going to switch to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1540) [the demo machine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1541) [There we go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1543) [So I've been working on this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1544) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1545) [What it does is it starts with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1545) [these really high-resolution](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1547) [images from our solar system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1550) [that I got from NASA, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1552) [lets you apply different filters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1554) [to them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1555) [And here we can see a quick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1556) [example, applying a filter to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1557) [our Sun.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1559) [our Sun.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1559) [I'm really pleased with how it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1560) [going so far, so I sent it off](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1562) [to James to get his opinion on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1564) [it, and he sent me back an email](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1565) [with 2 attachments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1568) [One was a Memgraph file, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1569) [other one was this image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1572) [Now, James is a pretty reserved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1575) [and understated guy, so when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1577) [he's got 2 red exclamation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1579) [points and a scream emoji, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1581) [know he's pretty upset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1583) [So I went to James and I said,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1585) ["You know, I don't understand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1587) [what the big deal is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1588) [I clearly have at least half a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1589) [gigabyte before I'm even in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1591) [red, you know.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1593) [I have all this available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1594) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1595) [Shouldn't I be using it?"](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1595) [And James, who's a much better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1597) [developer than I am, pointed out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1599) [a few things that's, a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1601) [things that are wrong with my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1602) [logic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1603) [First of all, this gauge is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1604) [measuring a device with 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1607) [gigabytes of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1609) [Not all our devices have that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1610) [much memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1611) [If this code was running on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1612) [device with a, only 1 gigabyte](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1614) [of memory, there's a good chance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1615) [our app would already be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1617) [terminated by the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1618) [system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1619) [system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1619) [Second, the operating system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1620) [doesn't just, doesn't use just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1624) [how much memory your app is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1626) [using when designing when to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1628) [terminate your app, but also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1629) [what else is going on in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1631) [operating system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1632) [So just because we're not to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1633) [red yet doesn't mean we're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1635) [in danger of being terminated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1636) [And third, this represents a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1640) [terrible experience for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1642) [user.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1643) [In fact, if you look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1644) [usage comparison chart, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1645) [see other processes has zero](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1647) [kilobytes of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1649) [That's because they've all been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1651) [jettisoned by the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1652) [system to make room for our app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1653) [You should all take a good look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1656) [at me and give me the stink eye](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1658) [because now when the user has to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1660) [go watch your app, you have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1661) [load from scratch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1663) [So James makes some pretty good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1665) [points, so I think, in general,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1667) [we want to get this needle as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1668) [far to the left as possible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1669) [instead of as far to the right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1671) [So let's see what we can do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1674) [Let me go ahead and take a look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1676) [at the Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1677) [And I have a couple go-to tricks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1679) [And I have a couple go-to tricks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1679) [that I use when working with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1684) [Memgraph file or go-to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1686) [strategies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1688) [And the first -- actually, let](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1689) [me bring this up a little bit --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1690) [is to look for leaks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1693) [So if I go down to the Filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1695) [toolbar and click on the leaks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1698) [filter, that'll show me just any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1699) [leaks that are in my Memgraph](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1702) [file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1703) [Turns out this Memgraph file has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1704) [no leaks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1707) [Well, that's both kind of good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1707) [news and bad news.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1709) [It's great that there are no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1711) [leaks, but now I have to figure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1712) [out what's actually going on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1713) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1714) [The other thing that Memgraph is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1715) [really good for is showing me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1717) [how many instances of an object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1720) [are in memory and if there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1721) [more than I expect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1723) [But if I look at this Memgraph,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1724) [I can see if I actually just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1726) [focus specifically on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1727) [objects from my code, there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1729) [only 5 in memory, and there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1732) [actually only 1 of each of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1733) [these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1735) [If there were, you know,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1736) [multiple root view controllers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1737) [or multiple noir filters, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1739) [or multiple noir filters, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1739) [multiple filters in memory, more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1741) [than I expect, that's something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1743) [else I could investigate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1744) [Well, there's no more instances](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1746) [here than I expect, but maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1749) [one of these is really big.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1750) [It's not very likely, but I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1752) [might as well check.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1753) [So I'm going to go to the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1754) [inspector.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1756) [I'm going to look at these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1757) [Each of them, it lists the size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1758) [for each of the objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1759) [So I can see my app delegate is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1761) [32 bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1762) [The data view controller is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1763) [1500.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1764) [As I go through each of these,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1766) [none of these are clearly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1768) [responsible for the, you know, 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1770) [plus gigabytes of memory my app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1773) [is using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1775) [So that's it for my bag of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1777) [tricks in dealing with Memgraph](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1778) [in Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1780) [Where do I go now?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1781) [Well, I just watched this great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1783) [WWDC session about using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1785) [command-line tools in Memgraph](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1788) [files.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1790) [So let me see if I can find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1791) [anything by trying that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1793) [And thinking back, the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1795) [thing James suggested was using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1797) [vmmap with the summary flag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1799) [vmmap with the summary flag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1799) [So let me give that a try, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1802) [let me pass in my Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1804) [And let's take a look at this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1806) [output.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1810) [So now, what should I be looking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1811) [for in here?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1813) [Now, in general, I'm looking for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1814) [really big numbers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1815) [I'm trying to figure out what's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1816) [using all this memory, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1817) [bigger numbers mean more memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1819) [use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1820) [Now, there's a number of columns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1821) [here, and, you know, some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1823) [them are more important than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1825) [others.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1826) [First of all, virtual size, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1827) [mean, virtual means not real.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1830) [I can almost practically ignore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1832) [this column.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1834) [It's memory that the app has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1834) [requested but isn't necessarily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1836) [using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1837) [Dirty sounds like something I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1838) [definitely don't want in my app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1840) [I'd much rather my app be clean](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1842) [than dirty, so that's probably](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1844) [something I want smaller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1845) [And then, swapped, which,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1847) [because this is iOS, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1848) [compressed, remembering back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1849) [both Kyle and James pointed out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1852) [that it's the dirty size plus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1855) [the compressed size that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1857) [operating system uses to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1859) [operating system uses to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1859) [determine how much memory my app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1860) [is really using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1862) [So those are the two columns I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1864) [really want to concentrate on,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1865) [so let's look for some big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1866) [numbers there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1867) [I can see immediately CG image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1868) [jumps out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1871) [It has a very big dirty size and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1871) [a very big swapped size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1873) [That's a giant red flag, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1875) [let's keep looking.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1876) [I can see this is IOSurface has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1878) [a pretty big dirty size but no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1881) [swapped size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1883) [MALLOC LARGE has a big dirty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1885) [size but a really small or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1887) [smaller swapped size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1890) [And there's nothing else in here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1891) [that's really that big.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1893) [So I think, based on what I see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1895) [here, I really want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1897) [concentrate on the CG image VM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1899) [regions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1901) [So I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1903) [copy that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1903) [So what's the next step?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1905) [Well, we want to know more about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1908) [some virtual memory, so vmmap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1910) [seems like the place to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1912) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1913) [This time, instead of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1914) [summary flag, I'm just going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1915) [pass my Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1917) [pass my Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1917) [But I really only care about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1921) [CG image memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1922) [I don't care about all the other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1924) [virtual memory regions that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1925) [vmmap will tell me about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1929) [So I'm going to go ahead and use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1930) [grep to just show me the lines](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1932) [that talk about CG image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1935) [So let's see what that looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1938) [like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1938) [So now, I have three lines.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1940) [I see there's two virtual memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1941) [regions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1944) [There, and I see their start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1945) [address and their end address.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1946) [And then, I can see these are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1948) [the same columns as above.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1950) [This is virtual, resident,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1951) [dirty, and compressed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1954) [And this last line here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1956) [actually the summary line again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1957) [So that's the same data that was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1960) [above.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1963) [Looking at my two regions, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1964) [see I have a really small region](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1965) [and a really big region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1967) [That big region is clearly what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1969) [I want to know more about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1970) [So how can I find out more about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1973) [that particular VM region?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1975) [Well, I went looking through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1978) [Well, I went looking through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1978) [documentation from vmmap, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1980) [noticed it has this verbose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1982) [flag, which, as the name](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1983) [implies, outputs a lot more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1985) [information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1987) [And I wonder what that can tell](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1988) [me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1990) [So let's go ahead and pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1991) [verbose and the Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1992) [And again, I only care about CG](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=1997) [image regions, so I want to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2002) [grep to filter to just those.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2004) [Oh, now I see there's actually a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2006) [lot more regions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2008) [What's going on here?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2010) [Well, it turns out that vmmap,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2011) [by default, if it finds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2013) [contiguous regions, it collapses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2015) [them together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2017) [And in fact, if you look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2018) [starting on the second line](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2019) [here, the end address of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2021) [region is the same as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2023) [starting address of this one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2024) [And that pattern continues all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2026) [the way down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2027) [So vmmap, by default, collapses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2028) [those into a single region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2031) [But looking at the details here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2032) [I can see there are actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2034) [some differences.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2034) [And in particular, some of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2035) [use a lot more dirty memory and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2037) [use a lot more dirty memory and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2037) [some have a lot more compressed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2040) [memory, so this gives me an idea](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2042) [of maybe something I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2044) [focus on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2045) [But I'm actually going to use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2046) [different strategy here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2047) [I know that the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2049) [system, not necessarily, but as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2050) [a general rule, the later the VM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2054) [region was created, the later in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2057) [my app's life cycle it happened.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2059) [And since this Memgraph was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2062) [taken during this huge spike in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2063) [memory use, chances are these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2065) [later regions are more closely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2067) [tied to whatever caused that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2069) [spike.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2071) [So instead of trying to find the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2072) [one with the biggest dirty and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2073) [compressed size, I'm going to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2075) [ahead and just start at the end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2076) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2077) [I'm going to grab the beginning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2078) [address of that final region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2080) [Now, where do I go from here?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2083) [Well, one of the tools that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2085) [James mentioned was heap, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2087) [that's about objects on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2090) [heap, and I'm dealing with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2091) [virtual memory region, so that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2093) [doesn't help.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2094) [Then, there's leaks, but leaks,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2096) [I don't have a leak here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2098) [I already know from looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2099) [I already know from looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2099) [the Memgraph there's no leaks,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2100) [so that doesn't seem like the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2102) [tool I want to use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2103) [But I went looking through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2104) [help information for leaks, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2106) [it turns out leaks can do lots](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2109) [of things and including telling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2111) [me who has references to either](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2114) [an object on the heap or virtual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2116) [memory region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2117) [So let's go ahead and see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2119) [that tells us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2120) [So I'm going to use leaks, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2121) [then I'm going to pass this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2123) [traceTree flag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2125) [And what that does is it gives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2127) [me a tree view of everything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2129) [that has a reference to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2132) [address I'm passing in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2133) [In this case, I'm passing in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2134) [starting address of my virtual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2136) [memory region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2139) [And then, finally, we give it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2142) [the Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2144) [So what does this look like?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2145) [So what we see here is this tree](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2147) [of all these references.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2149) [If we scroll up to the top,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2150) [which is way up here, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2153) [actually see here's my VM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2155) [region, here's my CG image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2156) [region, and then I can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2158) [there's a tree view here of all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2159) [there's a tree view here of all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2159) [the things that have references,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2162) [and what references them, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2163) [what references them, and so on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2164) [and so forth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2166) [And in fact, if we go back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2166) [Xcode, and we actually filter on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2168) [the same address, and I go ahead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2171) [and look at this object, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2174) [tree is the exact same tree I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2176) [see from leaks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2178) [And if I wanted to, I could go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2179) [through and expand every single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2180) [one of these nodes and look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2182) [the details for each of them,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2183) [but that's going to take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2185) [while, and it's kind of tedious.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2186) [The nice thing about the leaks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2188) [output is not only can I kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2189) [quickly scan through it, if I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2192) [want to, I can search or filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2193) [it, or I can put it into a bug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2196) [report or an email, which I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2197) [can't really do with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2199) [graphical view that's in Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2200) [So what am I looking for here in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2203) [this output?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2204) [Well, ideally, I would find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2206) [something, a class that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2208) [responsible for, a class from my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2209) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2211) [I happen to have looked through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2212) [this already, and I know there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2214) [none of my classes in here, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2215) [what's the next best thing?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2216) [Well, a class that I know I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2218) [Well, a class that I know I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2218) [creating, like a framework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2220) [class, that's either being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2221) [created on my behalf or that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2222) [directly creating.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2224) [So I know that, you know, my app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2225) [has UI views.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2226) [It has UI images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2228) [And I'm using these core image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2229) [classes to do the filtering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2232) [And so if we go ahead and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2233) [look through here, and I'm using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2235) [a very sophisticated debugging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2237) [tool called my eyeballs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2238) [And we go ahead and we look for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2241) [-- let me see if I can find what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2243) [I want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2248) [It's a very big terminal output.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2249) [Makes it a little more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2252) [confusing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2253) [Well, so, for example, you know,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2255) [here's a font reference, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2256) [know, you know, my application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2258) [uses fonts, but chances are the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2259) [fonts aren't responsible for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2262) [lot of my memory use, so that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2264) [not going to help.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2266) [If we go down further, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2267) [actually see there's a number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2269) [these CI classes, and those are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2271) [the core image filters, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2274) [that's core image, you know,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2276) [classes it's creating to do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2277) [filtering work in my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2278) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2279) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2279) [So that may be something I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2280) [to investigate further as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2282) [I happen to have already done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2284) [that and haven't found anything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2285) [useful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2288) [So I can't really get anywhere](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2289) [further looking at the leaks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2291) [output, which is unfortunate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2293) [So what should I go to next?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2295) [Fortunately, James had](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2298) [memory-backed trace recording,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2303) [allocation-backed trace](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2305) [recording turned on when he](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2306) [captured this Memgraph, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2307) [means I can use the other tool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2309) [he talked about to look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2311) [creation backtrace of my object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2313) [So I'm going to use malloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2316) [history.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2318) [And this time, I pass it, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2320) [Memgraph file, first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2322) [And then, I'm going to pass it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2324) [from the help documentation,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2327) [this fullStacks flag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2328) [And what that does is it prints](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2331) [out each frame on its own line,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2332) [makes it a lot more human](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2335) [readable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2336) [And then, I'm going to pass it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2337) [the starting memory address of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2338) [the starting memory address of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2338) [my VM region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2340) [Let's see what this looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2341) [Well, this actually is not that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2344) [big of a backtrace, and I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2345) [see actually my code appears on,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2346) [here on several lines.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2349) [Lines 6 through 9 actually come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2350) [straight from my application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2352) [code, and I can see here on line](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2354) [6 that my NoirFilter apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2356) [function is what is responsible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2359) [for creating this particular VM](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2361) [region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2363) [So that's pretty good smoking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2364) [gun as to where I want to look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2367) [in my app for who's creating all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2368) [this memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2370) [And in fact, if we go back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2371) [the Memgraph file, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2373) [actually see that's the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2374) [backtrace that appears in Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2376) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2378) [You can actually see right here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2379) [is also the NoirFilter apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2380) [method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2382) [We don't get the nice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2382) [highlighting you normally see in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2384) [the backtrace view here because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2385) [we're not debugging a live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2387) [process.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2388) [We're loading a Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2388) [But you can see it's the exact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2390) [same output as we get from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2391) [malloc history.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2392) [And in fact, to just kind of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2393) [confirm things even further, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2397) [I go ahead and I look at my full](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2399) [I go ahead and I look at my full](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2399) [list of CG image VM regions and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2402) [I collect, I grab the second one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2405) [from the bottom, the next one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2409) [up, and let's look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2410) [backtrace for that one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2411) [And it turns out it's the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2415) [backtrace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2416) [So the same code path is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2417) [responsible for that region as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2418) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2420) [And in fact, looking at several](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2420) [of those regions, it actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2423) [uses the same backtrace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2424) [So now, I have a really good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2426) [idea of what in my application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2427) [is responsible for creating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2430) [these VM regions that are using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2432) [up a whole bunch of the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2433) [in my application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2434) [So what can we do about it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2436) [Well, let's go back to Xcode,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2438) [and I can go ahead and close the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2440) [Memgraph file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2441) [And the first thing I want to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2443) [is let's take a look at the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2446) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2447) [If I look at my filter, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2448) [see right here is the apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2452) [function, and I can actually see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2454) [right away something jumps out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2455) [at me, which is I'm using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2457) [UIGraphicsBegin ImageContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2458) [UIGraphicsBegin ImageContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2458) [WithOptions and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2460) [UIGraphicsEnd ImageContext,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2462) [which I remember Kyle said you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2464) [shouldn't be using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2466) [There's a better API to use in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2466) [those circumstances.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2468) [So that's something I definitely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2469) [want to come back to, but the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2470) [first thing I need is I need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2472) [some kind of baseline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2473) [I need to get an idea of how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2474) [much memory my app is using so I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2475) [can make sure my changes are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2477) [making a difference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2478) [So I'm going to go ahead and run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2480) [the application, and I'm going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2481) [to go to the debug navigator and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2484) [look at the memory report.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2486) [So now, I can see the memory my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2488) [app is using as I run it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2490) [Now, I really like this image of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2493) [Saturn's north pole.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2495) [It's this weird hexagon shape,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2497) [which is both kind of cool and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2499) [little freaky.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2501) [So let's take a look at that,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2502) [and let's apply the filter and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2504) [see what we get.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2505) [So 1 gig, 3 gigs, 4 gigs, 6](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2507) [gigs, 7 gigs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2511) [This is bad.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2513) [And actually, this actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2514) [brings up a good point, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2518) [this would not fly on a device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2519) [this would not fly on a device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2519) [at all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2521) [So when you're running in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2522) [simulator, you have to remember](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2523) [that it's useful for debugging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2524) [and testing changes, but you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2526) [need to validate all that stuff](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2527) [on devices as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2528) [But the other thing that's nice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2529) [is the simulator is never going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2531) [to run out of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2533) [So if I have a case where my app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2534) [is getting shut down on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2535) [device, maybe try it in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2536) [simulator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2538) [I could see what's, you know, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2539) [can wait for a really big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2540) [allocation, not get shut down,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2541) [and then investigate it from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2543) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2544) [And one thing I would like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2545) [point out is actually we do show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2546) [you the high-water mark over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2548) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2551) [And in this case, I'm up to 7.7](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2551) [gigabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2553) [It's terrible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2555) [So let's see what we can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2556) [about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2558) [I'm going to go back to my apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2559) [function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2563) [And now, you know, I do want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2564) [come back to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2566) [beginImageContext WithOptions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2567) [thing, but thinking back to what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2568) [Kyle said, when you're dealing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2570) [with images, what's the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2572) [important thing in terms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2574) [memory use?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2575) [It's the image size, so let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2576) [take a look at what that looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2578) [take a look at what that looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2578) [like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2580) [I'm going to go ahead and apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2580) [the filter again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2583) [And then, once I'm stopped in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2584) [the debugger, I want to go ahead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2587) [and see the size of this image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2591) [And I'm actually just going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2594) [take a sip of water before I hit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2595) [return here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2598) [Actually, I'm not going to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2599) [any water.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2602) [This is 15,000 by 13,000.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2604) [Now, I checked in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2607) [documentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2608) [On UIImage that size, that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2609) [points, not pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2612) [If this is a 2X device or a 3X](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2613) [device, you have to multiply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2616) [that by a big number.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2618) [You know, Kyle was upset because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2621) [an image was taking 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2623) [megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2624) [Nobody tell him about this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2625) [And in fact, just to confirm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2627) [things, I want to try this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2629) [I'm going to do a, the 15,000](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2631) [times 13,000, and the iPhone X](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2636) [times 13,000, and the iPhone X](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2636) [is a 3X device, so it's 3 times](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2640) [the width times 3 times the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2642) [height times 4 bytes per pixel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2646) [That number looks kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2650) [familiar.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2653) [So I'm pretty sure I know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2655) [exactly what's using up my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2657) [7-and-a-half gigabytes of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2659) [memory, and it's not necessarily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2660) [my beginImageContext thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2664) [It's the size of this image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2665) [And there's no reason the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2667) [needs to be this big.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2669) [What I want to do is scale it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2670) [down so it's the same dimensions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2672) [as my view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2673) [And that way, it'll take up far](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2674) [less memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2676) [So if I go back to the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2677) [loading code that's up here --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2678) [actually, before I do that, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2680) [want to go ahead and disable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2681) [this break point -- so let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2682) [take a look at what this does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2685) [Well, it's pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2686) [straightforward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2686) [It's getting the URL from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2687) [bundle, it's loading some data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2689) [from that URL and loading it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2691) [into UIImage, then that, then,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2692) [which gets passed to the filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2695) [So what I want to do is, before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2697) [I send it to the filter, I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2698) [I send it to the filter, I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2698) [to scale down the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2700) [However, I remember what Kyle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2702) [said.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2703) [I don't want to do the scaling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2704) [on UIImage because it still ends](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2705) [up just loading that whole image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2707) [into memory anyway, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2708) [what I'm trying to avoid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2710) [So I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2711) [let's collapse this function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2713) [And I'm going to replace it with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2716) [the code Kyle suggested.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2717) [Okay, so let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2720) [what this code is doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2723) [So here again, we're getting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2725) [image from the bundle, but now,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2728) [this time -- just a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2731) [lighter -- I'm calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2733) [CGImageSource CreateWithURL to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2735) [get a reference to the image and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2738) [then passing that to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2739) [CGImageSource CreateThumbnail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2741) [AtIndex.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2743) [So now, I can scale the image to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2744) [the size I want without having](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2745) [to load the whole thing into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2747) [memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2748) [Let's give this a shot and see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2749) [if it makes a difference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2751) [I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2752) [rebuild and wait for it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2753) [launch on the application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2756) [And then, once it's there -- oh,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2759) [And then, once it's there -- oh,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2759) [there's a warning.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2762) [I have an extra this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2766) [Let's see.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2770) [Okay, building.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2772) [Building, building, building.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2775) [Okay, launching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2777) [Good. All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2778) [Now, let's go ahead and take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2779) [look at the memory report.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2780) [Let's go back to Saturn's north](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2782) [pole, which is something I've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2785) [always wanted to say.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2787) [And let's apply our image and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2789) [see what it goes to now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2792) [So now, we're at 75, 93](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2793) [megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2795) [Our high-water mark in this case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2796) [is 93 megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2798) [Significant improvement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2801) [[applause] Much better than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2804) [almost guaranteed to get shut](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2806) [down 7-and-a-half gigabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2808) [But now, I remember there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2811) [actually, I want to go back, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2813) [let's go ahead and stop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2815) [And I still want to go back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2818) [my filter method and change this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2819) [my filter method and change this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2819) [UIBeginImageContext code and do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2823) [what Kyle suggested here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2825) [So I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2826) [delete this code and add in my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2828) [new filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2832) [So now, in this case, I'm going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2834) [ahead and creating a UIGraphics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2836) [ImageRenderer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2838) [And I'm using my CI filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2839) [within the renderer to do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2841) [filter, apply the filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2844) [Let's go ahead and run this --](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2846) [hopefully, it'll build -- and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2849) [see if this happens to make any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2850) [difference in terms of my memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2852) [usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2853) [So let's go back to the debug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2855) [navigator and to the memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2857) [report.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2858) [And once again, we get to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2860) [back to Saturn, and let's go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2862) [ahead and apply our filter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2866) [Now, let's see what our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2871) [high-water mark ends up this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2871) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2874) [Ninety-eight.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2874) [So that's actually the same, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2876) [it turns out that's, if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2879) [it turns out that's, if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2879) [think about it, that's what I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2880) [expect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2881) [My image is still going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2882) [using, in this circumstance, 4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2883) [bytes per pixel, so I'm not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2885) [actually getting any memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2887) [savings by using this new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2888) [method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2890) [However, if there was an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2890) [opportunity for memory savings](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2892) [-- for example, you know, if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2894) [operating system could determine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2896) [that it could use fewer bytes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2897) [per pixel or if it determined](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2898) [that it needed to use more, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2900) [would do the right thing, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2901) [don't need to worry about it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2903) [So even though I don't see a big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2904) [improvement, I know my code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2905) [still better for having made](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2907) [these changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2908) [So there's still more I could do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2910) [here, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2912) [I want to make sure we unload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2913) [the image when the app goes into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2914) [the background, and I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2915) [make sure we're not showing any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2917) [images in views that aren't on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2919) [screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2920) [There's a lot more I can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2921) [here, but I'm really pleased](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2922) [with these results, and I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2924) [to send them back to James.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2925) [So I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2927) [grab a screenshot and add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2928) [little note to it for James just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2930) [to show him how pleased I am](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2933) [with all of this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2934) [And I think we're going to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2936) [ahead and send him the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2937) [starry-eyed emoji.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2941) [And hopefully James will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2944) [happy with these results.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2946) [So now, I'm going to hand it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2947) [back to Kyle, who's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2950) [wrap things up for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2951) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2953) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2954) [&gt;&gt; Thanks, Kris.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2956) [Thanks, Kris.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2960) [That was awesome.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2961) [With just a little bit of work,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2962) [we were able to greatly reduce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2964) [our memory use by orders of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2965) [magnitude.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2969) [So in summary, memory is finite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2970) [and shared.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2974) [The more we use, the less the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2976) [system has for others to use it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2977) [We really need to be good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2979) [citizens, and be mindful of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2980) [memory use, and only use what we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2981) [need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2983) [When we're debugging, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2986) [memory report in Xcode is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2987) [crucial.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2989) [We can just turn it on when our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2990) [app is running because then, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2991) [we monitor it, the more we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2992) [notice the regressions as we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2994) [debugging.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2996) [We want to make sure that iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2999) [We want to make sure that iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=2999) [picks our image formats for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3001) [We can save 75% memory from SRGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3003) [to alpha 8 just by picking the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3006) [or by using the new UIImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3008) [GraphicsRenderer APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3010) [It's really great for masks and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3011) [text.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3014) [Also, we want to use ImageIO](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3016) [when we downsample our images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3018) [It provides us or prevents a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3021) [memory spike, and it's faster](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3022) [than trying to draw a UIImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3024) [into a smaller context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3025) [Finally, we want to unload large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3027) [images and resources that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3030) [not on the screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3032) [There's no sense in using that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3033) [memory because the user can't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3034) [see them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3036) [And even after all of that,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3038) [we're still not done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3040) [As we just saw, using Memgraphs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3042) [can help us further understand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3044) [what's going on and reduce our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3046) [memory footprint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3047) [That combined with malloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3048) [history gives us great insight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3049) [into where our memory's going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3050) [and what it's being used by.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3052) [So what I'd recommend is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3054) [everyone go out, turn on malloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3056) [history, profile your tool, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3058) [history, profile your tool, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3058) [start digging in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3060) [So for more information, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3063) [go to our slide presentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3064) [And also, we'll be down in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3067) [technology labs shortly after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3070) [this for a little bit if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3071) [have additional questions for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3072) [us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3073) [Thanks, and have a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3075) [remainder of WWDC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3075) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/416/?time=3078)