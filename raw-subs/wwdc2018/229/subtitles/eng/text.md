# Using Collections Effectively

## Summary
Every app uses collections! Go beyond the basics with specific tips on how best to use indices, slices, bridging, laziness, and reference types. Gain better understanding of when to use each collection for best performance.

## Info
* Developer Tools
* WWDC 2018 - Session 229 - macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=16) [&gt;&gt; Good morning.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=22) [My name is Michael LeHew, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=24) [worked on the collections for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=25) [the foundations team at Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=26) [And today, I want to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=27) [specific things that you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=30) [know about to ensure that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=31) [use of collections in Swift is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=33) [as effective as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=34) [I'm going to cover a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=36) [territory today about details](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=38) [and all aspects of collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=39) [available for use in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=42) [We're going to explore some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=43) [common pitfalls and how to avoid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=44) [them including performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=46) [issues, and I'm also going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=47) [offer very specific advice about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=48) [when to choose to use specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=50) [collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=51) [So let's begin.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=53) [I want you to imagine a world, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=54) [world without collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=57) [And in this world, we may not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=59) [And in this world, we may not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=59) [have arrays, but it still has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=63) [bears, but every time we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=64) [another bear, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=67) [need to define another variable,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=70) [and we want to do things with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=72) [these bears.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=73) [We're going to need to repeat](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=73) [ourselves.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=74) [Pretty scary, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=76) [It gets worse though.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=78) [This world also doesn't have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=79) [dictionaries, but thankfully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=80) [being clever developers, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=83) [work around that with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=85) [function, where we painstakingly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=85) [define each case that we care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=87) [about, and using this function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=89) [is very similar to using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=91) [dictionary, except none of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=92) [dynamic capabilities that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=94) [need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=95) [But who likes a mutable state,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=96) [right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=97) [Fortunately for us though, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=98) [don't live in this world.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=100) [Thankfully our world has bears](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=102) [and collections along with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=103) [rich first-class syntax for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=105) [defining them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=107) [And APIs that help us not repeat](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=108) [ourselves when we iterate or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=111) [retrieve the elements that they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=113) [may store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=115) [Collections are so pervasive and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=117) [share so many common features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=118) [share so many common features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=118) [and algorithms that in Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=120) [they all conform to a common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=121) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=123) [Not surprisingly, it's called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=124) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=126) [And in Swift, collections are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=126) [sequences whose elements can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=129) [traversed multiple times,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=130) [nondestructively, and whose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=132) [elements can be accessed via a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=133) [subscript.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=135) [Let's see, look at how they do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=137) [that but considering an abstract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=139) [representation of a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=140) [This could be an array defined](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=143) [contiguously in memory, a hash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=144) [table, a red black tree, a link](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=146) [list or anything else that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=149) [can imagine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=150) [What matters is that it supports](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=151) [the concept of an initial index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=152) [called start index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=154) [It can be used to access the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=156) [initial element of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=158) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=159) [It has an end index, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=160) [identifies the end of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=161) [collection, and collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=162) [support the ability to iterate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=164) [from their start index to their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=166) [end index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=167) [They can do this multiple times,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=169) [and they also support a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=171) [subscript to retrieve elements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=172) [from the collection itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=174) [Let's see what this looks like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=176) [in code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=178) [Indeed, if we look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=179) [Indeed, if we look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=179) [definition of collection, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=180) [declared as a sequence of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=182) [elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=183) [It also has an additional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=184) [associated type called index,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=185) [which must be comparable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=187) [It offers a subscript to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=190) [retrieve elements from, or using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=191) [that index, and we define a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=193) [start and an end index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=195) [identifying the bounds of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=196) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=198) [And finally, we have a function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=198) [called index after, which lets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=201) [us get from one index to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=202) [another.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=204) [And this last function is so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=204) [important because it allows the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=207) [standard library to define many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=208) [useful and powerful default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=210) [behaviors with the incredible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=212) [power of protocol extensions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=213) [Let's look at some of these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=215) [When you conform to collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=218) [you gain access to an incredible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=219) [range of functionality with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=221) [properties that let you get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=222) [first and the last element or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=224) [identify the count or check to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=226) [see if a collection is empty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=228) [You also gain API that lets you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=230) [iterate through a Collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=231) [using 4N syntax.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=232) [And super useful functions like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=235) [map, filter, and reduce.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=236) [Now let's go ahead and make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=239) [Collection even more powerful by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=239) [Collection even more powerful by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=239) [adding our own extension.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=241) [Collection already provides a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=243) [way to iterate through every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=245) [element, but I want a function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=246) [that will let me iterate through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=248) [every other element, skipping](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=249) [some of the values along the way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=251) [and will do this by adding an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=253) [extension to Collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=254) [Let's start with the methods](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=256) [signature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=256) [We're going to call our function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=258) [every other, and it's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=259) [take a closure that will call on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=260) [each element that we care about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=261) [We'll get the bounds of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=264) [iteration, and to find another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=265) [variable, that starts at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=267) [start, which will mutate along](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=269) [as we go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=270) [We'll call the closure on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=272) [current element and advance our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=273) [current index to the next one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=276) [And we may have invalidated our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=277) [index at this point, we may have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=279) [reached the end of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=280) [collection, so we need to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=280) [sure that we did that, and if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=281) [did, we can then advance our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=283) [index one more time and thus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=284) [skip every other element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=286) [And if we call this we see, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=288) [we call this on the close range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=289) [from one to ten, we see that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=291) [skip the even elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=293) [And so we see that Collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=294) [let us describe some really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=296) [powerful behavior, but it turns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=298) [powerful behavior, but it turns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=298) [out collections aren't alone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=300) [In fact, Collection is not the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=302) [only protocol that we have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=303) [In Swift, we have access to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=304) [rich hierarchy of collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=305) [protocols, each greatly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=307) [improving on the kinds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=308) [assumptions that we can make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=309) [about our types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=310) [Let's go ahead and talk about a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=311) [couple of these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=312) [We've already established that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=313) [Collection lets you go forward](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=315) [from a given index, but there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=317) [are also bidirectional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=319) [collections, which let you go in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=320) [the other direction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=322) [Now, of course, bidirectional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=324) [collections are collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=326) [themselves, and so we can still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=327) [iterate forward as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=328) [The next most flexible form of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=331) [collection is what's known as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=332) [random access collection, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=334) [with these, these add the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=335) [requirement that it would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=336) [constant time to compute, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=338) [compute another index from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=340) [another or to compute the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=341) [distance between two indexes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=342) [The compiler cannot enforce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=344) [this, and so when you conform to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=345) [random acts as a collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=347) [you're making a promise.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=348) [But if you satisfy this promise,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=349) [if you can deliver on this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=351) [promise, the protocol gives you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=352) [the power to access any index in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=353) [the collection in constant time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=355) [And of course, random access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=357) [collections remain collections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=359) [collections remain collections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=359) [and so you can still iterate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=360) [forward and backward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=361) [Now as Swift developers, we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=362) [access to many useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=365) [collections that conform to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=366) [these protocols, collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=368) [such as array, set, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=370) [dictionary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=371) [But thanks to the general](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=372) [purpose utility of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=374) [protocols, many other types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=375) [conform to these collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=377) [protocols as well, such as data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=378) [range, and string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=380) [Or the index collections, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=382) [they all gain access to all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=384) [this rich functionality by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=385) [simply conforming to Collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=386) [in their own fashion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=388) [Indeed, once you know how any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=389) [one of these types works, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=391) [can apply that knowledge to any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=392) [of the others, and there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=393) [quite a few.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=395) [So I'm going to talk about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=395) [details about how a type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=398) [conforms to Collection, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=399) [all begins with describing how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=401) [it is indexed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=403) [Each collection has its own kind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=406) [of index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=407) [And that index must be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=408) [comparable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=410) [In some cases, the indices can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=412) [look like integers, like arrays,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=414) [but just because an index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=416) [happens to look like an integer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=417) [doesn't mean that you should use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=418) [it like one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=419) [it like one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=419) [Now I want to ask a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=421) [questions that might have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=422) [surprising answers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=423) [The first is how do we get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=425) [first element of an array, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=426) [instantly you probably all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=428) [thought, well I'll just call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=430) [array subzero.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=431) [An array's index happens to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=432) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=434) [So you can sometimes say this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=434) [and get exactly what you intend.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=436) [But it isn't the best way to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=438) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=439) [I'm going to go ahead and ask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=439) [the same question, but this time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=440) [about a different collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=442) [What's the first element of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=443) [set?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=446) [Now this might seem like a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=446) [really weird question, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=447) [Sets are unordered.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=449) [However, they are collections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=451) [and being collections, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=452) [iterate through them, and when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=453) [you iterate through a set,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=454) [you're going to iterate through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=455) [one element first, and so that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=456) [really the question we're asking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=458) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=459) [So can I say set subzero?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=460) [Happily, the compiler will say](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=462) [no, and that's because set's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=464) [index type is an int, the type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=466) [system wants us to use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=469) [correct index type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=470) [Lucky for us we already know how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=472) [to do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=474) [We know the collection protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=474) [tells us that all collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=475) [have a start index, so let's go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=476) [ahead and use that, and if we do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=478) [this, this will actually work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=479) [this, this will actually work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=479) [with all collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=480) [Start index is always going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=481) [be the element of the first item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=483) [that you would see when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=485) [iterate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=485) [But there's a nuance to watch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=486) [out for when using indices to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=488) [directly subscript into any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=489) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=490) [And that is, it can crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=491) [I haven't actually asserted that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=495) [these collections have contents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=497) [in them, and so when you're, I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=498) [just using start index, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=500) [these collections could be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=501) [empty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=502) [It turns out though that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=503) [accessing the first element in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=504) [collection is such a common task](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=505) [that there's an even better way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=508) [Simply call first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=511) [And if you call first, this is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=512) [lot safer, because the return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=514) [time of this is optional,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=515) [reflecting the fact that not all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=517) [collections have a first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=518) [element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=519) [So I have another question.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=519) [It's the second element of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=524) [collection, and I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=525) [emphasize collection here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=526) [It could be any collection, an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=528) [array, a set, or something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=529) [doesn't even exist yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=530) [Let's go ahead and add a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=532) [property to collection via](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=533) [protocol extension, and we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=535) [call it second, and just like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=535) [first, it's going to return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=537) [optional, because not all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=538) [collections have two elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=539) [collections have two elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=539) [So, let's try writing this by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=542) [subscripting 1.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=545) [But here our zero-based indexing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=546) [instincts are going to lead us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=548) [astray, and then we'll be caught](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=549) [by the compiler again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=551) [We want this code to work with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=553) [every collection, and not all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=554) [collections use integers to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=556) [index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=557) [So let's try a different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=558) [approach.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=559) [What I really want is one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=561) [greater than the start index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=562) [But lucky here, the compiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=565) [will catch this as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=566) [You can't add 1 to an arbitrary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=569) [index type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=570) [Index types are supposed to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=571) [opaque or can be opaque.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=572) [And what we really need to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=574) [doing here is we need to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=576) [using the API provided by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=577) [collection protocol to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=578) [So let's go ahead and do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=580) [I commented out a sketch of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=582) [things that we're going to need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=584) [to do to find the second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=585) [element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=586) [The very first thing that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=587) [need to do is we need to check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=588) [to see if the collection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=588) [empty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=589) [Collections are empty when their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=591) [start index is exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=592) [equivalent to their end index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=593) [So let's check for that and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=594) [return nil, because such a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=596) [collection doesn't have a second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=597) [collection doesn't have a second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=597) [element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=600) [Oh, and so now we can assume](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=601) [that our collection has one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=604) [element in it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=605) [We can use index after to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=606) [the second element or the second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=609) [index, but we need to make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=610) [that that index is valid, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=612) [let's see this visually.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=614) [We advance after, but if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=615) [collection only had one element](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=616) [in it, we have now actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=617) [produced an invalid index, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=618) [if we tried to subscript with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=619) [that index, we'd get that fatal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=620) [error that we saw just a moment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=622) [ago.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=623) [So we check for it to be valid,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=623) [and this is very similar to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=624) [empty [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=625) [We just make sure that our index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=626) [is not equal to the end index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=628) [returning nil.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=629) [Again, because two-element](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=630) [collections don't have a, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=631) [one-element collections don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=633) [have a second element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=634) [At this point, we have all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=635) [assumptions we need to know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=636) [our collection has at least two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=638) [elements in it, and so we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=639) [safe to use the subscript](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=640) [operator with that index,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=641) [retrieving the value that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=643) [desire.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=644) [Now, it turns out, or that looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=645) [like a lot of code, but it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=648) [worth pointing out that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=650) [general purpose index math will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=651) [work with any collection, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=653) [is pretty awesome, and it turns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=654) [out Swift has a better way to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=656) [this though.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=657) [There's something called slices,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=658) [There's something called slices,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=658) [but before I show how to do it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=660) [with slices, I want to talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=661) [about what slices are and how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=662) [they work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=664) [Slices are a type that describe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=668) [only part of a collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=670) [And every slice has their own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=673) [start and end index, and slices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=674) [exist separately from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=677) [collections, from their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=678) [originating collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=679) [And what makes slices so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=681) [efficient is they occupy no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=682) [extra storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=683) [They simply refer back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=684) [original collection, and when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=685) [slices are subscripted, they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=688) [read out of the original buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=690) [And they can do this because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=692) [they share the same indices as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=694) [their underlying collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=696) [And let's take a look at how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=697) [that works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=698) [We can prove this to ourselves.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=698) [We'll start with an array, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=700) [we'll ask that array to drop its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=701) [first element, producing a slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=703) [that's one element shorter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=705) [And because we care about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=706) [proving about the indices, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=708) [actually get the second index of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=709) [the array by asking to advance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=710) [one after the start index, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=713) [then we'll compare those.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=714) [And indeed, they are the same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=715) [Now this dropfirst function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=718) [looks exactly like we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=719) [looks exactly like we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=719) [succinctly get the second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=720) [element of our collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=721) [So let's go back to our previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=723) [solution, and see how much more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=724) [expressive we can be with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=725) [slices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=726) [Remember all that fancy index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=728) [[inaudible] code we had to write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=730) [earlier?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=731) [Well, by using dropfirst, we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=732) [going to let slices take care of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=734) [all that fancy index bounds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=735) [checking for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=736) [And since first returns an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=737) [optional, this will work as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=739) [expected with empty and single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=741) [element collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=743) [Let's visualize what's happening](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=745) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=746) [We start with an array, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=747) [form a slice by dropping the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=749) [first element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=750) [We then use the first property](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=752) [to subscript into the slice,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=755) [retrieving the element from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=757) [original collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=758) [Now I don't know about you, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=759) [I'd much rather maintain this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=760) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=763) [Now every type is free to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=764) [describe its own slice type, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=766) [many do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=767) [For instance, arrays define](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=768) [array slices that are especially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=770) [attuned to the most common use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=771) [cases that arrays work with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=772) [Similarly, string defines a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=774) [substring slice type, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=777) [substrings, again, are tuned to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=779) [substrings, again, are tuned to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=779) [the special cases that are most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=780) [common with strings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=781) [Some types, like set, will make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=783) [use of the generalized slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=786) [type defined in the standard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=787) [library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=788) [That's because sets are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=789) [unordered.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=790) [There's not very much else that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=790) [they can do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=791) [They just basically need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=791) [maintain a start and an end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=792) [index [inaudible] to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=793) [original collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=794) [Data and range on the other hand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=796) [are their own slice types, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=798) [so there's a lot of options that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=800) [you have here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=801) [And there's one more thing about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=802) [slices that I want to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=804) [before we move on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=805) [Let's suppose that we had a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=806) [really large collection, like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=808) [thousands and thousands and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=810) [thousands of elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=811) [And we add a couple of small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=812) [slices to parts of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=814) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=814) [It's important to remember that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=816) [the slice keeps the entirety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=817) [the originating collection alive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=819) [as long as the slice is around.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=821) [And this can lead to surprising](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=823) [problems.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=824) [Let see how this works in code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=825) [Let's suppose I have an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=827) [extension on an array that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=829) [allows me to return the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=830) [half, and I'm using the droplast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=831) [function here to do so.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=833) [And we have an array of eight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=835) [numbers, and we call our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=836) [extension, producing the slice,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=838) [extension, producing the slice,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=838) [and then to try to get rid of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=840) [that original storage of eight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=841) [numbers, I go ahead and assign](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=843) [that array to an empty array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=845) [Our first clue that something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=846) [interesting is happening occurs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=849) [when we ask our slice for its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=851) [first element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=852) [We're somehow able to return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=853) [one, even though we threw away](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=854) [the storage for the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=856) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=858) [Either there was a copy or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=859) [something magical is going on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=860) [And so if we wanted to eliminate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=863) [that buffer though, and oh the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=865) [magic that's actually going on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=867) [is that we're holding onto the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=868) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=869) [And so if we wanted to eliminate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=870) [that, what we could do is we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=871) [could form an actual copy of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=872) [array from the slice, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=874) [if we set that slice to an empty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=876) [array itself, that copy would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=877) [still be valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=879) [Let's visualize what just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=881) [happened.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=882) [We started with an array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=883) [We then formed a slice on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=885) [first half of that array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=886) [We then created a copy of that,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=889) [setting the array to be empty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=892) [and setting that slice to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=893) [empty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=894) [And only after we did that did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=895) [the underlying storage go away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=897) [So in this matter, slices sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=899) [So in this matter, slices sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=899) [of work like lazy copies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=902) [You get to choose when you make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=904) [a copy of the elements yourself,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=905) [and it turns out that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=908) [concept of being lazy and doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=909) [something later is really useful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=910) [in other contexts too.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=912) [One such context is function](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=915) [calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=917) [Now function calls in Swift are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=918) [eager by default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=920) [That is, they consume their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=922) [input and return their output as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=923) [demanded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=925) [Consider this example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=927) [We start with a range from one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=928) [to 4000, and ranges are a really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=929) [succinct way of representing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=931) [lot of numbers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=932) [It's just a start and an end,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=933) [and it knows how to produce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=935) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=936) [We then map this though](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=937) [multiplying each value by two,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=938) [and so we've now actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=939) [allocated an array of 4000](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=940) [elements and performed our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=942) [mapping function on each of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=943) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=945) [We then filter that down to four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=946) [elements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=947) [And so at this point, we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=948) [actually gone ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=949) [allocated 4004, you know, space](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=950) [for 4004 elements, but we only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=953) [really needed the final four.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=956) [And that's an awful lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=958) [And that's an awful lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=958) [intermediate computation that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=961) [maybe we don't always desire.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=962) [It would be great if there was a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=964) [way just to not do any of it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=965) [unless it was absolutely needed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=967) [And Swift's answer for that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=968) [called being lazy, just like in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=971) [real life.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=972) [We'll start as we did before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=974) [with the range, and then we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=975) [tell that range to be lazy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=978) [And when we do this, what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=979) [happens is we wrap the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=980) [collection with a lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=983) [collection, and when we perform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=985) [operations on this lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=986) [collection, what's going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=987) [happen is we're going to wrap it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=989) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=990) [And so when we wrap the, when we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=990) [call map on it, we actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=992) [aren't mapping.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=993) [We're not doing anything with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=994) [that closure other than storing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=995) [it for later should we ever need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=996) [to use it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=997) [Further, if I filter that lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=998) [map collection, the filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1000) [simply wraps the map collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1001) [noting that it's going to filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1003) [later on demand, but not right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1004) [now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1006) [Now let's go ahead and ask our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1007) [lazy filter collection for it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1009) [first element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1010) [When we do this, we'll start by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1015) [asking the lazy filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1018) [collection for it's first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1019) [element, but the lazy filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1019) [element, but the lazy filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1019) [collection doesn't know.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1021) [It wraps something that might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1022) [know.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1024) [And so it'll defer to the map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1025) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1026) [And the map collection also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1026) [doesn't know it's first element,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1028) [but it wraps a collection that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1030) [might, and indeed, the range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1031) [knows it's first element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1032) [The first element of the range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1034) [is the value one, which it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1036) [returns to the lazy map](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1037) [collection where now the lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1038) [map collection can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1041) [perform it's closure, computing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1042) [the value 2, which it returns to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1044) [the lazy filter collection as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1046) [candidatefirst element.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1047) [Now lucky for us in this case, 2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1049) [happens to be less than 10, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1051) [so the lazy filter collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1052) [finds it first element on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1053) [first try, which it returns back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1055) [to its caller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1057) [Now that's a lot of different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1058) [computation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1060) [And I mentioned that lazy aims](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1061) [to only do calculation as needed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1063) [on demand, but another thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1064) [that it avoids is creating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1066) [intermediate storage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1067) [So I want to show an example of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1069) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1072) [Let's suppose we had an array of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1072) [different kind of bears.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1073) [However, I want to point out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1075) [that some of these bears are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1077) [redundant.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1078) [We already know that they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1079) [We already know that they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1079) [bears.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1080) [They don't need to tell us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1081) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1081) [So let's write some code to find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1083) [those silly, redundant bears,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1084) [and we'll do this using a lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1085) [filter, as before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1087) [And in this case, producing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1088) [lazy filter is going to be a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1091) [lazy filter collection that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1093) [wraps an array of strings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1094) [In our closer here, were going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1096) [to print out which bear we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1097) [currently iterating on before we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1099) [do our predicate check.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1101) [And we're doing this because I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1101) [want to understand how filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1103) [works a little better, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1104) [we'll call first, and when we do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1105) [this, we'll defer to the lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1106) [filter collection, and then the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1108) [lazy filter collection will in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1111) [turn defer to the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1112) [storage where we'll print out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1113) [Grizzly, check the predicate,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1117) [which in this case is false,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1122) [Grizzly does not contain the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1123) [word bear, and advance on to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1124) [panda.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1125) [When we get to panda, when we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1127) [get to panda, we'll again print](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1131) [out panda, check to see if it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1132) [contains the word bear, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1134) [advance on to spectacle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1135) [Spectacle gets printed, also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1137) [Spectacle gets printed, also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1137) [doesn't contain the word bear,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1140) [and we advance finally to gummy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1141) [bears, which mercifully has the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1142) [word bear in it, and which the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1144) [lazy filter collection can now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1147) [return to its caller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1148) [Now what would happen if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1152) [called first again?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1152) [Well, it's the same story.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1155) [We ask the lazy filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1158) [collection, which defers to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1159) [underlying collection, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1161) [repeats that calculation,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1162) [returning it to its caller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1164) [Now this might not typically be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1166) [what you want, and so if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1169) [find yourself needing to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1170) [repeatedly ask the lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1171) [collection to calculate its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1172) [result, there's a way to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1173) [sure that that happens just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1175) [once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1175) [We can ensure that the lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1176) [collection is iterated exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1178) [once by creating a new nonlazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1180) [collection from the lazy, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1182) [when you do this, it will still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1184) [defer to the lazy collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1186) [but now the iteration will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1187) [proceed through the entirety of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1188) [your underlying collection,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1190) [producing essentially, you know,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1193) [the nonlazy version of that lazy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1195) [calculation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1196) [And so in this case, we get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1197) [array containing the string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1199) [array containing the string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1199) [gummy bears.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1200) [And if we print the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1201) [element of that ray, we don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1202) [need to consult the closure at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1203) [all or the lazy collection at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1205) [all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1206) [We basically stamped out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1206) [laziness and now have an eager](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1207) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1208) [So when should we be lazy?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1211) [Well, lazy collections are a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1214) [really great way to eliminate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1215) [the overhead of chained maps and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1216) [filters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1217) [They excel when you find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1218) [yourself only needing part of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1219) [the result of a collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1220) [calculation, or we should avoid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1221) [using lazy if your closures have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1224) [side effects, and your closures](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1226) [should rarely have side effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1227) [And be sure to reify back, or I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1229) [should say, be sure to consider](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1231) [reifying back into a regular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1232) [collection when you cross API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1233) [boundaries.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1235) [Lazy should often be an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1236) [implementation detail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1237) [Now up until now, we've been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1238) [able to do a lot of cool things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1240) [with just mutable collections,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1242) [but of course Swift lets us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1244) [mutate our collections as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1246) [Let's talk about the two kinds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1249) [of collections that we haven't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1250) [talked about yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1251) [The first of these is mutable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1252) [collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1254) [This adds a setter to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1256) [subscript so that you can change](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1256) [the contents of a collection but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1258) [not its length.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1259) [And you have to be able to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1260) [this in constant time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1261) [The next is called a Range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1265) [Replaceable Collection, and this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1267) [is the kind of collection that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1268) [you get when you can remove](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1269) [elements from a collection or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1271) [insert them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1273) [And now I want to talk about one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1274) [of the questions I get asked all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1276) [the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1279) [Why does my perfectly reasonable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1280) [collection code crash?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1281) [And like all good question](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1283) [answers, I almost always follow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1284) [up with a few questions of my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1286) [own.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1286) [Sometimes I start with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1288) [classic, well what are you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1289) [trying to do?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1290) [And I usually quickly follow up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1290) [with, well how are you using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1292) [your collections?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1294) [Are you mutating them?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1295) [Are you sure you aren't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1296) [accessing your collections for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1296) [multiple threads?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1297) [And I ask these questions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1298) [because their answers often lead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1300) [to the root cause of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1302) [problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1304) [Well, let's begin with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1304) [assumption that threads aren't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1306) [involved.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1307) [I'm not ready to think about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1308) [threads yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1309) [It's not even 9:30.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1309) [Suppose we had an array, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1312) [get the index of an element that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1314) [we know is there, in this case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1315) [the value e.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1317) [And then we mutate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1318) [collection, say by removing its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1319) [collection, say by removing its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1319) [first element, and we go ahead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1320) [and print the element associated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1323) [with that index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1324) [Well when we do this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1326) [unfortunately this will produce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1327) [a fatal error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1329) [The index is no longer valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1331) [In fact, the index became](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1333) [invalid the moment we mutated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1334) [our collection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1336) [A far safer approach would be to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1337) [mutate our collection first and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1340) [then calculate the index.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1342) [It's worth pointing out that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1344) [mutation always invalidates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1347) [indices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1348) [This doesn't just apply to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1349) [arrays.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1350) [Let's take a look at how this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1351) [problem could manifest with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1352) [dictionaries.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1353) [Let's suppose that we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1355) [dictionary showing a few of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1355) [bear's favorite things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1356) [We'll grab the index of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1359) [bear's favorite food and print](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1360) [it out, confirming that, indeed,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1361) [it's salmon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1363) [Next, we'll add a couple more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1365) [favorite things that this bear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1366) [has, and then we'll make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1367) [that our favorite food is still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1369) [salmon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1370) [And we'll see that, wait a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1370) [minute, our favorite good isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1372) [hibernation, it's salmon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1373) [And just like arrays, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1375) [invalidated our index the moment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1378) [we mutated the dictionary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1379) [we mutated the dictionary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1379) [It's also worth pointing out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1381) [that this code can crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1382) [So how do we go about fixing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1385) [this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1386) [Well, it turns out it's the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1387) [exact fix that we used with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1388) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1390) [We just simply recompute the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1391) [index after we mutate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1392) [Well, one thing to keep in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1393) [that when you're recomputing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1395) [indices this is something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1396) [can sometimes be expensive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1397) [Some index search methods take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1398) [linear time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1400) [And so you want to take care to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1402) [only find the indices that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1403) [need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1405) [So here's my advice if you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1406) [to avoid finding yourself in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1407) [these kinds of situations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1408) [Remember that mutation almost](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1410) [always invalidates your indices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1412) [You might get away with it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1413) [sometimes, but it's really best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1415) [to just treat this as a hard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1416) [rule.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1418) [You'll be much happier for it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1418) [Also remember that slices hold](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1420) [on to the underlying original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1422) [state of the collection even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1424) [after it was mutated, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1425) [because of that, really think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1426) [twice about holding onto indices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1428) [or slices when the underlying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1430) [collection is mutable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1431) [And keep in mind that index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1433) [computation can sometimes take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1434) [nontrivial amount of time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1436) [So take care to only calculate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1439) [So take care to only calculate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1439) [indices as needed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1440) [So a little bit later, let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1441) [bring threads into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1444) [discussion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1444) [I mentioned that one of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1445) [questions that I ask is are your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1446) [threads accessible for multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1448) [threads?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1449) [And the reason why I ask this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1450) [because our collections assume](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1453) [that you will access them from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1454) [single thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1455) [And this is a really good thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1457) [for reasons of performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1458) [It makes it so that all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1460) [single-threaded use cases don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1461) [have to pay the tax of locks or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1462) [any of those other primitives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1464) [that you could use to ensure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1466) [mutual exclusion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1467) [And when threads are involved,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1470) [only developers using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1471) [collections will have all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1472) [information needed to restrict](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1473) [access with the appropriate lock](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1475) [or a serial queue at a much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1476) [higher level abstraction than us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1478) [lowly framework developers could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1479) [ever offer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1480) [So let's see what these kinds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1480) [problems could look like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1483) [Let's suppose we have an array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1485) [that we aim to fill up with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1486) [sleeping bears, and to simulate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1487) [each bear being their own bear](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1489) [and in charge of themselves,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1492) [we're going to get access to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1492) [concurrent dispatch queue that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1493) [we'll use to tell each bear to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1496) [go to sleep.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1497) [And because this is a concurrent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1498) [dispatch queue, it's some time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1499) [dispatch queue, it's some time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1499) [helpful to like imagine the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1501) [running at the same time, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1502) [I'll simulate by putting them on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1504) [the same line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1505) [And later in our application,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1506) [let's go ahead and check in on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1508) [those sleeping bears, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1509) [sometimes we'll see grandpa and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1511) [cubs snoozing happily.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1513) [Other times, cub will go to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1515) [sleep first, and then it'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1517) [grandpa.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1518) [Sometimes, quite mysteriously,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1519) [only grandpa is sleeping in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1521) [And other times, it'll be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1523) [cub, and sometimes our program](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1525) [just up and crashes, and nobody](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1528) [bear's getting any sleep.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1530) [All of these possibilities](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1532) [suggest that there's a possible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1533) [race condition, and indeed, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1534) [seems likely given all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1536) [potential threads involved in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1537) [this example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1539) [And we can prove this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1541) [ourselves using the thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1541) [sanitizer or TSAN that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1542) [included within Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1544) [And if we were to do so, we'd](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1545) [get output that kind of looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1547) [like this, and indeed, TSAN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1548) [would catch the race.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1550) [It would tell us there's a Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1551) [access race.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1553) [It would tell us which threads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1554) [are involved and give us a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1555) [summary at the end telling us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1558) [which line to actually go start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1559) [which line to actually go start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1559) [looking for our problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1560) [And all that evidence is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1562) [actually going to be really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1563) [helpful to find the bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1564) [So we've proven that there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1566) [bug here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1567) [TSAN has never lied in my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1568) [experience with them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1570) [So we can fix this by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1572) [eliminating the bears' ability](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1574) [to go to sleep at the same time,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1575) [and we'll do that with a serial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1576) [dispatch queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1577) [And now only one bear can go to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1579) [sleep at a time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1580) [And so if we peek in on our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1581) [sleeping bears again now, taking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1582) [care to do so on the appropriate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1585) [queue, we see that sure enough](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1586) [grandpa and cub are snoozing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1589) [away peacefully like we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1590) [expected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1591) [So my advice for working with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1593) [collections for multiple threads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1595) [is try to isolate your data so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1596) [that it can only be seen from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1598) [single thread, and when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1599) [can't do that, make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1600) [you have an appropriate form in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1602) [mutual exclusion, such as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1603) [serial dispatch queue or locks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1605) [And always use the thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1607) [sanitizer to double check your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1609) [work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1610) [It's far better to catch bugs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1610) [before they ship in your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1612) [than after.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1613) [And I have a little bit more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1614) [advice for working with mutable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1616) [collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1617) [The first of which is if you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1619) [The first of which is if you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1619) [avoid it, don't use mutable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1621) [state at all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1622) [So far all the difficulties that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1624) [I've described have come about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1625) [because we've been working with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1626) [mutable state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1627) [You can avoid all the potential](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1628) [for this complexity by avoiding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1630) [mutable collections in the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1631) [place.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1632) [Many times you can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1633) [emulate the mutations that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1634) [want to perform by using a slice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1636) [or using a lazy wrapper, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1638) [it's almost always easier to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1640) [understand data that cannot](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1641) [change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1642) [And thanks to mutability being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1643) [built into Swift, the compiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1645) [will help you if you're leaving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1647) [a state mutable when you're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1648) [actually mutating it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1649) [Now I have one more piece of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1652) [advice that actually concerns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1653) [how best to use mutable state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1655) [when you have to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1656) [And that's when you're forming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1658) [new collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1659) [You can help performance if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1660) [you're lucky enough to know an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1661) [exact count or a really good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1662) [approximation of how many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1665) [elements you're actually going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1666) [to need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1667) [Most collection APIs have a way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1667) [of being able to provide this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1669) [hint, and when you do this, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1670) [get exactly the size you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1671) [with no overhead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1673) [If you don't, our collections](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1674) [are general purpose tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1676) [They're meant to work on a wide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1678) [variety of cases, and as you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1679) [variety of cases, and as you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1679) [incrementally add elements, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1680) [may actually end up over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1681) [allocating the amount of storage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1683) [that you need, but taking care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1684) [that you don't over estimate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1686) [when providing such hints,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1687) [because otherwise you'll find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1689) [yourself in the same exactly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1690) [situation where you're using up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1691) [more storage than you actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1692) [need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1693) [And now, I want to move on to my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1694) [final topic for today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1696) [And that's the wide range of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1697) [collections that become](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1700) [available for you when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1700) [import Foundation and when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1702) [should consider using them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1704) [In addition to the standard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1706) [library collections, when you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1708) [import Foundation, you gain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1709) [access to the great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1710) [reference-type collections that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1711) [objective C developers have been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1712) [using for decades.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1714) [And many of these also gain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1715) [conformance in Swift and thus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1717) [behave just the collections that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1719) [we've been talking about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1720) [That said, there are a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1722) [important things to keep in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1723) [mind.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1724) [First thing to keep in mind is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1724) [that these NS [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1728) [collections are reference types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1728) [And this is best examined by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1730) [considering an example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1731) [We're going to define value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1733) [types and reference types and do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1734) [the same things with them on two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1735) [sides.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1737) [So with our value type, we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1738) [call it x.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1739) [call it x.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1739) [It will be an array of strings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1740) [We get an empty array called x.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1742) [With a reference type, we get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1745) [empty array, but x is pointing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1746) [to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1748) [We then mutate that array with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1750) [the value type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1752) [That array is mutated in line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1752) [With the reference type, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1754) [array is, the reference, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1756) [array that is being referenced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1757) [is mutated in line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1759) [We add another variable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1761) [With the value type, something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1762) [really special happens.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1764) [We actually don't copy the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1765) [storage at this point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1766) [Why is an array that knows that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1767) [its storage is actually owned by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1769) [x?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1770) [And why is that actually going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1771) [to perform that copy until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1773) [either of those collections is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1774) [mutated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1775) [The reference type is a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1776) [bit different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1777) [Y is just another pointer to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1778) [same underlying array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1780) [So let's go ahead and mutate y.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1783) [We'll put another bear in that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1784) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1785) [With the value type what happens](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1786) [is first we invoke that copy on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1787) [write machinery.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1788) [We're writing to a y, so we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1789) [to copy it, and then we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1791) [insert the next bear.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1793) [With the reference, it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1795) [little bit simpler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1797) [There's only one array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1798) [We simply put the panda in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1799) [We simply put the panda in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1799) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1800) [There's a second thing that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1801) [need to keep in mind when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1804) [working with the foundation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1805) [collections in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1807) [And that is, all objective-C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1808) [APIs in Swift appear as Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1811) [native value types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1813) [And this is actually really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1814) [wonderful because it let's code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1815) [in each language speak naturally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1816) [with the types that they work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1818) [with best.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1819) [But how can this work?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1821) [The two languages have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1822) [completely different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1822) [implementations for these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1823) [collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1824) [And the reason why it works is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1825) [something known as bridging.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1827) [Bridging is how we convert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1829) [between the two different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1830) [runtime representations, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1831) [this is something that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1833) [necessary because Swift and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1833) [objective-C, I'm sure you've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1835) [noticed, are very different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1836) [languages with very different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1837) [compile and runtime features.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1839) [And while we've optimized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1842) [bridging to be as fast as it can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1843) [be, it's not free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1844) [There will always be a cost when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1846) [bridging between the two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1848) [languages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1848) [So what happens when we bridge?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1850) [Well, when we bridge between the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1852) [language, we have dispersed set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1854) [up new storage, equivalent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1855) [storage, so if you're taking n](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1857) [things in one language, you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1858) [take up n space in the next one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1859) [take up n space in the next one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1859) [Then we need to go element by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1861) [element and convert potentially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1862) [between them, and this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1864) [per-element bridging can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1865) [sometimes be recursive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1866) [For instance, if I have an array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1867) [of strings, first we'll bridge](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1868) [the array, and then we'll bridge](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1870) [each individual string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1871) [And when this happens at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1872) [boundary between the two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1874) [languages, we call it eager](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1875) [bridging.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1876) [And collections will always be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1877) [bridged eagerly when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1879) [elements of the collection need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1881) [bridging as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1882) [And this arises most often with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1883) [dictionaries keyed by strings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1885) [When collection bridging is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1887) [eager, we call it lazy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1889) [And this happens when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1891) [element types of the collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1892) [aren't bridged themselves, such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1893) [as NSViews.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1895) [In this case, bridging will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1896) [deferred until the collection is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1898) [actually first used.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1899) [Let's make this concrete with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1900) [some examples.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1902) [We'll first consider an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1903) [objective-C API describing an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1904) [NSArray of NSDatas.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1905) [Now NSArray is bridged to array,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1907) [and NSData is bridged to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1909) [value-type data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1911) [And so such a collection would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1912) [be bridged eagerly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1913) [I mentioned a moment ago that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1914) [NSViews are not bridged in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1917) [Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1918) [They remain reference types in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1918) [They remain reference types in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1918) [Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1920) [And so an NSArray of NSViews](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1920) [will be lazily bridged.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1923) [The bridging won't happen until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1924) [you first access or try to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1925) [that array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1927) [And finally, an NSDictionary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1930) [with keys that are NS strings](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1933) [will be bridged eagerly because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1935) [the strings need to come across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1937) [in Swift as value-type strings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1938) [So now that we know what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1942) [bridging is, how it works, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1942) [when it happens, we can move on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1944) [to the most important question](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1946) [of all, which is when should you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1947) [care about it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1948) [And the answer is really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1949) [straightforward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1950) [When you measure it negatively](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1951) [impacting your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1952) [Specifically, when you take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1955) [time profile or trace an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1957) [instrument, pay special](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1957) [attention to where your code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1959) [crosses between the languages,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1960) [especially when this happens](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1961) [inside a loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1962) [Some bridging is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1964) [happen, and that's totally okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1965) [What you're looking for though](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1967) [is a disproportionate amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1968) [time or a surprising amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1970) [time spent in code that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1971) [didn't write that has the word](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1973) [bridge in it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1974) [Let's look at a concrete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1976) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1977) [Suppose I have a manuscript for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1978) [Suppose I have a manuscript for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1978) [a great children's story that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1980) [I'm working on, but it's really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1981) [long, so I'm only going to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1982) [a little bit here, but to really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1983) [make it pop, I want to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1985) [every word or every instance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1987) [the word brown actually be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1989) [color brown, and in the interest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1991) [of space, I'm only going to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1992) [highlighting the first word.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1993) [To do this, I'm going to use an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1994) [NS mutable attributed string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1997) [I'll pass my story in there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=1998) [And then using the attributed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2001) [strings string property, I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2003) [ask for the range of the Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2005) [string brown, which will produce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2006) [a range of strings native index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2008) [type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2009) [And as mutable string works with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2010) [NS ranges, and so I'll use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2012) [convenience initializer that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2013) [introduced last year to convert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2014) [to an NS range, and this, I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2017) [calling again attributed strings](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2019) [string property to do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2021) [conversion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2023) [And then we'll color the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2024) [instance of the word brown.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2025) [And when I go to run this code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2027) [I notice it's a little slow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2028) [So I profile it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2030) [And I see that, to my surprise,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2032) [I thought all the time would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2034) [spent coloring the word brown,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2035) [but indeed, it's actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2036) [computing the indices, and why](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2037) [is that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2038) [And the reason for that is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2039) [And the reason for that is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2039) [we're actually bridging our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2041) [string multiple times across](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2042) [languages.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2043) [Mutable attributed string is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2044) [objective-C reference type, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2045) [so when we're asking for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2048) [string property, we're actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2049) [having to convert from an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2050) [NSString to a string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2051) [And we're doing it once here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2052) [when we calculated the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2055) [range, and we're doing it a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2056) [second time when we convert for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2057) [the NSRange.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2058) [You can imagine how expensive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2059) [this would be if we did this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2061) [a loop looking for all the text](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2062) [to color.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2064) [Now let's look into why this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2064) [happening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2066) [Every time I call text.string,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2067) [we start in a Swift execution](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2069) [context.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2070) [However, the implementation of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2071) [NSMutableAttributedString is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2073) [objective-C, and so in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2074) [provide the result, we actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2075) [have to consult the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2077) [implementation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2078) [The original implementation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2080) [returns an NSString, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2081) [the reference type, and so when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2083) [return to string, it needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2084) [bridged, graphing cluster by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2087) [graphing cluster, character by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2088) [character.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2091) [And bridging happens whether](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2091) [it's a return type or a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2095) [parameter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2097) [So now that we know those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2101) [details, we can make, now we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2102) [actually make this a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2104) [better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2106) [Let's just bridge once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2106) [And let's remeasure our code and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2107) [see that indeed we've improved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2111) [our performance by half.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2112) [But it turns out this year we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2113) [can do a little better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2114) [Oh, and also, now we're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2116) [bridging where we do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2118) [But this year we can do a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2119) [bit better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2120) [This year, if we actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2121) [[inaudible] to an NSString when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2123) [we ask for the text.string's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2124) [property, when we get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2125) [variable out, no bridging is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2126) [actually going to occur.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2128) [And further, by doing so, now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2130) [that string is an NSString, when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2132) [we call the range of property,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2135) [we're actually going to get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2136) [NSRange out of it automatically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2137) [We won't need to do any of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2139) [range conversion between Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2140) [native types and the NS ranges,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2142) [which is pretty excellent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2144) [So let's measure this code and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2146) [see how it is, and sure enough,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2147) [this looks pretty good.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2149) [Much, much faster than the, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2150) [know, almost 800 milliseconds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2151) [that we were consuming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2152) [previously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2153) [However, I do want to point out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2154) [that we're still bridging here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2156) [And it's a teeny, tiny bridge,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2157) [but we're still bridging.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2159) [but we're still bridging.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2159) [Brown here is a Swift value type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2161) [string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2163) [And every time we call into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2164) [objective-C API range of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2167) [[inaudible] NSString, we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2169) [actually going to bridge that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2170) [teeny, tiny string back to an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2171) [NSString.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2173) [This is inexpensive in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2174) [case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2175) [I'm only doing it once, but you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2176) [can imagine, if this was in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2177) [loop, that small amount would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2178) [add up over time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2180) [And so you want to take care to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2181) [avoid bridging the same small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2183) [strings repeatedly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2184) [However, before you do such](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2185) [optimizations, always measure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2186) [And so now that we've seen the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2189) [details of bridging, I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2190) [offer a little bit of advice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2191) [about when to use Foundation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2192) [collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2193) [You should consider using them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2194) [explicitly when you need a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2196) [collection with reference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2198) [semantics.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2199) [Don't need to write one of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2200) [for yourself, we already have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2201) [many great ones.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2202) [You should also use it when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2203) [you're working with types that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2204) [you know to be reference types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2205) [Things like NS proxies or core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2207) [data managed objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2208) [And the final time to consider](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2209) [using them is when you're round](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2212) [tripping with objective-C code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2213) [but I'd recommend strongly doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2215) [this only after you've measured](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2216) [and identified that bridging is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2218) [indeed the culprit for whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2219) [indeed the culprit for whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2219) [performance problems you may be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2220) [seeing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2221) [And now, we've reached the end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2223) [of today's dive into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2225) [incredible power of our world's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2226) [collections in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2227) [I want you to use this new-found](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2228) [understanding to review your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2230) [existing use of collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2232) [Look for places where you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2234) [improve your code through more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2235) [effective use of indices and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2236) [slices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2237) [Measure your code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2238) [And look for places where you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2240) [could benefit by being lazy or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2241) [by tuning how you bridge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2244) [Use the thread sanitizer to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2246) [audit your mutable state, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2248) [further hone your mastery of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2250) [collections by apply all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2251) [concepts discussed today in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2253) [Playgrounds and you own apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2254) [Be sure to visit our last few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2257) [labs today if you have any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2258) [questions about collections.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2259) [We're here to help.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2261) [Thank you so much for you time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2262) [Now go out and be effective.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2263) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/229/?time=2265)