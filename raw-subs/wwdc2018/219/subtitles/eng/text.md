# Image and Graphics Best Practices

## Summary
Whether it's for UI elements or a fundamental part of your application, at some point, you have to handle images. This session is packed with engaging insight into how images are handled in iOS including discussion of UIImage, UIImageView, custom drawing in UIKit, plus advanced CPU and GPU techniques that can help you maximize performance and minimize memory footprint.

## Info
* Media
* WWDC 2018 - Session 219 - iOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=18) [&gt;&gt; Hello, everybody.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=24) [Welcome to Image and Graphics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=26) [Best Practices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=27) [My name's Kyle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=28) [I work on UIKit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=29) [And today, I'm going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=30) [sharing with you some techniques](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=32) [and some strategies for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=33) [efficiently working with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=35) [graphical content in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=36) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=37) [We're going to take a tour of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=39) [the framework stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=40) [First, we're going to start with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=41) [UIImage and UIImageView, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=43) [are UIKit's high level tools for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=45) [working with graphical content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=48) [in your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=49) [Then, we're going to focus on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=51) [how you can best do custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=52) [drawing inside of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=54) [applications with UIKit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=55) [And finally, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=57) [touch, briefly, on integrating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=58) [touch, briefly, on integrating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=58) [advanced CPU and GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=60) [technologies into your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=62) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=64) [And throughout this talk we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=66) [going to be focusing primarily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=67) [on our use of two scarce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=69) [resources on the device; memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=71) [and CPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=74) [And we tend to think of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=76) [things as separate quantities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=77) [They have their own tracks in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=79) [the debug navigator.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=80) [They have their own instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=82) [in the instruments application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=83) [But really, they're intricately](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=85) [linked.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=87) [And it might be apparent that as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=88) [your application uses more CPU,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=91) [that has a negative impact on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=94) [the battery life and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=96) [responsiveness of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=98) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=99) [But what might be less obvious](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=99) [is that as your application and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=102) [other applications on the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=104) [consume more memory, that also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=106) [causes more CPU utilization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=109) [Which, has further detrimental](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=111) [effects on battery life and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=112) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=115) [So, we're going to focus on how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=115) [to improve our use of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=117) [resources.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=118) [What better context for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=119) [What better context for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=119) [discussing this problem than an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=123) [application that works pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=124) [extensively with photographic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=125) [content, like the Photos app?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=127) [You see, we're editing a photo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=130) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=131) [And as I mentioned previously,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=131) [UIImages, UIKits, high level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=133) [class for dealing with image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=136) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=138) [So, we have a UIImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=138) [representing this rich content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=140) [And we tend to divide graphical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=143) [content in our applications into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=144) [two categories; rich content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=146) [like this photograph and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=148) [iconography.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=149) [UIImage is also the data type in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=151) [UIKit that we use to represent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=153) [things like the icon displayed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=155) [in this button.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=157) [And as I mentioned previously,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=158) [UIImageView is the class that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=162) [UIKit provides for displaying a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=164) [UIImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=166) [Now, in classical MVC style](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=167) [UIImage can be thought of as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=172) [model object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=174) [And UIImageView, of course, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=175) [the name implies, is a view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=177) [And these objects in their roles](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=178) [And these objects in their roles](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=178) [as model and view, have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=181) [traditional responsibilities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=182) [UIImage is responsible for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=184) [loading image content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=186) [And UIImageView is responsible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=188) [for displaying it, for rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=189) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=192) [Now, we can think of this as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=193) [simple relationship that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=194) [establish once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=195) [It's a one-way relationship.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=197) [Bu the actual story is a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=199) [bit more complicated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=200) [In addition to rendering being a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=203) [continuous process, rather than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=205) [a one-time event, there's this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=206) [hidden phase.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=208) [It's really important to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=210) [understand in order to measure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=211) [the performance of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=213) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=213) [And this phase is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=214) [decoding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=215) [But in order to discuss](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=217) [decoding, I first need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=218) [discuss a concept called a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=220) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=221) [A buffer is just a contiguous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=222) [region of memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=224) [But we tend to use the term](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=226) [buffer when we're discussing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=227) [memory that's composed of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=229) [sequence of elements of the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=230) [size, usually, of the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=233) [internal construction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=235) [And for our purposes, one really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=237) [important kind of buffer is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=239) [important kind of buffer is an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=239) [image buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=241) [This is a term we use for buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=242) [that holds the in-memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=244) [representation of some image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=245) [Each element of this buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=248) [describes the color and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=250) [transparency of a single pixel](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=252) [in our image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=255) [And consequently, the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=256) [this buffer in memory is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=259) [proportional to the size of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=260) [image that it contains.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=262) [One particularly important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=265) [example of a buffer is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=266) [the frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=269) [And the frame buffer is what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=271) [holds the actual rendered output](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=272) [of your application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=274) [So, as your application updates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=276) [its view hierarchy UIKit will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=278) [render the application's window](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=281) [and all of its subviews into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=283) [frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=285) [And that frame buffer provides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=286) [per pixel color information that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=288) [the display hardware will read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=290) [in order to illuminate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=292) [pixels on the display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=293) [Now, that last part happens at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=298) [fixed interval.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=299) [fixed interval.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=299) [It can happen at 60 fps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=300) [So, every 1/60th of a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=303) [Or on an iPad with ProMotion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=305) [Display, it can happen as fast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=308) [as every 1/120th of a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=309) [And if nothing's changed in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=312) [application, the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=315) [hardware will get the same data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=316) [back out of the frame buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=317) [that it saw, previously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=319) [But as you change the content of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=321) [the views in your application,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=325) [for example, you assign a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=326) [UIImage to our image view, here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=328) [UIKit will re-render your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=331) [application's window into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=332) [frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=334) [And the next time the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=334) [hardware pulls from the frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=336) [buffer it'll get your new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=337) [content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=339) [Now, you can contrast an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=340) [buffer to another kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=343) [buffer, a data buffer, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=344) [just a buffer that contains a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=346) [sequence of bytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=347) [In our case, we're concerned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=349) [about data buffers that contain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=351) [image files.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=353) [Perhaps, we've downloaded them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=354) [from the network or we've loaded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=355) [them from disk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=357) [A data buffer that contains an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=359) [A data buffer that contains an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=359) [image file, typically, begins](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=360) [with some metadata describing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=362) [the size of the image that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=364) [stored in that data buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=365) [And then, contains the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=367) [data itself, which is encoded in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=369) [some form like JPEG compression](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=371) [or PNG.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=373) [Which means that the bytes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=373) [subsequent to that metadata](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=377) [don't, actually, directly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=379) [describe anything about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=380) [pixels in the image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=382) [So, we can take a deeper look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=387) [this pipeline that we've set up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=388) [We have a UIImageView here and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=391) [we've highlighted the region of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=392) [the frame buffer that will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=394) [populated by the image view's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=395) [rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=397) [And we've assigned a UIImage to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=398) [this image view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=400) [It's got a data buffer that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=401) [represents the content of an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=403) [image file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=404) [Perhaps, downloaded from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=405) [network or read from disk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=406) [But we need to be able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=409) [populate the frame buffer with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=410) [per pixel data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=412) [So, in order to do that UIImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=415) [will allocate an image buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=418) [whose size is equal to the size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=420) [of the image that is contained](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=422) [in the data buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=423) [And perform an operation called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=424) [decoding that will convert the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=426) [JPEG or PNG or other encoded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=430) [image data into per pixel image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=432) [information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=435) [And then, depending on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=437) [content mode of our image view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=438) [When UIKit asks the image view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=440) [to render it will copy and scale](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=442) [the image data from the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=446) [buffer as it copies it into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=447) [frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=449) [Now, that decoding phase can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=450) [CPU intensive, particularly, for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=455) [large images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=457) [So, rather than do that work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=458) [every time UIKit asks the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=460) [view to render, UIImage will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=462) [hang onto that image buffer, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=464) [that it only does that work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=466) [once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=468) [Consequently, your application,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=469) [for every image that gets](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=471) [decoded, could have a persistent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=472) [and large memory allocation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=474) [hanging out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=476) [And this allocation, as I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=477) [mentioned earlier, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=479) [mentioned earlier, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=479) [proportional to the size of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=480) [input image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=482) [Not necessarily, the size of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=483) [image view that's actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=484) [rendered in the frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=485) [And this can have some pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=487) [negative consequences on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=489) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=490) [The large allocation that is in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=492) [your application's address space](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=494) [could force other related](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=496) [content apart from content that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=498) [it wants to reference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=500) [This is called fragmentation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=501) [Eventually, if your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=505) [starts accumulating a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=507) [memory usage the operating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=509) [system will step in and start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=510) [transparently compressing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=512) [content of physical memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=514) [Now, the CPU needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=516) [involved in this operation so in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=518) [addition to any CPU usage in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=519) [your own application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=521) [You could be increasing global](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=523) [CPU usage that you have no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=525) [control over.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=526) [Eventually, your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=528) [could start consuming so much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=530) [physical memory that the OS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=531) [needs to start terminating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=533) [processes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=535) [And it'll start with background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=536) [processes of low priority.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=537) [And, eventually, if your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=539) [And, eventually, if your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=539) [application consumes enough](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=541) [memory, your application itself](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=542) [could get terminated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=544) [And some of those background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=546) [processes are doing important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=547) [work on behalf of the user.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=548) [So, they might get started up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=549) [again as soon as they get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=550) [terminated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=551) [So, even though your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=553) [might only be consuming memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=555) [for a short period of time, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=556) [can have this really long-tail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=558) [effect on CPU utilization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=560) [So, we want to reduce the amount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=564) [of memory that our application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=565) [uses.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=566) [And we can get ahead of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=567) [curve with a technique called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=568) [downsampling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=570) [Now, here we see a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=572) [more detail about our image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=574) [rendering pipeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=575) [Including the fact that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=577) [image view we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=578) [display our image in is actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=579) [smaller than the image we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=581) [going to display inside of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=582) [Normally, the core animation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=584) [framework would be responsible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=587) [for shrinking that image down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=588) [during the rendering phase, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=590) [we can save some memory by using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=592) [this downsampling technique.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=594) [And what we're going to do,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=595) [essentially, is capture that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=596) [shrinking operation into an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=598) [shrinking operation into an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=598) [object called the thumbnail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=601) [And we're going to wind up with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=603) [a lower total memory usage,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=604) [because we're going to have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=608) [smaller decoded image buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=609) [So, we set up an image source,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=612) [create a thumbnail, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=614) [capture that decoded image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=616) [buffer into UIImage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=618) [And assign that UIImage to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=619) [image view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=622) [And then, we can discard the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=622) [original data buffer that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=624) [contained our image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=625) [And we're left with a much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=626) [smaller long-term memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=628) [footprint for our application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=629) [The code to do that has a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=631) [steps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=633) [So, I'm going to walk you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=633) [through them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=634) [I'm not going to do extremely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=634) [low-level detail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=636) [But I'll highlight the important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=637) [bits.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=639) [First, we're going to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=640) [CGImageSource object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=641) [And CGImageSourceCreate can take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=643) [an option dictionary.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=646) [And the important option we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=647) [going to pass here, is this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=648) [ShouldCache flag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=650) [And this tells the Core Graphics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=652) [framework that we're just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=653) [creating an object to represent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=654) [the information stored in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=657) [file at this URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=659) [file at this URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=659) [Don't go ahead and decode this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=661) [image immediately.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=663) [Just create an object that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=664) [represents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=665) [We're going to need information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=666) [from this URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=667) [Then, we're going to calculate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=669) [on the horizontal and vertical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=672) [axis.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=674) [Based on the scale that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=674) [going and point size we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=676) [to render at, which is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=678) [larger dimension in pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=680) [Calculate that information, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=682) [then create an options](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=684) [dictionary for our thumbnail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=685) [There are a couple of options](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=688) [listed here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=689) [You can look in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=690) [documentation for exactly what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=690) [these options do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=692) [But the very important one is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=692) [this CacheImmediately option.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=694) [By passing this option here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=697) [we're telling Core Graphics that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=700) [when I ask you to create the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=702) [thumbnail that's the exact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=703) [moment you should create the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=705) [decoded image buffer for me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=707) [So, we have exact control over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=709) [when we take that CPU hit for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=711) [decoding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=712) [Then, we create the thumbnail,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=715) [which is a CGImage, that we get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=717) [back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=719) [back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=719) [Wrap that in the UIImage and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=720) [return it from our helper](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=721) [function that we've written](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=722) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=723) [So, to give you an idea of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=724) [magnitude of savings that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=726) [technique gives us, we're just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=728) [displaying the full screen image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=730) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=731) [This is a photograph.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=731) [It's 3,000 by 2,000 pixels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=732) [If we do no optimization, just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=734) [throw UIImageView in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=736) [storyboard and assign our image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=737) [to it, this application takes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=739) [31.5 megabytes just sitting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=740) [doing nothing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=743) [Now, using this downsampling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=744) [technique and only producing an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=747) [image buffer that's the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=749) [the actual display, we can get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=750) [the memory usage of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=752) [application down to 18.4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=753) [megabytes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=755) [And that is a huge reduction in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=756) [memory usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=758) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=761) [Thanks for the applause, but you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=764) [should all get the applause for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=765) [implementing this technique in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=766) [your applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=767) [You can imagine how much of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=768) [big deal this is for an app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=771) [that's displaying a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=772) [potentially large input images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=774) [in a small space on screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=776) [For example, the Camera Roll.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=779) [For example, the Camera Roll.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=779) [You might implement such a view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=782) [using UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=784) [So, here we've implemented cell](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=785) [for item at indexPath.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=786) [And we're using our helper](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=788) [function that we wrote earlier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=790) [to downsample the images to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=791) [size that they're going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=793) [displayed at when the cell is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=794) [actually put on the screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=796) [So, you think this is a pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=799) [good thing to do, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=801) [Like rather than having these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=802) [large allocations hanging](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=803) [around, we're reducing our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=804) [memory usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=806) [Unfortunately, that doesn't save](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=807) [us from another problem that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=809) [common in scrollable views like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=810) [table views and collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=812) [views.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=813) [It's a, probably seen this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=815) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=816) [You scroll through an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=817) [application and it starts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=817) [hitching as you scroll.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=819) [What's happening here is that as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=821) [we're scrolling the CPU is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=824) [relatively idle, or the work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=826) [that it does can be done before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=829) [the display hardware needs the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=830) [next copy of the frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=832) [So, we see fluid motion as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=835) [frame buffer is updated and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=838) [display hardware is able to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=839) [display hardware is able to get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=839) [the new frame on time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=840) [But now, we're about to display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=843) [another row of images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=844) [And we're about to ask Core](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=846) [Graphics to decode those images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=847) [before we hand the cells back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=850) [UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=851) [And that could take a lot of CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=853) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=854) [So much so, that we don't get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=856) [around to re-rendering the frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=857) [buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=859) [But the display hardware is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=860) [operating on a fixed interval.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=861) [So, from the user's perspective](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=863) [the application has just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=866) [stuttered.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=868) [Now, we're done decoding these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=869) [images, we're able to provide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=870) [those cells back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=871) [UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=872) [And animation continues on, as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=874) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=876) [Just saw a visual hitch, there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=877) [Now, in addition to the obvious](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=880) [responsiveness consequences of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=882) [this behavior, there's a more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=884) [subtle detrimental effect on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=886) [battery life.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=888) [Because iOS is very good at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=890) [managing the power demand on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=892) [batter when there is a smooth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=894) [constant demand on the CPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=897) [And what we have here are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=899) [And what we have here are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=899) [spikes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=900) [As new rows are about to come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=901) [into view on the scroll view,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=903) [we're spiking the CPU usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=905) [And then, returning back down to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=908) [a low level.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=909) [So, there are two techniques we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=910) [can use to smooth out our CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=913) [usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=916) [The first one is prefetching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=917) [And if you want to know a whole](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=919) [lot about prefetching check out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=921) [the A Tour of CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=924) [Talk from this year's WWDC.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=925) [But the general ideas here, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=927) [that prefetching allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=929) [CollectionView to inform our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=930) [data source that it doesn't need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=932) [a cell right now, but it will in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=934) [the very near future.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=936) [So, if you have any work to do,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=937) [maybe, you can get a head start.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=939) [That allows us spread out CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=940) [usage out over time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=942) [So, we've reduced the maximum](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=945) [size of the CPU usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=946) [Another technique we can use is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=948) [performing work in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=951) [background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=952) [So, now that we've spread out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=953) [work over time we can, also,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=954) [spread it out over available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=955) [CPUs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=957) [The consequences of this are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=958) [The consequences of this are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=958) [that your application is more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=963) [responsive and the device has a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=964) [longer battery life.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=967) [So, to put this in action here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=968) [we've got a implementation of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=971) [the prefetch method on our data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=973) [source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=975) [And it's going to call our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=976) [helper function to produce a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=977) [downsampled version of the image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=979) [that we're about to display in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=983) [this CollectionView cell.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=984) [And it does this by dispatching](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=985) [work to one of the global](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=988) [asynchronous queues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=990) [Great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=993) [Our work is happening in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=994) [background.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=994) [This is what we wanted to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=995) [But there is a potential flaw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=997) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=999) [And it's a phenomenon that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1000) [like to call thread explosion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1002) [And this is what happens when we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1004) [ask the system to do more work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1006) [than there are CPUs available to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1007) [do it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1010) [If we're going to display a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1011) [whole number of images, like 6-8](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1012) [images at a time, but we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1014) [running on a device that only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1015) [has 2 CPUs, we can't do all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1017) [that work at once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1019) [that work at once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1019) [We can't parallelize over CPUs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1020) [that don't exist.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1022) [Now, to avoid deadlock when we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1023) [dispatch asynchronously to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1027) [global queue, GCD is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1028) [create new threads to capture](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1031) [the work we're asking it to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1034) [And then, the CPUs are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1035) [spend a lot of time moving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1037) [between those threads to try and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1038) [make incremental progress on all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1040) [of the work we asked the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1042) [operating system to do for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1043) [And switching between those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1045) [threads, actually, has a pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1046) [significant overhead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1048) [We'd do a lot better if one or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1049) [more of the CPUs just got a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1053) [chance to get images out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1055) [door.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1057) [So, we're going to borrow a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1059) [technique that was presented](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1059) [last year in the Modernizing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1062) [Grand Central Dispatch Usage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1064) [talk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1065) [And we're going to synchronize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1066) [some work, or I'm sorry.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1067) [Not synchronize, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1068) [serialize some work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1069) [So, rather than simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1072) [dispatching work to one of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1074) [global asynchronous queues,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1075) [we're going to create a serial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1078) [queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1079) [And inside of our implementation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1081) [of the prefetch method we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1082) [going to asynchronously dispatch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1085) [to that queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1086) [Now, it does mean that an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1087) [individual image might not start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1089) [making progress until later than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1090) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1092) [But it also means that the CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1093) [is going to spend less time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1095) [switching between bits of work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1097) [that it can do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1098) [Now, these images that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1101) [displaying can come from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1102) [number of places.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1103) [They might come with our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1105) [application, in which case they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1106) [might be stored in an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1108) [asset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1109) [Or they might be stored in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1110) [file instead of our application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1111) [wrapper.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1112) [Or they could come from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1113) [network.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1114) [Or they could be in a document](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1115) [that's stored in the application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1117) [documents directory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1119) [They could be stored in a cache.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1120) [But for artwork that comes with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1123) [your application, we strongly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1125) [encourage you to use image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1127) [assets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1129) [And there are a number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1130) [reasons why.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1132) [Image assets are optimized for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1134) [name based and trait-based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1136) [lookup.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1137) [It's faster to look up an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1138) [It's faster to look up an image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1138) [asset in the asset catalog, than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1140) [it is to search for files on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1141) [disk that have a certain naming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1143) [scheme.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1144) [The asset catalog runtime has,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1145) [also, got some really good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1148) [smarts in it for managing buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1150) [sizes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1151) [And there are, also, some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1152) [features unrelated to runtime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1154) [performance that are exclusive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1156) [to image assets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1157) [Including features like per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1159) [device thinning, which mean that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1160) [your application only downloads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1161) [image resources that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1163) [relevant to the device that it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1164) [going to run on and vector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1165) [artwork.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1167) [The vector artwork was a feature](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1170) [that was introduced in iOS 11.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1172) [And you enable it by checking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1173) [the Preserve Vector Data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1174) [checkbox in the editor for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1176) [image asset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1178) [And the upshot of this is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1179) [if your image gets rendered in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1182) [an image view that is larger or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1183) [smaller than the native size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1185) [the image it doesn't get blurry.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1186) [The image is, actually,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1189) [re-rasterized from the vector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1190) [artwork so that it has nice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1191) [crisp edges.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1193) [One place that we use this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1195) [the operating system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1197) [If you turn on dynamic type to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1198) [If you turn on dynamic type to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1198) [very large size in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1200) [Accessibility settings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1201) [And then you tap and hold on an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1203) [item in the tab bar a little HUD](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1205) [shows up as a magnified view of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1207) [the item that you're currently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1210) [holding your finger over.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1211) [So, if you want your artwork to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1214) [look good in places like this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1216) [check the Preserve Vector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1218) [Artwork checkbox in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1219) [I'm sorry.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1221) [The Preserve Vector Data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1222) [checkbox in the image asset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1222) [inspector.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1225) [Now, the way this works is very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1226) [similar to the pipeline we saw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1227) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1229) [Rather than a decode phase, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1229) [have a rasterize phase that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1232) [responsible for taking the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1234) [vector data and turning it into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1235) [bitmap data that can be copied](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1238) [to the frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1239) [Now, if we had to do this for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1245) [all of the vector artwork in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1246) [your application we would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1247) [consuming a lot more CPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1249) [So, there's an optimization we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1250) [make here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1252) [If you have an image that has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1253) [Preserve Vector Data checked,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1255) [but you render it at the normal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1257) [size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1258) [The asset catalog compiler has,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1259) [The asset catalog compiler has,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1259) [actually, already produced a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1262) [pre-rasterized version of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1265) [image and stored it in the asset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1266) [catalog.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1268) [So, rather than doing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1269) [complicated math of rasterizing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1270) [your vector artwork into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1272) [bitmap, we can just decode that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1274) [image that's stored in the asset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1277) [catalog and render it directly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1278) [into the frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1281) [If you're planning on rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1284) [artwork at a few fixed sizes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1287) [Maybe, you have a small version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1289) [and a large version of an icon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1291) [Rather than relying on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1293) [Preserve Vector Data checkbox,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1295) [create two image assets that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1297) [have the two sizes that you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1299) [you're going to render your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1301) [image at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1302) [That will allow the optimization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1304) [to take the CPU hit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1307) [rasterizing your artwork at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1309) [compile time, rather than every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1311) [time the image is drawn into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1313) [frame buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1316) [So, we've seen how to work with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1318) [UIImage and UIImageView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1320) [But that's not all of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1322) [graphical work that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1324) [application does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1325) [Sometimes, your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1326) [draws content at runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1327) [The example of this happening](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1332) [might be seen in something like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1334) [this editing view in the Photos](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1336) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1338) [The UIButton that's displaying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1340) [an icon and UIButton can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1343) [UIImageView directly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1346) [But UIButton doesn't support the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1348) [style of this Live button, here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1349) [that you can tap to enable or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1352) [disable the Live Photo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1353) [So, we're going to have to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1356) [some work here, ourselves.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1357) [And one implementation of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1358) [might be to subclass UIView and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1361) [implement the draw method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1363) [And this implementation here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1365) [draws a yellow roundRect, draws](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1367) [some text, and an image on top](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1369) [of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1371) [Don't recommend this approach](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1373) [for a couple of reasons.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1375) [Let's compare this view subclass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1378) [Let's compare this view subclass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1378) [to our UIImageView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1382) [Now, as you may already be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1383) [aware, every UIView is,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1385) [actually, backed by a CALayer in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1387) [the Core Animation runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1389) [And for our image view, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1391) [image view creates the, asks the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1393) [image to create the decoded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1395) [image buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1397) [And then, hands that decoded](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1398) [image over to CALayer to use as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1400) [the content of its layer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1403) [For our custom view that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1405) [overrode draw, it's similar, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1407) [slightly different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1410) [The layers responsible for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1411) [creating an image buffer to hold](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1412) [the contents of our draw method,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1414) [and then our view, excuses draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1416) [function and populates the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1419) [contents of that image buffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1422) [Which is then, copied into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1423) [frame buffer as needed by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1425) [display hardware.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1427) [In order to understand how much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1434) [this is costing us and why we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1436) [should, perhaps, pursue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1437) [alternative ways of implementing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1438) [this UI.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1439) [this UI.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1439) [The backing store that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1441) [using here, the image buffer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1442) [that's attached to the CALayer,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1444) [the size of that is proportional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1446) [to the view that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1448) [displaying.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1449) [Now, one new feature and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1451) [optimization that we have in iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1452) [12 is that the size of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1453) [elements in that backing store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1456) [will, actually, grow dynamically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1459) [depending on whether you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1461) [drawing any color content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1462) [And whether that color content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1464) [is within or outside of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1465) [standard color range.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1467) [So, if you're drawing wide color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1468) [content using extended SRGB](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1470) [colors, the backing store will,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1472) [actually, be larger than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1474) [backing store would be if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1477) [used only colors within the zero](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1478) [to one range.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1481) [Now, in previous versions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1482) [iOS, you could set the contents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1485) [format property on CALayer as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1487) [hint to Core Animation saying,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1489) [''I know I am not going to need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1491) [to support wide color content in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1493) [this view'', or, ''I know I am](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1494) [going to need to support wide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1496) [color content in this view''.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1497) [Now, if you do this, you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1498) [Now, if you do this, you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1498) [actually going to be disabling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1500) [the optimization that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1502) [introduced in iOS 12.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1503) [So, check your implementations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1505) [of layerWillDraw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1507) [Make sure you're not going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1508) [accidentally defeat an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1510) [optimization that could benefit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1510) [your code when running on iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1512) [12.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1513) [But we can do better than just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1516) [hinting at whether we need a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1519) [wide color capable backing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1521) [store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1523) [We can, actually, reduce the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1523) [total amount of backing storage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1525) [that our application needs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1526) [We can do that by refactoring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1527) [this larger view into smaller](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1529) [subviews.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1531) [And reducing or eliminating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1532) [places that override the draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1534) [function.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1536) [This will help us eliminate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1537) [duplicate copies of image data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1539) [that exist in memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1541) [And it will allow us to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1542) [optimized properties of UIView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1543) [that don't require a backing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1546) [store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1547) [So, as I mentioned, overriding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1548) [the draw method will require](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1552) [creating a backing store to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1553) [with your CALayer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1555) [But some of the properties in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1556) [UIView can still work, even if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1558) [UIView can still work, even if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1558) [you don't override draw.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1560) [For example, setting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1561) [background color of a UIView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1563) [doesn't require creating a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1564) [backing store, unless you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1566) [using a pattern color.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1568) [So, I recommend not using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1569) [patterned colors with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1570) [background color property on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1571) [UIView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1572) [Instead, create a UIImageView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1574) [Assign your image to that image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1577) [view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1579) [And use the functions on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1580) [UIImageView to set your tiling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1581) [parameters appropriately.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1583) [When we want to clip the corners](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1585) [of that rounded rectangle, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1589) [want to use the CALayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1592) [cornerRadius property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1593) [Because Core Animation is able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1595) [to render clipped corners](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1597) [without taking any extra memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1600) [allocations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1601) [If we, instead, use the more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1603) [powerful maskView or maskLayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1604) [properties we'd wind up taking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1606) [in extra allocation to store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1609) [that mask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1610) [If you have a more complicated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1613) [background that has transparent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1615) [areas that can't be expressed by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1616) [the cornerRadius property,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1619) [the cornerRadius property,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1619) [again, consider using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1620) [UIImageView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1621) [Store that information in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1623) [asset catalog or render it at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1625) [runtime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1627) [And provide that as an image to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1628) [the image view, rather than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1629) [using maskView or maskLayer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1631) [Finally, for that icon, the Live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1634) [Photo icon, UIImageView is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1637) [capable of colorizing monochrome](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1640) [artwork without taking any extra](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1643) [allocations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1645) [The first thing you want to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1647) [is either check the, not check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1649) [the checkbox, but set the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1651) [property in the image asset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1652) [editor, the render mode property](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1653) [to always template.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1656) [Or use the withRenderingMode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1657) [function on UIImageView to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1659) [create a UIImage whose rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1661) [mode is always template.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1662) [Then, assign that image to an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1664) [image view and set the tintColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1665) [of that image view to the color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1667) [you want the image to render in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1669) [UIImage, as it's rendering your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1672) [image to the frame buffer, will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1673) [apply that solid color during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1675) [that copy operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1678) [that copy operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1678) [Rather than having to hold on to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1680) [a separate copy of your image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1682) [with your solid color applied to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1683) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1687) [Another optimization built into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1688) [UIKit provided view, UILabel is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1689) [able to use 75% less memory when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1692) [displaying monochrome text than](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1696) [when displaying color text or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1698) [emojis.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1699) [If you want to know more about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1701) [how this optimization works in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1702) [detail and how to apply it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1704) [your custom subclasses of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1705) [UIView, check out the iOS Memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1707) [Deep Dive session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1709) [Goes into great detail about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1711) [this backing store format called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1712) [A8.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1715) [Sometimes, you want to render](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1718) [artwork offscreen stored in an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1721) [image buffer in memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1724) [And the class UIKit provides to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1725) [do that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1727) [UIGraphicsImageRenderer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1728) [There's another function that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1730) [older;](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1732) [UIGraphicsBeginImageContext.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1733) [But please, don't use that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1735) [Because only Graphics Image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1737) [Renderer is capable of correctly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1738) [Renderer is capable of correctly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1738) [rendering wide color content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1740) [What you can do in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1742) [applications is use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1744) [UIGraphicsImageRenderer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1745) [render to an offscreen place.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1747) [And then, use UIImageView to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1749) [display that, efficiently, on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1750) [the screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1752) [Similarly, to the optimization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1754) [that we've introduced in CALayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1756) [backing stores.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1759) [We've, also, made](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1760) [UIGraphicsImageRenderer capable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1762) [of dynamically growing the size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1764) [of its image buffer, depending](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1766) [on the actions you perform in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1767) [the actions block.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1770) [If you are running your code on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1773) [a operating system prior to iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1775) [12, you can use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1777) [prefersExtendedRange property on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1778) [UIGraphicsImageRendererFormat to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1781) [tell UIKit whether you plan on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1783) [drawing wide color content or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1785) [not.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1787) [But there's a medium middle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1790) [ground here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1792) [If you're primarily rendering an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1793) [image in to a graphic image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1795) [renderer, that image may use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1796) [color space that required values](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1799) [color space that required values](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1799) [outside of the range of SRGB.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1802) [But doesn't, actually, require a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1805) [larger element size to store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1807) [that information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1809) [So, UIImage has a image renderer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1810) [format property that you can use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1813) [to get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1815) [UIGraphicsImageRendererFormat](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1816) [object preconstructed for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1817) [optimal storage of re-rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1819) [that image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1821) [Lastly, we're going to talk a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1827) [little bit about how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1827) [integrate advanced CPU and GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1828) [technologies that we provide in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1831) [iOS into your applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1832) [So, if you've got a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1836) [advanced processing to do to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1838) [your images, perhaps, in real](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1840) [time, consider using Core Image.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1842) [Core Image is a framework that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1846) [allows you to create a recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1848) [for processing an image and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1849) [handle that on the CPU or on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1851) [GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1853) [If you create a UIImage from a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1855) [CIImage and hand that to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1857) [UIImageView, UIImageView will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1859) [UIImageView, UIImageView will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1859) [take care to execute that recipe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1861) [on the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1864) [This is efficient and it keeps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1865) [the CPU free for doing other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1868) [work in your application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1869) [In order to use it create your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1871) [CIImage as normal, and then use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1873) [the UIImage ciImage initializer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1875) [There are other advanced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1879) [frameworks for processing and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1880) [rendering graphical content that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1883) [are available on iOS, including](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1885) [Metal, Vison, and Accelerate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1887) [And one of the data types that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1890) [is common among these frameworks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1892) [is CVPixelBuffer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1893) [And this is a data type that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1895) [represents a buffer that can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1897) [in use or not in use on the CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1899) [or on the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1902) [When constructing one of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1904) [pixel buffers make sure to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1905) [the best initializer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1907) [The one that's closest to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1908) [representation you have at hand.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1909) [Don't unwind any of the decoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1912) [work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1914) [It's already been done by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1915) [existing UIImage or CGImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1917) [representations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1919) [representations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1919) [And be careful when moving data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1921) [between the CPU and the GPU, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1922) [that you don't just wind up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1924) [trading off work between the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1926) [two.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1927) [You can, actually, get them to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1927) [execute in parallel.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1928) [Finally, check out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1931) [Accelerate and simd session for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1932) [information on how to properly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1934) [format your buffers for being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1936) [processed by the Accelerator](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1938) [framework.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1939) [So, to summarize a few key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1940) [points.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1944) [Implement prefetch in your table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1945) [views and collection views, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1947) [that you can get some work done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1948) [in advance and avoid hitching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1949) [Make sure that you're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1953) [defeating any optimizations that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1954) [UIKit is providing to reduce the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1956) [size of the backing stores](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1958) [associated with your views.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1960) [If you're bundling artwork with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1963) [your applications store it in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1965) [the asset catalog.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1966) [Don't store it in files that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1969) [associated with your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1970) [And finally, if you're rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1973) [the same icons at different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1975) [sizes don't over-rely on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1976) [Preserve Vector Data checkbox.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1978) [Preserve Vector Data checkbox.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1978) [For more information there is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1982) [couple of related sessions,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1984) [including one about actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1986) [investigating your performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1988) [problems.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1991) [And we'll also have labs,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1992) [tomorrow and Friday.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1994) [And if you have any questions,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1995) [come see us in the labs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1997) [Thanks for watching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=1998) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/219/?time=2001)