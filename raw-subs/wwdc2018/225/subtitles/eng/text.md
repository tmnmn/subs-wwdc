# A Tour of UICollectionView

## Summary
UICollectionView is a flexible, powerful tool to help you achieve great user experiences in your applications. Hear how you can leverage these rich APIs to rapidly move from initial design ideas to polished shipping applications. Topics range from getting started to advanced update animations and layouts.

## Info
* Frameworks
* WWDC 2018 - Session 225 - iOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=22) [&gt;&gt; Well, good afternoon and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=30) [welcome to a tour of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=30) [UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=32) [My name is Steve Breen-- I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=34) [set this over here-- and I'm a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=35) [frameworks engineer on the UIKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=36) [team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=38) [And I'm joined on stage today](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=39) [with my colleague, Mohammed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=41) [Jisrawi, also on the UIKit team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=42) [So today we're going to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=48) [something a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=49) [different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=50) [We're going to build an app from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=51) [some specs we receive from our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=52) [designer, Breanka [phonetic],](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=54) [and this is going to leverage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=56) [many of the capabilities of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=57) [UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=58) [Now, while we work through all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=60) [the tasks required to build our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=62) [app, we're going to touch on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=63) [wide range of topics regarding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=65) [UICollectionView including](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=67) [layouts, updates, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=68) [animations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=70) [So we've got a ton of ground to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=72) [cover, so let's jump right in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=74) [All right, so here's the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=77) [spec we got from our designer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=79) [It looks like a friends feed,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=80) [imagine that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=81) [A great little columnar layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=82) [It looks pretty straightforward,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=84) [okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=88) [Okay, this looks great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=89) [So here we've got this really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=90) [fancy looking mosaic layout,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=91) [which is the contents of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=93) [friends feed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=94) [Okay, so Mohammed, since you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=96) [going to be writing all the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=97) [for us and walking us through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=98) [how to use these features, what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=99) [are your thoughts on these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=101) [designs?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=102) [&gt;&gt; Well, you know, I'm seeing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=103) [these for the first time, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=104) [they seem like great candidates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=105) [for collection view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=107) [I think we can have a lot of fun](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=108) [with this one, especially.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=109) [&gt;&gt; Yeah, this one looks great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=110) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=111) [So before we dive into code, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=112) [Mohammed starts walking us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=115) [through this, we need to cover](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=116) [three core concepts we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=118) [three core concepts we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=118) [understand about CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=120) [before we dive right into that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=121) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=122) [So let's do these now, and we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=122) [going to talk about the layout,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=124) [data source, and the delegate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=126) [Okay. So, first of all, let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=130) [chat a little bit about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=131) [layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=132) [So if you open up the definition](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=133) [for UICollectionView for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=135) [very first time, and you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=136) [familiar with UITableView, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=138) [notice right away that there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=140) [lot of familiarity in the API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=141) [You got a delegate and a data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=142) [source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=145) [All these things look pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=145) [familiar, but the layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=146) [concept, that's pretty unique](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=148) [and distinct to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=150) [UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=152) [You can really think of it as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=153) [UICollectionView's super power.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=154) [It allows CollectionView to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=156) [abstract away the visual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=158) [arrangement from your content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=159) [separate from the content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=161) [itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=162) [Layout is all about the where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=164) [content is displayed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=166) [Now, each individual item is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=168) [specified by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=172) [UICollectionView layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=173) [attributes, for attributes like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=174) [such as bound, center, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=176) [frame, things like that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=178) [You can think of it as a set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=179) [You can think of it as a set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=179) [properties you can use to define](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=180) [these items that are displayed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=182) [You can even customize these by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=183) [printing your own subclasses of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=186) [UICollectionView layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=187) [attributes and include these in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=188) [your designs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=190) [Okay. So as the user is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=192) [scrolling through the content on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=194) [screen, the layout is considered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=196) [to be immutable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=198) [Now if you need to change this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=200) [like for example you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=202) [change the appearance of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=203) [layout, you would use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=204) [invalidation mechanism, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=206) [Mohammed will walk us through in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=208) [a little bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=209) [Okay. Now, one great thing about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=211) [layout being a separate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=213) [abstraction is we can transition](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=215) [from one layout to another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=217) [layout and get a great animated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=218) [effect when you move between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=220) [layouts, and layout A doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=222) [need to know anything about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=224) [layout B.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=226) [They just declare what the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=227) [layout is going to be, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=228) [transitions occur.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=229) [Okay. So CollectionViewLayout is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=231) [an abstract class, and as such,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=234) [it's not meant to be used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=236) [directly, but rather subclasses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=238) [directly, but rather subclasses](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=238) [of CollectionViewLayout are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=240) [meant to be used.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=241) [Fortunately, we provide one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=244) [UICollectionViewFlowLayout, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=246) [you're probably familiar with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=248) [this class if you used](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=249) [CollectionView before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=250) [Now there's a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=251) [customization points on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=253) [CollectionViewLayout including](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=255) [some properties that we'll talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=256) [about in a little bit, but you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=257) [can also customize it using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=259) [delegate, and we'll talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=261) [the CollectionViewDelegate in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=263) [moment, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=264) [CollectionViewFlowLayout will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=265) [specify additional things that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=268) [extend that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=270) [CollectionViewDelegate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=271) [Okay, so what's Flow all about?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=274) [Well it's a line-based layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=275) [system, and because of this, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=277) [can cover a wide range of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=279) [different designs that you might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=281) [receive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=283) [All right, so what does line](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=286) [base mean?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=287) [Well let's go through this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=288) [So the best way to explain what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=289) [a line based system is like is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=291) [to give an example, so let's do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=294) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=295) [Okay. So here we see, we've got](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=296) [a vertical scrolling collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=297) [view, and we're going to mimic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=299) [view, and we're going to mimic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=299) [what flow layout does when it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=301) [lays out this content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=302) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=304) [So here's our first item, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=305) [start at the top leading edge,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=307) [and we start laying out our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=310) [items along a line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=312) [Now look at this line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=314) [This line is orthogonal to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=315) [scroll axis.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=317) [We're scrolling vertically, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=318) [the line is horizontal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=318) [Okay, now notice here, we filled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=321) [up the available space for items](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=322) [on that line, so now we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=324) [to drop to the next line and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=325) [continue laying out our content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=328) [And finally, we drop to that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=330) [last line, and bingo, we got all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=332) [our content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=334) [Now if I dropped some guides on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=336) [here to show highlight where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=338) [those lines are horizontal,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=339) [let's talk about some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=342) [definitions that we have for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=343) [ways to customize flow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=345) [First up is the notion of line](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=347) [spacing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=349) [And as you see the arrows here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=350) [the line spacing is going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=352) [the space between these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=353) [horizontal lines.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=354) [Similarly, inter-item spacing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=356) [Similarly, inter-item spacing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=356) [the space between the items](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=360) [along the layout line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=362) [And we have two properties on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=363) [flow layout that let you specify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=364) [the minimums for both of these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=366) [Okay. So let's cement our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=368) [intuition a little bit and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=371) [rotate the whole thing, pi over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=372) [2, and let's start over at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=373) [top leading edge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=375) [Now, this one is scrolling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=377) [horizontally, right, so we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=379) [going to have a vertical layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=380) [line, and when we get to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=382) [bottom of this area, we filled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=384) [out that line, back up to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=385) [top.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=387) [Okay. This pattern is pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=388) [familiar now, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=389) [There we go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=391) [There's all our content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=392) [Now we have our vertical layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=394) [lines.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=395) [So now in this orientation, our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=396) [line spacing is this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=399) [And our inter-item spacing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=401) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=404) [It's key to remember when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=405) [working with flow layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=406) [Okay, so that's layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=408) [Let's talk a little bit about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=410) [the data source, and if you work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=412) [with TableView, this should look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=414) [very familiar.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=416) [It's a very similar pattern.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=417) [They share very similar APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=419) [They share very similar APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=419) [Okay, so if the layout is all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=420) [about the where content goes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=423) [the data source is the what.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=426) [The content itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=427) [Three core methods to think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=429) [about here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=431) [The first one is optional,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=431) [number of sections in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=432) [CollectionView, and this one if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=433) [you don't provide it, we'll just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=436) [assume you mean one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=436) [Similarly, we have number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=439) [items in section, and this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=441) [going to tell you the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=442) [items in each individual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=444) [section, because they can all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=445) [have different numbers of items.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=446) [And then the last one, sell for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=447) [item index path is where you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=449) [provide the actually content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=450) [you're going to display to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=451) [users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=452) [Okay. So that's the data source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=453) [Okay, the final of our three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=456) [topics we're going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=457) [before we dive into code with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=459) [Mohammed is the Delegate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=460) [Okay. So use of the Delegate is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=462) [optional.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=465) [Now, CollectionView is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=467) [subclass of UIScrollView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=468) [So we use the same Delegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=470) [that's provided by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=472) [ScrollView superclass, but we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=474) [extend it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=476) [So if you need to modify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=477) [scrolling behavior, you can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=478) [scrolling behavior, you can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=478) [it also against this same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=480) [Delegate and also work with some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=481) [of the UICollectionViewDelegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=483) [methods that provide things like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=486) [fine-grained control over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=488) [highlighting and selection as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=489) [the user interacts with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=491) [content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=492) [And we also got an API that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=493) [let's you know, hey, something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=495) [came on screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=497) [WillDisplayItem and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=498) [DidEndDisplayingItem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=499) [Okay. So those are the three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=501) [core concepts we really need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=504) [talk about before we dive into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=506) [code to get started with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=508) [UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=510) [So let's switch over to the dev](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=510) [box with Mohammed and have him](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=512) [show us how it works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=514) [Mohammed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=515) [&gt;&gt; All right, so the first of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=515) [our two screens that column](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=518) [layout is a great use case for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=520) [using CollectionViewFlowLayout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=522) [We can probably accomplish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=525) [everything we need there, and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=526) [would be a great way to get us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=527) [started using UICollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=530) [So now while we could accomplish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=534) [the entire goal of our design](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=536) [with a flow layout, I'm actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=538) [with a flow layout, I'm actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=538) [going to subclass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=540) [CollectionViewFlowLayout because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=541) [we're going to do a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=542) [of extra customization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=543) [So I'm going to start out by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=544) [creating an instance of my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=547) [ColumnFlowLayout class, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=550) [I've already prepared.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=552) [I'm going to use that instance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=553) [to create my CollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=555) [I'm going to take that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=557) [CollectionView, and I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=558) [set some view properties, like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=559) [auto resizing mask, background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=561) [color, and since it's the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=563) [ScrollView, I can set some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=565) [it's ScrollView properties as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=566) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=568) [This is all just to get it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=568) [look and feel the way I want it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=569) [to look in our app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=571) [After adding the CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=573) [to my view hierarchy, I'm going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=574) [to register my PersonCell class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=576) [using its unique identifier with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=578) [CollectionView so we can get our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=580) [cell design to app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=582) [And then I'm going to set the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=585) [view controller as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=586) [CollectionView's data source so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=587) [we can give it some information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=589) [about how many cells it's going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=591) [to display and what sort of data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=592) [it's going to display in it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=594) [cells.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=595) [And then I'm going to set it as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=596) [it's delegate as well, so we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=599) [it's delegate as well, so we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=599) [handle cell selection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=600) [So now that we've gotten set up,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=602) [we need to actually conform to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=604) [these two protocols.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=605) [So let's start out by conforming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=607) [to the data source, and we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=610) [two required methods we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=612) [implement here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=614) [The first of these is number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=614) [items in section where we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=617) [just return the number of people](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=620) [or the number of items in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=622) [people array to get our data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=623) [model objects displayed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=626) [The second method we'll need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=628) [implement is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=630) [CellForItemAtIndexPath where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=632) [we'll dequeue a cell from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=634) [CollectionView using our unique](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=636) [identifier, pass a person and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=637) [object that we get out of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=641) [people array, to the cell to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=642) [actually display our data, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=644) [then return the cell.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=647) [And to wrap things up here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=650) [we'll just need to implement one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=652) [optional method from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=654) [Delegate protocol, so we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=656) [handle selection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=658) [So I'm just going to add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=659) [So I'm just going to add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=659) [DidSelectItemAtIndexPath where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=660) [we'll just instantiate our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=664) [FeedView controller, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=666) [going to be our second screen if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=667) [we don't already have an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=669) [instance, and then we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=670) [to pass it a person object so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=672) [know whose images to display,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=674) [and then we'll push it onto our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=677) [navigation controller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=679) [Okay. So let's build this and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=681) [switch to the simulator to see.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=684) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=689) [[ Applause and Cheering ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=690) [Okay. So we have our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=694) [CollectionView on screen here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=695) [and we have some cells.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=697) [You can see them, though they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=699) [kind of squished.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=701) [They're not the right size, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=702) [we're going to have to do some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=704) [of that customization we thought](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=705) [we might need to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=706) [So let's go back to Xcode, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=707) [let's pop open our column of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=711) [class here, our ColumnFlowLayout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=715) [class that we've put together,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=720) [and let's take a look at what we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=723) [need to do here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=726) [So I already have a stub](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=727) [override of the layouts prepare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=730) [method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=732) [Now,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=733) [UICollectionViewLayoutsPrepare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=734) [method is called whenever the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=735) [layout is invalidated, and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=737) [the case of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=739) [UICollectionFlowLayout, our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=739) [layout is invalidated whenever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=742) [the CollectionView's bounds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=744) [size changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=746) [So if our app rotates on a phone](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=747) [or if our app is resized on an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=749) [iPad.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=752) [So this is a great place to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=753) [any customization that takes the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=755) [size of the CollectionView into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=759) [account.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=761) [In our case, we want our cells](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=761) [to be some function of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=762) [CollectionView's width.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=765) [And we can let the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=767) [CollectionView know how big we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=768) [want our items to be by saying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=771) [it's item sized properties.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=773) [So I'm going to go ahead and do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=774) [that here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=775) [So I'm just going to set my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=777) [CollectionView's item size to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=778) [CollectionView's item size to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=778) [CG size with a width that is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=781) [width of the CollectionView's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=783) [bounds, inset by its layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=784) [margins, and then we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=787) [give it a height of 70 points](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=788) [just to match our design.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=790) [And since we're already here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=794) [I'm going to do a couple of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=794) [other little things here just to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=795) [get things to look nice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=797) [I'm going to apply a section](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=799) [inset with some padding at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=801) [top that matches our inter-item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=802) [spacing, and I'm going to set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=804) [the layout section inset](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=806) [reference property to from safe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=808) [area so everything is neatly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=810) [tucked within the CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=812) [safe area insets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=813) [Okay. So let's go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=815) [simulator one more time and see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=817) [what our properly constructed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=819) [layout looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=820) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=821) [That looks great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=823) [That looks just like our spec. I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=824) [think our designer is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=827) [be really happy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=827) [And if we rotate to landscape,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=828) [we see that our cell is a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=832) [size, and so we know that our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=833) [invalidation code is getting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=835) [called again in prepare.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=836) [Now while this is okay, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=839) [Now while this is okay, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=839) [might be thinking, it's not the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=841) [best that we can do here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=843) [It doesn't look as great as it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=844) [can.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=847) [We might want to do something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=848) [more interesting here like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=849) [display multiple columns since](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=850) [we have the space available to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=852) [us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=854) [Now flow layout makes it really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=855) [easy to do this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=856) [If you remember during Steve's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=858) [explanation of how flow layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=859) [performs it's layout earlier,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=861) [flow layout will automatically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=862) [try to fit in as many items as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=864) [it can within a line before it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=866) [wraps to the next one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=868) [So using that, we can kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=870) [figure out that layout-- that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=873) [can get multiple columns if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=876) [change our item size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=877) [So if we head back to Xcode, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=879) [our layout here, and if we just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=881) [change how we're calculating our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=884) [item size here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=886) [So I'm just going to remove this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=887) [fit here, and I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=890) [replace it with something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=892) [does a little bit of extra math.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=894) [So I'm just starting out with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=896) [the same available width that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=898) [had before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=899) [had before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=899) [This is the bounds inset by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=900) [margins, and some arbitrary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=902) [definition of what a minimum](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=905) [column width is, it's 300](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=907) [points.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=910) [And then taking both of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=911) [values and using them to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=914) [calculate a maximum number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=915) [column that I think I can fit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=917) [within the available space, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=918) [I'm taking that and dividing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=921) [available width by it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=923) [calculate an optimal cell width,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=924) [which might be more than our 300](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=926) [points.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=929) [I'm then passing that to the CT](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=930) [size that I'm using as my item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=932) [size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=933) [Okay. So let's go back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=934) [simulator again and see what our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=937) [updated layout looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=939) [Okay. So everything is the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=942) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=943) [We didn't break it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=943) [It's a good start, and if we go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=944) [to portrait, there are our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=947) [multiple columns side by side,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=950) [just what we want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=951) [What do you think, Steve?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=953) [&gt;&gt; That looks great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=955) [We got a great adaptable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=956) [columnar base layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=957) [Not a lot of work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=958) [&gt;&gt; No.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=960) [&gt;&gt; What's next in our design?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=960) [&gt;&gt; Well, now that we've eased](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=962) [ourselves in with our friends](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=962) [list, it's time to start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=964) [thinking about that fancy mosaic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=965) [layout for [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=967) [&gt;&gt; Oh, yeah.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=968) [That's going to be great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=968) [&gt;&gt; Yeah.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=969) [&gt;&gt; Let's switch back over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=969) [slides, and let's chat a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=970) [bit about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=973) [Okay. So let's take a look at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=977) [this layout or design here and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=979) [see what we can do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=981) [So our first inclination, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=982) [don't know about yours, but mine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=983) [would be can I use Flow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=985) [I've got it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=986) [It's ready to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=986) [Let's try to use it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=987) [So let's zero in on this design](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=989) [a little bit and see if Flow is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=990) [going to make sense for us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=992) [And this particular region where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=994) [these three photos are, I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=996) [going to zoom in on that real](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=997) [quick.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=999) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1000) [So now in this instance we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1001) [a very large photo on the left](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1003) [and then a vertical stack on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1005) [right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1007) [So in the flow universe, since](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1008) [it's line based, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1009) [lay out that large left item,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1010) [move over to the next item where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1013) [it's got room, try to lay out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1014) [another item, and then jump to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1015) [the next line.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1017) [But we're not done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1018) [We've got that vertical stack to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1019) [We've got that vertical stack to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1019) [contend with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1020) [So this really is not going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1021) [work for Flow because it turns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1023) [out it's not really a line-based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1024) [layout, this fancy layout of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1027) [ours.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1028) [But going through this exercise](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1029) [is useful, so, you know, let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1030) [start with flow first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1032) [Okay. So in this instance, we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1035) [going to create our own custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1036) [layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1038) [Oh, no, we're scared, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1039) [Nope, it's not complicated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1040) [We've got four basic methods to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1041) [deal with here, and I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1043) [bring up one additional method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1045) [that gets an honorable mention.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1047) [Okay. So four methods.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1049) [Here we go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1051) [Our first method I want to talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1052) [about is the CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1054) [Content Size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1055) [Now, recall before we mentioned](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1057) [CollectionView is a subclass of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1059) [UIScrollView, and one of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1060) [features of UIScrollView is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1062) [you have a visible region with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1064) [large content area, and you get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1065) [that great iOS experience of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1067) [moving your content around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1069) [inside that, and so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1070) [CollectionView needs to know how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1072) [to tell the ScrollView, hey,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1073) [here's how big my content is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1075) [Okay. So how do we get this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1077) [size?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1079) [Well, if you imagine a rectangle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1080) [that encompassed all the content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1081) [that the layout is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1083) [define for your CollectionView,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1084) [we want the size of that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1086) [Okay, so that's CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1089) [Content Size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1091) [Next up we have two methods that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1093) [are in the business of providing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1095) [layout attributes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1097) [The first one is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1099) [LayoutAttributesForElements (in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1100) [Rect).](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1101) [Now this is called periodically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1103) [by CollectionView when it needs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1104) [to know what is needed to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1105) [display on screen as the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1106) [scrolls through your content or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1108) [displays for the first time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1109) [So this query is by a geometric](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1111) [region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1113) [Okay. It's companion API,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1115) [LayoutAttributesForItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1118) [AtIndexPath, as you can imagine,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1119) [it's just looking for a single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1122) [item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1123) [Give me the attributes for that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1123) [Okay, so we're going to see more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1125) [when Mohammed walks us through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1127) [this, but for these two APIs,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1128) [it's important to note that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1130) [performance matters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1131) [Okay, so the fourth of our four](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1137) [core custom layout subclass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1139) [core custom layout subclass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1139) [items is going to be the Prepare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1141) [method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1143) [Now Mohammed has already chatted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1144) [about this a little bit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1145) [This is called every time the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1146) [layout is invalidated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1148) [So this is a great time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1149) [compute anything, such as your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1151) [layout attributes you might want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1152) [to cache and also your content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1153) [size, which is going to be asked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1156) [for pretty soon afterwards.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1157) [Okay. So our honorable mention](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1163) [APIs, so let's talk about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1165) [one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1166) [This is a Should Invalidate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1167) [Layout For Bounds Change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1168) [So this is called every time the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1170) [bounds in the CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1173) [changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1174) [Okay, so again, it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1175) [CollectionView is a UIScrollView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1176) [subclass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1177) [So what do we mean by a bounds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1178) [change?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1180) [Well, when a ScrollView bounds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1181) [change, the origin can change](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1183) [during a scrolling, and also the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1185) [size can change when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1187) [application size changes or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1188) [CollectionView size changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1190) [So this is going to be called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1191) [during scrolling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1193) [Hence the oh yeah emoji.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1195) [This is called very often.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1196) [So making the right decision](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1198) [So making the right decision](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1198) [here is important.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1200) [Okay, so the default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1201) [implementation in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1203) [UICollectionViewLayout returns](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1204) [false.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1206) [So if you need this to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1207) [something different, here's your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1208) [chance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1210) [And as a way of an example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1211) [UICollectionViewLayout will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1213) [return false if the origin](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1216) [changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1218) [Okay, so if the user is just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1218) [scrolling through your content,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1219) [we won't invalidate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1220) [Let it by default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1221) [But if the iPad rotates, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1223) [phone rotates, and your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1225) [changes to a different size,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1226) [it'll return true.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1228) [Now a slight exception to this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1230) [is things like floating headers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1232) [and footers, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1233) [We have to recompute those while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1234) [you're scrolling your content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1235) [That'll do a custom invalidation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1237) [to take care of those things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1239) [Okay. So enough theory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1240) [Let's switch back to our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1242) [development machine and have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1244) [Mohammed walk us through what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1247) [this is going to look like in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1248) [code building this fancy custom,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1249) [UICollectionViewLayout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1251) [&gt;&gt; All right, let's dive right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1253) [in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1255) [So I've already put together](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1256) [another layout subclass that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1258) [another layout subclass that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1258) [we're going to use for this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1260) [layout, and you might notice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1261) [that it's a subclass of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1263) [UICollectionViewLayout directly,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1264) [not a subclass of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1266) [CollectionViewLayout, and this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1267) [is for the reasons that Steve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1269) [explained to us earlier are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1271) [UICollectionViewLayout doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1274) [really meet the needs of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1276) [custom mosaic design.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1277) [So the first thing I'm doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1280) [here is I'm setting up a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1282) [of instance variables that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1283) [going to use to hold onto some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1285) [key pieces of information that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1286) [can refer to later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1288) [The first of these is a content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1290) [bound CG rect, which I'm going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1292) [to use to keep a representative](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1294) [bounds of all the items within](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1297) [my CollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1299) [And the second is a cached](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1300) [attributes array, which I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1303) [going to use to hold onto my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1304) [layout attributes so I can refer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1306) [to them quickly when performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1308) [matters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1309) [So we're going to start out by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1311) [implementing our prepare method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1312) [again for this layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1314) [Prepare is the ideal place to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1316) [the bulk of our layout work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1319) [the bulk of our layout work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1319) [because it's getting called once](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1321) [per invalidation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1323) [We can set up our layout here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1324) [and then avoid having to do any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1326) [heavy layout work or any heavy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1328) [layout math in the methods that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1330) [are called much more frequently.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1332) [So we're doing a couple of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1338) [things here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1339) [First, we're resetting our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1339) [cached attributes and our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1341) [content bounds just to clear out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1343) [any stale information from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1344) [previous invalidations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1346) [Next, we're doing a few things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1349) [for every item in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1352) [CollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1353) [The first of these is actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1355) [preparing the attributes, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1356) [now I'm not going to go too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1358) [deeply into what that entails](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1359) [for our specific layout because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1361) [this is going to be different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1362) [for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1363) [This is where you are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1364) [calculate the sizes and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1366) [positions and transforms, etc.,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1367) [for your cells to match your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1369) [design needs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1372) [But there are a couple of key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1373) [things that we're going to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1374) [here after we are done with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1375) [attributes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1377) [The first is, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1378) [cache them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1379) [We're going to put them in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1379) [We're going to put them in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1379) [cached attributes array so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1380) [can grab them quickly later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1381) [And the second is, we're going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1384) [to union their frame with our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1386) [content bounds rect so that our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1388) [content bounds are kept up to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1390) [date.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1391) [So now that our prepare is up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1393) [and running, we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1395) [implement the remaining methods](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1396) [in our layout that we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1398) [get everything working.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1400) [So the first of these is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1402) [CollectionView Content Size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1405) [where if we had done our job](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1407) [right in Prepare, we can just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1409) [return our Content Bounds as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1410) [size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1412) [Next is should invalidate layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1415) [for bounds change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1417) [Now since our layout doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1419) [have any elements that require](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1420) [us to invalidate while we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1423) [scrolling, so no floating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1424) [headers, no floating footers or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1427) [anything like that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1428) [We only really want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1430) [invalidate when our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1430) [CollectionView's bounds of size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1431) [changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1433) [So we'll just return true if our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1434) [new bounds of size is not equal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1436) [to our CollectionView's bounds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1438) [of size, our current bounds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1439) [of size, our current bounds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1439) [size.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1441) [After that, we'll implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1443) [LayoutAttributesForItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1445) [AtIndexPath where, again, since](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1446) [we've prepared all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1448) [attributes in our Prepare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1449) [method, we can just grab the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1450) [specific attributes that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1452) [correspond to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1454) [RequestAtIndexPath from our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1455) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1457) [And finally, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1458) [implement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1460) [LayoutAttributesForElements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1462) [InRect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1463) [Now this method is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1465) [periodically by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1466) [CollectionView with different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1467) [query rects, which may be bigger](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1469) [than our CollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1471) [Our CollectionView is just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1472) [asking for a set of attributes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1474) [that match a certain region.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1476) [It's our job to return an array](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1478) [that contains all the attributes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1481) [that correspond to all the items](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1484) [that are going to appear within](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1486) [that rect in our CollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1487) [So we can answer that question](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1490) [here simply by filtering our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1492) [cached attributes array on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1494) [frame of the attributes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1497) [frame of the attributes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1497) [So if our attributes have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1500) [frame that intersects our query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1502) [rect, we can return them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1504) [Okay. So let's switch back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1506) [the sim and see what our layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1508) [looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1511) [So I'm going to select one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1512) [these feeds, and there you go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1514) [We have our layout.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1515) [Our images are nicely loaded in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1517) [this fancy mosaic configuration,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1519) [and if we rotate to landscape,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1521) [you can see that our cells have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1523) [resized so we've updated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1525) [everything correctly, we've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1526) [invalidated, which is great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1528) [So this looks like our spec, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1532) [that scrolling performance isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1536) [great, is it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1538) [&gt;&gt; No.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1539) [&gt;&gt; No, it's pretty bad, huh.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1539) [So you might already have an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1541) [idea of what's going on here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1543) [Let's switch back to the code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1544) [and see what might be happening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1545) [So if we take a look at our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1549) [layout attributes or elements in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1550) [rect here, remember that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1551) [method gets called frequently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1554) [during scrolling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1555) [So this function here, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1558) [So this function here, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1558) [filtering our entire array, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1561) [might imagine can get really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1563) [expensive as the number of items](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1565) [in our CollectionView increases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1566) [So the more photos we have in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1568) [our app, the slower our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1569) [scrolling performance is going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1571) [to be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1572) [So if you find yourself in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1574) [situation like this, it helps to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1575) [step back and think about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1577) [nature of your layout and think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1578) [about whether you can find any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1580) [optimization opportunities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1581) [So our layout kind of demands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1584) [that every cell apps next to or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1588) [below it's preceding cell.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1591) [So this means that our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1593) [attributes are already sorted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1594) [within our cached attributes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1597) [array by their frame's minimum y](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1599) [value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1601) [So we have a sorted array, so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1603) [can speed up our search by doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1605) [something like a binary search](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1608) [as opposed to our linear filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1609) [that we're doing now.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1611) [So let's remove our slow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1613) [implementation here, and let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1617) [implementation here, and let's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1617) [replace it with something that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1620) [should be much faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1621) [So I'm going to step through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1623) [this bit by bit, don't worry.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1626) [So the first thing we're doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1628) [here is we're calling into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1630) [binary search function that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1633) [we've already prepared, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1635) [takes in a range of indices](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1636) [within our array and our query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1637) [rect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1640) [If it finds a set of attributes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1642) [with a frame that sits within](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1645) [our rect, it'll return the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1647) [attributes as index within our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1648) [array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1650) [Then starting from that index,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1652) [we can build up the set of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1654) [rest of attributes for our query](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1656) [rect simply by looping up and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1659) [down in our array and picking up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1661) [attributes until we exit our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1663) [query rect, until we find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1666) [attributes that are outside our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1667) [rect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1669) [And this should be much faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1669) [You have thousands of items in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1671) [your array.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1673) [You're not going to loop through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1673) [the array thousands of items,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1675) [thousands of times.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1676) [Okay, so let's go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1678) [Okay, so let's go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1678) [sim again and let's see what our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1680) [faster scrolling algorithm looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1682) [like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1683) [Let's pop this open and give it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1687) [a flick.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1689) [It's way faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1690) [What do you think, Steve?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1691) [&gt;&gt; Much better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1693) [Okay, great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1694) [So we've got these two great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1694) [layouts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1696) [What's next?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1697) [&gt;&gt; So we have our two screens.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1698) [That just leaves our update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1700) [animations for our friends list](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1702) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1704) [&gt;&gt; Oh, great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1704) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1705) [Well let's switch back over to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1705) [slides, and let's walk through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1707) [that totally cool update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1708) [animation I think our designer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1710) [called it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1712) [All right, so we've got a video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1713) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1714) [Let's run through this and see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1715) [what this totally cool update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1716) [animation looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1718) [Okay. So we have some elements](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1719) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1721) [We see that last item is getting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1721) [refreshed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1724) [I guess somebody posted a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1724) [picture, and then we got another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1726) [item there, it looks like, yeah,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1728) [that third item smears is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1729) [going to be here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1731) [Okay. So we've got three basic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1732) [operations happening, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1735) [We've got a reload, a move, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1736) [a delete.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1739) [Why don't we switch back over to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1740) [the dev machine, and Mohammed,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1741) [why don't you show us how this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1743) [works?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1744) [&gt;&gt; Sure thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1746) [Okay, so we're doing multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1748) [animated updates at the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1751) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1752) [So you might be aware of a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1754) [tool that UICollectionView and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1755) [UITableView provide us, and it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1757) [the Perform Batch Updates API,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1759) [which basically allows us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1761) [pass the collection view a set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1764) [of updates that can be performed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1766) [at the same time with animation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1768) [So I'm going to add a call to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1770) [CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1773) [PerformBatchUpdates, and note](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1774) [that I'm doing both my data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1776) [source updates and my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1777) [CollectionView updates in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1778) [closure here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1780) [This is really the best way that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1781) [I have of coordinating my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1783) [updates and keeping things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1785) [neatly in sync and avoiding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1787) [inconsistencies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1788) [So, first I'm just updating my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1790) [last item in my data source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1793) [I'm removing the second to last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1797) [item, picking up the last item,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1799) [item, picking up the last item,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1799) [moving it to the top, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1801) [I'm asking the CollectionView to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1802) [perform the animations that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1804) [want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1805) [Okay. Let's go back to the sim](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1806) [again and see what our update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1808) [looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1810) [So I have wired our update code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1810) [through this update button at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1813) [the top right corner, and uh oh.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1814) [&gt;&gt; What's going on?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1818) [&gt;&gt; Oh, that's embarrassing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1820) [What's going on here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1823) [&gt;&gt; You know, I've been writing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1825) [iOS for a long time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1826) [I've seen this movie before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1827) [&gt;&gt; Yeah, it sucks when it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1829) [happens on stage though.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1831) [You know, we're running out of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1834) [time here, so why don't we just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1836) [call reload data, and we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1837) [come back and do the animations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1839) [for V2.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1841) [&gt;&gt; Really?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1841) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1843) [You know, we could do that, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1848) [then we'd lose that totally cool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1850) [update animation, and our users](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1851) [expect these lively interfaces,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1853) [right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1856) [&gt;&gt; Yeah, yeah, you're right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1856) [You know what?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1857) [They deserve better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1858) [&gt;&gt; Ah, I like the way you think.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1859) [&gt;&gt; Ah, I like the way you think.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1859) [All right, let's switch back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1860) [over to slides real quick, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1861) [let's see if we can save our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1863) [totally cool update animation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1864) [You've seen this before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1867) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1868) [So first of all, let's dig into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1869) [this debug exception and see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1871) [what it's trying to tell us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1872) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1874) [So it's saying here we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1875) [attempting to perform a delete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1876) [and a move from the same index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1878) [path, 0-3.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1880) [So if I remember right, that was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1881) [the fourth item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1882) [We did a reload and a move on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1883) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1884) [We didn't delete it, we deleted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1885) [the third item, 0-2, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1887) [&gt;&gt; I don't remember deleting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1890) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1891) [&gt;&gt; So, yeah, what's up with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1891) [that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1892) [All right, but before we do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1893) [this, let's go back and take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1894) [peek at the PerformBatchUpdates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1896) [API and talk about some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1898) [high-level principles.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1900) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1901) [So as Mohammed mentioned earlier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1901) [when he introduced this API, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1903) [purpose of this API is that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1905) [can commit multiple updates at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1907) [the same time and have anything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1908) [animate together and get that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1910) [great experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1911) [And as he also mentioned, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1914) [super important to perform your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1915) [data source updates alongside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1917) [your CollectionView updates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1919) [your CollectionView updates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1919) [inside that CollectionView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1920) [update closure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1921) [Now, what I'm saying for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1923) [CollectionView also applies for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1924) [TableView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1925) [So if you got TableViews in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1926) [apps, all this information is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1927) [going the same direction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1929) [Okay. So let's make some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1931) [observations here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1932) [The CollectionView updates, when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1934) [you do inserts, moves, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1936) [deletes, the ordering of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1936) [do not matter in your update's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1939) [closure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1940) [Put them anywhere you want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1941) [Now however your data source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1943) [updates, when you're changing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1945) [the structure offer your data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1946) [source, which is backing that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1947) [data source, or does matter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1948) [Okay, so this is best served by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1952) [showing an example, so I'm going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1954) [to take a example of two arrays](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1956) [that have three elements in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1958) [them, and we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1959) [strengthen our intuition on this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1960) [and show a delete and an insert,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1961) [but we're going to do the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1964) [run through with the delete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1965) [first and the second delete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1966) [second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1968) [We're going to reverse the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1968) [order, just to kind of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1969) [strengthen our intuition.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1971) [I do this all the time, draw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1972) [pictures, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1973) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1973) [So we deleted the first item,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1974) [and now we're going to insert at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1977) [index one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1979) [index one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1979) [Okay, on the second example, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1981) [reverse the order and do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1982) [insert first and then the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1983) [delete.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1985) [So our intuition holds, indeed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1986) [we get a different result.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1988) [This is probably not a good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1989) [thing, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1990) [So let's contrast this with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1992) [CollectionView updates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1994) [Now here I have two sets of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1996) [CollectionView updates on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1997) [submit via batch updates, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=1998) [I've left out the data source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2001) [updates, just to keep the slide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2002) [tidy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2003) [But I've got an insert and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2004) [delete on the first one, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2005) [second one has a delete and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2007) [insert, and the order is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2008) [different.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2010) [This will give you the exact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2010) [same result.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2011) [We're all engineers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2013) [We want to know why, why is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2014) [that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2015) [Well, let's talk about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2016) [How does this happen?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2018) [Why is the ordering not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2019) [important for the update sent to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2020) [the CollectionView, and of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2022) [course it is for your data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2023) [source.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2024) [Okay. So let's walk through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2024) [these operation by operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2026) [So the first one to delete, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2027) [is process in descending index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2030) [path order.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2032) [Now let's talk about the index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2033) [paths.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2035) [So first of all, if you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2035) [think about what's happening on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2037) [a PerformBatchUpdate, before the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2038) [batch update starts, your data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2039) [batch update starts, your data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2039) [source is in a before state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2041) [Now once everything is done in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2044) [the batch updates, you'll be an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2045) [after state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2047) [Okay. So for delete, the index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2048) [paths always referred to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2050) [before stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2052) [So that's delete.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2053) [So insert is processed in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2055) [ascending index path order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2058) [paths.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2059) [So the index paths refer to in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2060) [the insert are always referring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2063) [to the final state or the after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2065) [updates stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2067) [Okay, a move is this mixture of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2069) [the two, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2070) [You have a from and a to index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2071) [path, and the from is in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2073) [before state, right, and the to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2075) [is in the after state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2078) [Reload. Now reload is a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2079) [bit of a super command if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2082) [will, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2083) [It actually decomposes down into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2084) [a delete and an insert.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2086) [And the index path specified in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2088) [a reload is speaking about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2091) [before state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2094) [Okay. So this insight now that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2096) [we understand what reload is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2097) [really doing can kind of tell us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2099) [really doing can kind of tell us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2099) [a little bit of what's going on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2100) [with our error in our app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2102) [because of the delete on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2105) [reload on the last one is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2106) [conflicting internally with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2107) [notion of moving that item,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2109) [okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2110) [So we can address this in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2110) [minute when we get back to code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2112) [Okay, so I'm not going to go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2114) [through these, but you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2115) [reason about these later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2116) [Just put it up here as reference](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2117) [that these are the things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2118) [that'll cause CollectionView to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2119) [go bonkers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2121) [Don't do it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2122) [And how can we take all this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2123) [knowledge and simplify it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2127) [distill it in such a way that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2129) [can always apply our data source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2130) [updates from a given set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2132) [CollectionView or TableView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2134) [updates and make sure everything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2135) [is in sync.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2136) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2137) [So these four basic rules.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2137) [So first of all you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2139) [decompose those moves and to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2140) [delete and inserts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2141) [Easy. And then combine all your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2142) [deletes and inserts into two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2144) [separate lists, process the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2145) [deletes first in descending](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2148) [order on the index paths, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2150) [then finally apply those inserts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2152) [in the ascending index path](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2154) [order.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2155) [Do this, and you're good to go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2155) [What about reload data?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2159) [What about reload data?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2159) [And I know Mohammed said we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2160) [could just hit that and we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2162) [done, and everybody laughed so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2163) [I'm pretty sure I yelled and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2164) [that's the case, but the thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2165) [about reloaded data is you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2167) [get those great animations, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2168) [this is really a sledge hammer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2169) [approach.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2171) [So, and we really prefer the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2172) [apps to be lively and animated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2173) [and feel great for our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2175) [customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2176) [So, and this is used in special](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2176) [cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2179) [Okay, Mohammed, let's switch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2180) [back over real quick and see if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2181) [we can get this fixed in code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2183) [and save that totally cool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2184) [update animation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2186) [&gt;&gt; All right, time to redeem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2187) [myself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2188) [&gt;&gt; Yes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2189) [&gt;&gt; So let's use the guidelines](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2189) [that Steve just shared with us](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2192) [to fix our update animation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2193) [So let's remove our existing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2195) [implementation here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2196) [And if you recall, our update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2197) [consisted of a reload, a delete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2200) [and a move, and our reload and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2204) [the move were at the same index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2206) [path.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2208) [They started at the same one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2209) [So that's really where our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2210) [conflict is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2211) [So we'll need to start out by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2212) [separating those two.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2214) [So let's take our reload out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2215) [into its own call to perform](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2217) [batch updates, and here I'm just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2219) [batch updates, and here I'm just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2219) [updating my data source, again,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2224) [same as before, and calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2226) [reload items on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2228) [CollectionView.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2229) [I'm just performing it in a UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2230) [view performed without animation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2232) [closure because if you look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2234) [closely at our spec, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2236) [actually nonanimated, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2238) [initial reload.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2239) [Okay. So next up, we have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2242) [take care of our remaining](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2244) [updates, that delete and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2245) [move.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2249) [And let's reason about them for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2249) [a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2251) [We have a delete at index two,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2252) [and then we're moving the item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2255) [at index three to index zero.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2258) [So if we break down our move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2261) [using the guidelines that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2263) [just learned about, that becomes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2264) [a delete at index 2, a delete at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2267) [index 3, and an insertion of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2270) [item from index 3 at index 0.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2273) [So now we have two sets of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2277) [operations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2280) [We have deletions and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2280) [insertions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2281) [We can process them accordingly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2283) [First, we'll perform our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2285) [deletions in descending order.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2287) [So we'll do our deletion at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2288) [index 3 first, and will hold](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2291) [onto the person from there so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2293) [can insert them later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2295) [And then we'll delete the item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2297) [at index 2.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2299) [Then we'll need to process our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2303) [insertions in ascending order.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2304) [We just have one, so we can just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2306) [go ahead and insert it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2307) [And finally, we'll ask the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2310) [CollectionView to perform the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2311) [animations that we want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2314) [Now, note, I'm still calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2315) [move here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2318) [I didn't break it down into it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2319) [component actions because we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2320) [still want the collection view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2322) [to play the right animations,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2324) [and if we've done the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2325) [thing with our data source, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2326) [CollectionView will do the right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2327) [think in terms of animations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2329) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2331) [Let's go back to the simulator](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2331) [and see what our update looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2333) [like when it works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2336) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2338) [Here goes nothing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2340) [&gt;&gt; Wow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2341) [&gt;&gt; Great!](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2342) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2343) [I'm going to reload and take a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2348) [slow-mo victory lap just to--](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2349) [there we go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2351) [That looks exactly like our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2353) [spec, doesn't it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2355) [&gt;&gt; That's great, awesome.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2356) [All right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2357) [Well let's wrap it up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2358) [We covered a ton of content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2359) [Can you switch it back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2361) [slides?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2362) [And I'd like to issue a bit of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2363) [call to action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2364) [So if you've been nervous or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2365) [anxiety building that custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2369) [layout, take the stuff we just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2370) [applied today and go back and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2372) [dive in and create those custom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2373) [layouts and build really great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2375) [CollectionView solutions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2376) [And if you got a lot of reload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2378) [data sprinkled all throughout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2379) [your apps and you're losing out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2381) [on these gray animations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2382) [They'll inspect those things and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2384) [see maybe why you didn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2385) [understand or something wasn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2386) [quite jived about why it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2387) [happening and fix those spots.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2388) [Okay, so more information, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2392) [can see the link on the slide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2394) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2395) [And we also have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2396) [CollectionView lab tomorrow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2397) [morning at 9.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2398) [If you have any questions or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2399) [If you have any questions or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2399) [comments about your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2400) [CollectionViews, please swing on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2401) [by and chat.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2402) [Mohammed and I will both be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2403) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2404) [And thanks very much for coming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2405) [out, and I hope you enjoy the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2407) [rest of your conference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2408) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/225/?time=2409)