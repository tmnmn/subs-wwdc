# Data You Can Trust

## Summary
A lot can go wrong when loading data into your app. Whether you work directly with JSON and property lists, or with higher-level APIs such as NSCoding and Codable, learn how to defend your customers and secure your code against invalid or malicious data. Avoid fatal assumptions by validating payload structure, type information and domain correctness, to turn the data you work with into data you can trust.

## Info
* Developer Tools
* WWDC 2018 - Session 222 - iOS, macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=22) [&gt;&gt; Good morning, everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=28) [Thank you all for joining me,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=30) [even before the coffee's kicked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=31) [in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=32) [My name is Itai and I work on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=33) [the foundation team.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=34) [In this session, I'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=36) [talk to you about how the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=37) [that flows through your app can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=39) [affect it, and how you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=40) [better protect your customers by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=41) [building trust in that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=43) [Let's get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=45) [Apps don't live in a vacuum.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=47) [In order for your apps to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=50) [something useful, they have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=51) [draw in data from external](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=52) [sources, like the disc, or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=54) [network, or your customers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=55) [themselves.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=56) [And then do something meaningful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=57) [with that data, and then present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=59) [with that data, and then present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=59) [it to your customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=60) [In order for that data to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=62) [consumable, it has to come in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=64) [some known format or structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=65) [What happens when it doesn't?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=68) [Usually, this means the data is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=71) [corrupted, or invalid in some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=73) [way and can be ignored.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=75) [But sometimes, this data can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=77) [invalidate assumptions that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=79) [app makes, and it can cause your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=81) [app to misbehave, or maybe even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=83) [crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=85) [This can be a bad experience for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=86) [your customers who might have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=89) [wait for your app to get updated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=90) [in the app store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=92) [And it's an even worse](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=93) [experience if it's a crash on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=94) [launch, because they can't even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=96) [use the app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=97) [And, in the meantime, while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=98) [you're waiting, you'll get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=99) [wave of one-star reviews.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=101) [It's a bad experience for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=103) [everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=103) [This is something to be even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=106) [more cognizant of, if you're a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=107) [framework author.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=108) [Because it's not just one app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=110) [that could possibly be affected,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=111) [but maybe many apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=113) [Today, we're going to be talking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=116) [about trust.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=117) [And specifically, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=119) [And specifically, we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=119) [be talking about how to build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=120) [trust in data, by making sure of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=122) [two things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=123) [One, that the data that we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=125) [going to be using, hasn't been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=127) [modified from underneath us, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=128) [two that it contains what we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=130) [expect it to in the format and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=132) [structure that we want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=134) [So, we'll do just that by taking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=136) [a look at the lifecycle of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=139) [data, and what we can validate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=140) [about that data at every stage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=142) [in the lifecycle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=144) [Then, we'll see what sort of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=146) [type-level validation we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=148) [apply with the NS Secure coding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=150) [protocol.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=151) [And then apply those same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=152) [concepts to codable types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=153) [Let's get started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=157) [In order to talk about data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=160) [we're going to want to build a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=161) [mental model of the forms that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=162) [data can take within our app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=164) [At the most basic level, data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=167) [makes its way into our app as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=169) [stream of bites.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=171) [There's not much we can tell](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=174) [about this data at this stage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=175) [without looking at it, but this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=176) [we'll call raw data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=178) [we'll call raw data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=178) [Now, to get working with that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=181) [data, we need to make sure it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=183) [conforms to that known format or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=184) [structure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=186) [And in this case, each of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=187) [code points correspond into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=188) [UTF code point, and sorry, one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=191) [moment, let me make that a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=193) [little bit more readable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=194) [It looks like this is JSON.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=195) [And so, once we've made sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=197) [that that data conforms to some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=198) [format that we want to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=200) [with, we'll call this formatted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=201) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=204) [Now, formatted data, on its own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=204) [doesn't mean much, until we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=206) [create primitive values out of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=208) [it, strings, and arrays, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=209) [dictionaries that we can then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=211) [use as building blocks for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=212) [further algorithms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=214) [So, this we'll call our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=215) [primitive data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=216) [Now, there's building blocks we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=219) [most often want to work with,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=220) [not as just primitive values,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=221) [but as our own model types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=223) [So, once we do that, we'll make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=226) [use of this as we're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=228) [call, structure data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=229) [Now, these forms of data in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=232) [apps, form an abstraction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=234) [timeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=237) [Raw data is the least abstract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=239) [Raw data is the least abstract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=239) [data that we're going to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=240) [with, and our own structured](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=241) [model types are the most](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=243) [abstract.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=244) [So, our goal for today is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=245) [take that data as far along the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=247) [spectrum as we can.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=248) [Now, our apps can stop at any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=250) [point, make use of the data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=252) [however, we see fit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=253) [But we really want to work with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=254) [our own model types wherever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=255) [possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=256) [Now, the goal for today is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=258) [not just go as far along the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=259) [abstraction spectrum as we can,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=261) [but to build trust as we do so.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=263) [At every stage, the data is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=266) [going to get more complicated,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=267) [and there's going to be more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=268) [that we need to validate about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=270) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=271) [But once we do that, there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=271) [also going to be more that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=272) [can trust about it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=273) [Now, for our use case today,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=276) [we're not really going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=277) [talking about formatted data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=278) [Very often it's just a stepping](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=280) [stone between raw and primitive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=281) [data, and you don't work with it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=282) [directly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=283) [For instance, given raw data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=285) [foundations JSON serialization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=287) [will give you primitive data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=289) [back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=290) [You don't see just the formatted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=290) [date directly, and you won't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=292) [make use of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=293) [So, today we'll just be talking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=294) [about raw, primitive, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=296) [structured data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=297) [Now, let's start by talking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=300) [about raw data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=301) [Again, as we mentioned, raw data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=302) [is just a stream of bytes that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=304) [made its way into your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=306) [Until you inspect that data and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=308) [you give it meaning, there's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=310) [much you can do with it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=311) [Now, we might care to know what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=313) [we can take a look at about that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=315) [data before we start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=317) [interpreting it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=318) [Is it even safe to do that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=319) [One thing we can validate about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=322) [this data before making use of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=323) [it is its length.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=324) [Say your app expects to load a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=326) [1-kilobyte file from disc, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=327) [finds a 1-gigabyte file in disc.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=329) [Does it make sense to even load](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=332) [that data in the first place,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=333) [and start reading it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=334) [Almost certainly not.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=336) [Now, sometimes we might not be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=338) [able to have length expectations](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=339) [about the data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=341) [Maybe it's external data we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=342) [don't own.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=343) [We don't' know how much data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=343) [there could be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=344) [But in some cases, we might also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=346) [be able to verify a checksum, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=348) [a cryptographic signature that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=349) [represents what the data might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=351) [look like, even if we don't know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=353) [what's inside.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=354) [Checksum is built by hashing all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=356) [of the data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=357) [And if any bit in the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=358) [changes, either due to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=359) [changes, either due to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=359) [potential malicious third party,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=361) [or just regular data corruption,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=363) [bad blocks on disc, a bad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=364) [network connection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=366) [If any one of the bits flips in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=367) [that data, it will invalidate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=368) [the checksum, or the signature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=370) [And we'll know before even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=372) [reading any of those bytes, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=373) [the data is incorrect, and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=375) [shouldn't trust it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=376) [Now, we also don't always have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=379) [checksum.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=381) [Maybe it's data we don't own,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=381) [where you can't get that ahead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=382) [of time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=383) [So, at this stage, there isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=383) [much we can do with this data,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=385) [besides read it and inspect it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=387) [And so, once we do that, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=389) [get primitive data out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=392) [Now, as we've mentioned, we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=394) [take that raw data and pass it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=396) [through, usually deserialize it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=398) [like foundations JSON](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=399) [serialization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=400) [When we do that, we'll get inert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=402) [strings and dictionaries and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=404) [arrays of numbers back out that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=405) [we can use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=406) [And if this process exceeds, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=407) [know two things about that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=409) [One, that the data was indeed in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=412) [the correct format that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=413) [expected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=414) [For instance, XML data won't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=415) [pass through JSON serialization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=416) [And two, if we trust the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=418) [And two, if we trust the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=418) [deserializer, we know that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=420) [run-time objects we get back out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=423) [are going to be valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=424) [Again, foundations JSON](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=426) [serialization will always give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=427) [you strings and numbers and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=428) [arrays that you can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=429) [work with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=431) [It's individual values that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=432) [can trust.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=433) [But at this stage, we might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=434) [wonder okay how can we make use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=436) [of this data, or what can we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=438) [trust about it, and what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=439) [validation do we still need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=441) [do?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=443) [Well, we don't actually know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=444) [much about the contents of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=446) [data yet until we start looking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=448) [at it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=449) [And in fact, we might not know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=449) [anything about the structure of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=451) [the data until we start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=452) [inspecting it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=453) [If you've ever worked with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=454) [dynamic deserialization in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=456) [way, you'll know that there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=457) [lot of downcasting from anys.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=458) [There's no upfront expectation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=460) [what the data can be because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=461) [it's very generalized.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=462) [And so, we'll want to check to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=464) [see what the data contains and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=465) [how we can work with it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=467) [So, let's motivate this with an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=469) [example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=470) [I've been working with an app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=471) [lately called Sell My Old Junk,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=472) [which allows me to sell my old](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=474) [junk to some friends and family.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=476) [And when one of them opens up my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=478) [app, my app makes a request to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=480) [my server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=482) [Which requests a list of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=483) [products that are currently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=485) [available for sale to my friends](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=486) [and family.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=488) [When the server receives this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=489) [request, it responses with JSON,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=491) [that indicates here are the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=493) [products available to sell.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=493) [Now, this is what an API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=497) [response from my server might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=498) [look like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=500) [It's an array of product](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=501) [listings, which have some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=502) [interesting fields that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=503) [might care to look at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=504) [For instance, each listing has a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=506) [product ID.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=509) [A positive integer that uniquely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=510) [identifies the product.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=511) [And in my case, these are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=513) [sequential integer IDs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=514) [Every listing also has a name](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=517) [and a description which are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=518) [strings.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=519) [And there are a few other type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=520) [fields here that we might care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=521) [to look at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=522) [For instance, there's a field](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=523) [that's a Boolean that indicates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=525) [whether or not this listing has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=526) [already been sold.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=527) [And there's some internal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=528) [structure here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=530) [This list of tags, which are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=531) [strings, which we might care to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=532) [use.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=533) [There are also a few fields](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=535) [here, which come to us as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=537) [strings, but really represent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=538) [other forms of data that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=539) [other forms of data that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=539) [might care to look at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=541) [For instance, URLs and dates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=542) [So, let's make use of this data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=545) [In my app, I can fetch that data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=547) [from the network say with URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=549) [session, and wherever possible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=551) [I'll validate the length.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=552) [Maybe my server can produce a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=553) [checksum that I can validate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=555) [Or a cryptographic signature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=556) [Once I've done that, I can take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=557) [the data and pass it off JSON](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=561) [serialization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=562) [If deserializing the data fails,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=564) [JSON serialization will throw an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=566) [error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=567) [Will check and then catch and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=568) [handle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=569) [May display dialogue to my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=570) [customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=571) [Again, in our purlins of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=572) [day, we've just taken raw data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=574) [and carried along it the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=577) [abstraction spectrum to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=578) [primitive data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=579) [And if anything went wrong, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=580) [can handle that failure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=581) [So, now we need to make use of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=584) [this data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=585) [How can we consume it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=586) [Well, JSON is an any variable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=587) [that contains the actual values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=589) [So, I can downcast it to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=592) [array of dictionaries that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=593) [expect it to be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=594) [Now, this part of my app cares](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=596) [only about product listings that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=597) [are related to music.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=598) [So, will filter out any products](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=600) [that don't contain the music](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=602) [tag.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=603) [And here, I have that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=603) [substructure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=604) [That list of tags, which will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=605) [downcast an array of strings and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=606) [make use of it, right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=608) [Whoops. Each of those forced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=611) [downcasts, actually contains a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=614) [hidden fatal error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=616) [If either of those casts fails](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=618) [because the API changed or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=620) [data changed along the way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=621) [before it made into my app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=623) [again due to data corruption or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=624) [malicious changing, those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=626) [downcasts will fail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=628) [And when they do fail, they'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=629) [abort, and they'll crash my app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=631) [And again, that's a bad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=633) [experience for my customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=634) [Let's take a look at how this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=635) [could happen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=637) [So, here again is that sample](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=638) [API response.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=640) [And we'll take a look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=642) [list of tags here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=643) [And say that second tag in there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=645) [is modified.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=648) [Instead of a string, we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=649) [number.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=650) [It's maliciously changed by a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=651) [third-party, or maybe again due](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=652) [to regular data corruption.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=654) [We can't always tell.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=655) [Downcasting this list of tags](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=657) [will fail because they're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=660) [strings and we never checked to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=661) [make sure they work before we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=663) [cast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=664) [So, to avoid this, our main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=666) [tenant for the day will always](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=668) [be validate first, execute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=669) [later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=671) [Instead of asserting that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=673) [know what the structure of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=674) [data is, check first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=675) [Don't blindly assume.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=677) [So, let's see how we can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=679) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=680) [So, here again is that first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=681) [forced downcast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=682) [And instead of forcibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=684) [downcasting these values, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=685) [conditionally downcast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=687) [This allows me to validate that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=692) [the data actually contains what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=695) [I want and if that cast fails,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=697) [well I can handle that error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=700) [instead of fatally erroring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=701) [Now, similarly, later](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=704) [downcasting that list of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=706) [strings, instead of forcibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=707) [downcasting, again I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=709) [conditionally downcast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=710) [And in this case, instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=712) [throwing an error, I can give a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=713) [default value that allows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=715) [execution to continue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=716) [In this case, I'll simply ignore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=717) [any product listings that don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=719) [any product listings that don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=719) [have a valid list of tags.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=721) [I could throw an error, but in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=723) [this case, I chose not to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=724) [Now, type validation isn't the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=727) [only form of validation that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=729) [want to perform at this stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=730) [For instance, if that had been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=733) [replaced by null, which is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=734) [totally valid in JSON, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=736) [would've seen a similar crash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=739) [In Swift strong static type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=741) [system nullability is part of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=743) [the type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=745) [And indeed, you can't downcast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=745) [null to a string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=747) [And so, again, this cast would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=748) [have failed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=750) [Now, even if all of these values](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=752) [are of the correct type and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=754) [nullability, there's other forms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=755) [of validations that we should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=757) [care about here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=758) [For instance, I said that each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=759) [product listing has a positive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=761) [integer ID.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=762) [In my case, they're all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=763) [sequential integers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=764) [Does it make sense for one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=765) [these IDs to be negative?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=767) [No, it doesn't.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=769) [But even if it is always](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=769) [positive, does it make sense for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=771) [it to be such a large positive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=773) [integer value?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=774) [I'm not selling that many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=775) [things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=777) [So, no it doesn't.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=778) [and in this case, this might be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=778) [due to somebody trying to cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=779) [due to somebody trying to cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=779) [overflow in my app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=781) [This is something you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=783) [watch out for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=784) [Now similar to range validation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=787) [is length validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=788) [Again, every product listing has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=790) [a description.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=792) [Does it make sense for that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=792) [description to be empty?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=794) [Well, in my case, I know that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=796) [anytime I upload a product](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=798) [listing, I'm always going to put](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=799) [a description in there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=801) [So, in my case, no it doesn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=802) [make sense for it to be empty.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=803) [But even if it's not empty, does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=806) [it make sense for it to be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=807) [full length and contents of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=808) ["Romeo and Juliet?"](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=809) [Also no, it doesn't make sense.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=811) [Something here's gone wrong and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=812) [I need to look for that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=814) [Now, there's additional forms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=818) [validation that we really do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=819) [care about here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=820) [Even if all of these fields are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=820) [right type, nullability, and fit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=822) [within the range and length that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=824) [we expect, their values and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=825) [contents are also equally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=827) [important.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=828) [Every product listing has a URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=830) [that I can send a customer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=831) [see more information about that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=833) [product listing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=834) [This comes to me as a string,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=836) [but it actually has to contain a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=837) [URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=839) [Does it make sense for it to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=839) [Does it make sense for it to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=839) [any arbitrary string?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=841) [No, and in my case, I want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=842) [make sure that it actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=844) [represents a URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=845) [But more importantly, just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=847) [because it looks like a URL,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=849) [doesn't mean it will point to my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=850) [domain.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=851) [And this is something I care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=852) [very deeply about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=853) [I really, really want to keep my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=854) [customers safe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=856) [I don't want to possibly send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=857) [them to a phishing domain, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=859) [could look like mine, but not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=861) [really be my site.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=863) [So, this is something that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=865) [care about watching out for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=866) [Now, lastly, even if each of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=869) [these fields is valid on its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=870) [own, sometimes the relationships](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=872) [between fields that matters.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=874) [For instance, each product](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=876) [listing has a date when it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=878) [created, and a date when it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=879) [last updated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=880) [Each of these can be valid on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=882) [their own, but does it make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=883) [sense for the date that it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=884) [last updated to come before when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=885) [it was created?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=887) [No. And in my case, this might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=889) [not open a security](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=890) [vulnerability in my app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=891) [But this is something that maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=892) [you watch out for because it's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=894) [good indicator that something's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=895) [gone wrong, and maybe I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=896) [shouldn't trust this data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=897) [So, let's take a look at how we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=898) [So, let's take a look at how we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=898) [can start doing that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=901) [Here, I've started writing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=903) [function which will take one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=904) [such listing and start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=905) [validating all of the contents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=907) [So, I'll take a listing, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=909) [I'll start pulling out the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=910) [product ID.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=912) [And we've learned here not to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=913) [forcibly downcast this ID to an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=915) [Int, but conditionally downcast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=917) [And if the cast fails the guard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=919) [will fail and will throw an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=920) [error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=921) [Now I don't want to stop there,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=922) [I want to perform the range](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=924) [validation that ensures that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=925) [product ID is also valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=927) [That it's positive and not too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=928) [large.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=930) [And again, if something goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=930) [wrong, I'll throw an error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=931) [Now, later on I might care to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=937) [check out that URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=938) [And again, I'll downcast it to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=939) [string, instead of forcibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=941) [downcast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=942) [And here, I can check the link.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=944) [In this case, I know my server](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=945) [will never produce URLs that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=946) [too long.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=948) [So, if I find a really long URL,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=949) [I'll know that it's invalid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=950) [Once I've validated that, I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=954) [send it off to the URL type to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=955) [perform that domain-specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=957) [validation to make sure it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=958) [actually is a URL, and not just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=959) [actually is a URL, and not just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=959) [a garbage string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=960) [And again, if anything goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=961) [wrong, I'll throw an error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=962) [But, again, I don't want to stop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=964) [there, once I have an actual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=966) [URL, I want to make sure it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=968) [points to my domain and not a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=969) [phishing domain, so I'll keep](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=971) [working with that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=973) [Now, at this point, I can apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=975) [the same types of validation to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=976) [the other fields here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=977) [And again, if anything goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=978) [wrong, I'll throw an error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=980) [But once I have this function, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=981) [can apply it to all the product](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=982) [listings that I've loaded from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=984) [the payload.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=985) [And again, I'll stop executing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=986) [if anything goes wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=989) [Now, this is how we can work to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=993) [validate primitive data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=995) [But as we just saw, primitive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=997) [data can be very general.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=998) [A string can be a string, but it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1000) [can also be a date.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1003) [And it can also be a URL.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1005) [Sometimes we care to work with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1010) [data with the semantics that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1012) [matter to us.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1013) [We wanted to make sure that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1014) [host of that URL was our domain,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1015) [and we can't do that with just a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1017) [regular string.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1019) [Similarly, a dictionary can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1021) [represent a model like a listing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1023) [here, or it can represent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1024) [arbitrary customer data that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1026) [know nothing about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1027) [Instead of performing the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1030) [validations everywhere to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1031) [sure all the fields that we care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1032) [about are there, isn't it nicer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1033) [to work with our own model](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1035) [types, where that guarantee is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1036) [always present?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1038) [It is. And in our case, we want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1039) [to work with structured data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1043) [wherever possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1044) [We can use primitive date as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1045) [building block to get there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1047) [But we want to work with that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1048) [form of data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1049) [So, let's take a look at how we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1051) [can do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1052) [Elsewhere in my app, I have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1055) [purchase type, which does just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1057) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1058) [When a customer makes a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1060) [purchase, I store that data to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1061) [disc, so that later, when they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1063) [open the app, even if they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1064) [not connected to the network,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1066) [they can view their purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1067) [history.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1068) [Each purchase keeps track of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1070) [product listing it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1071) [associated with, and when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1072) [purchase was made, and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1074) [receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1075) [I can save it to disc in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1077) [way using NS coding and NS key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1079) [way using NS coding and NS key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1079) [to archiver.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1081) [And I'll archive it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1082) [But as we saw, when we unarchive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1084) [data, and we handle raw and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1085) [primitive data, we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1087) [validate it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1089) [So, let's do that by taking a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1090) [look at how doing it with coder](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1092) [here could work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1093) [If you've ever written in a note](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1094) [with coder, this might look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1095) [familiar to you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1096) [We'll start by decoding the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1097) [product listing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1099) [And again, we've learned to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1100) [conditionally downcast, instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1101) [of forcibly downcasting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1103) [And if something goes wrong,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1105) [well this is a fail-able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1106) [initializer, we'll simply return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1107) [nil, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1108) [if decoding succeeds, I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1110) [assign this to my property, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1112) [I'll keep going.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1114) [I'll do the same thing with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1115) [purchase data, and again,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1116) [conditionally downcast to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1117) [date.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1118) [If something goes wrong, I'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1119) [fail, and so on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1120) [And repeat this for each of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1121) [fields in my type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1123) [When I want to save one of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1125) [purchases to the history, well I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1127) [have a function, which does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1129) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1130) [It archives a purchase to binary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1130) [data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1133) [And then, I can save it out to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1134) [disc, or shrill that data off](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1136) [into database or similar.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1137) [When I want to load that data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1139) [When I want to load that data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1139) [back, well I can do the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1142) [thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1143) [I can get that raw data and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1143) [pass it along to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1146) [KeyedUnarchiver, to get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1146) [object back out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1148) [Now, as we've said, at every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1151) [point here, the data is getting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1152) [more complicated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1154) [There might be more to validate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1155) [about it before we can trust it,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1156) [just as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1157) [So, you might wonder, okay,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1158) [what's the catch here?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1160) [What else is there left to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1161) [validate?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1162) [And this downcast, here is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1162) [good hint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1165) [Note that this downcast happens](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1166) [after we've unarchived an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1169) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1171) [How could this ever fail?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1172) [It's a good indicator that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1175) [something else might be going on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1176) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1177) [So, let's take a look at that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1177) [This is an abstract](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1180) [representation of what these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1181) [model objects might look like in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1182) [my archive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1184) [Here we have all the fields that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1186) [we cared about in coding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1187) [And each of them contains their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1189) [own structure, and substructure,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1190) [and contents, and so on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1191) [But, interestingly here this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1193) [representation also contains the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1195) [name of the class of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1197) [object.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1199) [Let's take a look at how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1201) [KeyedUnarchiver can make use of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1202) [this information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1203) [So, we have a decode call we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1205) [currently making.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1207) [And this under the hood creates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1208) [a KeyedUnarchiver, and decodes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1209) [an object for the object key.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1211) [When you perform this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1214) [KeyedUnarchiver, KeyedUnarchiver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1215) [finds that class name in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1217) [object in the archive and pulls](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1218) [it out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1220) [And dynamically finds a class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1221) [with that same name in your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1223) [It then allocates an instance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1226) [that class and then initializes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1228) [it to allow it to decode its own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1230) [contents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1232) [Afterwards, it awakens the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1234) [object to give it a chance to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1236) [finalize its state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1237) [Now, this works great for our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1240) [objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1242) [But now, we might wonder what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1243) [happens if the data is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1245) [maliciously changed to contain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1246) [an object of a class that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1247) [didn't expect?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1250) [Well, this whole process that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1251) [just performed happened on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1252) [different type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1254) [We just allocated, initialized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1256) [and awoke an object of a class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1258) [and awoke an object of a class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1258) [that we didn't expect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1260) [What kind of effect can this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1262) [have in our app?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1263) [Well, as we saw before, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1266) [conditional downcast here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1267) [prevents us from accidentally](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1268) [using an object of this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1270) [unexpected class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1271) [We're only going to work with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1272) [objects of the types that we did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1273) [expect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1275) [The downcast fails, well we'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1275) [fail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1277) [But decoding one such object can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1280) [have a lasting impact in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1282) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1284) [Say that class has an alloc](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1284) [method, which changes global](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1287) [state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1288) [Maybe it allocates a singleton](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1288) [or changes some global data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1290) [Even though we throw the object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1293) [away, if this fails, this can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1294) [have a lasting impact in our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1296) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1297) [And can cause differing behavior](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1298) [somewhere else and an archive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1299) [can be maliciously constructed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1301) [in this way to cause this to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1303) [happen in our apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1304) [So, how can we validate the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1306) [to prevent this from happening?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1307) [This is exactly where the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1309) [NSSecureCoding protocol comes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1311) [in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1312) [NSSecureCoding is a protocol](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1313) [inheriting from NSCoding, whose](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1315) [goal is to prevent exactly this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1318) [goal is to prevent exactly this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1318) [sort of attack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1320) [By allowing you to pass in type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1322) [information upfront, it prevents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1324) [arbitrary code execution by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1327) [validating the contents of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1328) [archive to make sure it only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1330) [contains the types that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1331) [expect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1333) [The hallmark introduction of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1335) [NSSecureCoding were two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1337) [alternative methods to decode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1338) [object for key, which allow you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1340) [to pass that type information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1342) [upfront.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1343) [And using that type information,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1344) [NSKeyedUnarchiver can keep you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1346) [safe.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1347) [So, let's take a look at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1349) [current decode object for key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1349) [call that we have.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1351) [This top level decode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1352) [Now, here, if instead we use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1354) [variant that allows us to pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1356) [in the class upfront, in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1357) [case, we want to decode a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1359) [purchase, instead of performing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1359) [this whole process and whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1362) [is in the archive, you can first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1363) [gate it on a class check.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1366) [Let's examine this class check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1369) [for a moment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1370) [At every stage in decoding, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1371) [secure coding is on,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1374) [NSKeyedUnarchiver maintains a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1375) [list of classes, which are valid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1377) [to decode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1378) [When we make such a call,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1379) [When we make such a call,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1379) [NSKeyedUnarchiver, takes the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1382) [object that we used, this class,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1384) [and constructs an allowed class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1387) [list from it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1388) [When we go ahead and decode an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1390) [object from an archive, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1392) [class is first checked against](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1394) [the allowed class list.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1396) [And if it isn't present, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1397) [decode call will be rejected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1399) [Now, if the class of the object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1401) [that we find in the archive is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1404) [in the allowed class list,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1405) [there's a few checks that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1407) [need to perform.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1408) [Specifically, we'll need to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1410) [sure that this class itself also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1411) [conforms to NSSecureCoding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1413) [If it doesn't, we can't be sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1415) [that it itself will be able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1417) [further securely decode its own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1418) [contents.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1420) [And so, we can't safely decode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1421) [one of these objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1423) [In our case, the purchase class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1424) [will.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1426) [And so, it's safe to decode and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1426) [keep track of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1427) [Now, there's two other checks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1429) [that are related to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1431) [superclass-subclass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1431) [relationships.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1433) [If you have two classes, one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1434) [which is a subclass of another,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1436) [both conforming to NSCoding, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1438) [both conforming to NSCoding, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1438) [the superclass adopts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1440) [NSSecureCoding conformance, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1441) [subclass will inherit that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1444) [conformance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1445) [Now, the subclass may never have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1446) [had a chance to rewrite its init](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1449) [with coder to do the secure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1451) [thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1452) [And so, we have an escape hatch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1453) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1455) [The support secure coding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1456) [method, allows you to say,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1458) [actually I don't really support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1459) [secure coding, and you can turn](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1461) [this off to say, I'm not ready](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1462) [yet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1466) [Alternatively, if you still say](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1466) [yes, we have to make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1468) [you either inherited the full](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1470) [conformance to NSSecureCoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1472) [from the superclass, or that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1474) [overrode both of the methods to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1476) [indicate yes I really do support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1478) [secure coding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1480) [There isn't a mismatch here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1480) [In our case, purchase meets both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1484) [of these requirements and so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1485) [can safely decode it from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1487) [archive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1489) [Now, we go ahead and decode a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1490) [purchase, it itself decodes a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1492) [listing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1494) [And it can make use of the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1495) [type of call to indicate that it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1496) [wants a listing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1498) [When it does that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1499) [When it does that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1499) [NSKeyedUnarchiver uses that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1502) [class to build a new allowed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1503) [class list.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1505) [And everything is checked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1506) [against this new version of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1507) [list.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1508) [We go ahead and decode an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1509) [object, the same checks are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1510) [performed and in this case a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1512) [listing is still valid to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1513) [decode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1515) [But again, if we try to decode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1517) [an object of an unexpected class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1519) [that's not in the list, it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1521) [be rejected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1522) [Let's take a look at what that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1523) [rejection might look like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1527) [And this is called decoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1528) [failure and there are a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1530) [other types of failures that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1531) [might care to look at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1532) [So, when secure coding is on, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1533) [might be able to see secure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1535) [coding violations in cases like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1536) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1537) [But there's other forms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1537) [failure here, too.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1539) [For example, a type mismatch can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1540) [happen if you try to decode an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1542) [object and instead there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1544) [primitive value, like an integer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1545) [in the archive at that location.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1547) [Or, you try to decode a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1549) [primitive, like an integer, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1550) [instead we find an object or a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1552) [primitive of an incompatible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1554) [type like double.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1555) [These can cause decoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1557) [failures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1558) [There's another form of failure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1559) [There's another form of failure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1559) [that can happen here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1561) [And that's archive corruption.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1562) [If the archive itself is too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1564) [corrupted and doesn't follow the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1565) [expected format for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1567) [NSKeyedUnarchiver, well we won't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1568) [be able to decode anything, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1569) [so you'll get that same sort of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1571) [failure.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1573) [Now, what happens on failure is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1574) [decided by the decoding failure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1577) [policy on the Unarchiver.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1578) [There's two options here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1580) [On failure, we can either raise](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1582) [an exception or store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1583) [information about what happened](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1586) [and continue execution.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1587) [Raising exceptions is currently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1589) [the default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1591) [So, if we have a call, again](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1592) [this is our call from earlier,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1595) [trying to decode a listing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1596) [And we find an object of an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1598) [unexpected class in the archive,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1599) [under the hood this calls the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1602) [failWithError method, on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1603) [Unarchiver and passes in an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1604) [error that indicates what went](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1607) [wrong and where.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1608) [Now, under the hood,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1610) [failWithError has a decision to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1611) [make.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1612) [If the decoding failure policy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1614) [is to raise exceptions, it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1615) [raise exceptions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1617) [If you're writing a Swift app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1619) [If you're writing a Swift app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1619) [this is something you have to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1620) [mindful of.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1621) [Swift can't catch Objective-C or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1622) [C++ exceptions, and so this can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1623) [lead to a fatal error in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1626) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1627) [Now again, this can lead to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1627) [crash and a bad experience our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1628) [customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1630) [If the decoding failure policy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1631) [to set error and return, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1634) [error will be assigned to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1636) [Unarchiver's error property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1637) [And execution has to continue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1639) [And in this case, because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1641) [execution does continue, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1642) [decode call has to return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1644) [something, and so it will return](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1645) [nil to indicate that nothing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1647) [could be decoded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1649) [And as mentioned, if you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1650) [decoding a primitive type, here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1652) [and we find an object or a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1653) [primitive type that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1655) [incompatible, the same series of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1656) [steps has to happened.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1658) [And in this case, instead of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1659) [returning nil, we'll simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1661) [return 0.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1662) [Now failWithError is API on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1664) [NSKeyedUnarchiver, and we urge](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1669) [you to use in your own code to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1670) [indicate when failures happen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1672) [and what went wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1673) [Instead of simply returning nil,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1675) [failWithError first to record](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1677) [that information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1678) [If you do, there are a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1680) [things to keep in mind.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1682) [If the decoding failure policy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1684) [is to set an error, and return,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1685) [you have to keep in mind, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1687) [once an error is set on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1688) [Unarchiver, it won't later be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1689) [reset.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1691) [And that's because one decoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1691) [failure often leads to a cascade](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1694) [of decoding failures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1696) [And we don't want to lose sight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1697) [of what originally went wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1698) [Second, keep in mind that any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1702) [given failWithError call, can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1704) [either throw an exception or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1705) [continue execution, so you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1706) [to keep both of those options in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1709) [mind.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1710) [Especially if you're working](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1710) [Objective-C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1711) [Maybe you can catch the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1712) [exception.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1713) [So, there's things to handle](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1714) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1715) [And lastly, keeping an eye out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1715) [for nil, or 0 return values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1718) [This could either happen because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1720) [of a decoding failure, if the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1721) [decoding failure policy is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1723) [set an error and return.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1724) [Or, the data could have just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1726) [been missing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1727) [Or, even encoded as nil or 0.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1728) [So, to disambiguate between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1731) [these cases, check the error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1732) [property on the Unarchiver.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1733) [All right, so that was a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1734) [information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1738) [Let's distill this down into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1739) [Let's distill this down into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1739) [checklist to see how we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1741) [adopt NSSecureCoding on our own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1742) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1743) [We'll start by converting all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1745) [decode object for key calls to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1746) [the variant which allows us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1748) [pass in that type information up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1749) [front.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1750) [And then, if something goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1751) [wrong instead of just returning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1753) [nil, let's failWithError to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1754) [indicate what happened.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1756) [And lastly, this is a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1757) [opportunity to audit for further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1759) [points of failure, where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1761) [weren't performing validation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1762) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1763) [So, let's do just that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1764) [So, here again is a decode call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1767) [to decode a listing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1769) [And you'll notice that if we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1770) [pass in that type information up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1771) [front, the conditional downcast](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1772) [later can go away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1774) [There's a generic overload of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1776) [this method, which when given](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1778) [the type information statically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1779) [causes you to not have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1781) [conditionally downcast anymore.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1782) [You'll always get an object of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1784) [that class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1785) [Now, again, as we said, instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1787) [of returning nil on failure, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1789) [want to fail meaningfully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1790) [So, here we can fail with an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1792) [error to indicate what went](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1793) [wrong and where.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1795) [And in this case, we can use one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1796) [of the conveniences on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1798) [CocoaError to return a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1799) [CocoaError to return a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1799) [meaningful error that has a good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1801) [localized description for our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1802) [customers and that indicates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1803) [what went wrong.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1804) [We can always add a debug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1807) [description for ourselves, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1807) [later log if we care to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1809) [But this is the core.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1810) [We want to failWithError before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1812) [returning nil.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1813) [And then, later on, again, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1814) [were decoding the purchase date.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1818) [And here, there is a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1820) [opportunity to add further](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1822) [validation where we weren't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1823) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1824) [Here, if we can decode a date,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1826) [well, I was simply storing the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1828) [property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1829) [But instead, I want to make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1830) [that that date is valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1831) [For instance, a purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1833) [couldn't possibly had been made](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1834) [before my app went live on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1835) [app store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1837) [So, this is something you could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1837) [check.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1838) [And again, if something goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1839) [wrong here, we want to fail with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1840) [a meaningful error.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1842) [In this case, it wasn't that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1844) [data was missing, it was that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1845) [the data was corrupted or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1846) [invalid in some way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1847) [And so, we'll indicate just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1848) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1849) [Now, that we've gone ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1849) [done exactly this on our type,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1854) [we can go ahead and claim that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1856) [it supports secure coding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1858) [And lastly, conform to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1860) [NSSecureCoding protocol instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1862) [to indicate to the runtime that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1863) [this is what we intended.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1865) [It really does support secure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1866) [coding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1867) [And after that, well,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1868) [congratulations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1872) [We've earned our NSSecureCoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1873) [badge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1874) [Physical badge is sold](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1875) [separately.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1875) [Now, we think it's so important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1878) [for you to earn your own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1880) [NSSecureCoding badges and use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1881) [them that this year, we've added](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1883) [new API and NSKeyedUnarchiver to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1885) [make sure that NSSecureCoding is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1886) [done wherever possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1888) [This new initializer and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1891) [convenience methods, turns on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1892) [secure coding by default and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1893) [sets the default decoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1895) [failure policy to set error in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1897) [return.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1898) [So, unless you change the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1899) [decoding failure policy on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1900) [own, you don't have to worry](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1901) [about exceptions in Swift.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1902) [And indeed, the old initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1903) [and convenience methods are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1907) [deprecated in favor of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1908) [versions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1910) [So, we really want you to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1910) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1911) [And similarly, we've introduced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1913) [the same APIs on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1915) [NSKeyedUnarchiver, to make it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1916) [easier for you to turn](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1918) [SecureCoding on when archiving.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1918) [SecureCoding on when archiving.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1918) [And this is equally important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1920) [because it makes sure you can't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1922) [accidentally archive an object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1923) [which doesn't conform to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1925) [NSSecureCoding.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1926) [And you wouldn't later able to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1927) [decode it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1928) [And again, the old initializer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1930) [and convenience methods are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1931) [deprecated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1932) [And so, this means that if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1933) [have old code that looks like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1934) [this, well turn on SecureCoding](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1936) [when archiving.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1939) [And switch to the convenience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1940) [methods that allow you to pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1941) [in that type information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1942) [upfront.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1943) [This way, you can actually make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1945) [use of your SecureCoding badge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1946) [Make sure you've earned it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1948) [Now, if you can't yet support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1951) [SecureCoding, because your types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1952) [can't conform, or they,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1953) [themselves depend on types which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1955) [don't yet conform, that's okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1957) [You can still use these methods.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1958) [On nCode, simply turn off the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1960) [secure coding requirement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1962) [And on decode, these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1964) [conveniences always have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1965) [SecureCoding enabled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1966) [So, instead use the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1968) [initializer to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1970) [KeyedUnarchiver, and then turn](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1971) [SecureCoding off, manually.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1972) [This also gives you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1975) [opportunity to reset the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1976) [decoding failure policy back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1978) [the old default in case you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1979) [the old default in case you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1979) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1982) [Once you have such an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1982) [Unarchiver, well you can decode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1983) [as usual.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1985) [Now, if you're working on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1986) [Swift app, NSSecureCoding isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1989) [the only way for you to convert](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1991) [your own model types to external](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1993) [representations and back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1994) [Last year with Swift 4, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1997) [introduced the Codable protocols](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=1998) [which make it easier to do just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2000) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2001) [And importantly, all the design](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2001) [decisions that made their way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2004) [into NSSecureCoding were also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2006) [present in Codable from day one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2008) [Specifically, Codable never](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2010) [writes type information into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2012) [archives.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2014) [So, there's nothing to trust](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2015) [later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2016) [By requiring you to pass in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2016) [static type information upfront](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2018) [about what you expect to decode,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2020) [you can prevent exactly this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2022) [sort of attack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2023) [Now, Codable also comes with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2025) [conveniences.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2027) [If you have a type whose fields](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2028) [are all themselves codable, well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2029) [you'll get a synthesized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2031) [implementation of the init from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2032) [and encode to requirements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2033) [And the synthesized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2035) [implementation gives you type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2036) [and nullability checking for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2038) [free.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2039) [But as we saw, most types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2040) [require additional validation if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2041) [they come from external sources,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2043) [just like ours do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2044) [So, we need to further validate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2046) [those.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2047) [So, we can do that for our own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2049) [types by overwriting in it with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2051) [init from decoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2053) [And in this case, again, here's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2053) [that JSON response from earlier.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2055) [And I can trivially turn it into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2057) [a Codable type by simply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2058) [creating a type with all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2060) [same name fields.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2061) [Because all these fields are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2063) [codable, I get that free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2064) [implementation of init from and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2066) [encode to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2067) [But, I want to override init](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2068) [from to make sure I'm performing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2070) [the same validation that I was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2071) [before with the primitive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2072) [values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2073) [So, I can do that here, the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2074) [way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2076) [Where my old code decoded the ID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2078) [from the payload by downcasting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2081) [to an int, I can do similarly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2082) [here by decoding an int from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2084) [decoder.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2086) [If the type found in the payload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2088) [is of a different type or is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2090) [missing, this will throw an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2092) [error that indicates what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2093) [happened.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2094) [Now, more important than that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2095) [my own validation that I added](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2098) [my own validation that I added](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2098) [in that validate method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2100) [Here, I want to make sure I keep](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2101) [performing that same validation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2103) [to make sure the ID is valid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2104) [And here, I can use a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2106) [convenience method to throw a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2107) [meaningful error that indicates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2108) [what happened.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2110) [Now, later in that validate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2113) [function I might've pulled that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2114) [creation date out as a string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2116) [and then had to pass it along to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2118) [a date formatter to get a valid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2119) [date back out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2122) [Here, because we can use JSON](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2125) [decoder, we can simply decode a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2126) [date directly, we don't have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2129) [worry about that type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2130) [conversion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2131) [We can use JSON decoders date](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2132) [decoding policy to indicate what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2134) [sort of conversion can happen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2136) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2137) [And this is nice because this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2138) [conversion became a one-liner.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2140) [And, the other decode call is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2142) [also a one-liner, which makes it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2144) [easy for me to focus on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2146) [types of validation that I care](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2147) [about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2149) [Now, later on in the validate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2151) [function, I might have also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2152) [pulled out that substructure of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2153) [tags out as an array of strings,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2155) [and later had to map those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2157) [strings to my own type, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2158) [strings to my own type, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2158) [for further validation later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2160) [Here, again with Codable, I have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2164) [the benefit of tag conforming to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2165) [Codable itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2167) [And so, I can just decode an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2168) [array of tags directly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2169) [This happens automatically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2171) [And instead of focusing on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2172) [type conversion, allows me to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2174) [focus on the validation that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2175) [matters to me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2176) [This lets me make sure that this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2178) [data is data I can trust.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2179) [We talked about a lot today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2184) [We started with raw data and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2187) [carried it all away across the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2188) [abstraction spectrum to our own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2190) [model types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2191) [And along the way we saw how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2192) [build trust into that data by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2194) [validating a checksum, or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2198) [length on that raw data, we made](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2200) [sure that it was valid to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2202) [with an inspect, and even check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2203) [whether it conforms to some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2205) [format.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2206) [Once we've made sure that it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2207) [conforms to a known format, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2208) [knew that that formatted data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2210) [was valid to work with and pull](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2212) [primitive values out of.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2214) [By validating the contents and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2217) [structure of those primitive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2219) [structure of those primitive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2219) [values, we made sure that it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2220) [valid to work with them to turn](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2222) [them into our own model types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2223) [By validating the semantics and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2226) [relationships between those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2227) [model types, we made sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2229) [they were valid to work with and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2230) [that they were data we could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2232) [trust.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2233) [So, where to go from here?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2235) [Well, now that you know all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2238) [this, I encourage you to go and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2239) [look at your code and do just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2240) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2241) [Validate data at every stage in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2243) [the lifecycle of that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2246) [Check for types and nullability.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2248) [But more importantly, range, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2249) [length, and domain-specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2250) [applications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2252) [If you have NSCoding types,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2253) [audit those types and earn your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2256) [NSSecureCoding badge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2257) [And don't just earn it, use it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2258) [Turn on secure coding wherever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2260) [you can.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2261) [And lastly, for new data types,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2263) [adopt Codable where possible and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2265) [make sure to perform that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2267) [validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2268) [Make sure you're only ever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2270) [working with data you can trust.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2271) [For more information about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2274) [Codable, specifically, see last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2276) [year's talk about What's New in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2277) [Foundation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2278) [But if you have more questions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2279) [But if you have more questions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2279) [about this topic or want to come](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2281) [to us for help on how to apply](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2282) [this in your own apps, come to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2284) [our lab later today, we have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2285) [foundation lab, where we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2286) [help you do just that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2287) [With that, I'd like to say thank](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2290) [you very much.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2291) [Have a great day.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2293) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/222/?time=2294)