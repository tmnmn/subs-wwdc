# Best Practices and Whatâ€™s New with In-App Purchases

## Summary
Learn about the latest updates in StoreKit, including offering introductory pricing for subscriptions, requesting ratings and reviews, promoting your in-app purchases within the App Store, and developing in the sandbox environment. Dive deep into best practices for processing transactions and validating receipts.

## Info
* App Store and Distribution
* WWDC 2018 - Session 704 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=7) [&gt;&gt; Good afternoon.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=21) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=22) [Welcome to Best Practices and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=27) [What's New with In-App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=28) [Purchases, my name is Dana](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=29) [DuBois, I'm an App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=30) [engineering manager.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=32) [In-app purchases are an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=34) [essential part of how so many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=35) [apps do businesses in the App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=37) [Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=38) [Whether you have a subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=39) [model where you're maybe a video](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=40) [streaming service or a newspaper](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=43) [or magazine or you offer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=44) [consumables, content that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=46) [user can buy over and over again](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=49) [like in-game currency or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=51) [non-consumables, something where](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=52) [the user buy once and uses from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=55) [then on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=56) [It's important to make that user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=58) [experience great, this is your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=59) [experience great, this is your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=59) [business after all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=62) [So we're going to cover some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=65) [best practices in order to help](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=66) [you make that experience great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=68) [We're also going to talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=70) [some stuff that we have been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=70) [doing to make this great for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=72) [you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=74) [So first, I'm going to invite my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=79) [colleague Ross up on stage, he's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=79) [going to talk about Introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=81) [Pricing, this is a feature we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=82) [launched last December and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=83) [allows you for your subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=85) [business to entice new customers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=86) [in.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=88) [I'm going to give a quick update](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=89) [on trials in the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=91) [We're going to go over ratings](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=92) [and reviews and how your app can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=95) [get customers to give feedback](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=97) [into the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=99) [I'm going to give an update on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=100) [how you can use the Apple App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=102) [Store Sandbox environment for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=104) [testing your in-app purchases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=106) [Ross is going to come back up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=109) [and talk about processing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=110) [transactions, this is when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=111) [you're actually buying those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=112) [in-app purchases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=113) [And finally, I'm going to give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=115) [you an overview about the in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=117) [receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=119) [receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=119) [So to begin here's my colleague](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=121) [Ross.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=124) [&gt;&gt; Thanks Dana.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=127) [In iOS 11.2 and macOS 10.13.2 we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=129) [added the Introductory Pricing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=133) [feature to in-app purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=134) [subscriptions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=135) [This allows you to create a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=137) [one-time use discount for new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=137) [subscribers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=139) [We set up introductory pricing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=141) [in App Store Connect and each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=143) [subscription can only have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=145) [single introductory price at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=146) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=148) [When an eligible user purchases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=149) [the subscription in your app the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=150) [discount is applied](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=153) [automatically by the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=153) [Each user is eligible for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=156) [single introductory price based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=157) [on the subscription group.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=159) [I'll go into that a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=160) [more later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=163) [Along with Introductory Pricing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=164) [we added several new types and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=165) [properties in StoreKit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=167) [These APIs reflect the data that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=169) [you've set up in App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=170) [Connect and you can use them to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=171) [format your UI to display the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=174) [terms of the subscription to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=175) [your users, as well as to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=177) [determine which users are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=179) [determine which users are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=179) [eligible for the introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=180) [prices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=181) [For example, here's what it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=183) [looks like in the App Store when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=186) [you set up an introductory price](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=187) [on a promoted in-app purchase.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=188) [You can see that it clearly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=191) [naturally lays out the terms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=192) [the subscription to the user,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=194) [the first year for 19.99, then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=196) [39.99 for each year after that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=198) [This is also a great benefit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=201) [promoting your in-app purchases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=203) [that have introductory prices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=204) [Users can see the discount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=205) [before they even install your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=206) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=207) [Today I'm going to go over these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=209) [new APIs with you and look at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=210) [couple ways you may want to set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=212) [up your introductory prices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=213) [First, there's a new property on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=217) [SKProduct which is called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=220) [fittingly enough](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=221) [introductoryPrice.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=222) [This is a new class that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=224) [called SKProductDiscount.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=225) [This class contains all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=227) [information about introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=228) [price you've set up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=229) [And as you can see it's an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=230) [optional property that's because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=232) [only subscriptions can have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=233) [introductory prices and not all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=235) [subscriptions will have them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=236) [So let's dive into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=239) [So let's dive into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=239) [SKProductDiscount.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=240) [SKProductDiscount reflects the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=243) [data you've set up about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=245) [introductory price in App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=246) [Connect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=247) [It has a price and a price](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=248) [locale property and these behave](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=250) [the same as the properties with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=252) [the same names you're familiar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=253) [with on SKProduct.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=254) [Also as a subscription period](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=255) [property, this is a new class](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=259) [called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=261) [SKProductSubscriptionPeriod and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=261) [this reflects all the data about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=264) [the billing and renewal terms of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=265) [the introductory price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=266) [It achieves this with two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=268) [properties of its own, the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=270) [is unit which is an enum that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=272) [can be day, week, month or year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=273) [The next is number of units.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=277) [So for example if you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=279) [unit of month and a number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=282) [units of 2 that means that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=284) [introductory price renews every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=285) [2 months.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=287) [And back on SKProductDiscount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=288) [there's also a numberOfPeriods](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=291) [property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=293) [So this reflects the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=294) [those subscription periods the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=296) [introductory price is valid for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=297) [Say if you have that 2-month](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=299) [Say if you have that 2-month](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=299) [introductory price, the number](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=300) [of periods is 3, that means the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=302) [introductory price is valid for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=303) [a total of 6 months.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=305) [Finally, on SKProductDiscount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=310) [there's a payment mode property.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=312) [This is another new enum that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=315) [has three values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=316) [The first value is payAsYouGo,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=318) [this behaves like a normal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=321) [subscription where the user pays](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=322) [once per renewal period.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=324) [The renewal period for these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=327) [does have to be the same as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=328) [renewal period of the base](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=329) [subscription you've set up the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=330) [introductory price on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=331) [So if you had a month-long](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=333) [subscription you couldn't have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=335) [2-week long introductory price](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=337) [in this case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=338) [You can use these types of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=339) [introductory prices to offer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=341) [your users a longer introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=343) [duration but with less friction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=345) [up front.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=346) [For example, if you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=348) [3-month renewing subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=351) [that's billed at 9.99 you could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=352) [set up a 6-month introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=356) [price that renews twice at 1.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=357) [price that renews twice at 1.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=357) [each.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=360) [The billing period would look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=362) [like this, the user purchases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=363) [the subscription at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=365) [introductory price of 1.99 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=367) [receives 3 months of access.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=369) [After that they can renew at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=371) [1.99 for another 3 months of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=373) [access.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=375) [When that's over they'll renew](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=376) [at the normal subscription terms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=378) [of 9.99 for 3 months.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=379) [Here's what the data from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=380) [StoreKit would look like in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=383) [case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=385) [You can see the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=386) [subscriptionPeriod has a unit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=387) [month and the number of units is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=388) [3, so it'll renew every 3 months](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=390) [number.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=392) [And then the numberOfPeriods is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=393) [2 giving us that total of 6](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=394) [months of introductory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=395) [The payment mode is payAsYouGo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=397) [And the price for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=399) [introductory price is 1.99.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=400) [The next payment mode is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=406) [payUpFront.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=407) [With this type of introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=407) [price the user pays just one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=410) [time and receives the entire](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=412) [introductory duration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=413) [This is not limited to multiples](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=415) [of your subscriptions renewal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=417) [period.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=418) [So in this case, you could have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=419) [So in this case, you could have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=419) [a 1-year renewing subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=420) [and offer a 1-month introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=422) [price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=424) [So if we can take our previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=425) [example of our 3-month auto](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=428) [renewable subscription, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=430) [time we'll offer a payUpFront](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=432) [introductory price for 6 months.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=434) [Charging 3.99, so it's about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=436) [same overall cost as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=439) [previous example, but this time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=440) [the user will pay 3.99 upfront](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=442) [and receive the entire 6 months.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=444) [After that's up we'll renew with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=446) [the normal terms of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=448) [subscription at 9.99 for every 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=449) [months.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=451) [Here's what the data from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=456) [StoreKit would look like in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=456) [case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=457) [The subscriptionPeriod's unit is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=458) [still month, but this time we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=459) [have 6 units.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=461) [The numberOfPeriods is 1 because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=462) [it's a payUpFront introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=464) [price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=465) [The final payment mode is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=471) [freeTrial.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=472) [This behaves the same as the old](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=474) [freeTrial behavior where the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=475) [user pays nothing and receives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=476) [the entire introductory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=477) [duration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=478) [This is available under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=480) [durations varying from 3 days](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=481) [all the way up to 1 year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=483) [Excuse me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=488) [Also in iOS 12 and macOS 10.13.2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=490) [we've added the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=494) [subscriptionPeriod property to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=495) [SKProduct itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=496) [This way you have access to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=498) [billing and renewal terms of all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=499) [of your auto renewable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=501) [subscriptions not just the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=502) [introductory price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=503) [Also, in iOS 12 and macOS 10.14](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=506) [we've added the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=509) [subscriptionGroupIdentifier to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=509) [the SKProduct.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=511) [This is important because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=512) [introductory pricing eligibility](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=515) [is based on the subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=517) [group not the subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=518) [itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=519) [Each user is eligible for a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=521) [single introductory price per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=522) [subscription group.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=523) [This is because subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=525) [groups are meant to offer the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=527) [same features or content just a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=528) [different at renewal periods and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=530) [price points.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=531) [For example, many apps offer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=532) [both a yearly and a monthly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=534) [option for the same content with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=535) [the yearly one being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=537) [less-expensive over time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=538) [Now it wouldn't really make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=540) [sense for a user to receive an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=541) [introductory price to both the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=542) [monthly and the yearly option](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=543) [for exact same content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=545) [Since introductory prices are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=549) [applied automatically by the App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=550) [Store at the time of purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=552) [it's important that your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=553) [correctly determines the user's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=554) [eligibility when displaying the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=556) [price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=559) [For more information about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=559) [determining eligibility you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=560) [see the engineering subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=561) [session which is just after this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=563) [one at 3 o'clock.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=564) [Now with these new APIs you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=565) [have access to all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=568) [information you've set up in App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=569) [Store Connect for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=570) [subscriptions, so your app can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=571) [reflect any changes you make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=573) [without updates to your binary](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=574) [or to your server code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=575) [I'd like to invite Dana back on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=577) [who has a few tips and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=579) [improvements for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=581) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=584) [&gt;&gt; Thank you Ross, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=587) [Introductory Pricing is a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=589) [way to attract new customers if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=591) [your business model is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=594) [subscription.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=595) [But what if it doesn't make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=597) [sense for your app and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=598) [sense for your app and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=598) [app's business model to offer a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=600) [subscription service?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=601) [Well, starting today we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=603) [excited to announce that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=606) [offer free trials for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=608) [non-subscription based apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=609) [This will allow you to have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=611) [try before you can buy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=612) [experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=614) [So how do you do this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=615) [Well you take your payUpFront](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=619) [app and you make it free in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=622) [App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=625) [And then you add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=626) [non-consumable in-app purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=628) [to unlock.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=630) [So if your app is 9.99 in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=630) [App Store you're going to want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=632) [to make a non-consumable in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=633) [purchase of 9.99.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=635) [But it's important to let the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=638) [user decide when to begin the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=639) [trial period, so to do that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=641) [need to make a second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=643) [non-consumable in-app purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=645) [at price tier 0.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=647) [This will be a free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=648) [non-consumable that the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=650) [will use to begin their trial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=652) [period.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=654) [The naming convention of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=656) [free non-consumable should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=658) [free non-consumable should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=658) [detail out how long that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=660) [introductory period is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=662) [So in this example it's 14-day](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=664) [trial.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=665) [Before the user begins their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=667) [free trial, they should be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=670) [clearly informed of how long](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=671) [that trial is, in your app's UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=673) [what the ultimate cost is going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=675) [to be to unlock at the end of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=678) [that free trial.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=680) [And finally, what features or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=682) [content is going to be lost if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=685) [they let the free trial expire](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=687) [and choose not to purchase the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=688) [full unlock.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=690) [That information needs to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=691) [presented up front.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=692) [So this gives you a quick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=694) [overview of the change, I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=694) [going to talk more about how you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=696) [can implement this inside your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=697) [app when I go over receipts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=698) [Right now however I'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=700) [give an update on requesting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=704) [ratings and reviews.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=706) [Whether or not your app has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=708) [in-app purchases if it's in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=710) [App Store you care about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=711) [feedback your users are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=713) [give.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=715) [And there are ae few ways the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=715) [App Store and StoreKit can get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=716) [you that information.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=718) [First, in iOS 10.3 we introduced](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=721) [the SKStoreReviewController.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=724) [This is a powerful API and it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=726) [allows an app to give a quick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=728) [and easy prompt for the user to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=731) [select a star rating or maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=732) [even type in a review and get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=734) [right back to using your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=736) [But with great power comes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=738) [restrictions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=741) [First, we limit the number of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=743) [times that this prompt can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=745) [appear per app, per device and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=747) [per year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=750) [Second, if users choose never to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=752) [see these rating prompt they can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=755) [just go into App Store settings](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=757) [and disable them altogether.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=758) [So with those 2 restrictions in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=761) [mind what are some strategies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=763) [you want to use for when to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=765) [determine is the best time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=766) [call into the review controller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=769) [Well first and foremost, don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=772) [interrupt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=774) [If the user is in the middle of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=775) [playing that level and fighting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=777) [the big boss at the end of it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=778) [the big boss at the end of it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=778) [it's not a great time to ask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=781) [them to rate your game, wait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=782) [until they're done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=784) [You should also wait until both](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=785) [they've had enough experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=789) [with your app to actually have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=790) [good opinion about it, as well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=792) [as wait until they've had a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=794) [positive experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=795) [Maybe they just finished](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=796) [fighting that boss, maybe they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=797) [just ordered food and it got](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=799) [delivered through your app, wait](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=800) [until that positive experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=802) [Finally, I mentioned before that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=805) [we limit the number of times we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=806) [will prompt this review her app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=808) [per device, per year, but that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=810) [doesn't mean we do any sort of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=813) [rate limiting.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=814) [So if within one session you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=815) [call the SKStoreReviewController](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=817) [3 times and the user keeps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=820) [clicking not now they will see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=822) [that 3 times in a row.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=824) [It's up to you to add your own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=825) [rate limiting to your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=827) [So how does this look in code?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=829) [Well as I've been saying, wrap](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=831) [any call to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=834) [StoreReviewController around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=835) [your own app's business logic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=836) [Here's what you're going to want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=838) [to check, is this a good time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=839) [to check, is this a good time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=839) [do it, are they in the middle or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=840) [have they just completed a task.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=843) [Have they just had a positive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=845) [experience and have you prompted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=846) [recently, that's where you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=848) [to have your check.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=850) [As soon as all of those pass you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=851) [simply call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=853) [SKStoreReviewController.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=854) [requestReview.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=855) [It takes no input and it gives](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=857) [back no output, it's a simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=859) [but powerful API.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=861) [We've gotten immense response](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=863) [from developers about these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=865) [APIs, I'm happy to share a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=867) [with you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=868) [Zappos have said they're seeing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=870) [10 times the amount of reviews](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=872) [that they used to using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=874) [SKStoreReviewController and it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=876) [giving them the confidence to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=877) [know that they're delivering the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=879) [right things to their customers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=880) [Frosty Pop, maker of such great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=882) [games like Kingpin Bowling and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=885) [Ninja Attack have said that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=887) [they're getting greater](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=890) [visibility in the App Store and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=891) [because of a larger sample size](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=893) [they have a much greater and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=896) [more relevantly engaged user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=897) [base giving feedback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=899) [base giving feedback.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=899) [I hope this type of feedback](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=900) [convinces you that you shouldn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=903) [be using your own prompts to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=904) [request review you should move](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=906) [over to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=907) [SKStoreReviewController, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=908) [really has been making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=911) [tremendous gains.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=912) [As I'm sure you saw yesterday,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=916) [we announced a beautiful new Mac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=918) [App Store and we know you guys](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=920) [are all going to rush off and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=922) [make great new Mac apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=923) [And so with that we're excited](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=925) [to announce that we brought the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=927) [write a review API to the Mac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=929) [starting with Mojave.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=931) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=932) [So I mentioned there were a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=937) [ways you can get users to write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=938) [reviews for your apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=941) [Well another way of doing it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=944) [you can deep link right into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=946) [App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=947) [We also introduced this in iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=949) [10.3 and we're also bringing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=950) [that to the Mac this year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=952) [It's basically just a link right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=954) [into your product page, you tell](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=956) [the App Store bring up the write](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=957) [a review sheet and the user can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=959) [a review sheet and the user can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=959) [fill it out right then and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=960) [there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=961) [As an alternative to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=962) [SKStoreReviewController this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=964) [works much better from any sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=965) [of UI you might have where the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=967) [user has to take an immediate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=969) [action.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=970) [So for example, if you had a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=971) [button inside a settings page](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=973) [within your app basically asking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=975) [the user to kindly write a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=977) [review this would be a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=978) [time to use a deep link right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=980) [into your product page.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=982) [So how does this work?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=984) [Well pretty simple, you take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=985) [your product page URL and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=988) [add action=write-review to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=990) [end of it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=992) [This informs the App Store to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=992) [bring right up the write a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=994) [review sheet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=995) [If you don't know how to get a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=996) [product URL for your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=998) [linkmaker.itunes.apple.com is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1001) [great facility for finding that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1004) [You can get a lot more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1006) [information about ratings and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1007) [reviews, including how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1008) [respond to your customer reviews](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1009) [right on the developer website.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1011) [I'd like to do a deep dive into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1013) [the App Store Sandbox next.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1018) [So what do I mean by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1020) [Sandbox?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1022) [Well first what don't I mean,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1023) [I'm not talking about the app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1025) [Sandbox, that part of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1027) [operating system in kernel that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1030) [limits what resources your apps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1031) [have access to.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1034) [What I'm really talking about is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1035) [a dedicated environment, it's an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1036) [entire copy of the App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1038) [commerce engine on the server](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1040) [side that's there for you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1042) [test your apps and in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1044) [purchases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1046) [StoreKit knows when to go to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1048) [Sandbox environment based on how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1051) [your app is signed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1052) [So for example, you're building](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1054) [your app in Xcode, it's signed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1056) [with the developer's certificate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1058) [StoreKit knows right then and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1060) [there take all of your requests](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1061) [to the Sandbox environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1063) [If the user downloads the app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1065) [from the production App Store in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1068) [that case it's going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1069) [production signed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1070) [StoreKit knows to go right to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1071) [the regular production](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1073) [environment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1075) [So what makes the Sandbox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1076) [environment different?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1078) [Well first we don't charge, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1079) [Well first we don't charge, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1079) [is an environment for you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1082) [test your in-apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1084) [You're going to test them over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1085) [and over and over again, there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1086) [no reason to charge.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1088) [Second, we have specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1090) [dedicated Sandbox accounts that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1092) [you create in App Store Connect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1094) [for your developer to use in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1096) [Sandbox environment, they're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1098) [the same as your regular iTunes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1099) [in-apps accounts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1102) [We also as I mentioned before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1104) [have a completely different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1106) [backend environment which means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1107) [there's a completely different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1109) [URL from when you're doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1110) [server to server receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1112) [validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1113) [This is important to know if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1114) [you're taking that development](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1115) [test receipt from your device,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1117) [sending it to your QA server and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1119) [wanting to have that go to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1121) [Verify Receipt endpoint for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1124) [validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1125) [I'll talk more about that a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1127) [little bit later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1128) [We also offer some test modes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1130) [right in StoreKit.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1132) [So for example,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1133) [SKReceiptRefreshRequest can take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1134) [in an argument to get an expired](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1138) [in an argument to get an expired](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1138) [receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1140) [This way you can actually test](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1141) [hey what happens if I get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1143) [expired receipt later on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1144) [We also have an ability for you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1148) [to simulate what would happen if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1149) [a kid is asking their parent for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1152) [an in-app purchase.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1154) [We have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1156) [simulatesAskToBuyInSandbox.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1157) [Probably one of the biggest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1160) [differences is that when you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1161) [working with in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1164) [subscriptions we can track down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1165) [how long it takes to auto renew.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1167) [If you have an annual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1169) [subscription in your app it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1170) [would be ridiculous for us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1172) [make you wait a year to test](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1173) [your annual subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1175) [renewing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1177) [A general rule of thumb is 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1179) [year in real time equals 1 hour](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1181) [in Sandbox.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1184) [You can also see that if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1186) [have a monthly subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1187) [that's only 5 minutes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1188) [We also limit the number of auto](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1191) [renews in Sandbox to 5.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1193) [So when you buy that initial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1196) [subscription purchase you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1199) [subscription purchase you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1199) [have 5 automatic auto renews](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1200) [working up this cadence and at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1203) [the end it'll just stop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1204) [This is to simulate what would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1206) [happen if a user goes into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1207) [managed accounts and disables](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1209) [that subscription, they just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1210) [turn it off or what we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1211) [voluntary turn, they've decided](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1213) [they don't want to use your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1215) [service anymore.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1216) [So how do set all this up, how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1217) [do you work with the Sandbox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1221) [environment?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1222) [Well first you go into App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1223) [Connect, you create your users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1224) [You create your products that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1227) [you're going to sell, you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1229) [going to need to get that up on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1230) [the server side before your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1231) [starts working with that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1233) [You build and sign your app in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1235) [Xcode just like you do all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1236) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1237) [And you launch your app and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1239) [go find a product to buy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1240) [And then when prompted you sign](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1242) [in with your Sandbox account.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1244) [Now if you're paying attention](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1246) [you might have thought I missed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1248) [a step.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1250) [What would happen if I'm already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1251) [signed in to my production app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1253) [or iTunes Store, don't I need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1256) [sign out before using a Sandbox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1258) [sign out before using a Sandbox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1258) [account?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1260) [Well starting in iOS 12 that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1261) [no longer the case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1263) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1265) [Down here we've separated out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1271) [your production account from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1274) [your Sandbox account, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1275) [manage it separately just like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1276) [how we use the receipt to decide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1278) [which environment to use we use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1279) [the -- I'm sorry, just like we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1281) [use the certificate to know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1282) [which environment to use we know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1284) [to use the Sandbox account when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1286) [you're in development mode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1288) [So look forward to that in iOS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1290) [12 I think it's going to make a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1292) [huge difference for carrying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1293) [these test apps on your personal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1294) [devices for long-term testing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1295) [So now I'm going to invite Ross](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1298) [back up and he's going to talk](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1301) [about some best practices, some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1302) [things you want to keep in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1303) [when processing your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1305) [transactions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1305) [Ross.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1307) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1308) [&gt;&gt; I would like to go over a few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1315) [common questions and scenarios](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1316) [we see and discuss the best way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1317) [to handle them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1319) [to handle them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1319) [First things first, you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1321) [add your Transaction Observer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1322) [the default gaming queue as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1324) [early as possible in the life](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1325) [cycle of your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1326) [This is a common issue we see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1329) [where apps don't add a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1330) [Transaction Observer until the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1332) [user navigates to the in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1333) [purchase UI or even until they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1334) [begin a transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1336) [In fact we recommend adding it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1338) [right in the application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1340) [didFinishLaunching](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1341) [WithOptions method of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1342) [AppDelegate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1343) [Well why we recommend this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1345) [Well the Transaction Observer is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1347) [StoreKit's way of communicating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1349) [changes in transactions the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1350) [is making in their app and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1352) [pretty much all of these changes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1354) [are important.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1355) [And it's a good user experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1355) [and generally good business to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1357) [make sure you handle any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1358) [transaction promptly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1359) [There are a few cases when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1362) [transactions can become](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1363) [interrupted.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1364) [For example, if the user leaves](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1366) [your app in the middle of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1367) [transaction, maybe they got](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1368) [caught playing games in class.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1369) [Your app could be terminated by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1372) [the system later on or even by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1373) [the user and then when it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1375) [opened back up again StoreKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1376) [won't know to continue the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1378) [transaction until you add the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1379) [transaction until you add the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1379) [Transaction Observer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1380) [If the user decides to buy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1381) [something else this could result](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1383) [in confusion when they receive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1384) [two prompts or they could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1385) [receive a prompt out of nowhere](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1388) [when you finally add the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1389) [Transaction Observer again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1390) [Not great [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1393) [Another common case where the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1395) [user needs to leave your app in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1396) [the middle of a transaction is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1397) [if they have to edit their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1398) [billing info, this happens all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1398) [the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1400) [You'd have to leave your app and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1401) [you want to make sure to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1402) [smoothly continue the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1402) [transaction when they do return.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1403) [Finally, it happens your app can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1406) [crash, in this case you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1409) [make sure to smoothly continue](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1411) [as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1412) [Now there are some other reason](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1413) [as well that you want to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1417) [sure to add this as early as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1418) [possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1419) [There are several types of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1419) [transactions that can actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1421) [come from outside your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1423) [For example subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1425) [renewals come through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1426) [Transaction Observer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1427) [When an auto renewable renews](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1429) [successfully you'll receive a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1430) [transaction in the payment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1432) [queue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1433) [You definitely want to make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1433) [to receive this as early as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1436) [possible so you don't interrupt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1437) [the user's service when they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1438) [actually have paid for it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1439) [actually have paid for it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1439) [Also promoted in-app purchases,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1443) [users click on these in the App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1445) [Store and then the transaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1446) [is handed off to your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1447) [So you want to make sure to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1449) [a smooth transition there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1450) [Finally, if you set up promo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1453) [codes for your in-app purchases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1454) [these are redeemed from inside](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1455) [the App Store and sent to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1456) [app as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1457) [Another question we get all time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1463) [is when should I call Finish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1464) [Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1465) [Well the general rule is you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1467) [should call Finish Transaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1469) [after a transaction has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1470) [completed successfully and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1471) [have downloaded and delivered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1473) [all the content to the user or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1474) [after the transaction has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1477) [computed unsuccessfully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1478) [To get more specific, let's go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1480) [through all the transaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1483) [states and talk about how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1484) [handle them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1486) [The purchasing state you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1487) [need to do anything at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1490) [moment, just continue to observe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1490) [the payment queue and wait for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1492) [the state to change.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1493) [In the purchased state the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1494) [transaction has completed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1497) [successfully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1498) [You should download and deliver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1499) [You should download and deliver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1499) [all of the content to the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1500) [and then call Finish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1502) [Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1503) [In the failed state the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1504) [transaction has completed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1507) [unsuccessfully.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1508) [You should inspect the error and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1509) [handle it appropriately, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1511) [update your UI, record](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1512) [analytics, whatever you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1513) [do, and then you should call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1514) [Finish Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1516) [And it's also important to note](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1517) [here that transactions come back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1519) [in the failed state if the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1522) [cancels them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1523) [So it's very important that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1524) [do inspect the error and make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1525) [sure it's not the canceled error](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1526) [because you shouldn't show any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1528) [UI in that case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1529) [You know the user just canceled](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1530) [they don't need to know that it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1531) [failed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1532) [The restored state, this is very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1535) [similar to the purchased state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1537) [It indicates the transaction has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1538) [completed successfully, so again](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1540) [you should download and deliver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1541) [all of the content to the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1542) [and then you should call Finish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1544) [Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1545) [Finally, the deferred state,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1548) [this is similar to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1550) [purchasing state except it means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1551) [that the transaction is waiting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1553) [on some outside action to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1554) [continue.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1555) [For example, if a user has Ask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1557) [to Buy turned on, so Ask to Buy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1558) [to Buy turned on, so Ask to Buy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1558) [is a feature that allows parents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1561) [to manually approve or decline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1562) [transactions made by their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1564) [children.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1565) [Any user can have Ask to Buy set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1567) [up, but it can happen to any of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1569) [your in-app purchases so it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1571) [important that you handle this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1572) [case appropriately.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1573) [Speaking of Ask to Buy, if your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1578) [transaction is deferred due to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1580) [Ask to Buy the user will receive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1581) [a message from the App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1584) [saying that their parent has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1585) [been notified to approve it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1586) [If it is approved and then it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1589) [will be returned to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1591) [Transaction Observer in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1593) [purchased state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1594) [You should let the user know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1595) [it's been approved, of course](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1596) [deliver the content, and call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1598) [Finish Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1599) [If it's declined it will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1601) [returned to your Transaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1604) [Observer in the failed state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1605) [So here you should let the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1606) [know that it was declined and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1608) [then call Finish Transaction to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1609) [finish it up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1610) [However, if there's no action](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1612) [taken within 24 hours then the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1615) [transaction fails silently, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1618) [transaction fails silently, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1618) [means that nothing will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1622) [returned to your Transaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1623) [Observer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1624) [Furthermore, all Ask to Buy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1625) [transactions within that 24](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1627) [hours are consolidated into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1629) [single ask.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1631) [So the important takeaway here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1633) [is that you should not wait on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1634) [deferred transactions or even](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1635) [expect them to come back at all,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1637) [you should make sure you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1638) [lock the UI and allow the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1639) [to continue using your app as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1641) [much as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1642) [Another important tip when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1644) [working with in-app purchases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1646) [that have Apple hosted content](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1647) [via SKDownload is that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1649) [should always finish downloading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1651) [the hosted content before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1652) [calling Finish Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1654) [This is because once you call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1656) [Finish Transaction all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1657) [SKDownloads will be canceled and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1659) [no longer valid for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1661) [redownloading.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1662) [If you do this on accident then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1664) [you have to call Restore](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1665) [Transactions to get a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1667) [download to finish.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1668) [So even if your download fails](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1669) [you should withhold calling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1671) [Finish Transaction until you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1673) [retry it and you actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1674) [successfully download it and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1676) [deliver that content to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1676) [user.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1678) [Finally, if you're using Receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1680) [Verification you should always](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1682) [make sure to do this before](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1685) [calling Finish Transaction as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1686) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1687) [This is especially important for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1688) [consumable in-app purchases](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1689) [because consumable in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1691) [purchases only appear in receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1692) [as long as they're unfinished.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1694) [Once you do call Finish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1696) [Transaction they will no longer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1697) [appear in their seats and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1698) [won't be able to validate them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1699) [So if you're using Receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1701) [Verification make sure that it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1702) [a real Apple signed transaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1704) [the user paid for, always do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1706) [this before calling Finish](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1707) [Transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1709) [I'd like to hand it back to Dana](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1709) [to discuss some tips for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1712) [managing the receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1714) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1716) [&gt;&gt; Thanks again Ross.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1720) [So what is the receipt?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1723) [It's a lot like its name](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1726) [implies, it is a record of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1726) [app in in-app purchases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1729) [It's a lot like the piece of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1730) [paper you get when you buy some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1731) [retail good.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1733) [It's stored on the device, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1734) [a file, it's a file that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1737) [actually get from the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1739) [actually get from the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1739) [It comes from the server,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1740) [StoreKit doesn't make it and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1741) [store it on the device and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1743) [app can actually read it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1745) [It's signed by the App Store so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1747) [that's how you know it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1749) [authentic.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1750) [And finally, it's for your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1752) [and for that device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1755) [The receipt is an important way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1757) [for making sure that that app is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1759) [valid for the device it's trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1762) [to run on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1763) [How do you validate the receipt?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1764) [Well there's two things you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1768) [do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1769) [First, you can look at on-device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1769) [receipt validation, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1771) [where you can just use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1772) [cryptography right on your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1775) [device to validate that receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1776) [and unlock content right then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1778) [and there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1779) [Alternatively, you can do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1780) [server-to-server validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1782) [This is where you take the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1784) [receipt, send it up to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1785) [trusted server, and it'll manage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1787) [it for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1789) [In this case it'll call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1790) [itunes.apple.com/verifyreceipt,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1793) [send that receipt over and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1796) [App Store will validate it for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1797) [your trusted server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1799) [your trusted server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1799) [This is great if you have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1801) [subscription service on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1802) [backend.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1804) [However, I'm going to focus more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1805) [for the purposes of my talk for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1807) [on-device validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1809) [If you have a subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1811) [service I highly suggest you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1812) [check out engineering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1814) [subscriptions here in Hall 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1815) [today at 3 o'clock right after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1818) [this talk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1819) [But I do want to make one point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1820) [about server-to-server](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1824) [validation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1825) [As I said, it's completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1827) [correct, it's completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1828) [appropriate to take that receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1829) [from the device and send it up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1830) [to your server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1832) [But you should never send the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1834) [receipt from your device](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1836) [directly to Verify Receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1837) [You don't control either end of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1840) [that connection, you don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1842) [control the user's device and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1843) [what connections it makes and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1844) [you don't control the other end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1845) [with the App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1847) [There's no way to make a trusted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1848) [connection from your app right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1849) [then and there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1851) [You should send it, always send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1851) [it up to an intermediate server.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1853) [So what is the structure of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1855) [receipt?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1859) [Well it has some purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1860) [information, the certificates](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1861) [and signatures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1863) [We give you an API to pull it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1864) [off the file system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1866) [And as I said it's a single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1868) [file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1870) [We use opensource standards,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1871) [PKCS Cryptographic Container and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1875) [ASN.1 to store the metadata](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1878) [within the receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1880) [These are all well documented](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1881) [and well published open file](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1883) [formats.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1885) [And there are tons of options](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1886) [out there for verifying and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1889) [reading the receipt, OpenSSL,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1890) [asn1c, there's tons more, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1894) [can even build your own.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1896) [How do you read that receipt no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1898) [matter what API you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1899) [use?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1900) [Well you call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1901) [bundle.appStoreReceiptURL, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1902) [returns a URL to your app, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1904) [again it's just a path to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1906) [file in the file system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1908) [There you're going to want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1910) [read in that content, get that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1910) [blob of data into memory, and if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1912) [you're doing server-to-server](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1914) [validation send it up to your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1915) [server, otherwise you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1917) [process it right there on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1918) [process it right there on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1918) [device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1920) [When you are processing it if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1921) [you're using OpenSSL here are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1923) [some tips you want to follow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1925) [First, build a static library](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1927) [not a dynamic one, it much more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1930) [secure if you use a static](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1932) [library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1933) [Finally, if you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1935) [include the Apple Root CA](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1936) [Certificate, which is what you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1938) [need to validate the receipt you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1939) [can grab that online, there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1941) [tons of documentation out there,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1942) [but watch out for the expiration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1944) [of that receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1946) [So as I mentioned before there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1950) [tons of solutions out there for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1951) [this, but keep in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1953) [convenience comes at a price.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1955) [This is your business, you need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1957) [to understand and know the risks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1959) [that come to any solution you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1961) [implement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1962) [If you're using some popular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1964) [third-party solution out there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1966) [and there's an exploit within](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1967) [there your app is going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1969) [vulnerable to that as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1971) [It's your revenue stream, make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1973) [sure you understand what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1975) [products you're choosing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1977) [So I mentioned that there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1982) [signature and there's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1984) [certificates within the receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1985) [One best practice is don't check](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1987) [the expiration date of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1990) [certificates within the receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1992) [against the current clock.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1993) [First of all, the user can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1995) [actually change the clock on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1997) [device, but more importantly the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1998) [receipt isn't necessarily](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2004) [invalid just because the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2006) [certificates within it are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2007) [expired.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2009) [What you should be comparing it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2010) [to is the dates of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2011) [transactions within the receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2013) [As long as all the transactions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2015) [occurred before the certificate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2017) [is expired it's a valid receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2018) [So let's dive in and get a sense](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2023) [of what is inside the receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2025) [That purchase information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2028) [contains just a bunch of types](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2029) [and attributes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2031) [Here you can see there's a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2033) [bundle identifier and a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2034) [other values that go along with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2036) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2038) [If you're going to check that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2041) [the receipt is for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2042) [application first you want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2043) [check that bundle identifier and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2045) [you want to check type 3, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2047) [gives you the version that goes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2050) [with the app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2051) [But a best practice here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2054) [always use hardcoded values,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2055) [don't just read from your app's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2057) [Info.plist.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2059) [It's too easy to change the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2060) [Info.plist to match an invalid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2062) [receipt to spoof your app into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2064) [running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2066) [Now that you've matched that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2067) [bundle identifier and version to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2069) [the receipt you're going to want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2071) [to make sure that it's valid for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2073) [your device and the way to do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2075) [this is to use attribute 5.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2076) [Attribute 5 is shawl SHA-1 hash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2079) [of a couple values, including](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2082) [the bundle identifier, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2084) [device identifier, the thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2086) [that represents the hardware](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2088) [that is running your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2089) [application, and an opaque](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2090) [value.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2092) [This is a bit of cryptic or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2093) [[inaudible] entropy, it changes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2094) [over time and we store that in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2095) [the receipt as type 4.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2097) [You're going to take those 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2099) [You're going to take those 3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2099) [values, generate your SHA-1 hash](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2100) [and compare and if it matches](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2104) [what you generate with what's in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2107) [the receipt you know that that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2109) [receipt was generated for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2110) [app on that device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2112) [Well what happens if you get an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2117) [invalid receipt or it just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2118) [doesn't exist for whatever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2121) [reason?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2122) [StoreKit gives you APIs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2124) [request a new receipt from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2126) [App Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2128) [Again, the receipt comes from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2130) [our commerce backend so you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2131) [going to need a network in order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2133) [to be able to complete this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2135) [operation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2136) [In order to make sure that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2138) [are using an authentic receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2141) [from an authentic user a sign-in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2143) [may be required.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2144) [When you get an updated receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2146) [you need to be careful to avoid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2149) [any sort of continuous loop of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2151) [validate and refresh.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2153) [If you get an updated receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2154) [check it once and if it's still](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2156) [invalid error out then.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2157) [So what does this look like in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2160) [code?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2161) [You simply call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2162) [SKReceiptRefreshRequest, you set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2163) [your purchase queue delegate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2166) [right there on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2168) [ReceiptRefresh, you call start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2169) [and as that receipt gets updated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2171) [we'll call back and let you know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2172) [when it's down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2174) [On macOS you can also call exit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2175) [173, that 173 code will tell the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2179) [operating system and tell](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2183) [StoreKit to refresh a receipt on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2184) [your behalf.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2187) [There the app will get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2189) [relaunched once a new receipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2190) [comes down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2191) [As I mentioned earlier, we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2192) [now allowing non-subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2196) [apps to do free trials and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2198) [receipt is a great way to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2199) [understand is the user in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2201) [middle of a free trial or have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2203) [they bought the full unlock](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2205) [non-consumable IAP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2208) [To do this you're going to want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2209) [to look for type 17 within the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2213) [receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2215) [This includes all of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2216) [subscription consumable and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2218) [subscription consumable and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2218) [non-consumable IAPs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2220) [Within type 17 there's a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2223) [subdictionaries of data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2225) [Type 1702 is going to be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2228) [product identifier that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2232) [associated with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2234) [non-consumable IAP.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2235) [This is where you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2237) [want to check to see is it my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2239) [non-consumable that represents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2241) [the beginning of the free trial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2243) [or the non-consumable that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2244) [represents the full unlock of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2245) [the app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2247) [You're also going to want use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2249) [type 1704, this is where you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2250) [check the purchase date of when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2252) [that consumable was actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2253) [made.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2254) [So what's the algorithm you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2258) [going to want to follow?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2259) [Well first, you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2260) [iterate over all those in-app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2261) [purchases, all of those type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2263) [17's.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2264) [If you find any within the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2266) [receipt that matches the product](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2268) [identifier that you've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2270) [represented the Full Unlock of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2271) [the app you're done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2273) [You know that the user has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2274) [purchased the Full Unlock of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2276) [your app, give them the access](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2277) [to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2279) [to it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2279) [Alternatively, if you find a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2281) [Free Trial Product Identifier,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2283) [the product identifier that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2285) [represents the user beginning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2286) [their free trial you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2288) [want to look at the purchase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2289) [date associated with that free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2290) [trial.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2291) [Here's where things get a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2293) [tricky.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2294) [You can't always trust the clock](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2295) [on the device, again the user](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2297) [can change that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2298) [So you might want to use your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2299) [own backend server or some sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2300) [of time server to make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2302) [it's still within your free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2304) [trial period.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2305) [There's also device check APIs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2307) [which I highly recommend you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2310) [check out that help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2310) [determine whether or not the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2312) [user has previously completed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2313) [their free trial window on that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2315) [device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2317) [Lastly, if neither are present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2319) [this is your signal to display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2321) [that free trial upsell to begin](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2323) [the free trial, but again you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2326) [need to be careful to make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2328) [you represent the length of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2329) [free trial, the content that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2331) [they're going to lose if they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2332) [don't buy that Full Unlock, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2334) [the ultimate price of the Full](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2336) [Unlock.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2338) [If you already have an app in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2341) [the App Store and you're selling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2343) [it or you have a subscription](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2345) [model and you want to move to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2346) [new free trial there's some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2348) [things you can also use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2350) [receipt for to make that easier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2351) [for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2352) [So if you're paid up front and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2354) [you want to move to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2355) [subscription or if you're paid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2356) [up, paid up front and you want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2358) [to move to a free trial use type](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2359) [19.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2362) [This will tell you the original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2363) [version that the user purchased](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2365) [that app with from the App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2367) [Store.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2368) [Even if they delete the app and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2369) [redownload it over and over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2371) [again that type 19 will tell you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2372) [exactly what version they bought](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2374) [their app with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2376) [If the user did originally pay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2377) [up front make sure to give them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2381) [the functionality that they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2384) [bought.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2385) [Just because you move to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2386) [subscription model if they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2387) [bought it when it was a paid for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2388) [app in the App Store you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2390) [give them that access to that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2393) [content they originally paid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2394) [for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2395) [So again use type 19 within the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2397) [So again use type 19 within the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2397) [receipt to know what version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2400) [they bought that app with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2402) [So we went over a lot of things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2404) [today, we talked about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2406) [Introductory Pricing, this is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2407) [great means of enticing new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2409) [customers into your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2411) [subscription, you can show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2412) [content right on the App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2414) [if you're merchandising your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2417) [subscription IAPs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2418) [I also talked about how you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2420) [now offer non-subscription free](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2422) [trials within your apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2424) [We talked about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2427) [SKStoreReviewController and how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2428) [developers have seen such a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2431) [great response to that and how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2432) [we brought it to the Mac App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2433) [Store this year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2434) [Talked about the Sandbox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2437) [environment and how now we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2438) [manage your Sandbox account](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2439) [separately from your regular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2441) [iTunes and App Store production](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2442) [accounts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2444) [Ross gave a great overview of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2445) [things you need to keep in mind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2447) [when processing your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2448) [transactions, including making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2449) [sure to observe early and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2451) [knowing when the right time to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2453) [call Finish Transaction is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2454) [And finally, I gave you some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2456) [good points on how to manage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2458) [good points on how to manage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2458) [that in-app receipt for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2460) [on-device validation and making](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2461) [sure your free trials go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2462) [smoothly using the receipt.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2464) [For more information I highly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2467) [suggest you stick around for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2469) [Engineering Subscriptions if you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2470) [have a subscription business](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2472) [model.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2473) [We're also going to be at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2474) [labs today at 4 o'clock and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2475) [Thursday morning at 9 a.m. We'd](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2478) [love to get your questions and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2479) [help you out as best we can.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2481) [Thanks so much for coming.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2482) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2484)