# Best Practices and What’s New with In-App Purchases

## Summary
Learn about the latest updates in StoreKit, including offering introductory pricing for subscriptions, requesting ratings and reviews, promoting your in-app purchases within the App Store, and developing in the sandbox environment. Dive deep into best practices for processing transactions and validating receipts.

## Info
* App Store and Distribution
* WWDC 2018 - Session 704 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/

## Text
 [（app内购买项目的
最佳实践与新特性）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=17) [(演讲704)](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=20) [下午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=21) [欢迎来听“app内购买项目的
最佳实践与新特性”演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=27) [我叫Dana DuBois
我是App Store工程经理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=30) [app内购买项目是
App Store中许多app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=34) [开展业务的必要组成部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=36) [不管你是有订阅模型 可能是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=39) [视频流服务或是报纸、杂志订阅
或者是你提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=42) [用户可以重复购买的消耗性产品
像是游戏内货币](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=48) [或是一些非消耗性产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=52) [用户只要买一次就可以一直用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=53) [将用户体验搞好是很重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=58) [将用户体验搞好是很重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=58) [毕竟这是你的生意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=62) [我们会介绍一些不错的实践方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=65) [来帮助你提升用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=67) [我们还会介绍一些我们一直在做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=70) [致力于提升用户体验的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=73) [首先我要请同事Ross上台来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=78) [请他来介绍下推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=81) [这是我们去年十二月发布的一个功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=83) [它可以帮助你吸引新用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=85) [我会介绍下
App Store中的试用功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=89) [我们会介绍评分与评价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=94) [及如何让用户到App Store
对你的app进行反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=96) [我会介绍你该如何使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=101) [Apple App Store沙盒环境
测试你的app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=102) [Ross会回来给你们介绍
有关交易处理的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=108) [在这个时候你会实际购买
app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=112) [最后我会给你们概述
app内收据的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=116) [最后我会给你们概述
app内收据的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=116) [首先让我的同事Ross来介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=121) [谢谢 Dana](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=126) [在iOS 11.2和
macOS 10.13.2中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=129) [我们向app内购买的订阅中
添加了推广性定价功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=133) [你可以给新订阅者
一个一次性的折扣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=137) [我们在App Store
Connect中设置推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=141) [而且每个订阅
同时只能有一个推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=144) [当有合格的用户
购买你app中的订阅时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=149) [App Store
会自动使用这个折扣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=152) [根据订阅群组 每个用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=156) [都会符合一个单独的推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=159) [我会在晚些时候进行介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=160) [除了推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=164) [我们还在StoreKit中
加了几个新类型和属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=165) [这些API反应了你在App Store
Connect中所设置的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=169) [你可以使用它们格式化你的用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=173) [给你的用户显示订阅条款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=175) [还可以决定哪些用户
是有资格使用推广性定价的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=178) [还可以决定哪些用户
是有资格使用推广性定价的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=178) [例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=184) [当你对一个促销的app内购买项目
设定推广性定价时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=185) [App Store看起来是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=187) [你们会发现 它很清晰自然地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=191) [将订阅的条款介绍给了用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=193) [第一年是19.99
以后每年是39.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=196) [推广性定价对于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=201) [促进你app内购买项目的销售
也有很大益处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=202) [用户甚至能在安装你的app前
就能看到折扣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=205) [今天我会和你们谈谈这些新API
并且看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=209) [有哪些办法可以设置推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=212) [首先在SKProduct上
有个新属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=217) [恰如其分地叫
introductoryPrice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=220) [有个新的类叫做
SKProductDiscount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=224) [这个类包含了所有你需要用来
设置推广价的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=227) [如你所见 这是个可选的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=231) [那是因为只有订阅才有推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=233) [而且不是所有的订阅都有推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=236) [让我们来仔细看下
SKProductDiscount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=239) [让我们来仔细看下
SKProductDiscount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=239) [反映了你所设置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=243) [在App Store Connect中
关于推广价的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=245) [它有price
和priceLocale属性 这些属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=249) [与SKProduct中
你所熟悉的同名属性有相似性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=252) [还有个
subscriptionPeriod属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=257) [这是个叫
SKProductSubscriptionPeriod的新类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=260) [它反映了关于推广价付款和续费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=264) [的全部数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=266) [它是通过自己的两个属性来实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=269) [第一个属性是Unit
这是枚举 可以是天、星期、月或年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=272) [第二个属性是
numberOfUnits](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=277) [例如 如果你有一个月的Unit
还有两个numberOfUnits](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=279) [这就意味着推广价
会每两个月续费一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=285) [在SKProductDiscount上
也有一个numberOfPeriods属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=290) [它反映了推广价有效的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=294) [订阅周期数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=297) [比方说 你有个两个月的推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=299) [比方说 你有个两个月的推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=299) [周期数为3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=302) [这就意味着
该推广价总共六个月有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=303) [最后在SKProductDiscount上
有个PaymentMode属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=310) [这个新的枚举有三个值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=315) [第一个值是payAsYouGo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=319) [这就像是个普通的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=321) [用户在每个续费周期只付一次款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=323) [而这些订阅的续费周期必须跟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=327) [你所设置的基本订阅推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=329) [的续费周期相一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=331) [如果你有个一个月长的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=333) [你就不能在这里设置两周长的推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=336) [你可以使用这些类型的推广价
来向你的用户提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=340) [更长 更提前 没有分歧的推广期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=343) [例如 如果你有个三个月的续订](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=348) [需要付9.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=353) [你就可以设置一个6个月的推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=355) [一共续费两次 每次1.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=358) [一共续费两次 每次1.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=358) [付费期看起来是这样的 用户购买了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=362) [推广价为1.99的订阅
他会收到三个月的访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=366) [到期后他们可以
再以1.99续费三个月](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=371) [在那之后 他们会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=377) [以9.99的常规订阅条款
来续费三个月](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=378) [在本例中 来自StoreKit的
数据看上去是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=383) [你能看到subscriptionPeriod
的单位是月](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=386) [而单位数为三
所以它会每三个月续费一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=389) [而周期数为2](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=393) [这样我们就有总共六个月的推广期了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=394) [付款模式是即买即用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=398) [推广价是1.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=399) [接下来的付款模式是
payUpFront](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=405) [这类的推广价就是
用户只需要付一次款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=409) [就可以收到整个的推广期订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=412) [这并不限于你的多个订阅续费期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=415) [在本例中
你能有个一年的续费订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=419) [在本例中
你能有个一年的续费订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=419) [并提供一个月的推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=422) [拿我们前面的例子来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=427) [我们有个三个月的自动续费订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=429) [这次我们提供一个
六个月推广价的提前付款方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=432) [你要付3.99
就跟上例的总体花费是相同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=438) [但这次用户提前付3.99
就可以收到整个六个月的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=441) [在那之后
我们会每三个月以9.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=447) [这个常规订阅条款来续费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=450) [StoreKit中的数据
在本例中看起来是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=455) [订阅周期的单位还是月](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=458) [但这次我们有六个单位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=460) [而周期数是1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=462) [因为这是个提前付款的推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=464) [最后一个付款模式是
freeTrial](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=471) [它跟老的freeTrial
功能是一样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=474) [用户不需要付款
就能收到整个推广周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=476) [它在从三天到一年的范围都是可用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=480) [抱歉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=488) [在iOS 12
和macOS 10.13.2中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=490) [我们向SKProduct添加了
subscriptionPeriod属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=494) [这样你就可以访问
你所有自动续费订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=498) [付款和续费条款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=501) [不仅仅是推广价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=502) [我们在iOS 12
和macOS 10.14中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=506) [还向SKProduct加入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=509) [subscriptionGroupIdentifier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=511) [这很重要 因为推广性定价的资格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=514) [是基于订阅群组的
而不是订阅本身](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=517) [每个用户对应一个订阅群组的
一个推广价就是合格的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=521) [这是因为订阅群组就是要为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=526) [不同的续费期和价格点
提供相同的功能或内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=529) [例如 许多app为相同的内容
提供了年度和月度的选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=532) [而年度的会随着时间加长更便宜些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=536) [用户如果为相同的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=540) [收到月度和年度的推广价是不合理的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=543) [由于推广价是在购买的时候
由App Store自动应用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=549) [你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=552) [要在显示价格时正确地决定
用户是不是有资格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=554) [关于决定资格的更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=559) [你可以听下“工程订阅”这个演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=561) [就在本场演讲结束后的三点开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=563) [现在有了这些新API
你就可以访问所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=567) [你在App Store Connect中
所设置的关于你订阅的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=570) [这样你的app不需要更新二进制
或是你的服务器代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=572) [就可以反映出你所做出的任何变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=574) [我想请Dana回到台上来
向你们介绍一些提示和改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=578) [谢谢 Ross](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=587) [如果你的商业模型是订阅的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=589) [推广性定价
是个不错的方法来吸引新用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=594) [但是如果你的app和商业模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=597) [但是如果你的app和商业模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=597) [不适合开展订阅服务呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=601) [从今天开始
我们很激动地宣布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=603) [你可以为没有订阅的app
提供免费试用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=607) [你可以在购买前先试用一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=612) [你要如何实现呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=617) [你要把你提前付款的app做成
免费的 放到App Store上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=619) [然后你要添加一个解锁用的
非消耗性app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=626) [若我的app在App Store
标价9.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=630) [你就要将这个非消耗性的
app内购买项目定价为9.99](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=632) [重要的是 你要让用户自己决定
什么时候开始试用期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=638) [要这么做的话 你需要再做一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=642) [0级价位的
非消耗性app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=644) [这是个免费的非消耗性内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=648) [用户可以用它来开始试用期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=652) [该免费非消耗性内容的命名规范](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=656) [要详细说明推广期有多长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=660) [在本例中 是14天试用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=664) [在用户开始他们的使用之前
他们应该从你app的用户界面中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=668) [清楚地知道试用期有多长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=673) [在免费试用结束时
最后解锁要花多少钱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=677) [最后还有就是
如果他们让免费试用过期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=682) [并且不购买完全解锁的话
会失去什么功能或内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=686) [该信息需要被提前呈现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=691) [它会让你对变化有个快速了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=693) [我会在介绍收据的时候
讲一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=696) [应该如何在你的app中实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=697) [而现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=701) [我想介绍下
关于请求评分和评价的更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=704) [不管你的app中
有没有app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=708) [只要在App Store中上架了
你就会关心用户所给出的反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=711) [App Store和StoreKit
有几种方法来能你获得该信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=715) [首先在iOS 10.3中 我们引入了
SKStoreReviewController](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=721) [这是个很棒的API
它可以让app快速弹出一个窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=725) [让用户选择一个星级评分
甚至是写一个评价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=732) [然后回来接着用你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=735) [不过这么厉害的功能肯定是有限制的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=738) [首先我们限制了每个app
在每台设备上每年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=742) [能弹出此窗口的次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=747) [其次 如果用户永远都
不想看到这些评分窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=752) [他们只需要去App Store
设置中把它们全部禁用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=757) [有了这两个限制 你可以用什么策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=761) [来决定什么时候
来调用评价控制器呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=766) [首先就是我们不要打扰到用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=772) [如果用户正在玩某个关卡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=776) [而且正在打关底的首领](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=778) [而且正在打关底的首领](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=778) [这不是让他们对你游戏评分的好时机
等到他们打完了再说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=781) [你还应该等到
他们对你的app有了足够的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=787) [对其形成了完整的看法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=790) [还要等他们对你的app
有了一个正面的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=793) [可能他们刚刚打完了首领
可能他们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=796) [刚通过你的app订了餐
等到他们有了正面的体验再说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=800) [最后 我之前提过我们限制了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=805) [这个app每台设备每年
能弹出的评价窗口的次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=806) [但是我们没有限制评分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=812) [所以如果在一次会话中你调用了
SKStoreReviewController三次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=815) [并且用户一直在点击现在不要
他们就会连续看到三次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=821) [你可以自己决定app中的
评分限制次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=825) [它在代码中是什么样？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=829) [正如我一直在说的 将对于
StoreReviewController的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=831) [隐藏到你自己app的业务逻辑中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=836) [你要检查下
现在是这么做的好时机吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=838) [你要检查下
现在是这么做的好时机吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=838) [他们是还在某项任务中
或是刚刚完成任务吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=841) [他们是不是刚收获了正面的体验呢？
你最近有没有弹出过窗口呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=845) [你要在检查中加入这些判断条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=849) [如果所有这些判断条件都通过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=851) [你就可以调用SKStoreReviewController.
.requestReview](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=853) [它没有输入和输出
它是个简单但功能强大的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=857) [我们已经收到了很多来自开发者的
对于这些API非常好的反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=863) [我很高兴能给你们分享其中的一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=868) [Zappos说道 他们通过使用
SKStoreReviewController](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=870) [收到了原来十倍的评价
而且这让他们有信心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=875) [他们是在将正确的内容给用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=879) [Frosty Pop是Kingpin Bowling
和Ninja Attack这些伟大游戏的开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=882) [他们在App Store
的曝光度更高了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=889) [因为有了更大的样本
他们可以更好地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=893) [获得相关用户群体提供的反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=897) [获得相关用户群体提供的反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=897) [我希望这类反馈能说服你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=901) [不要用自己的弹出窗口来请求评价了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=903) [你应该使用
SKStoreReviewController](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=907) [它真的能为你带来很大的收获](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=911) [我相信你们看到我们昨天发布了全新
漂亮的Mac App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=916) [我知道你们会去赶紧开发一些
很棒的新Mac app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=921) [所以我们很激动地宣布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=925) [我们给Mac带来了写评价API
从Mojave开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=928) [我提过了 你有几种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=937) [让你的用户
为你的app写评价的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=938) [另一种方法就是你可以设置
App Store的深度链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=944) [我们也在iOS 10.3中
引入了它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=949) [今年我们也会将它带到Mac中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=951) [它基本上就是一个
进入到你产品页面的链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=954) [你告诉App Store
打开写评论表单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=957) [你告诉App Store
打开写评论表单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=957) [用户可以随时随地填写这个表单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=960) [作为SKStoreReviewController
的替代品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=962) [这可以在用户需要
采取快速行动的任何用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=965) [表现得更出色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=968) [例如 如果你的app中的
设置页面有个按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=971) [要请用户写个评价的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=976) [这时候在你的产品页面中
用个深度链接非常不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=979) [那要如何实现呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=984) [非常简单 你只要在产品页面URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=985) [的后面加上action=write-review
就可以了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=990) [这会让App Store
直接打开写评价的表单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=992) [如果你不知道如何获得
你app的产品URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=996) [linkmaker.itunes.apple.com中
就可以找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1001) [你可以获得
关于评分和评价的更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1006) [包括如何直接在开发者网站上
回复你的用户评价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1009) [我接下来想深入介绍下
App Store沙盒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1015) [我说的沙盒是什么意思呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1020) [首先我说的不是什么呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1023) [我不是在说
操作系统内核中的app沙盒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1026) [它限制了你的app可以访问的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1030) [我所介绍的是一个专用的环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1035) [它是服务器端App Store
商业引擎的一个完整备份](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1038) [你可以在那里对你的app
和app内购买项目进行测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1042) [StoreKit知道什么时候
要进去沙盒环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1048) [它根据你app
如何被签署进行判断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1052) [例如 如果你是在Xcode中
构建你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1054) [它就是由开发者证书签署的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1057) [StoreKit知道何时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1060) [将你的所有请求发送到沙盒环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1062) [如果用户是从生产
App Store下载的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1066) [这时候就是生产签名的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1069) [StoreKit知道
要去常规的生产环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1071) [那沙盒环境有什么不同呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1076) [首先我们不会扣款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1079) [首先我们不会扣款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1079) [这是个让你用来测试
app内购买的环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1082) [你会一次又一次地进行测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1085) [是没有理由扣款的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1087) [其次我们在App Store
Connect中有专门的沙盒账号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1090) [可以让你的开发者在沙盒环境中使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1094) [这些账号跟你的普通iTunes
app内购买账号是不一样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1099) [正如我之前提过的
我们的后台环境也是完全不同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1105) [这意味着在你做服务器
到服务器端收据验证时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1108) [会有个完全不同的URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1111) [这很重要 如果你要将开发测试收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1114) [从你的设备中发送到QA服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1118) [在验证收据端点进行验证的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1122) [我接下来会再介绍一些相关内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1127) [我们还在StoreKit中
提供了一些测试模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1130) [例如
SKReceiptRefreshRequest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1133) [可以传入参数来获得一个过期的收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1137) [可以传入参数来获得一个过期的收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1137) [这样你就可以测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1141) [“如果我得到了一张过期的数据
那么然后会发生什么呢？”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1143) [我们还可以让你模拟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1148) [如果孩子要家长
进行app内购买是什么样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1152) [我们在沙盒中有
simulatesAskToBuy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1156) [可能其中的一个很大不同就是当你在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1160) [处理app内订阅的时候
我们可以追踪多久要自动续费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1164) [如果你在app中有个年度订阅的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1169) [我们让你等一年才能测试
你的年度订阅续费是很荒谬的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1173) [一个基本原则就是
现实中的一年等于沙盒中的一个小时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1178) [你还可以看到 如果你有个月度订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1186) [那在沙盒中就是五分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1188) [我们还将沙盒中的
自动续费限制次数设为5](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1191) [当你购买初始订阅的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1196) [当你购买初始订阅的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1196) [你会有五次自动续费依次出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1200) [最后会自己停掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1204) [这是为了模拟用户进入管理账号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1206) [禁用订阅的时候会发生什么
他们将其关闭](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1209) [或者我们称之为自愿转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1212) [他们决定不想再用你的服务了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1215) [你该如何对这些内容进行设置
及如何使用沙盒环境呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1220) [首先你要进入App Store
Connect创建你的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1223) [你要创建想卖的产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1228) [在你配置app之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1230) [要先把服务器端配置好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1232) [一如既往 在Xcode中
构建并签名你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1235) [你要启动你的app
找到一个要买的产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1239) [然后在弹出窗口登录你的沙盒账号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1242) [如果你注意到的话
会发现我少了一个步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1247) [如果我已经登录了产品app或
iTunes Store会怎样？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1252) [难道你不用在使用
沙盒账号之前先登出吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1258) [难道你不用在使用
沙盒账号之前先登出吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1258) [从iOS 12开始
就不再需要这么做了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1261) [我们将你的产品账号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1271) [与你的沙盒账号分开了
你可以单独对其进行管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1274) [就像我们如何用数据
来决定要使用哪个环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1277) [抱歉 就像我们如何用证书](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1282) [来决定要使用哪个环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1283) [我们知道在开发模式的时候
要使用沙盒账号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1285) [我很期待iOS 12中的该功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1290) [我觉得这会让在你的个人设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1292) [长期测试这些app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1293) [发生一个很大的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1296) [我想请Ross回到台上来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1300) [他会介绍一些最佳实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1301) [一些你在处理交易的时候
需要注意的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1303) [Ross](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1307) [我想介绍一些常见的问题
和看到的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1315) [讨论下处理它们的最好方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1318) [首先你应该将交易观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1321) [尽早在你app的生命周期中
添加到默认支付队列中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1324) [这是我们遇到的一个常见问题
app里刚开始没加交易观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1329) [直到用户到了
app内购买用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1333) [或者甚至开始交易的时候才加上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1335) [其实我建议就把它加到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1338) [application:
:didFinishLaunchingWithOptions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1340) [这个AppDelegate方法上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1342) [为何我们要这样建议？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1345) [交易观察器是
StoreKit中用来交流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1347) [用户在你app进行交易时
产生的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1350) [所有这些变化通常都是很重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1354) [迅速地处理好所有交易能保证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1356) [你获得很好的用户体验和业务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1358) [有些时候交易可能会被干扰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1362) [例如 如果用户在交易中
离开你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1366) [可能他们在上课时玩游戏被抓到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1369) [你的app可能会随后
被系统或是用户终止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1372) [然后当它再被打开的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1376) [StoreKit在你加上
交易观察器前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1377) [就不知道要继续交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1379) [就不知道要继续交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1379) [如果用户决定再买点别的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1382) [这可能会让他们收到两个弹出窗口时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1385) [或对你最后加上交易观察器时
突然弹出的窗口感到疑惑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1388) [这样的用户交互体验不是很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1392) [另一个常见的问题就是
用户需要在交易中离开你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1395) [因为他们要编辑他们的支付信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1397) [这些问题一直会发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1399) [你会离开app 并且保证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1401) [在他们返回app时
可以顺畅继续交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1402) [最后就是有时候你的app会崩溃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1407) [在这种情况下
你也需要保证它可以流畅地继续运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1410) [还有其他一些原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1415) [你要尽早添加这个内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1417) [还有几种类型的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1421) [可能来自你的app之外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1422) [例如来自交易观察器的续订](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1425) [当一个自动续订的订阅
续费成功的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1429) [你会在付款队列中收到一笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1431) [你要尽可能早地收到此信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1434) [这样你就不会在用户已付款的情况下
中断用户的服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1437) [这样你就不会在用户已付款的情况下
中断用户的服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1437) [在推广的app内程序购买中
用户点击App Store中的这些内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1443) [交易会转移到你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1447) [所以你要确保衔接顺利](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1449) [最后如果你为app内购买
设置了促销代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1453) [这些会从App Store兑换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1456) [然后也会被发送到你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1457) [我们遇到的另一个问题是何时该调用
finishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1463) [一般来说你应该
在交易完全成功后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1467) [调用finishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1470) [还有已下载并向用户交付了所有内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1473) [或是在交易未成功完成的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1476) [为了更具体地解释
让我们来看看所有的交易状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1481) [并讨论下如何处理它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1485) [你目前无需在购买状态下
执行任何操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1488) [只需继续观察付款队列
并等待状态发生变化即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1491) [在已购买状态下
交易已经成功完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1496) [你应该下载并向用户提供所有内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1500) [然后调用
finishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1502) [在失败状态下
交易彻底失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1506) [你应该检查错误并妥善处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1510) [你可能要更新用户界面
记录分析 完成所有事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1512) [然后你应该调用
finishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1515) [此处还需要注意的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1518) [如果用户取消这些交易
交易将以失败状态返回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1522) [所以你要检查错误 并确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1524) [这不是由于用户取消交易产生的错误
因为在这种情况下不应显示任何界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1527) [用户刚选择取消了
他们不需要知道交易失败了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1530) [恢复状态
与购买状态非常相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1535) [它表示交易已经成功完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1539) [所以你应该再次下载
并将所有内容提供给用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1541) [然后你应该调用
finishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1544) [最后 延迟状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1548) [它类似于购买状态
除了它意味着交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1550) [正在等待一些外部行动后继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1554) [例如
用户开启了请求购买功能的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1557) [请求购买功能可以让家长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1560) [手动批准或拒绝子女进行的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1562) [任何用户都可以设置请求购买](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1567) [但它可能会发生在
任何app内购买项目中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1570) [所以你需要恰当地处理这种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1572) [说到请求购买的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1577) [如果你的交易由于请求购买而延期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1580) [用户将从App Store
收到消息说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1583) [他们的父母已被通知批准交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1585) [如果交易被批准
那么它将以购买状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1589) [返回到交易观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1594) [你应该让用户知道它已被批准](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1595) [当然还要发送内容并调用
finishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1598) [如果它被拒绝](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1602) [它将在失败状态
返回到交易观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1604) [这里你应该让用户知道它被拒绝了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1607) [然后调用
finishTransaction来完成它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1609) [但是如果在24小时内
没有采取任何措施](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1612) [那么交易就会静默地失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1617) [那么交易就会静默地失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1617) [这意味着什么都
不会返回到你的交易观察器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1622) [此外 24小时内的
所有请求购买交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1625) [都会合并为一个任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1629) [所以重要的一点是
你不该等待延期交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1633) [甚至不要期望它们会回来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1635) [你该确保你不要锁定用户界面
并允许用户尽可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1639) [继续使用你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1641) [另一个重要提示是 在app内购买](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1644) [已经通过Apple托管
SKDownload内容时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1648) [你该在调用finishTransaction前
先停止下载托管的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1651) [这是因为在你调用了
finishTransaction之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1656) [所有SKDownloads
都将被取消并且不能被重新下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1659) [如果你不小心这么做了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1664) [你须调用restoreTransactions
开始一个新下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1665) [即使你的下载失败了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1669) [也应该先暂停调用finishTransaction
直到你重新下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1671) [并且成功下载
而且将该内容提供给用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1675) [最后如果你使用了收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1681) [你需要确保在调用finishTransaction之前
执行此操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1684) [这对可消耗性app内购买尤为重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1688) [因为可消耗性app内购买](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1691) [只有在未完成时才会出现在收据中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1693) [在你调用了
finishTransaction之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1696) [它们就不会再出现在自己的位置上
你也就无法再验证它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1697) [因此如果你使用了收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1701) [请确保它是真正的Apple签名的
用户付费的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1703) [在调用finishTransaction之前
始终执行此操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1707) [我想把舞台交还给Dana](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1711) [来讨论管理收据的一些技巧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1712) [再次谢谢你 Ross](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1719) [那么收据是什么呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1723) [这就像它的名字所暗示的那样
它是app在app内购买中的记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1726) [这很像你买零售品时
得到的那张纸](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1730) [它存储在设备上 它是一个文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1736) [它其实是从App Store
获得的文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1738) [它其实是从App Store
获得的文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1738) [文件来自服务器
非StoreKit生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1740) [我们将其存储在设备上
你的app就可以读取它了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1743) [它由App Store签署
这样你知道它是真实的了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1747) [最后 它适用于你的app和该设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1752) [收据是一个重要的媒介](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1757) [它可以确保在设备上运行的
app是合法的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1759) [你应该如何验证收据呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1766) [你可以做两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1768) [首先你可以查看设备上的收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1769) [你可以在设备上使用加密技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1772) [来验证收据以及解锁内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1776) [或者你可以做服务器对服务器的验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1780) [你可以在这里获得收据
将其发送到你信任的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1784) [服务器会为你管理它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1788) [在这里它会调用
itunes.apple.com/verifyreceipt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1791) [将收据发送到App Store
它会为你信任的服务器验证收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1796) [将收据发送到App Store
它会为你信任的服务器验证收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1796) [如果你在后台有订阅服务的话
这非常棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1801) [但是 我的演讲会重点关注](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1805) [设备上的验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1809) [如果你在用订阅服务
我强烈建议你关注下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1811) [在本场演讲过后
今天下午3点在1号厅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1815) [举行的“工程订阅”演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1818) [但我想说一点
关于服务器到服务器验证的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1822) [正如我说过的那样
从设备上取得该收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1827) [并将其发送到你的服务器
是完全没问题的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1829) [但是你绝不应该将收据直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1834) [从你的设备上发送到收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1836) [你不控制该连接的任何一端](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1840) [你无法控制用户的设备
以及它进行的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1842) [你也无法控制另一边
与App Store的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1845) [你无法在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1848) [app与App Store间
建立可信的连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1849) [你应该将它发送到
中间服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1851) [那么收据的结构是什么样的呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1857) [它有一些购买信息
证书和签名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1860) [我们有个API可以让你
将其从文件系统中取出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1864) [我说过这是一个单一的文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1868) [我们使用开源标准](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1872) [PKCS加密容器
以及ASN.1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1875) [来存储收据中的元数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1879) [这些都是文档完整并且
非常公开的开放文件格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1881) [而且有很多可以用来
验证和阅读收据的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1887) [例如OpenSSL asn1c等
还有更多 你甚至能建立自己的标准](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1892) [不管你打算使用哪种API
你应该如何阅读收据呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1898) [在你调用Bundle.appStoreReceiptURL时
它会将一个URL返回到你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1901) [但它只是到达文件系统中
文件的路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1906) [你需要阅读该内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1910) [把那一小块数据写入内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1912) [如果你在做服务器到服务器验证的话
将其发送到你的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1914) [或者你也可以直接
在设备上对其进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1918) [或者你也可以直接
在设备上对其进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1918) [如果你在使用OpenSSL
对其进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1921) [那么你需要遵循一些提示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1925) [首先要建立一个静态库
而不是一个动态库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1927) [如果你用静态库的话会更安全些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1931) [最后如果你要包含
Apple Root CA证书](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1935) [你需要验证从网上获取的收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1939) [你能找到很多的文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1942) [但要留意
该收据的过期时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1944) [正如我之前提到的那样
有很多的解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1950) [但请记住
便利是有代价的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1954) [这是你的生意
你需要了解并认识到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1957) [伴随着你所实施的解决方案的风险](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1960) [如果你用了一些流行的
第三方解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1964) [并且其中有个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1967) [那么你的app也会变得脆弱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1970) [这是你的收入流](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1974) [请确保你了解你所选择的产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1975) [我提过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1982) [在收据中有签名和证书](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1984) [我们的好办法就是 不要检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1987) [收据中的这些证书的过期时间
是否与当前时间一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1991) [首先 用户其实是可以
改变设备上时间的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=1995) [更重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2000) [就因为证书过期了
并不代表收据就无效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2007) [你应该将其与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2010) [收据上的交易日期进行比较](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2012) [只要所有的交易
都在证书过期之前发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2015) [那这就是有效的收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2019) [让我们深入了解下收据内的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2024) [购买信息只包含了一些类型和属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2028) [在这里你可以看到有一个包标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2033) [以及与之相伴的其他一些值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2036) [如果你要检查收据
是否适用于你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2041) [首先你需要检查该包标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2045) [你还需要检查类型3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2047) [它会给你提供app的版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2049) [但这里最好的做法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2054) [使用硬编码的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2055) [不要只从app的
Info.plist中读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2057) [将Info.plist
更改为无效收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2060) [欺骗你的app运行非常容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2065) [现在你已经将这个包标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2067) [和版本与收据进行了匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2071) [你需要确保它对你的设备有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2073) [要这么做的话
你要用属性5](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2076) [属性5是一些值的
shawl SHA-1哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2079) [包括包标识符
设备标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2084) [这些表示了正在运行app的硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2087) [和一个不透明的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2091) [这是一个神秘的不稳定的熵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2093) [它会随着时间而改变
我们将它作为类型4存储在收据中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2095) [你要用这三个值
来生成你的SHA-1哈希值并进行比较](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2099) [你要用这三个值
来生成你的SHA-1哈希值并进行比较](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2099) [如果它与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2106) [收据中所生成
的内容匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2107) [那么你就可以知道该收据是为
这台设备上你的app生成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2109) [那么如果你收到无效的收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2117) [或是不管出于何种原因
它不存在呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2121) [StoreKit为你提供了从
App Store请求新收据的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2124) [收据来自我们的商业后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2130) [所以你需要连网](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2133) [才能完成这个操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2135) [为了确保我们使用的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2138) [来自真实的用户的真实收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2142) [你需要用一个登录界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2144) [当你收到更新的收据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2148) [你需要小心地避免](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2149) [任何形式的连续循环验证和刷新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2151) [如果你收到更新的收据
请检查一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2154) [如果它仍然无效 你就需要报告错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2157) [它在代码中看起来是什么样的？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2160) [你只需要调用
SKReceiptRefreshRequest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2162) [你只要在ReceiptRefresh上
设定你的购买队列代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2165) [你调用开始后
收据就可以获得更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2170) [我们会进行回调
让你知道何时会这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2172) [在macOS上
你也可以调用exit 173](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2177) [173代码会告诉操作系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2180) [并且让StoreKit
以你的名义刷新收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2184) [在收到新的收据后
app就会重新启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2189) [正如我前面提到的那样
我们现在允许非订阅app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2194) [进行免费试用
收据是一种很好的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2198) [在试用过程中对用户进行了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2202) [或是让他们购买完整解锁的
非消耗性app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2204) [要做到这一点
你会用到收据中的类型17](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2212) [它包括了你所有的订阅中的可消耗性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2216) [与非消耗性app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2219) [与非消耗性app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2219) [在类型17中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2223) [有一些数据的副字典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2224) [类型1702就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2230) [跟你非消耗性app内购买项目
有关的产品标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2233) [你要在这里查看
是不是我的非消耗性app购买](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2238) [代表了试用的开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2242) [还是说非消耗性app购买
代表的是完整app的解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2244) [你还会用到类型1704](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2249) [你可以检查购买日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2251) [也就是什么时候进行了
消耗性app内购买](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2253) [那么你要用什么算法呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2258) [首先你要遍历所有类型为17](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2260) [的app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2263) [如果你在收据中找到
任何可以匹配产品标识符的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2267) [这说明你已完成了
app的完全解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2271) [你知道用户已经购买了
你app的完全解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2274) [为他们提供了访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2278) [相应地 如果你找到了
免费试用产品标识符](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2281) [产品标识符表示了
用户开始了免费试用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2285) [你需要查看与该免费试用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2289) [相关的购买日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2291) [这里会有些棘手的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2293) [你不能总是相信设备上的时钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2295) [用户是可以更改时钟的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2298) [所以你想使用
自己的后台服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2299) [或某些时间服务器来确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2301) [仍在你的免费试用期的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2304) [还有些设备检查API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2307) [我强烈建议你们看看
可以帮助你确定用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2310) [是否已经完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2312) [先前在该设备上的免费试用窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2315) [最后如果两者均不存在
那你就可以显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2319) [免费试用追加销售
来开始免费试用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2323) [但是你需要确保 你告知了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2327) [他们免费试用的长度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2330) [让他们知晓如果他们不购买解锁版
他们将失去的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2332) [以及完全解锁的最终价格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2336) [若你已在App Store中
上架了app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2341) [你正在销售它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2344) [或你在使用订阅模型
你想转而使用新的免费试用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2345) [你还可以利用收据来实现一些功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2349) [来让这一过程更为容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2352) [如果你已经提前付清并转到了订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2354) [或是你付清了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2357) [提前付清了 并且你想转而使用
免费使用的话 请使用类型19](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2359) [它会告诉你用户从App Store中
所购买的app的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2363) [初始版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2366) [即使他们删除了app
并重复下载它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2369) [类型19会告诉你
他们购买的app到底是什么版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2372) [如果用户确实提前付款了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2379) [请确保为他们提供他们购买的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2382) [因为你转到了订阅模型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2386) [而他们在App Store
购买的是付款版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2388) [你需要让他们可以访问
他们原来付费购买过的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2392) [所以我们要使用收据中的类型19](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2398) [所以我们要使用收据中的类型19](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2398) [来了解他们购买了app的什么内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2402) [我们今天介绍了很多内容
我们介绍了推广性定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2405) [这是个不错的方法
来吸引新用户订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2409) [如果你在推销你的
订阅app内购买项目的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2413) [你可以直接在App Store上
显示内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2417) [我还介绍了
你应该如何提供app中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2420) [非订阅免费试用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2425) [我们介绍了SKStoreReviewController
以及开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2427) [对它的反响有多好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2431) [我们今年如何将其引入了
Mac App Store上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2433) [我们还介绍了沙盒环境
以及现在我们如何从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2437) [你的常规iTunes和App Store生产账号中
将沙盒账号分出来单独管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2441) [Ross很好地介绍了在处理交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2445) [你需要留意的事情
包括保证尽早观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2448) [并且知道什么时候要调用
FinishTransaction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2452) [最后我介绍了关于如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2456) [在设备上验证app中
收据的一些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2460) [以保证你的免费试用
可以顺畅地使用收据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2462) [要了解更多的有关信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2468) [我强烈建议你们坚持
去听下“工程订阅”这个演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2469) [如果你有订阅业务模型的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2472) [我们今天下午四点钟还有个实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2474) [然后周四早上9点还有一个实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2477) [我们很乐意回答你的问题
并尽我们所能帮助你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2479) [非常感谢大家的光临](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/704/?time=2482)