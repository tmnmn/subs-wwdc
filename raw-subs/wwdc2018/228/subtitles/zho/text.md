# What’s New in Energy Debugging

## Summary
People expect long battery life on their mobile devices, and apps play a vital role in achieving that experience. Understand how app behavior affects battery consumption, and learn strategies to conserve energy while providing the best experience for your app. Find out how Xcode Energy Reports can help you tune your app to use the least amount of power possible.

## Info
* Developer Tools
* WWDC 2018 - Session 228 - iOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/

## Text
 [（能耗调试新特性）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=17) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=22) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=24) [大家下午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=26) [我是Phil Azar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=27) [我是Apple能耗团队的
软件工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=29) [今天很荣幸和同事David一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=31) [和你们分享能耗调试新特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=34) [电池待机时间对客户来说非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=40) [能耗组竭尽全力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=43) [设法让每个人每天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=45) [只用为设备充一次电](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=48) [我们和Apple的开发人员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=50) [通力合作指导协助
他们制定高效的电池设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=53) [以优化电池待机时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=56) [app对客户来说也非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=60) [事实上 我们发现大多数设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=63) [都直接用于第三方app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=66) [这很不可思议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=69) [关注app设计的电池效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=70) [变得比以往更加重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=74) [为此 我们今天将谈到三个方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=78) [首先 我们会讲到app中能用到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=82) [电池待机时间的几个概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=85) [以确保app尽可能低能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=88) [然后会讲到几个可用的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=91) [以理解和度量app中
哪儿消耗了电池电量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=95) [最后 交给同事David](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=100) [他会介绍可用的新工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=103) [让能耗调试更进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=105) [现在开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=108) [介绍几个通用的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=110) [为了获得满意的电池待机时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=113) [要从几个首要原则开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=115) [并理解电池待机时间的构成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=117) [并理解电池待机时间的构成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=117) [现在开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=121) [能量是什么？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=124) [（能量是什么？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=125) [从根本上 从物理角度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=126) [能量是动力和时间的产物](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=128) [app在平台上运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=131) [以不同的速度消耗能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=134) [因为app进行的任务不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=137) [消耗的能量也不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=139) [此外 app进行的耗能任务越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=141) [要面对的能量消耗也越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=145) [可以画一张图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=147) [可以看到app在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=150) [有不同能量消耗的峰值和低谷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=152) [曲线下方是能量消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=155) [这直接关系到app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=159) [不同的运行模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=161) [app激活和空闲时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=164) [消耗的能量不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=168) [app激活时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=170) [消耗能量的速度最快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=173) [因为用户为了所需的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=175) [才直接使用app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=177) [app空闲但保持运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=180) [能量消耗下降](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=182) [最后app挂起时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=186) [仍有基本的能量消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=188) [这也很有意思](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=191) [app执行本来设计的任务时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=193) [会请求系统调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=196) [执行任务需要的硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=199) [调用相关硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=201) [所需要的能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=203) [称作开销](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=206) [app无法直接控制开销](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=208) [但它的任何行为都会有影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=210) [app第一次使用硬件资源时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=215) [叫做激活能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=219) [app访问 比如说 无线电](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=221) [或者访问 比如说 相机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=224) [并用到子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=226) [消耗的能量称作激活能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=229) [所以能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=233) [电池待机问题是两部分
组成的优化问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=234) [我们要考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=238) [我们要考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=238) [在消耗的激活能量上保持高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=240) [也要考虑向系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=242) [请求不同的硬件资源产生的开销](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=245) [我讲过硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=251) [和这些子系统都会消耗能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=253) [系统里到底什么在消耗能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=255) [作为开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=258) [app开发过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=259) [将遇到一些不同的硬件子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=262) [但我们认为有四个子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=265) [是能量消耗最多的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=268) [（什么消耗能量？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=270) [这里列出来了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=272) [任务处理、网络、位置和图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=274) [我们看看这些
并试着理解它们是指什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=279) [任务处理是你能想象到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=283) [它是app使用系统资源时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=286) [要消耗的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=288) [系统芯片作为例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=290) [例如内存、CPU等等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=291) [是真正干活的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=295) [这里消耗的能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=297) [大幅取决于app执行的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=299) [大幅取决于app执行的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=299) [请求系统执行的任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=302) [总的来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=306) [app执行的代码越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=307) [处理时消耗的能量就越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=310) [（任务处理）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=312) [当我们谈到设备消耗的能量时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=314) [网络是下一个要考虑的主要子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=317) [网络消耗的能量是你能想到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=322) [只要app请求执行任何通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=324) [移动网、Wi-Fi
蓝牙的网络任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=327) [就会以网络的形式消耗能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=330) [这部分能量取决于流量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=334) [app请求通过这些技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=336) [发送越多的数据流量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=338) [消耗的能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=340) [（网络）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=342) [粗略而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=343) [app的网络请求越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=344) [网络方面消耗的能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=347) [位置服务也类似但有轻微不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=351) [位置子系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=354) [app请求通过GPS
Wi-Fi、移动网定位时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=355) [app请求通过GPS
Wi-Fi、移动网定位时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=355) [位置系统就会耗能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=362) [位置服务消耗的能量
取决于精度和频率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=365) [如果频繁的请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=370) [高精度的定位用户位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=373) [位置服务就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=375) [消耗大量能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=377) [（定位）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=378) [归纳一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=380) [app越长时间跟踪位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=381) [位置服务消耗能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=384) [最后还有图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=390) [图像子系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=393) [能想到GPU和CPU
这些处理单元](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=395) [在绘图部分消耗能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=399) [这取决于动画和用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=402) [app请求显示动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=405) [或者渲染用户界面时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=408) [绘图系统就会消耗能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=410) [这高度取决于复杂度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=414) [动画和用户界面越复杂](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=416) [绘图消耗能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=419) [绘图消耗能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=419) [（绘图）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=421) [最后 总的来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=424) [app显示动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=426) [和用户界面时渲染越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=428) [绘图消耗能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=430) [我们讲了四个子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=435) [结论是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=438) [有共同线索把它们联系起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=439) [app开发过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=442) [执行任务越多 消耗能量越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=443) [反过来不一定
因为那意味着app可能做得越少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=448) [因此关键是要优化我们的任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=452) [并尽量使其能耗低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=456) [可这并不容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=460) [考虑耗能效率是一个过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=462) [不是简单优化一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=465) [突然app能耗就低起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=467) [app就能延长电池待机时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=471) [要建立这样的思维模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=474) [app有一组要用到的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=477) [并需要高效的使用这些资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=478) [并需要高效的使用这些资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=478) [如上面所说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=482) [我们看看现实世界的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=483) [考虑低能耗并开始这个过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=487) [举例说app在前台时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=492) [app在前台时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=495) [它要提供主要的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=497) [对很多人来说
这是app最主要和最关键的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=499) [如上所述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=503) [前台的能耗效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=505) [在于向用户提供价值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=507) [确保在用户体验方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=510) [做什么都有立即响应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=513) [（前台）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=514) [一个原则是只做必要的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=515) [听起来很直白](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=520) [我们看一个例子 为何这如此重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=522) [例如正在构建一个媒体app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=527) [媒体app的主要目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=529) [是以固定的频率向用户展示内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=531) [（例子）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=534) [一个有效的方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=535) [是以时间为基准](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=537) [是以时间为基准](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=537) [刷新显示内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=540) [这将确保用户看到的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=542) [尽可能最新并没有干扰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=544) [这不是个低能耗的方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=549) [我们想想为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=552) [如果为方案画出耗能时间曲线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=554) [能看到每次绘图时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=559) [就要消耗一些激活能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=561) [但真正重要的在于有大量的开销](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=565) [因为每次请求显示新内容时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=569) [很可能要调用网络
绘图、处理等子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=573) [处理这些任务并显示内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=577) [而用户未必想要这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=580) [我们会在app运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=582) [持续大量耗能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=584) [我们能做得更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=587) [如果考虑用户实际想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=589) [刷新内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=591) [我们能实现一个贴合需求的方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=593) [新方案里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=597) [用户交互或者某类服务器通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=598) [用户交互或者某类服务器通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=598) [会提供新内容并显示给用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=602) [这个方案区别不大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=607) [但是个低耗能的方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=609) [在耗能方面有巨大的不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=611) [我们看看为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=614) [设想app在前台运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=616) [现在发生用户交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=619) [我们会刷新内容并向用户显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=620) [然后app进入空闲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=624) [此时用户滚动并阅读刚显示的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=628) [会注意到这里的开销还是有点高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=632) [但已经降低不少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=634) [窍门在于让不再需要的子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=636) [进入睡眠并空闲下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=640) [另一个降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=645) [前台能耗的原则是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=647) [将用户界面的复杂度最小化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=650) [我提到过绘图能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=653) [高度取决于复杂度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=655) [而我们想让app看起来尽可能好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=659) [而我们想让app看起来尽可能好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=659) [因此我们花大量时间让用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=662) [和动画看起来美观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=665) [然而 这可能有意外的副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=668) [举个例子看看为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=671) [如果我是一个视频播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=675) [目标是让用户观看视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=677) [很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=679) [但我可能试图在视频上
加新的控件和用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=681) [例如 和视频相关的
进度条或者音量控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=685) [这让用户在使用app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=690) [和观看视频时有更大的控制权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=693) [这实际上可能耗能很高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=697) [我们想想为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=701) [大多数设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=703) [当屏幕上没有用户界面时允许低耗能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=707) [播放视频的地方有显示优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=709) [当构建这样的app时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=712) [这一点会不那么清晰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=714) [然而却造成了很大不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=716) [一个利用优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=719) [一个利用优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=719) [应对我们看到的高耗能的好方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=722) [是自动隐藏用户界面控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=727) [这意味着任何显示在视频上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=732) [或者用户界面层的相关内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=734) [在用户不交互时直接隐藏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=737) [这在视频播放时的耗能方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=740) [带来很大不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=743) [这个显示优化对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=744) [维持低耗能的播放非常关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=746) [我们讲了很多前台任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=753) [那后台任务呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=755) [很多构建诸如音乐播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=757) [或者闹钟这类app的人
都关注后台任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=760) [主要体验来自app后台的高效运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=763) [我们在后台时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=769) [有一些要注意的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=770) [可能app运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=773) [要同时连接到设备其他系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=776) [例如要使用iMessage
甚至FaceTime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=778) [例如要使用iMessage
甚至FaceTime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=778) [这样 我们应该关注
最小化工作任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=782) [以确保后台运行低能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=786) [（后台）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=788) [这是个很宽泛的描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=790) [让我们试着理解一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=791) [在后台运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=794) [你能够使用系统上其他app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=796) [已经使用的子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=798) [然而 注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=800) [能耗的优先级很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=802) [倾向于那些前台的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=805) [所以我们要关注最小化工作任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=808) [确保不会中断那些体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=811) [能开始考虑的一个办法
是把任务结合起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=814) [例如 如果要在后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=818) [进行大量维护工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=820) [或者我们要执行大量网络任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=822) [最好是把这些任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=824) [合起来一次完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=828) [那样我们对系统其他任务的
影响最小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=830) [一个遇到的很常见的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=835) [是上传分析以及与app分析配合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=837) [是上传分析以及与app分析配合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=837) [（举例）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=840) [可能你收集这些分析数据时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=841) [会立即发送
因为这是一个很健壮的方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=844) [它让你构建一个数据集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=847) [以应对app的崩溃情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=849) [那样做可能会能耗有点高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=852) [如果每次进入后台都发送分析数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=855) [我们可能过度使用网络硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=859) [我们看看能耗时间曲线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=862) [它是这个样子的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=863) [每次进入后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=866) [我们驱动网络资源发送分析数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=868) [然后再次空闲下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=871) [图上三点看起来不算太多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=874) [但可以想象如果大量使用app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=877) [这些会一次次叠加起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=880) [解决问题的正确方法非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=884) [就是分批次发送这些数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=887) [我们有大量符合聚合原则的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=890) [其中一个很大的组成部分
是NSURLSession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=894) [通过一个自由属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=897) [通过一个自由属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=897) [和后台回话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=900) [使用NSURLSession
能快速让你利用这种优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=901) [这也是解决的正确方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=908) [这样做以后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=911) [我们再看看能耗时间曲线的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=913) [这里能看到app执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=916) [上传分析数据的时间长了一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=920) [能耗却小了很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=923) [都集中在一次消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=926) [这就是在后台运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=929) [聚合任务的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=933) [完成任务的短期能耗很高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=935) [但一旦完成后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=937) [不再需要担心这些任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=940) [或者中断另一个任务的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=942) [另一个直观的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=947) [是快速结束任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=950) [使用系统上允许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=952) [你利用后台运行的API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=954) [例如用户界面后台任务或者
UIKit、VOIP、PushKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=957) [例如用户界面后台任务或者
UIKit、VOIP、PushKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=957) [这些API有办法让你指明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=961) [你不再需要在后台运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=966) [因此作为开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=970) [如果在使用这些后台模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=973) [你应该调用这些完成处理函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=975) [让系统知道任务完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=978) [事实不总是这样 很多情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=980) [我们可能忘了或者不想结束任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=983) [所以 让任务自己过期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=987) [这对能耗影响很大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=990) [也确实不是软件开发过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=992) [必须看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=997) [用能耗时间曲线解释一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1000) [为什么这会高能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1002) [想象因为什么原因进入后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1004) [任务开始 一段时间后任务完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1007) [如果像说过的 让任务自己过期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1010) [我们进入消耗能量的这段空闲期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1013) [app在后台运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1016) [因为某些原因请求API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1018) [因为某些原因请求API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1018) [但并没什么发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1021) [然后我们有长期的开销](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1023) [因为保持系统唤醒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1025) [使用资源的子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1027) [现在等着我们完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1030) [一个快速的解决办法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1035) [是可用时随时调用完成处理函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1037) [如前所述 用户界面后台任务
是最大组成部分之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1042) [从前台进入后台时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1045) [我们调用该API和UIKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1048) [如果不让系统知道我们不再需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1050) [如果让系统知道
我们不再需要执行任何任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1053) [我们让硬件系统在需要时进入空闲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1055) [从而节省大量能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1059) [这是我们调用完成处理函数的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1061) [能看见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1064) [激活能量的尾部没有了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1065) [也大幅降低了开销的尾部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1068) [方案简单却极大影响能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1072) [我们讲了一些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1081) [开始把低能耗当做一个过程来考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1083) [如果在所有用例中关注任务优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1086) [我们就能有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1090) [优化app能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1093) [要继续深入刚才讲过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1096) [或者更深入了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1098) [讨论过的这些优化后的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1100) [强烈建议查阅去年的视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1103) [怎样编写低能耗app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1106) [那场演讲中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1108) [能找大量有趣资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1109) [以及app中使用低能耗设计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1111) [更多例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1115) [现在讲过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1120) [app设计中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1122) [改善能耗的一些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1124) [我们花了大量时间讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1126) [通过考虑app后面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1130) [硬件系统改善app能耗的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1132) [我们如何量化这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1135) [例如修改后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1137) [想了解对app的真实影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1138) [想了解对app的真实影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1138) [现在我们讲讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1143) [做那方面工作能用到的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1144) [今天有两个能用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1149) [量化耗能影响的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1152) [第一个是能耗表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1155) [Xcode调试器里能直接访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1157) [能耗表是个不错的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1160) [让你在代码能耗方面快速迭代](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1162) [帮助你在较高的层面理解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1164) [哪些子系统消耗了能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1167) [如果能耗表还不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1171) [你能直接进入开发者工具包的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1173) [工具会让你深入到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1177) [设备的不同子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1178) [在较低的层面理解
这些子系统的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1181) [和它们在干什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1186) [我们先看看能耗表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1188) [如上所述 这些能在Xcode
调试器用户界面里直接访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1191) [所以很方便使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1195) [（能耗表）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1196) [我们跳到用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1198) [如你所见 选择耗能多的一行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1199) [如你所见 选择耗能多的一行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1199) [这片用户界面的主要区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1202) [由三部分组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1204) [左上是经典读数表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1207) [读数从低到高到非常高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1211) [表示app即时的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1215) [平均能量消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1217) [有必要知道读数下降的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1220) [未必意味着好或者坏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1223) [它表示不论app在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1226) [都相对消耗了这么多能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1228) [这很重要 取决于你
因为作为开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1231) [需要考虑你的用例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1235) [并且你是否想要它做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1236) [右边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1239) [是平均组件利用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1241) [这是个饼图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1243) [显示了不同组件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1245) [相对整体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1247) [消耗的能量百分比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1251) [这非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1253) [因为它代表了我们之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1254) [提到的不同子系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1256) [如果有过多的开销 它有助于识别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1258) [如果有过多的开销 它有助于识别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1258) [或者意料外的某个组件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1261) [消耗了过多能量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1263) [然后在那下面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1266) [构成平均组件利用率饼图的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1268) [是一个时序图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1271) [代表app实际运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1273) [每个组件平均利用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1276) [这里也能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1278) [app当前运行状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1280) [前台或者后台 也会列出挂起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1283) [这是十分有用的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1287) [便于理解app的实时行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1288) [如我所说 能耗表用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1293) [高层面的特征识别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1296) [和快速分析非常不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1299) [这是关键所在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1301) [在代码上迭代时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1302) [作为开发者 你试着完成任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1304) [试着将其组合起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1306) [对耗能的设想不能立即清晰起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1308) [但耗能表是个不错的开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1311) [但假如已经那样做过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1315) [能耗表对你来说不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1316) [这时候就要用到工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1319) [这时候就要用到工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1319) [直接通过耗能表的用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1321) [能访问三个和之前说过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1324) [子系统最相关的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1325) [这些包括时间分析器、网络分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1330) [以及位置分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1334) [如果从能耗表用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1337) [点击进入这些工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1339) [就能从当前的调试会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1340) [转换成工具会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1343) [我们看看这些工具之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1346) [时间分析器并试着理解用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1348) [（时间分析器）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1351) [现在工具都有标准用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1353) [但有趣的是它们可用性很高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1356) [我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1360) [这里能看见时间分析器用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1362) [顶部是一个横条](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1365) [代表了实际工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1366) [的不同控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1369) [左上是运行暂停按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1371) [还有要分析的目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1373) [右边是个加号按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1376) [让你快速拖放其他工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1378) [让你快速拖放其他工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1378) [到这里的分析面板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1381) [这个分析面板让你看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1386) [当前正在运行和分析app的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1388) [因为用的是时间分析器
这里是CPU使用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1391) [图形展示不同时间的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1395) [CPU利用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1398) [那下面是权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1401) [因为用的是时间分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1404) [我们要理解app怎样使用CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1407) [为此 有个权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1410) [让你精确看到app调用情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1411) [以及使用的CPU权重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1415) [在那右边是app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1419) [最重堆栈调用加总](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1422) [那基本表明了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1424) [分析进行时最重的堆栈调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1426) [还有很多可用的出色工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1430) [这是其中的一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1434) [（工具有利于…）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1435) [这意味着十分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1438) [有利于一些任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1440) [其一是工具有利于根因分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1442) [例如特定子系统遇到问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1446) [例如 处理或者网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1448) [能用时间分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1451) [或者网络分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1453) [快速定位问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1456) [工具也有利于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1458) [深入分析app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1460) [如果实现了某种CPU效率改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1463) [例如削减算法运行时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1467) [工具是个不错的理解方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1471) [子系统上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1474) [计划的优化是否生效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1476) [工具还有利于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1480) [一个今天还](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1481) [没讲到的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1483) [就是不受限分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1485) [有个叫能耗日志的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1488) [能让你在app运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1491) [在设备上进行不受限分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1495) [可以在开发者设置里直接访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1498) [可以在开发者设置里直接访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1498) [启动它时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1501) [能像往常一样使用电话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1503) [如期望那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1504) [按任意数量用例使用app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1506) [任务完成之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1508) [直接从开发者工具停止录制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1509) [并跳到工具上传跟踪信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1512) [如果遇到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1515) [影响能耗的环境问题时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1516) [这非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1518) [我们讲过了工具 还讲过概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1523) [现在我想演示一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1526) [通过一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1528) [讲解怎样把这些串联起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1529) [解决能耗问题 让app低能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1531) [今天我们准备了一个简单的能耗游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1539) [其在屏幕上绘制小动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1542) [让app注入一些漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1544) [我们构建了一个简单的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1547) [只在视图控制器上有个代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1549) [主要目的是展示如何快速使用工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1551) [以迭代代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1555) [我将在这里通过Xcode的
用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1558) [我将在这里通过Xcode的
用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1558) [构建耗能游戏然后运行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1560) [你将看见在右边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1564) [它实际上在随机时间画了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1566) [电池小动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1569) [这样 非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1570) [如果直接跳到Xcode调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1573) [跳到能耗影响 就能看见能耗表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1576) [这是之前说过的用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1581) [这是之前讨论过的相同的三个区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1583) [能看到app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1586) [完全按照设计在执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1589) [在屏幕上绘制小动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1590) [但注意到我在进行网络传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1593) [我的开销无缘无故有点高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1595) [这是因为我们在进行少量网络传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1599) [每当在屏幕上绘制动画时
上传动画计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1602) [如此通过Xcode能耗表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1606) [能看到那样做的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1608) [现在我要把这停下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1611) [跳到代码部分理解其中的原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1614) [假如前往添加新动画的视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1619) [假如前往添加新动画的视图控制器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1619) [我有一个函数上传动画计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1622) [其创建简单连接对象
并在每次添加动画时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1625) [上传动画计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1628) [我将注释掉代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1630) [然后前往app代理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1633) [将其移动到后台运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1634) [唯一的上传动画计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1637) [在这个演示里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1640) [我将其命名为网络优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1641) [然后重新构建能耗游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1644) [向你们展示这对能耗表的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1646) [能耗游戏再次运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1651) [我将回到Xcode调试器用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1654) [回到耗能影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1657) [我们再看不到网络耗能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1659) [也看不到任何开销 这很不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1662) [这是个简单优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1665) [简单将网络请求从一处移到另一处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1667) [阻止其频繁发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1670) [让我们在安静的用例中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1673) [大幅降低能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1676) [现在我要注入一个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1680) [看看使用Xcode能耗表时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1681) [怎样发现漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1684) [漏洞1是个简单漏洞
在屏幕左下角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1687) [其导致CPU在后台运转](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1690) [这是很多人在实际开发中会遇到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1693) [我将注入这个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1697) [现在已经注入
我将进入后台能耗游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1700) [能在能耗表的用户界面中看见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1704) [我们切换到后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1706) [进行少量网络传输](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1708) [因为将网络调用移到后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1709) [现在也能看见CPU在疯狂运转](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1712) [这就是能耗表的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1716) [我们知道其中注入了一个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1718) [但能在能耗表中
直接发现这个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1720) [现在为了找到根因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1724) [我要前往时间分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1725) [如前所述 转换调试会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1727) [现在转换了调试会话
其会自动运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1734) [如你所见
权重调用图稍候开始增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1739) [如你所见
权重调用图稍候开始增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1739) [这里能看到发布线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1747) [消耗最多的CPU时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1749) [我们深入一点看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1751) [我们看到在叫做
appdelegate.compute的地方结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1755) [我们回到app 试着理解那是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1760) [演示的目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1769) [耗能游戏进入后台时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1772) [我们调用叫做
computation的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1773) [Computation
是个可怕的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1776) [当注入漏洞1时 其基本在
while true死循环里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1781) [疯狂运转](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1786) [演示目的很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1788) [但是用能耗表和时间分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1790) [能直接定位问题发生的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1793) [能看到
while true循环是不好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1796) [我要把这个注释掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1800) [我喜欢注释而不是删除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1804) [然后重新构建耗能游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1807) [回到能耗表看到一切正常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1813) [我们再次注入漏洞1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1816) [然后进入后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1822) [我们看到预期的网络活动
但没有CPU狂转](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1829) [不错 问题解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1833) [两个工具30秒到一分钟解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1835) [这就是工具的效力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1839) [让你快速迭代发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1841) [日常开发遇到的问题根源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1843) [我们回到幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1847) [（耗能演示调试）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1851) [这个演示的能获得一些结论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1855) [第一个结论是耗能表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1858) [第一个结论是耗能表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1858) [有利于快速迭代](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1860) [他们让你快速定位问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1862) [让你进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1866) [找出解决问题的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1868) [（app已发布 然后呢？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1870) [第二个结论是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1871) [工具有利于深入分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1873) [最后第三个结论是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1878) [我们要你把能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1880) [当做app开发的主要目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1882) [我们有强力的工具让你快速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1885) [定位消耗能量的地方并发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1889) [能耗相关问题的根源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1891) [如果你都做到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1894) [app也发布了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1895) [其在App Store里发布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1897) [所有用户都感激你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1899) [及时发布了app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1902) [然后呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1903) [假如仍有用户抱怨
app缩短电池待机时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1904) [你有怎样的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1908) [现在要交给同事David](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1911) [他将向你们介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1914) [如何面对这些挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1915) [并使用新工具解决它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1917) [David](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1919) [David](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1919) [下午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1925) [我是David 我今天来介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1926) [能耗调试的一些新工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1929) [如果你是iOS开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1935) [在App Store或
TestFlight上发布app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1937) [这部分介绍就是为你准备的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1940) [我将从下面的问题开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1943) [既然app已经发布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1946) [如何知道app在外表现如何？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1948) [既然app已经发布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1950) [换句话说 如何知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1951) [用户是否遭受](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1954) [缩短电池待机时间的耗能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1957) [用户可能在
App Store上留言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1960) [使用app是电池电量消耗很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1964) [但他们没法告诉你发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1968) [更糟的是 他们直接删除app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1971) [没留下任何反馈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1974) [所以弄清楚app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1976) [是否有能耗问题是个挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1979) [是否有能耗问题是个挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1979) [即使知道有能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1982) [如何在客户设备上调试问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1985) [你能使用Phil介绍过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1991) [工具和能耗表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1992) [但除非知道要测试什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1996) [否则将很难复现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=1998) [可能有环境因素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2001) [例如客户遭遇到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2003) [糟糕的Wi-Fi环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2005) [而你的办公桌Wi-Fi环境良好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2008) [因此这是富有挑战的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2012) [为了帮助回答这些问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2017) [我今天有幸介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2019) [使用Xcode能耗日志和
Xcode能耗分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2021) [调试耗能问题的新方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2026) [（调试耗能问题的新方法）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2029) [首先我将介绍Xcode能耗日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2030) [其是报告设备能耗问题的新方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2033) [然后我将介绍Xcode
能耗分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2037) [然后我将介绍Xcode
能耗分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2037) [其是查看能耗日志的新工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2040) [第一次用这些工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2044) [你将获得找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2046) [并解决能耗问题的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2050) [我们开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2053) [Xcode能耗日志是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2056) [从设备报告问题的新方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2058) [（Xcode能耗日志）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2059) [我们从CPU高能耗事件开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2062) [此时app占用大量CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2064) [每个能耗日志有权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2067) [其将指出代码中集中耗能点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2071) [这些日志将在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2074) [TestFlight
和App Store中可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2076) [你将获取真实世界](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2079) [用户的实际数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2080) [用这些日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2083) [你能够开始改进电池待机时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2085) [让我们讲讲Xcode
能耗日志产生时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2090) [例如用户正在使用app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2094) [其给CPU带来沉重负荷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2096) [（Xcode能耗日志何时产生？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2099) [（Xcode能耗日志何时产生？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2099) [这可能很自然
取决于app在干什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2100) [假设其长期给CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2104) [带来沉重负荷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2107) [导致检测到CPU高能耗事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2112) [现在CPU高能耗事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2117) [有检测到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2119) [两个关键阈值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2121) [第一个阈值是app在前台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2123) [占用80%CPU超过三分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2126) [第二个阈值是app在后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2130) [占用80%CPU超过一分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2134) [第二种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2137) [为了避免后台过度占用
app可能已经终止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2138) [每个CPU能耗日志条目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2145) [表示app占用大量CPU
而应该标识出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2148) [实际上是说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2152) [典型情况就是其导致了1%的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2154) [电量下降](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2159) [电量下降](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2159) [你可能对自己说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2161) [1%电量也没多糟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2163) [但放到现实情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2167) [iPhone 6s的1%
额外电量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2169) [用户能额外通话8分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2173) [或上网浏览6分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2177) [或听音乐30分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2180) [如果app继续这个速度消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2184) [电池可能消耗更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2188) [因此编写CPU高效的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2190) [非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2192) [用户也会注意到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2194) [能耗日志有三个部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2197) [能帮助理解发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2199) [第一是触发报告时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2202) [发生了什么的环境信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2204) [例如 其会说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2207) [app消耗了80%超过三分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2209) [（能耗日志里有什么？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2212) [第二部分信息是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2213) [能耗日志创建位置的元数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2216) [例如 是iPhone还是iPad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2219) [例如 是iPhone还是iPad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2219) [还是app的Build 30版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2222) [第三 也是最重要的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2225) [是权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2228) [其将展示代码里的集中能耗点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2229) [我们深入介绍权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2233) [它是怎样产生的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2236) [如何用它调试能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2237) [（Xcode能耗日志：
权重调用图）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2241) [假如app由主函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2243) [还有一些方法构成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2246) [方法1、方法2、方法3、方法4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2247) [代码开始运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2253) [直到检测到CPU高能耗事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2255) [到这时以每秒固定周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2260) [采样调用堆栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2264) [调用堆栈是运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2267) [活动帧的采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2271) [例如第一个调用堆栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2275) [显示主函数、方法1
方法2被激活](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2278) [显示主函数、方法1
方法2被激活](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2278) [第二个调用堆栈显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2284) [主函数、方法3
方法4被激活等等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2287) [现在试着把调用堆栈结合起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2297) [组成全局图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2300) [这里看到的是权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2303) [这个非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2306) [主函数在收集到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2309) [六个采样中都能看见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2311) [意味着主函数全部时间都在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2315) [其中方法1有五个采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2318) [而方法3只有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2323) [方法1中看到方法2和方法3](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2326) [分别有三个和一个采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2330) [这给我们一个整体图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2334) [关于哪儿的代码在执行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2336) [花费多少时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2339) [花费多少时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2339) [（权重调用图）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2343) [能耗日志创建时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2345) [每秒有周期性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2347) [采样调用堆栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2350) [每个调用堆栈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2352) [包含CPU执行的活动帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2355) [这些调用堆栈按](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2359) [采样数聚合成树形图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2363) [越多采样意味着越多代码执行次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2366) [能使用权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2370) [识别app意外的工作负荷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2372) [现在知道了能耗日志是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2377) [怎么访问它们呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2379) [首先能耗日志在设备上创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2382) [然后测试人员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2386) [和下载app的客户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2389) [将上传日志到Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2390) [可能有成百](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2394) [甚至上千的日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2395) [我们把日志聚合起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2398) [我们把日志聚合起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2398) [分类以一系列顶级
能耗问题展现给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2401) [你能用新的Xcode
能耗分析器工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2407) [下载查看这些日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2409) [Xcode能耗分析器是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2414) [调试外界能耗问题的命令中心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2417) [（Xcode能耗分析器）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2420) [能耗分析器使得查看
能耗日志非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2421) [能耗分析器连到App Store
的TestFlight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2426) [将看到全部iOS app的列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2430) [能够看到外界这些能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2435) [发生频率的统计数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2437) [将看到按多少设备受影响分类的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2442) [顶级能耗问题的列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2444) [将看到一些不同日志的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2448) [权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2450) [能分页查看日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2452) [项目中用打开命令直接前往代码库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2457) [项目中用打开命令直接前往代码库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2457) [能开始调试这些能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2461) [现在讲展示一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2464) [现在我确保登录了开发者账户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2475) [也上传了能耗游戏app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2479) [到App Store
的TestFlight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2481) [为了调用能耗分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2484) [能前往这里的窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2486) [点击分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2490) [这是能耗分析器的用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2495) [确保选中顶部的能耗面板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2499) [如果使用崩溃分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2503) [你应该对这个用户界面很熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2505) [左边是全部的app列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2508) [之后是顶级能耗问题列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2512) [中间是权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2516) [右边是一些能耗问题的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2519) [右边是一些能耗问题的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2519) [统计数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2521) [我们前往左边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2524) [选择能耗游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2527) [这是我们正在开发的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2529) [然后确保正确构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2532) [这里看见一系列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2540) [按影响次数分类的能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2543) [前往第一个能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2547) [其影响了64台设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2550) [右手的面板上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2556) [有发生了什么的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2558) [还有能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2561) [发生频率的分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2562) [能看见其在iPad、iPod
iPod Touch上都有发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2565) [能看见在过去两周](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2571) [其发生频率的分布情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2574) [我们看看权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2576) [看到有大量时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2581) [花费在调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2584) [这个app代理计算函数里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2586) [现在用这个按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2590) [直接前往代码库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2593) [直接回到代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2602) [左边是权重调用图里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2604) [调用堆栈采样之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2608) [能看到我们花费大量时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2612) [在这个计算函数里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2614) [这就是Phil之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2617) [在演示里提到的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2619) [我们能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2629) [他已将代码注释掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2631) [已经解决了耗能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2634) [我们回到分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2636) [我能点击这个按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2644) [把问题标记成已解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2647) [这样做的用处是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2650) [下次打开分析器时
能看到问题已经解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2653) [我们前往第二个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2657) [它影响了42台设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2659) [前往权重调用图之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2662) [我想让你们注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2664) [底部的三个特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2665) [第一是日志分页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2669) [我能从外界42个设备的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2673) [五个耗能日志采样中选出一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2677) [这些页面之间浏览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2682) [能发现权重调用图有一点不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2684) [这没什么问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2688) [因为调用堆栈和权重调用图只是采样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2690) [我们按相似度将其分类](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2694) [这些日志让你看起来很相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2697) [这些日志让你看起来很相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2697) [我点击这里的按钮时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2702) [显示出之前隐藏的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2706) [所有系统库帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2709) [这里的按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2712) [显示所有低采样数据的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2715) [我们会默认为你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2719) [把大多数这些帧都隐藏起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2721) [只显示最重要的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2723) [我们看看这个函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2734) [看起来这个计时函数里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2738) [花费了大量时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2740) [事实上之前听Phil
提过这个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2742) [他说他会看一眼的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2745) [因此我留给他处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2747) [我将其重命名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2750) [然后前往下一个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2756) [我们再看一个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2759) [我们再看一个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2759) [我看见大量时间花费在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2773) [设置下一个定时器和添加新动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2776) [其作用是什么？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2779) [我们深入看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2781) [我直接前往代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2785) [看到大量时间花费在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2797) [添加新动画的函数里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2799) [好吧 添加新动画开销很大](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2802) [但要问我们自己一个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2806) [这是预期的工作量吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2808) [这种情况下 答案并非如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2811) [因为预期每隔几秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2814) [才添加一次动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2817) [所以耗费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2819) [所以耗费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2819) [这么多CPU没什么道理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2820) [我们看看调用堆栈有谁调用了我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2824) [我们被设置下次刷新定时器调用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2828) [所以函数的功能是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2832) [看到在设置下次刷新定时器之内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2838) [我们被调用以添加新动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2840) [函数末尾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2843) [我们调用更新定时器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2845) [计划该函数下次调用时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2848) [定时器设定在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2853) [现在和下次刷新间隔内的
某个时间触发](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2854) [下次刷新间隔递减1 直到0](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2860) [然后在这行代码重新初始化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2866) [这就是问题所在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2872) [从上次刷新到现在的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2875) [时间间隔有可能是负数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2878) [时间间隔有可能是负数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2878) [我们见过这种事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2881) [特别是用户折腾系统的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2883) [可能是在玩游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2887) [也可能他们想重置时钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2889) [也许他们想要额外的时间或者机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2891) [所以他们前往系统设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2894) [把时间改到24小时之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2896) [这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2899) [这将导致下次刷新时间变成负数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2901) [当我们为定时器设置一个
过去的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2904) [定时器将马上触发](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2907) [然后反复调用自身](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2911) [所以这里就成死循环了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2914) [幸运的是这很容易修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2919) [我们前往这个函数
将其改成小于或等于0](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2922) [这样即使下次刷新时间是负数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2928) [也能从循环退出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2931) [这是不错的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2934) [这个能耗问题在普通测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2936) [这个能耗问题在普通测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2936) [很难发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2941) [可一旦看到变量的值就变得明显](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2943) [这就是能耗日志的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2948) [这就是能耗分析器的作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2951) [我们看看这个演示的三个结论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2954) [（能耗分析器演示的结论）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2957) [你能使用能耗分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2958) [发现顶级能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2960) [通过查看顶级问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2964) [查看发生的频率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2966) [查看受影响的设备和版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2968) [其次 你能使用权重调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2973) [查看集中能耗点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2976) [寻找不寻常的高采样计数的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2978) [留心非预期的工作量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2982) [最后使用OpenEnd项目
直接前往代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2986) [能针对在运行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2991) [修改并检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2995) [总结下今天我们学到什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=2998) [首先考虑能量使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3003) [在设计、开发和测试的每个方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3005) [都优先考虑能耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3010) [其次 使用出色的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3012) [例如能耗表和工具以分析app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3016) [第三 花点时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3021) [查看新的Xcode能耗分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3023) [理解和修复能耗问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3026) [更多信息请查阅下面的链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3031) [记得参与周五9点到11点的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3035) [“动力性能实验室”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3039) [谢谢并愿大家度过愉快的夜晚](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/228/?time=3041)