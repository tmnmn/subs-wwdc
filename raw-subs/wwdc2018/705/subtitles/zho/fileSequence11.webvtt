WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:10:56.924 --> 00:11:00.093 align:middle line:-2
这个标识符实质上
就是该用户的订阅ID

00:11:01.261 --> 00:11:04.798 align:middle line:-2
它很重要 因为它将显示在
所有后续续订交易中

00:11:05.098 --> 00:11:06.800 align:middle line:-1
让我们来看看这是如何工作的

00:11:07.167 --> 00:11:09.570 align:middle line:-1
假设你正在验证一笔续订交易

00:11:09.636 --> 00:11:11.038 align:middle line:-1
这与你在你的服务器上使用

00:11:11.104 --> 00:11:13.707 align:middle line:-2
/processTransaction端点
的方式完全相同

00:11:14.708 --> 00:11:17.578 align:middle line:-2
当你验证这笔交易时
假设它是一个有效的交易

00:11:18.111 --> 00:11:21.849 align:middle line:-2
你到了更新该用户的
订阅状态这个阶段

00:11:22.583 --> 00:11:24.751 align:middle line:-1
你会发现这里现在有多笔交易

00:11:24.818 --> 00:11:26.620 align:middle line:-1
因为这是一笔续订交易

00:11:26.687 --> 00:11:27.888 align:middle line:-1
（更新订阅状态）

00:11:27.955 --> 00:11:30.591 align:middle line:-1
现在根据你现有的服务器端逻辑

00:11:31.091 --> 00:11:33.260 align:middle line:-1
这个最新的到期日期已经过了

00:11:33.327 --> 00:11:36.330 align:middle line:-2
所以此用户目前不是订阅用户
你需要根据收据中的数据弄清楚

00:11:36.396 --> 00:11:39.199 align:middle line:-1
他们是否还是订阅用户

00:11:40.100 --> 00:11:43.770 align:middle line:-2
那么你如何使用此收据数据
来进行判断呢？

00:11:43.837 --> 00:11:47.608 align:middle line:-1
为了判断用户是否处于订阅有效期

00:11:47.674 --> 00:11:50.244 align:middle line:-2
你可以找出与
originalTransactionId对应的

00:11:50.310 --> 00:11:52.079 align:middle line:-1
那笔交易

00:11:52.145 --> 00:11:53.247 align:middle line:-1
（用户是否处于订阅有效期？）

00:11:53.313 --> 00:11:56.617 align:middle line:-2
然后你可以找到具有最新
expires_date的交易

00:11:57.184 --> 00:11:59.853 align:middle line:-1
如果你发现该日期是过去的某天

