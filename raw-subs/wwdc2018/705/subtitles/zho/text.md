# Engineering Subscriptions

## Summary
Learn the best practices for architecting your subscription infrastructure using StoreKit and server-side logic. Find out about simple engineering techniques to keep your subscribers longer, and how to utilize new tools and APIs to give your subscribers the best experience.

## Info
* App Store and Distribution
* WWDC 2018 - Session 705 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/

## Text
 [（订阅工程实现最佳实践）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=16) [（演讲705）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=21) [大家下午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=23) [我叫Pete Hare
我是Apple App Store团队的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=30) [一名工程经理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=32) [我们在这里讨论构建你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=34) [和服务器基础设施的最佳方式
从而支持订阅服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=36) [今天我将在这里讨论几个主题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=40) [首先 我们将讨论构建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=42) [你的app和服务器体系结构
的最佳方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=44) [我们还会介绍一些有助于提升](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=47) [用户app内体验的窍门和技巧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=49) [我的同事Michael会谈下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=52) [如何减少订户流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=53) [最后我们将会宣布一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=56) [你可以使用的分析和报告工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=58) [你可以使用的分析和报告工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=58) [但首先让我们谈一谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=62) [如何构建你的app
和服务器基础架构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=63) [（设备和服务器架构）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=65) [我们从一个简单的问题开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=67) [什么是订阅？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=70) [订阅就是让用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=72) [通过周期性的向你付费
来访问你的内容或服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=75) [当你从工程层面看它时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=79) [订阅实际上只是一组重复交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=80) [其中每个将解锁某个订阅周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=84) [若想在你的app中使用订阅功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=88) [作为一名开发人员
你需要做一些事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=90) [来处理这些交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=92) [我们看看其中每一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=95) [首先 它始于你的app
收到一笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=96) [你的app收到交易后 你需要继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=102) [验证它是一笔真实的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=104) [即资金已经转移了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=106) [然后你就可以更新和维护
该用户的订阅状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=109) [以便他们能够持续访问你的服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=113) [让我们更详细地介绍其中每一个步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=116) [首先 我们谈谈在你的app中
接收该交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=118) [首先 我们谈谈在你的app中
接收该交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=118) [现在无论是首次购买订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=124) [还是续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=126) [你的app均已被设为
使用StoreKit框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=129) [来处理订阅和交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=131) [当你用StoreKit处理交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=134) [App Store将在后台
对用户的信用卡收取这些费用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=137) [无论何时只要有交易发生
它都会通过一个名为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=141) [SKPaymentTransactionsObserver
的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=145) [来通知你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=147) [这个交易观察者对象
实际上是你的app中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=150) [app内购买的核心部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=153) [它只是StoreKit中
一个协议 看起来像这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=155) [你可将其设置在任何对象上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=158) [这例子中 我们将它
设置在AppDelegate上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=160) [但最重要的是你需要
在app生命周期中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=163) [尽可能早的添加一个交易观察者
到默认支付队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=166) [一旦你在默认支付队列中
注册了交易观察者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=171) [你就准备好开始接收](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=174) [后台所发生的交易了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=176) [你在交易观察者中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=179) [你在交易观察者中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=179) [一个名为updatedTransactions的
回调函数中接收交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=181) [StoreKit会通知你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=184) [你要处理的一组交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=187) [它们可以各种不同的状态出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=189) [我们不打算在这次演讲中
深入讨论这些状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=191) [但请注意已购买状态的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=193) [这是StoreKit
正在告诉你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=197) [这笔交易已准备好进行验证和解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=199) [一旦你有一笔处于已购买状态的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=204) [你已准备好进行下一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=206) [即验证它是一个真实的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=208) [所以当涉及到检查真实性的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=212) [你怎么知道钱真的已经转手了呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=214) [你可用一种称为
App Store收据的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=217) [App Store收据
如你在百货公司得到的收据一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=220) [它是用户说他们购买了某东西的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=223) [购买证明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=225) [在这种情况下 它是app首次下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=227) [以及该app中发生的
任何app内购买的可信记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=230) [这是一个数字文件
它存储在用户的设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=234) [我们为你提供一个API来访问它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=237) [并且它由App Store生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=239) [并且它由App Store生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=239) [我们还使用数字证书
对此文档进行签名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=242) [以便你可以检查以确保它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=244) [是由Apple发布的真实文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=247) [最后 该文档仅适用于
你的设备上的该app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=250) [如果你之前使用过订阅服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=254) [你会注意到拥有多台设备的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=256) [他们的收据在每台设备上
看起来略有不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=259) [当涉及到验证你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=263) [所获悉的交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=266) [你需要做的第一步是验证该文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=267) [也就是App Store收据
是真实的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=269) [你怎么做到呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=272) [通过两种方式完成此操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=275) [首先 你可以使用设备上验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=276) [它直接发生在用户的设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=278) [你可以通过一系列检查
来校验用来签发该app的证书](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=280) [并验证其是否可信](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=283) [或你可使用被称为
“服务器到服务器验证”的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=286) [第二种技术是将
二进制编码的收据数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=289) [发送到你自己的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=293) [再从你的服务器发送到
App Store进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=295) [App Store
将为你做这些检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=298) [App Store
将为你做这些检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=298) [（收据验证
别让你的app上当受骗）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=300) [你可以使用这其中任何一种技术
但无论你选择哪种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=302) [最重要的是不要在用户的设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=305) [使用在线验证
这不是一种安全的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=306) [来验证此文件是真实的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=309) [但让我们在细节上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=313) [比较一下这两种方法
尤其是订阅管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=314) [和可更新订单订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=317) [这两种技术都可以用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=320) [验证文件的真实性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=322) [它们还可以让你访问收据的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=325) [比如该特定用户发生的任何交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=327) [但当涉及到可更新订单订阅时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=331) [服务器到服务器收据验证
有几个关键优势](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=333) [要优于使用设备上收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=336) [首先 我们在验证的响应中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=339) [会包含一些额外的订阅信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=342) [你可使用这些信息
Michael稍后继续讨论这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=345) [（比较验证方法）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=347) [你的服务器始终处于开启状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=349) [以便于在后台处理这些续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=350) [如果你拥有多个平台的服务
这点就非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=353) [你的服务器不易受
设备时钟更改的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=358) [你的服务器不易受
设备时钟更改的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=358) [如果你使用设备上收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=361) [来在用户设备上进行订阅管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=363) [实际上没有任何东西能够
阻止用户调整他们的时钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=365) [以使自己仍处于有效的订阅期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=368) [比如他们已经失效的免费试用期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=370) [最后 它更简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=375) [在服务器到服务器验证中
你只需与JSON API打交道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=378) [不必使用OpenSSL
或ASN.1解码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=381) [考虑到所有这些因素
我们真的很鼓励](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=385) [越来越多的人
在涉及到维护自动更新订阅状态时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=387) [采用服务器到服务器验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=390) [如果你有一个简单的不需联网的
实用app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=394) [你仍然可以使用设备上验证
进行订阅管理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=397) [若你有兴趣了解更多相关信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=401) [我想邀请你观看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=403) [去年StoreKit进阶
的演讲视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=404) [我们在该视频中更详细地介绍了
设备上收据验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=406) [但这次演讲的目的是
我们主要关注](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=410) [这里列出的服务器到服务器技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=412) [让我们回到刚才的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=416) [并了解我们如何使用
服务器到服务器验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=417) [来处理当前这笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=419) [来处理当前这笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=419) [回到我们的交易观察者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=421) [你可以使用主包中的
appStoreReceiptURL API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=423) [来访问该二进制收据数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=425) [一旦你获取该URL
你就可以提取出文件系统中该处的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=429) [二进制数据 接着你可以使用
base64Encode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=433) [取出那个receiptData
会返回一字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=436) [你可以将其发送到
你自己的服务器进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=439) [你可能会调用
currentUser上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=441) [一些app内的网络API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=444) [当你将数据发送到服务器进行处理时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=447) [显然你首先需要安全地做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=449) [你可以将它发送到你的服务器上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=451) [/processTransaction端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=453) [在此端点中
你可能包含一个参数userID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=455) [其与系统中当前用户的账户相关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=457) [你可以将此收据数据
发送至你的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=461) [然后一旦你的服务器收到它
你就可以建立一个安全连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=463) [到App Store的
/verifyReceipt端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=467) [然后你就可以将收据数据
发送到App Store了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=470) [在这里你可以包含一个密码字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=473) [这是你的app
和App Store间的共享密钥](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=475) [你可在App Store Connect中
对其进行设置并将其存储在你的服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=478) [你可在App Store Connect中
对其进行设置并将其存储在你的服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=478) [（验证一笔交易）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=481) [当你将此收据数据发送到
/verifyReceipt端点时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=483) [/verifyReceipt端点
将返回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=486) [一个类似这样的JSON载荷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=487) [当你验证交易的真实性时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=491) [首先检查的是这个status字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=494) [它能够表明Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=497) [的确签发了这个文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=498) [一旦你确认了
这个status字段为0](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=501) [你就可以检查此载荷的
receipt部分的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=504) [这是你发送给
/verifyReceipt端点的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=507) [二进制数据的解码版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=510) [因此你可在此做些事
如验证此收据中bundle_id](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=512) [是否与你的app的包ID相匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=515) [然后你可以检查in_app数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=519) [它包含此app中该用户的交易列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=521) [你还可以验证该收据的
product_id](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=525) [是否与你app中的该字段相匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=528) [假设这些都匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=532) [你就可以决定此收据能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=534) [赋予这个特定的用户
使用你的订阅产品的权利](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=536) [现在你已准备好继续进行第三步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=539) [现在你已准备好继续进行第三步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=539) [更新用户的订阅状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=541) [与每个订阅周期始于某笔交易类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=547) [它也会以到期日期结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=550) [/verifyReceipt的
响应会告诉我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=554) [每个交易的到期日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=556) [回头看一下
/verifyReceipt响应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=559) [你会注意到交易中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=562) [这个expires_date字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=564) [（更新订阅状态）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=566) [现在让我们看看用户表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=567) [你可能会将这些数据
保存在你的服务器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=569) [你可以从此交易中获取此过期日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=573) [并将其填充到你的服务器上的
一个字段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=575) [比如该用户的
latestExpiresDate字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=577) [这个字段将作为你的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=580) [判断该用户是否为订阅用户的依据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=584) [你也应该记录这个字段
original_transaction_id](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=588) [你可以将其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=590) [保存到该用户的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=593) [originalTransactionId字段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=595) [我们稍后还会谈到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=596) [为什么这很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=598) [一旦你在服务器上保存了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=601) [该用户的这两样信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=603) [你就可以进行最后一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=605) [也就是通知设备该交易通过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=607) [你的验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=609) [然后当你的设备得到这个回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=611) [它就会在你的交易观察者中
调用finishTransaction函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=614) [这是一个非常重要的步骤
因为完成交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=618) [实际上会将其清除出你的支付队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=620) [如果你不调用finishTransaction
它可能会在下次app启动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=622) [再次出现以进行处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=626) [因此请确保你完成每个
在StoreKit中开始的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=627) [当你完成交易后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=632) [你的服务器中将有更新后的订阅状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=634) [用户现在可以在订阅期内
自由享受该服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=636) [现在让我们再看看我提到的那个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=643) [保存在你的服务器上的用户表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=645) [使用此设置购买订阅的每个用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=647) [都将被分配一个唯一的
originalTransactionId](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=650) [即你从交易响应中保存的字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=653) [这个标识符实质上
就是该用户的订阅ID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=656) [这个标识符实质上
就是该用户的订阅ID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=656) [它很重要 因为它将显示在
所有后续续订交易中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=661) [让我们来看看这是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=665) [假设你正在验证一笔续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=667) [这与你在你的服务器上使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=669) [/processTransaction端点
的方式完全相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=671) [当你验证这笔交易时
假设它是一个有效的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=674) [你到了更新该用户的
订阅状态这个阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=678) [你会发现这里现在有多笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=682) [因为这是一笔续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=684) [（更新订阅状态）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=686) [现在根据你现有的服务器端逻辑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=687) [这个最新的到期日期已经过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=691) [所以此用户目前不是订阅用户
你需要根据收据中的数据弄清楚](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=693) [他们是否还是订阅用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=696) [那么你如何使用此收据数据
来进行判断呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=700) [为了判断用户是否处于订阅有效期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=703) [你可以找出与
originalTransactionId对应的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=707) [那笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=710) [（用户是否处于订阅有效期？）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=712) [然后你可以找到具有最新
expires_date的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=713) [如果你发现该日期是过去的某天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=717) [则表明该用户
不再处于订阅有效期内了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=720) [但是如果该日期是将来某天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=722) [则表示此用户仍处于有效订阅期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=724) [我们通过刚才这个例子
来看看这是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=728) [获取与该用户关联的
originalTransactionId](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=733) [并提取与此订阅相关的所有交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=736) [然后使用其expires_date字段
对这些交易进行排序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=740) [并找到具有最新过期日期的那个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=743) [现在你可以使用该expires_date
来更新该用户的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=746) [latestExpiresDate字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=750) [当你这样做时 你正在有效地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=752) [将该用户的订阅期延长一段时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=754) [你的服务器端逻辑现在知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=757) [该用户位于有效的订阅时间窗口中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=758) [当然 当你正在处理通过
StoreKit发送的续订交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=761) [你仍然需要告知设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=764) [它通过了这些验证检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=767) [并让你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=769) [再次调用finishTransaction函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=771) [（在设备上完成所有交易）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=773) [假设你已经设置并能正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=777) [App Store正在后台
向用户的信用卡收费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=780) [并且你正使用StoreKit处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=782) [这些来自你的app的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=785) [然后你的服务器将更新和维护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=787) [这个latestExpiresDate字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=789) [现在你已经能够通过服务端逻辑推断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=792) [用户是否为合法订阅用户了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=794) [（续订交易）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=796) [现在让我们来介绍一个
稍微复杂一些的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=797) [也许你通过网站提供服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=800) [现在当用户访问一个网站](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=804) [来使用你的订阅服务
你根据latestExpiresDate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=805) [知道该用户是一个合法订阅用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=808) [（多平台）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=811) [但尽管我们希望
人们一直在使用我们的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=812) [假设用户有几天没有使用过
你的app了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=816) [在这段时间内
App Store在后台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=819) [成功更新了该用户的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=822) [当用户尝试通过你的网站
访问服务器时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=825) [latestExpiresDate
现在已过期了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=828) [因为你的服务器尚未知晓该笔新交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=830) [那么你的服务器怎么知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=832) [发生在App Store上的
这笔交易呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=835) [（状态轮询）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=839) [（状态轮询）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=839) [你可以使用这种称为状态轮询的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=840) [这可以让你在你的服务器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=842) [直接发现这些交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=844) [为了设置为能够从你的服务器
进行状态轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=846) [你只需保存编码收据数据的最新版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=849) [即你发送的
与每个用户相关联的那个数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=852) [你可以将该编码数据视为一个令牌](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=856) [你能够像对待令牌一样对待它
是因为每次你将该编码收据数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=860) [发给/verifyReceipt端点时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=863) [/verifyReceipt端点
不仅会返回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=867) [该收据数据的解码版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=869) [它还包含与该用户订阅相关的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=872) [所有发生过的新交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=875) [它位于那个JSON响应中称为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=877) [latestReceiptInfo的字段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=880) [你可以使用该信息为用户
解锁这些新的订阅期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=882) [而无需启动该app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=886) [让我们看看它是如何工作的
当你验证交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=890) [就像我们之前看到的
你实际上在上传这个收据数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=892) [（验证续订交易）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=895) [现在 一旦你确定这个交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=896) [通过了与你以前一样的检查过程后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=899) [通过了与你以前一样的检查过程后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=899) [你就可以将
receiptData的值存储到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=902) [该用户的latestReceiptData字段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=904) [你现已存储了用户的
latestReceiptData](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=909) [这是一个
base64Encode字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=912) [当需要回答以下这个问题时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=915) [即我的用户是否处于订阅有效期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=917) [你可以直接从服务器获取
latestReceiptData](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=918) [并将其发送到
/verifyReceipt端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=922) [你还可包含一可选标志
即exclude-old-transactions](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=925) [这会告诉/verifyReceipt
你甚至不想知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=929) [收据的解码版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=931) [你只想了解是否有任何新的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=933) [（状态轮询）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=936) [/verifyReceipt
将返回这个特定的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=937) [即latest_receipt_info对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=941) [这个对象中包含那些
在生成此收据数据之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=942) [发生的新的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=945) [你可以直接从响应中的
latest_receipt_info对象中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=948) [获取expires_date](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=952) [并针对当前用户进行更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=955) [从而再次延长他们的访问有效期
到下一个订阅窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=957) [从而再次延长他们的访问有效期
到下一个订阅窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=957) [因此 试图访问你的网站内容的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=960) [现在可以进入到下一个订阅期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=964) [而无需使用新的交易来启动app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=966) [如果你使用状态轮询技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=971) [你必须要记住一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=973) [那就是当你的app再次联网时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=974) [交易仍会通过StoreKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=977) [在更新后的交易回调中出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=979) [你仍然应该处理这些交易
将其发送到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=981) [你的服务器以进行验证
并在用户的设备上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=985) [再次关闭它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=987) [即使你的服务器已经通过状态轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=988) [知道它们的存在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=991) [我们鼓励你将其作为
发送最新收据数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=993) [并将其存储到服务器上的机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=996) [状态轮询在用户的信用卡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1004) [可以收费时工作很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1006) [但是如果在某个订阅期内
用户的信用卡出现了一些问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1008) [以至App Store无法
对其下一个订阅周期收费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1012) [这时该怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1015) [这个用户是否注定会
非自愿地取消订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1017) [这个用户是否注定会
非自愿地取消订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1017) [并不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1021) [当遇到这样的结算问题时
你可以执行三个简单的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1023) [首先 你观察到这个用户
没有续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1026) [他们的订阅现在已经失效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1030) [其次 你可以引导该用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1033) [更新他的账单信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1036) [然后是第三步 当发生续订交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1039) [立即解除对该用户的屏蔽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1043) [第一步和第二步非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1047) [如果使用了我们刚刚谈到的
状态轮询技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1049) [但这里的第三步使用了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1051) [我们去年推出的特性
服务器到服务器通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1053) [我们来看看这个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1058) [假设在一个订阅期内
App Store在尝试向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1059) [此用户的信用卡收费时发生错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1062) [（服务器到服务器通知）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1064) [然后你会通过状态轮训发现这个用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1066) [没有新的续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1069) [你的服务器通过正确的计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1072) [确定该用户不再是合法订阅用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1074) [所以当用户通过网站访问你的服务时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1076) [你给他们一些适当的错误信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1079) [你给他们一些适当的错误信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1079) [告诉他们其订阅服务无法续订](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1081) [你可以引导该用户
在App Store中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1084) [更新他们的账单信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1087) [现在当用户更新他们的账单信息时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1089) [也许他们只需更新过期日期
或其它什么内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1091) [这时发生了两件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1094) [首先 App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1095) [会立即向用户的信用卡收费
并进行一次成功的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1098) [当App Store这样做了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1101) [它所做的第二步是
直接向你的服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1103) [发出一个关于该续订交易的
HTTP POST请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1105) [该POST请求的载荷中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1110) [包括刚发生的交易的新信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1114) [你可以使用载荷中的
original_transaction_id字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1116) [来确定这个通知是针对哪个用户的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1119) [一旦你找出该用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1123) [你可以使用最新的
expires_date](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1125) [来为此用户进行更新
以便他们获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1127) [下一个订阅期的访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1131) [接着这位可能还在盯着你的网页](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1133) [试图访问其中内容的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1135) [将能够立即被解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1138) [将能够立即被解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1138) [因为你的服务器直接从
App Store收到该推送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1140) [当这种事情发生时
快速解锁用户非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1145) [尤其是当他们付出巨大努力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1148) [去手动更新他们的信用卡信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1151) [并等待访问服务器时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1153) [但是这里有一点需要注意
那就是只有当订阅确实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1155) [如我们刚刚看到的那样失效时
这个通知才会被发送](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1158) [为了发现成功的续订交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1162) [你仍然需要依赖
我们刚刚介绍的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1164) [状态轮询技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1166) [但设置并使用
服务器到服务器通知非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1168) [你所要做的只是在
App Store Connect中输入一个网址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1171) [这只是你自己服务器上的一个端点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1175) [如果你将其输入到
App Store Connect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1177) [App Store将开始向
服务器发送有关这些状态变更事件的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1179) [HTTPS POST请求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1182) [正如我们在POST请求中
看到的那样 请求中包含了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1184) [触发该请求的交易的
latest_transaction_info字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1188) [你需要确保你的服务器
符合ATS要求以便接收这些信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1190) [但这是一个非常简单的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1194) [它却可以给很多用户带来更好的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1196) [以上是一些关于
如何构建你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1202) [和服务器体系结构的技巧和窍门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1204) [让我们来谈谈你可以
在app内体验中使用的三个窍门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1206) [来大幅提升用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1210) [首先 我们假设用户已登录到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1213) [你提供的服务的账户中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1216) [为了跟踪每个订阅ID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1219) [你需要使用位于服务器上的
这个用户表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1222) [现在我们谈到实际创建账户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1225) [我们认为
最好在进行创建帐户步骤之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1227) [就可以进行app内购买](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1229) [（创建用户帐户）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1231) [为什么呢？
对用户来说这是一种更好的经验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1232) [你第一次打开某app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1235) [就可以购买订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1236) [并立即访问你想要的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1238) [对你而言 这样更好
因为你可以获得更高的转化率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1240) [用户不必输入邮件地址](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1243) [和密码就能够向你支付](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1245) [现在你可以通过在这些实例中
使用匿名帐户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1249) [来使用我们刚刚谈到的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1251) [你可以使用
original_transaction_id](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1255) [来关联多个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1259) [来关联多个设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1259) [如果你使用这样的匿名账户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1262) [当用户需要真正创建一个账户时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1264) [你可以简单地通过一个去匿名过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1267) [即更新邮件地址字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1270) [和其他个人信息相关的字段
来达到目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1273) [这是第一个窍门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1277) [第二个窍门是关于
如何销售你的app内购买项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1279) [在销售你的订阅时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1282) [你可以使用我们去年推出的功能
即推介定价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1283) [推介定价有一个重要的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1287) [即你在运行时需要知道用户是否真的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1290) [具有推介定价资格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1294) [你需要知道它的原因是
你必须知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1295) [你要呈现给用户的价格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1297) [无论是显示正常的
StoreKit价格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1300) [还是你想给用户提供的推介价格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1301) [来让他们进门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1304) [现在你可以通过监视](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1306) [后台正在发生的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1308) [来提前知道这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1311) [让我们看看它是如何工作的
在验证交易时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1313) [就像我们刚才看到的一样
你需要留意这两个字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1316) [is_trial_period字段
和is_in_intro_offer_period字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1319) [is_trial_period字段
和is_in_intro_offer_period字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1319) [如果这些字段中的任何一个为真](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1324) [这就表明这笔交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1326) [是一个推介价位或免费试用的交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1329) [如果是这样
你应该记录它的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1332) [针对当前用户的
product_id](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1336) [你可以将它们存储在名为
consumedProductDiscounts的字段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1337) [现在 如果你正在跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1341) [哪些产品被用来提供推介优惠
当你需要向用户显示一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1344) [新的订阅产品的价格时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1347) [你可以这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1351) [你可以获取
currentUser的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1353) [consumedProductDiscounts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1355) [在它们上面执行
SKProductsRequest函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1357) [现在iOS 12中
SKProductRequest的response](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1359) [包含subscriptionGroupIdentifier
属性的原因是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1363) [以便于你知道这个特定产品
来自哪个订阅组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1366) [现在有了这个
subscriptionGroupIdentifier](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1369) [你就可以在该用户的一组
consumedGroupDiscounts中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1372) [跟踪该消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1376) [你知道这个用户使用过哪个订阅组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1377) [你知道这个用户使用过哪个订阅组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1377) [现在 当你要呈现
比如说产品A的价格字符串时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1382) [它只需进行一个简单的检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1386) [你可以检查此用户的
consumedGroupDiscounts列表是否包含](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1387) [你想要卖给他们的产品的组标识符
在这种情况下是产品A](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1391) [如果确实如此
则表示该用户已实际使用过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1395) [之前的推介报价](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1398) [因此你可以将正常价格字符串
呈现给该用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1400) [但如果不是
他们仍然有资格获得该推介优惠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1404) [因此你可以使用位于
SKProductObject上的推介价格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1407) [在呈现价格字符串时
这部分没有什么变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1412) [它与你用于呈现
任何app内购买的技术相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1415) [我不打算在这里深入讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1419) [但我建议你观看上一个演讲的视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1421) [其中讨论了如何更加动态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1424) [呈现这些价格字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1426) [有关设置推介优惠的更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1428) [我也建议你看看
周三下午5点在三号厅举办的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1430) [“App Store Connect新特性”演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1433) [所以这是关于推介定价的第二个窍门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1437) [这里的第三个窍门是关于订阅管理的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1439) [这里的第三个窍门是关于订阅管理的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1439) [你可以直接在你的app的
用户界面中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1443) [让用户可以在不同订阅层级之间
升级和降级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1445) [为了做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1448) [你实际上可以像
出售首次订阅一样处理它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1449) [现在如果你正在销售给用户的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1453) [是同一个订阅组的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1455) [它将与用户已订阅的层不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1457) [你可以创建一个SKPayment](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1460) [就像你向用户出售](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1463) [首次订阅服务一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1464) [当你这样做时
StoreKit实际上会处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1466) [这是一次升级或降级的事实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1468) [所以你不必担心该用户会订阅两次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1470) [如果你不想在app中提供你自己的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1474) [升级和降级用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1476) [你也可以只提供一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1478) [到App Store
订阅管理界面的链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1479) [我们为你提供一个链接
以便你能够直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1482) [从你的app访问此界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1484) [在这里用户可以升级
降级甚至取消订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1485) [你的app通常是
用户进行订阅管理的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1490) [首选地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1492) [以便升级、降级或取消订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1493) [因此提供某种让用户
可以做到这点的链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1495) [是一个非常好的主意
它可能在你的app的设置中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1497) [是一个非常好的主意
它可能在你的app的设置中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1497) [为了进入这个页面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1501) [在我们的app内购买项目指南中
有一个可用的链接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1502) [链接在这里 如果你想要记一下的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1505) [以上是一些可以在app中
实现的简单窍门](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1509) [从而为用户提供
使用订阅服务的愉快体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1512) [接下来
我把话筒交给同事Michael](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1514) [他会谈一些能够防止订户流失的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1516) [实用技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1519) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1520) [下午好
我叫Michael Gargas](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1529) [我是App Store运营团队的
技术支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1531) [今天我想谈谈如何通过
使用Pete刚刚谈到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1535) [一些策略和方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1539) [来减少app内的订户流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1541) [今天我们将覆盖
非自愿流失和自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1544) [这是两种在订阅app中
常见的流失类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1547) [以及一些方法来赢回这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1551) [你可能已经失去或即将失去的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1553) [首先我们来谈谈非自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1557) [首先我们来谈谈非自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1557) [非自愿流失是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1561) [由于平台上付款或结算失败
而损失的订户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1564) [去年的WWDC中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1568) [我们向你介绍了我们做的一些工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1570) [来最小化app内的
非自愿流失的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1572) [我们宣布了我们升级后的
结算重试服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1576) [其中我们将重试时间
从24小时扩展到60天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1578) [我们还实施了新的重试策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1584) [并随时调整它们
以赢回越来越多的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1586) [2017年7月13日是
值得记住的一个日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1592) [因为这一天Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1595) [积极开始为你恢复订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1598) [如果我们查看自启动以来的
结算重试效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1603) [我们可以看到
我们的恢复率已经翻了一倍还多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1607) [而对于非自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1611) [我们已经在平台范围内
削减其2%以上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1613) [现在 如果看看我们的调整
如何影响订阅的恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1622) [我们可以看到
一个季度随着一个季度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1626) [我们已经能够持续恢复
你越来越多的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1629) [现在最终的结果是
自启动结算重试功能后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1635) [我们已经恢复了1200万次订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1640) [这就是Apple为尽量减少
你的非自愿流失所做的一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1647) [作为开发人员你也可以采取一些策略](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1650) [来最大程度地减少
你的订阅app内的自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1653) [你可以利用到Pete在前面提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1658) [一些订阅相关的收据字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1661) [你还可以使用宽限期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1663) [在此期间 你可以部署一些
有效的客户消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1665) [我们来看一个示例订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1671) [在这里我们可以看到
我们的订户将于4月26日到期续订](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1674) [然而他们遇到了一个结算问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1678) [然而他们遇到了一个结算问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1678) [所以为了让你知道
Apple正在通过结算重试服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1682) [积极尝试向该用户收费](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1686) [我们将在JSON响应中显示一个
合理命名的字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1689) [is_in_billing_retry_period](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1692) [其值为1代表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1695) [我们正尝试向该订户收取资金](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1698) [如果我们回到刚才的订阅示例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1703) [你可以看到
这已被添加到JSON响应中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1705) [当你看到它与过期日期同时出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1708) [这就是你作为开发人员
实施我们所谓的宽限期的标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1711) [你可能会问自己什么是宽限期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1717) [宽限期是在结算重试状态下的
免费订阅访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1722) [然而 这发生在你失去该用户之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1727) [在他们彻底流失之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1729) [宽限期的目标是改善订阅恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1732) [我们来看看如何利用收据响应中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1735) [部分信息做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1737) [我们回到刚才的示例订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1740) [你可以看到我们的订户处于
结算重试状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1743) [并将于4月26日到期续订](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1745) [我们想添加一些服务器端逻辑以使用
expires_date字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1749) [和is_in_billing_retry_period字段
来添加一段时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1753) [在这个例子中为三天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1757) [用户在这期间将能够继续访问该服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1759) [并在技术上仍然保持订阅状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1762) [你为什么要这样做呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1767) [因为这是部署有效客户消息的好时机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1768) [来在该情景下与你的订阅者进行沟通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1773) [让他们知道他们的订阅可能存在问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1775) [你可能想要执行某些操作
例如要求他们更新付款方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1779) [或让他们重申所订阅产品的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1783) [价值定位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1787) [在此期间 你也可以提供受限服务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1789) [比如在娱乐app中可以浏览
但不能观看体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1792) [这里我们可以看到Peak
一个App Store上的订阅app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1798) [这里我们可以看到Peak
一个App Store上的订阅app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1798) [Peak正在利用结算重试状态字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1802) [来向其订阅者呈现一条情景消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1805) [让他们知道他们的订阅存在问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1808) [当用户与其交互时
用户会看到另一个界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1812) [其中明确指出问题所在
以及解决问题的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1815) [如果能将用户从这个界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1821) [直接引导到我们的系统中
使其能够更新付款信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1824) [这将非常有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1827) [因此今天我很兴奋地宣布
在今年的WWDC后不久](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1830) [我们将有两个新的URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1833) [一个用来直接驱动用户
更新他们的账单信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1836) [另一个用来让用户管理自己的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1839) [比如Pete早些时候提到的
升级、降级和跨级操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1841) [这时很多开发者会问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1851) [我们何时能看到我们的用户被恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1853) [平均而言
我们看到大部分用户的恢复发生在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1856) [在平台上进入结算重试状态的
前7天内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1859) [在平台上进入结算重试状态的
前7天内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1859) [这应该是提供
完整访问宽限期的合适时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1866) [因为我们看到很多用户
在此期间自行恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1869) [你最好在该期间末尾](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1873) [部署客户消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1875) [来引导一些可能需要更长时间
才再次打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1877) [你的app的订阅者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1880) [让我们回到刚才的示例订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1884) [如果我们成功恢复了这些用户的订阅
会发生什么呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1887) [当重试尝试成功时
重试或恢复的那个日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1893) [将成为新的订阅周期的起始日期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1897) [这将在交易验证成功并完成时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1900) [反映在JSON响应中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1903) [但我们不会止步于此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1907) [我们也将部署服务器到服务器通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1909) [以便你可以在所有平台上立即解锁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1912) [用户的访问权限
并关闭与客户的这次交互](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1914) [让他们知道
你的账户现在已经没问题了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1918) [让他们知道
你的账户现在已经没问题了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1918) [这是非自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1922) [客户没有从技术上做出选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1924) [退订你的app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1926) [什么是自愿流失呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1929) [自愿流失是由于客户做出选择
而导致的订户流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1932) [其可能是取消订阅或请求退款](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1937) [明确来说 该用户主动做出选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1940) [来离开你的订阅产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1943) [那么作为一名开发人员你能做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1946) [来最大限度地减少
app内部的自愿流失呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1949) [Pete刚介绍了如何进行状态轮询
你可以实现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1953) [以获取有关用户的一些
关键的订阅详细信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1956) [当你获得该信息后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1960) [你可以使用它来提供
有吸引力的替代订阅产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1961) [以尽可能保住该用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1965) [所以让我们再多谈一下状态轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1971) [随着服务器到服务器通知的发布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1975) [你仍然需要进行状态轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1977) [实际上只有两个关键原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1979) [实际上只有两个关键原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1979) [首先是想知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1983) [我的订阅用户是否会在
下一个订阅期内流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1985) [第二个是 我的用户续订了吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1989) [我们经常被问到 作为开发人员
我应该在何时进行轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1994) [我什么时候应该尝试找到这些用户
并查看其订阅状态的改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=1997) [我们认为进行状态轮训
最有效的时间是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2003) [在订阅期的开始或结束时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2007) [通过响应式的部署](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2010) [你很可能会找到订阅产品中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2012) [自愿流失的大多数用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2015) [但当你进行状态轮询时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2020) [你还可以访问一些其他订户状态字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2022) [你可能想要获取这些字段并将对
/verifyReceipt的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2026) [所返回的解码JSON响应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2030) [保存到数据库的用户表中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2032) [或者 你可以解析出特定的字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2035) [例如结算重试状态
以便细分客户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2039) [例如结算重试状态
以便细分客户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2039) [并且了解哪些人处于重试状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2042) [而哪些不是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2045) [客户是否会自愿流失的标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2047) [通过称为auto_renew_status的字段显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2051) [auto_renew_status会让你知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2057) [如果其值为1 则该用户将
在随后的订阅期内恢复订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2060) [若值为0则代表他们会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2064) [下一个续订日期自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2067) [让我们看看这在我们的示例订阅中
看起来如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2071) [我们有一个3月26日购买的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2075) [他已经通过管理订阅设置界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2081) [禁用了自动续订功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2083) [碰巧的是 我们在该事件发生后不久
就进行了状态轮训](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2087) [我们可以通过收据响应看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2091) [auto_renew_status已变为0了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2094) [这时你可以更新你服务器上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2098) [这时你可以更新你服务器上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2098) [数据库中的用户表
并将该客户归类为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2101) [潜在自愿流失客户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2104) [如果回到我们刚才的示例订阅
我们执行了状态轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2110) [我们了解到这位顾客可能会离开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2113) [那我们该怎么办？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2116) [作为开发者
这是你在同一个订阅组中展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2118) [更具吸引力的降级优惠的机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2121) [在这里 我们可以看到
Peak正试图留住该用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2125) [通过向他们提供更短的使用期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2128) [或更低价的订阅期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2130) [或是另一个不同的产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2133) [如果该用户决定接受这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2137) [就像Pete向你展示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2140) [通过在你的app中
显示升级和降级一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2142) [我们想让你知道他们在接下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2146) [将续订的产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2149) [我们通过JSON响应中的
auto_renew_product_id字段来完成此操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2152) [这与产品ID不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2157) [因为这将是订阅者续订后的
下一个产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2159) [因为这将是订阅者续订后的
下一个产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2159) [我们可以在该示例订阅中看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2166) [我们的用户选择降级而不是流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2169) [我们已将auto_renew_status更改为1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2172) [并且添加了auto_renew_product_id字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2175) [立即获悉此更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2179) [也是非常有益的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2181) [为此 我们将发送一个
服务器到服务器通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2183) [让你知道你的订阅者
改变了他们的续订偏好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2187) [如果你这时向用户说明
他们当前使用的服务级别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2193) [与他们将在下一个订阅期
得到的服务级别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2197) [有何不同 这将是非常有益的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2199) [开展一个能100%留住用户的
订阅业务是不可能的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2204) [所以重要的是要了解
你怎样做才有可能赢回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2208) [流失的部分订阅用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2212) [赢回是指已流失用户的再次回归](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2216) [赢回是指已流失用户的再次回归](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2216) [这可能是通过向他们显示
重新订阅优惠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2220) [或调查他们离开的原因来达到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2223) [现在看看我们的示例订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2228) [让我们看看自愿取消是什么样子的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2230) [以及我们如何在app内部利用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2232) [在这里 我们的用户已选择
通过AppleCare取消](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2236) [为了让你知道这个事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2240) [我们将在JSON响应中
添加cancellation_date字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2243) [这是你知道
此客户已联系AppleCare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2246) [并取消或要求退款的标志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2250) [但作为开发人员
你希望立即知道这些信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2253) [为此我们将部署一个
服务器到服务器通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2258) [这很重要
因为你想要立即关闭所有平台上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2262) [这些用户的访问权限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2266) [并可能向他们显示其他订阅优惠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2268) [现在当这个用户流失后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2274) [能够分辨他是自愿取消订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2276) [还是由于某些支付或结算问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2278) [还是由于某些支付或结算问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2278) [而非自愿取消订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2282) [非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2284) [为此我们在JSON响应中
添加了expiration_intent字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2287) [为了清晰起见
这只会在订阅失效后显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2292) [我们真正关心的是两个关键值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2298) [第一个值是1
表示属于自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2300) [第二个值是2
表示属于非自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2305) [回到我们的示例订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2313) [我们的客户
通过AppleCare取消了订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2315) [可以看到我们已在收据响应中
添加了expiration_intent字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2317) [且其值为1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2320) [那么你作为一名开发人员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2325) [当看到用户处于这种状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2327) [并且你能分辨他们属于
自动或非自动流失的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2329) [你该怎么做？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2331) [对于自愿的情况
你可能想对这些在你的新系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2336) [对于自愿的情况
你可能想对这些在你的新系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2336) [建立过账户的订户进行调查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2340) [你可以问他们为什么服务不适合他们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2342) [以及你可以如何改善它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2346) [从而为他们或其他用户
提供更好的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2347) [此外 你还可以显示
同类的其他订阅产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2352) [因为如果他们重新订阅这些产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2356) [你希望继续为85/15的
收入分成积累时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2359) [当用户自愿流失时
我们可以看到Peak在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2365) [显示了重新订阅优惠
在这个例子中为一个60%的折扣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2369) [对于非自愿流失
由于用户没有主动做出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2376) [要退订的决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2380) [只需显示相同或替代的订阅产品即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2381) [你可能想要在用户登录到
你的app中时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2385) [显示一些持久的消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2387) [让他们知道他们已经失效
但随时都可以回来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2390) [你也可能想要部署受限订阅体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2394) [比如在娱乐app中只能浏览
但不能观看的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2398) [比如在娱乐app中只能浏览
但不能观看的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2398) [这是Tinder的界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2402) [当用户与专业级或订阅级功能
进行交互时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2404) [他们不断被提示订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2408) [总而言之 如果说你能
从这部分中学到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2412) [任何关于减少用户流失的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2415) [那就是你应该好好利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2417) [这些订阅收据字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2419) [然后你可以通过状态轮询来了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2423) [何时你的用户可能会自愿流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2426) [然后你可以使用该状态轮询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2432) [来部署一些有针对性
并且有效的客户通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2434) [最后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2438) [向这些用户展示相应的订阅优惠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2440) [以此希望赢回他们
或者从一开始预防他们流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2444) [现在我想将话筒交回同事Pete](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2449) [来讨论分析和报告的话题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2451) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2453) [谢谢Michael](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2462) [如果你还没处理过这些JSON字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2464) [我们强烈建议你尝试一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2467) [并感受它对客户保有率的巨大作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2469) [作为工程师
我们很少有这样的机会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2471) [通过如此简单的架构调整](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2473) [就可以对业务收入产生
如此大的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2475) [所以我们一起来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2478) [今天我们在分析和报告领域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2479) [带来的一些很棒的新升级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2481) [在App Store Connect中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2484) [销售和趋势部分包含大量有用的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2486) [现在你甚至可以更深入的了解
你的app的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2490) [当前的这个订阅摘要仪表板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2493) [现在还可以监控](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2496) [处于结算重试状态的订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2498) [这对了解用户行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2501) [以及确定最有效的宽限期长短](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2504) [非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2506) [就像刚才Michael谈到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2507) [今年我们还为订阅保有情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2510) [推出了一个全新的仪表板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2513) [这个页面显示了推介价格的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2515) [以及多少用户属于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2519) [以及多少用户属于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2519) [高提成客户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2521) [也就是当用户订阅超过一年时
你能够得到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2522) [85/15提成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2524) [仪表板包含新的图表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2528) [来帮助你快速识别哪些订阅群组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2530) [是表现最好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2532) [而且你可以随时监控你的订阅效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2534) [并比较你的app在不同时期的表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2537) [现在 所有这些新信息不仅可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2542) [在App Store Connect报告中显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2545) [还可以通过新的
App Store Connect API获取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2547) [这里的报告数据每天都会提供给你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2550) [你可以编写自己的程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2553) [来将其存入你自己的数据仓库
以进行进一步分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2556) [我们不会讨论更多关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2559) [App Store Connect API的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2561) [但我强烈建议你观看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2562) [周四下午3点在三号厅举办的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2564) [“自动化App Store Connect”演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2567) [其在自动化领域有一些
非常令人兴奋的改进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2568) [我们讨论了你可以从收据中得到什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2573) [以及你可以从这些
App Store Connect报告中获得的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2575) [现在总结一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2577) [App Store收据可以用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2579) [App Store收据可以用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2579) [验证那些StoreKit交易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2581) [并更新用户的订阅状态
以及在你的服务器上维护该状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2584) [你也能像Michael演示的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2587) [使用它们来了解个人用户的行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2590) [对于App Store Connect报告而言
它的原因稍有不同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2593) [它们更适合宏观层面的分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2596) [比如了解用户的订阅路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2598) [或者最重要的是
了解你能通过用户订阅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2601) [获得多少收入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2605) [今天我们谈论了很多主题
但作为总结](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2609) [请记住 当涉及到订阅管理时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2613) [服务器端状态管理
为你提供了更多的灵活性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2617) [如果你尚未这样做
请使用之前提到的URL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2620) [接收来自App Store的通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2622) [考虑在你的app中设置推介价格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2626) [这是让用户开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2628) [订阅你的app的好方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2630) [使用Michael向我们介绍的
那些字段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2632) [来添加一些简单的消息
以减少订户流失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2635) [对于实际已失效的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2637) [提供一些替代的的订阅选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2640) [也许这样可以赢回他们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2642) [最后 别忘了试试这些新的报告工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2644) [它们可在App Store Connect中找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2646) [有关本次演讲和视频的更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2650) [本次演讲编号为705](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2652) [我们稍后和星期四上午9:00](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2654) [都会有实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2657) [我们将有来自StoreKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2658) [和App Store Connect团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2660) [随时准备回答你可能遇到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2662) [任何关于订阅工程的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2663) [非常感谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/705/?time=2665)