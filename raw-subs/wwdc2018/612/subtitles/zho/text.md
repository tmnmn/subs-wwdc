# Metal Game Performance Optimization

## Summary
Realize the full potential of your Metal-based games by tackling common issues that cause frame rate slowdowns, stutters, and stalls. Discover how to clear up jitter and maintain a silky-smooth frame rate with simple changes in frame pacing. Get introduced to new tools for analyzing rendering passes and pinpoint expensive or unexpected work. Learn how to avoid thread stalls and get specific advice about handling thermal notifications.

## Info
* Graphics and Games
* WWDC 2018 - Session 612 - iOS, macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/

## Text
 [（Metal游戏性能优化）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=17) [（演讲612）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=22) [早上好 欢迎来到本次演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=29) [我叫Guillem Vinals Gangolells](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=31) [在Apple的
GPU软件性能团队工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=34) [你们这样的游戏开发者
使iOS成为一个优秀的游戏平台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=38) [在Apple
我们当然想助一臂之力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=43) [所以今年
我们检查了一些顶级的iOS游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=46) [并发现了一些常见的性能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=49) [我们分析了很多数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=52) [作为调查的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=54) [我们决定做这个谈话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=56) [所以这将是今天的主题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=59) [所以这将是今天的主题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=59) [开发出色的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=62) [但是 我只能在这里提供技术指导](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=64) [所以我们只能满足于此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=67) [（开发技术出色的游戏）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=69) [在开始之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=71) [我想借机感谢Croteam的朋友](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=72) [他们是《塔洛斯法则》背后的开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=75) [这是一款非常棒的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=78) [你将在这些幻灯片
和两个演示中看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=79) [请注意 它具有令人惊叹的视觉效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=83) [但它确实在性能上没变差](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=87) [这就是我们今天的目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=89) [让我们快速过一下今天的议题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=92) [我将首先介绍这些工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=96) [这是一个非常好的起步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=98) [然后我们将讨论实际的性能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=100) [有关帧速 线程优先级 热状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=104) [和不必要的GPU工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=108) [尽管所有这些问题似乎互不相关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=111) [它们会互相复合和影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=114) [所以解决所有这些问题很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=116) [让我们从工具开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=119) [让我们从工具开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=119) [（分析工具）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=121) [（及早分析及经常分析）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=123) [这是最重要的建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=124) [你应该尽早建档分析并经常更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=126) [除非你已经对游戏进行了分析
否则不要推出游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=130) [为此 你需要了解这些工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=133) [今天 我将关注其中两个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=137) [首先
我们看Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=140) [这是我们的主要分析工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=143) [你会想用它来理解性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=145) [延迟和总体时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=148) [其次 我们有Metal框架调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=151) [这也是一个非常强大的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=154) [你希望用它来调试GPU工作负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=156) [我们从哪里开始呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=160) [这是我们经常遇到的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=162) [嗯 今年我们让你们更轻松](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=165) [我们正在推出一种新的仪器模板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=168) [这将是一个很好的起点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=170) [游戏性能模板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=173) [这是现有工具的组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=175) [例如系统跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=178) [时间分析仪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=180) [和Metal系统跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=182) [我们为你配置好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=183) [它会记录与你的游戏相关的
所有CPU和GPU数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=185) [所以你可以用它调试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=189) [那么我们如何推出呢？
我们怎么到那里？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=192) [嗯…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=194) [只需打开Instruments
它就在屏幕中心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=195) [选择后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=199) [你将像设任何其它模板一样设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=201) [开始记录后
你将在窗口模式下执行此操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=204) [允许你任意地玩游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=207) [只有最后几秒的数据会被记录下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=210) [这就是最后几秒数据的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=214) [有很多信息 所以我们简单概述一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=218) [（系统跟踪和时间分析仪）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=223) [首先 我们有系统跟踪和时间分析仪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=225) [它将为你提供系统负载的概述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=227) [以及你的app CPU使用情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=230) [例如 用户交互式加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=233) [将记录给定时间内的所有活动线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=235) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=239) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=239) [你看到的橙色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=240) [表示可运行的线程数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=242) [大于CPU核心数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=245) [所以有一些意外情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=246) [这将提供系统的绝佳视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=249) [有几个很棒的谈话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=252) [更深入地探讨这个工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=254) [请进一步关注这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=256) [下一个是Metal系统跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=260) [我们的GPU分析工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=263) [它提供了图形堆栈的绝佳视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=264) [从Metal框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=268) [一直到到显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=270) [特别注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=272) [我们要密切关注GPU硬件时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=273) [分为顶点 片段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=277) [及计算 如果你的游戏用到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=280) [还要注意显示监视器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=282) [将是我们许多调查的起点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=284) [我们将识别长框架或启动器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=287) [我们将从那里开始一直调查下去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=289) [所以这是一个非常自然的起点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=292) [关于这个工具有很多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=296) [因为它确实是一个非常强大的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=298) [因为它确实是一个非常强大的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=298) [我鼓励大家去熟悉它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=300) [这几个演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=303) [将为你提供一个很好的起点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=304) [好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=308) [接下来要谈的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=309) [我们今年推出了一个线程状态视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=310) [此视图显示游戏中每个线程的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=314) [在这种情况下
每种颜色代表一种可能的线程状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=317) [例如被抢占以橙色表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=321) [已屏蔽以灰色表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=324) [我们专门为你 游戏开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=327) [设计了此视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=329) [因为我们知道
现代游戏中的线程系统非常复杂](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=331) [我们希望这对你有所帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=336) [我们还为每个CPU核心
提供了一个轨道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=340) [它将显示在该核心上运行的线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=344) [以及以颜色编码的该线程的优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=346) [用这个工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=351) [你将能够一目了然地看到系统的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=352) [还有…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=356) [这是一个简短但相当宽泛的工具介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=358) [这是一个简短但相当宽泛的工具介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=358) [现在我们该转向实际的性能问题了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=362) [第一个是关于帧速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=365) [让我们先看一下它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=370) [为此 我们用了Fox II
SceneKit演示的修改版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=372) [这将有助于我们更好地说明问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=376) [你能猜出哪个游戏生成得更快吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=380) [嗯…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=387) [你们中的一些人可能没有猜到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=388) [左边的游戏试图以
每秒60帧的速度生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=391) [但它只达到40](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=395) [所以它不流畅而有抖动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=398) [另一方面 右边的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=400) [它的目标是每秒30帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=403) [可以一贯地实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=405) [这就是为何它看起来更顺畅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=407) [但这有点违反直觉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=410) [为什么生成速度更快的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=414) [反倒看起来不太顺畅？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=418) [嗯 这个问题被称为微型口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=420) [或不一致帧速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=423) [它出现于帧时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=426) [高于显示刷新间隔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=428) [例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=431) [我们的游戏可能要25毫秒生成一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=433) [或每秒40帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=436) [而显示屏可能会每16.6毫秒刷新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=437) [或每秒60帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=441) [与我们刚看到的视频相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=443) [这会产生一些视觉上的不一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=445) [这种情况是怎么造成的？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=449) [我们在这种情况下做了什么？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=451) [嗯…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=455) [我们没有做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=457) [这就是问题所在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=458) [生成帧后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=461) [我们从显示链请求下一个可绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=463) [一旦我们得到了可绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=466) [我们完成了最后一步并立即展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=468) [我们明确地告诉了系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=471) [在下一个刷新间隔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=474) [尽快呈现可绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=476) [毕竟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=478) [我们的目标是每秒60帧 对吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=479) [我们的目标是每秒60帧 对吗？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=479) [还有另一类问题会导致微型口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=483) [有些游戏已经设定较低的帧率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=486) [但我们也发现了很多这样的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=492) [在主线程或
图像生成线程上用usleep](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=495) [（勿用usleep()
控制帧速！）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=498) [这在iOS中是一种很糟糕的做法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=499) [所以请不要那样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=501) [耐心等我几分钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=503) [我会告诉你在iOS中的正确方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=505) [现在…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=510) [让我们深入了解系统中发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=512) [微型口吃是可见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=516) [在这种情况下 我们在这里看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=519) [生成中涉及的所有组件的时间表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=520) [我们开始正常生成我们的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=523) [注意 这是一个三重缓冲区
在iOS中常见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=527) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=531) [每个可绘图都用字母和颜色表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=532) [注意这里的前提](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=536) [生成可绘图B](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=538) [生成可绘图B](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=538) [历时超过一个显示刷新间隔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=541) [即Vsyncs之间的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=544) [在这种情况下
生成到B可能需要25毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=547) [显示刷新间隔之间为16.6毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=550) [所以 既然这是前提](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=556) [这意味着我们需要在显示屏上保持A](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=558) [为下一个间隔给出时间以便完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=562) [我们会这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=566) [在那个时间段内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=567) [B实际上会完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=569) [并准备好呈现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=573) [但注意我们刚在这里隐藏了一个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=576) [在此间隔期间
我们还完成了C的生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=579) [我们已准备好立即呈现它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=583) [所以从这个时间段开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=586) [我们会遇到不一致的帧速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=589) [我们陷入了这种模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=591) [每隔一帧都不一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=593) [用户将看到微型口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=596) [现在…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=600) [现实世界中
这可能在以不同的形状和形式出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=601) [所以我们现在做的就是快速演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=606) [我将向你展示《塔洛斯法则》](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=608) [的仪器跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=610) [我们会用它来观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=612) [看能否识别现实世界中的微型口吃情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=613) [好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=625) [我们在这里看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=626) [与我之前展示的信息相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=627) [我们的游戏性能模板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=630) [已在默认状态下将此信息捕获](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=631) [注意我谈到的所有相同的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=634) [显示在左侧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=636) [所有游戏线程都在中间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=639) [尤其我们现在正在寻找微型口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=642) [所以这很直观地会让我们看显示轨道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=647) [因为微型口吃的定义
即是不一致的帧显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=650) [在这种情况下
我们在这里有显示轨道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=655) [注意 该显示轨道中有一些提示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=658) [注意 该显示轨道中有一些提示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=658) [我们添加了它们
这些是提示 这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=662) [它们会告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=665) [当表面显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=666) [比正常生成时预期更长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=668) [也许这是一个开始观察的好地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=673) [有一些堆砌](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=675) [让我们放大一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=677) [要放大 我们将长按选项键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=679) [并将指针拖动到感兴趣的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=681) [这种情况下
如果我们继续查看显示轨道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=685) [已经很明显存在微型口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=689) [我们可以看到
每个显示器都有不同的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=692) [所以在这种情况下 例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=696) [我们有50、33](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=697) [16 回到50](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=700) [再回到33](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=702) [所以当我们在仪器捕获中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=704) [看到这种模式时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=706) [这意味着存在微型口吃
我们应该纠正它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=707) [我们看看做法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=711) [回到幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=713) [好了…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=718) [我们刚刚看到了这个问题
及它在现实世界中的发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=719) [我们刚刚看到了这个问题
及它在现实世界中的发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=719) [模式基本相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=722) [那我们该怎么做呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=724) [最佳做实践
是确定游戏可以达到的帧速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=727) [所以在最小帧持续时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=732) [长于帧生成时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=734) [为此 有很多API可以帮助你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=737) [例如 MTLDrawable
addPresentedHandler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=741) [一旦可绘图出现 会给你一个回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=744) [这样一旦微型口吃发生
你就可以识别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=747) [其它两个API会帮你解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=751) [它们将允许你明确控制帧速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=755) [在这种情况下
我们提供了afterMinimumDuration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=760) [和atTime](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=763) [我们这里的目的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=765) [是把帧的最小持续时间
设置得比生成时间长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=766) [这正是我们要做的
让我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=771) [注意 当我们开始生成时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=775) [我们从一开始就保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=778) [我们从一开始就保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=778) [我们的帧显示时间长于生成时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=781) [每一帧都是一致的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=785) [用户的观感也会一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=788) [太好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=792) [另外 注意有副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=793) [帧速率将降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=795) [我们从每秒40帧降到30帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=797) [所以这也给了我们额外的帧时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=800) [我们是怎么做到的？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=805) [我们是如何修复帧速的？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=807) [嗯…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=811) [真的 只需几行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=813) [我们的模式与以前相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=816) [我们生成场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=818) [得到了下一个可绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=819) [我们做最后一步生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=821) [唯一的区别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=823) [是我们指定帧的最小持续时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=824) [并以最短持续时间呈现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=828) [就是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=831) [这将允许我们设置帧的最小持续时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=833) [它们将保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=836) [这样做之后 你可能会想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=839) [这样做之后 你可能会想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=839) [那么 最长持续时间呢？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=841) [我们的工作优先级概念如何体现？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=845) [或一帧可以花多长时间？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=848) [嗯 这是我们要谈的下一个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=851) [线程优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=853) [像之前一样 让我们先看一下它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=856) [还是用Fox II演示的修改版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=859) [你可能在想 而你会是对的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=863) [有很多事情可能导致这类的口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=865) [也许你正在作资源加载或着色器编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=867) [今天我们将重点关注更为根本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=872) [但也是非常常见的类型的口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=875) [即由线程停滞引起的口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=878) [如果工作优先级未很好地传达给系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=882) [你的游戏可能有意想不到的停滞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=887) [除了生成游戏之外
iOS还做很多事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=890) [线程优先级用于保证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=894) [整个系统的服务质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=897) [所以如果一个线程做了很多工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=900) [其优先级将随时间的推移而降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=902) [以让其它线程有机会运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=905) [这就是优先级衰减的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=908) [另外 在我身后的幻灯片上可看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=911) [优先级倒置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=914) [这是另一类
以非常类似的方式表现出来的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=916) [当生成线程依赖于来自同一引擎的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=920) [较低优先级的工作线程以完成工作时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=923) [在这种情况下 发生优先级倒置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=928) [我们看看它是怎么样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=931) [与我们之前看到的时间表相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=932) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=935) [我们开始以每秒30帧的速度生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=936) [很轻松](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=939) [但是 有一些背景工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=941) [iOS做很多东西
也许现在正在检查电子邮件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=944) [若我们的线程配置不正确](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=948) [那问题就来了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=950) [你可能会被该后台工作抢占](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=953) [你可能无法完成GPU上
所有工作安排](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=955) [并且没有帧的最大持续时间的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=961) [所以帧生成可能会持续数百毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=965) [用户会看到口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=968) [这就是它背后的理论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=972) [在实践中 它的发生遵循相同的模式
但以不同的方式显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=974) [我们再作一个演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=979) [我将向你展示另一个仪器捕捉的
《塔洛斯法则》信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=981) [来看看如何识别此问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=984) [在这种情况下 你看到的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=997) [使用游戏性能模板作的信息捕捉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1001) [但这一次 我们已经放大了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1004) [进入我们感兴趣的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1006) [这是一个很长的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1008) [它的持续时间为233毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1011) [所以我们应该调查这个很典型的口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1014) [一眼看去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1018) [一眼看去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1018) [我们已经知道GPU似乎未做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1020) [在此期间它处于闲置状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1024) [这意味着我们没有喂饱它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1027) [现在 我们可以看一下CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1030) [CPU似乎相当忙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1034) [就像它们真的……](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1037) [所有这些看起来都很稳固](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1039) [注意 你在此处看到的是我们的
app的时间分析器视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1042) [看上去没有在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1048) [为什么我们的游戏没有运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1051) [这怎么会导致口吃？为什么？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1053) [嗯…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1056) [我们可以切换到我提到的新视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1058) [新的线程状态视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1061) [要做到这个 你进入app的图标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1063) [并点击此处的按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1067) [这将拉出轨道显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1070) [在这种情况下
你可以切换到线程状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1073) [这有望帮助你看到这里有问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1077) [这有望帮助你看到这里有问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1077) [它以橙色突出显示 这已经告诉我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1082) [该线程已被抢占192毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1086) [这就是问题所在 生成线程未运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1090) [有些东西先占用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1093) [如果你想了解更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1096) [你可以在底部展开信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1098) [也将包含线程叙述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1100) [并且通过单击被抢先的线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1103) [你会看到这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1107) [对正在发生的事情的解释](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1109) [在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1111) [你的生成线程优先级为26](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1113) [非常低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1116) [低于后台线程优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1116) [因为App Store正更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1119) [这是不应该的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1122) [我们想告诉系统
对我们的用户来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1124) [在那个特定的时刻 我们的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1127) [比App Store更新更重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1129) [让我们回到幻灯片
看看该怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1131) [最好的做法是配置你的生成线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1142) [建议将生成线程优先级固定为45](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1146) [注意 在iOS和macOS中
优先级具有升序值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1151) [因此优先级31高于优先级4](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1156) [此外 我们需要选择退出
调度程序的服务质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1162) [以防止优先级衰减
从而降低我们的优先级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1166) [我们看看配置良好的
生成线程是怎样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1171) [现在我们按照刚才所说的来配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1176) [我们开始正常生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1179) [我们还有一些背景工作在运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1182) [否则这不公平](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1184) [而且 这个后台工作
可能是更新App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1186) [正如我们在演示中看到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1189) [但请注意一个又一个Vsync后
正常生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1191) [我们正在抢占CPU的
后台工作以运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1197) [我们正在抢占CPU的
后台工作以运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1197) [用户看不到口吃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1202) [你的游戏可以每秒30个固帧运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1205) [即使系统负载很重](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1209) [这在技术上很棒 这就是我们要做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1212) [让我们看看如何通过
一点代码实现这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1215) [确实是一点代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1219) [只有几行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1222) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1224) [它只是配置pthread属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1226) [在创建pthread之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1229) [我们需要选择退出服务质量
将优先级设置为45](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1232) [就是这样 现在我们
可以用这些属性创建pthread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1237) [它会正常工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1241) [这很简单同时技术上很了不起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1243) [不是那么简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1247) [是我们要讲的下一个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1249) [处理多个热状态的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1252) [目的是明确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1256) [为持续性能设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1259) [为持续性能设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1259) [并处理偶尔出现的热问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1262) [我们看看我们如何来做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1265) [iOS设备可提供前所未有的电量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1268) [但是在一个非常小的外形中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1272) [因此 随着更多的app
在设备上使用更多资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1275) [系统可能会开始采取措施](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1278) [以保持低温和反应速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1281) [此外 用户可能已启用低功耗模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1285) [会产生相似的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1289) [好 所以最好的做法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1294) [是将工作负载调整为系统状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1297) [你应该监控系统并相应调整工作负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1302) [iOS有许多API可以有帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1305) [例如
用NSProcessInfo thermalState](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1308) [来查询或注册通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1312) [设备热状态变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1315) [检查低功耗模式的方式类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1317) [检查低功耗模式的方式类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1317) [另外 请考虑查询
来自MTLCommandBuffer的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1322) [GPU启动/GPU结束时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1326) [以了解系统负载如何影响GPU时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1328) [我们看看如何用一个简单的
代码示例来做到这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1334) [这直接来自我们的最佳实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1338) [它的核心是一个
非常简单的switch语句](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1341) [每个case对应一个热状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1344) [这里有名义上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1347) [一般](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1350) [重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1352) [和关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1353) [这一切都很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1357) [现在我们知道我们处于热状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1359) [并且这些指令告诉我们要做些什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1362) [我们怎样才能真正帮助
系统保持低温？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1365) [嗯…](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1370) [我可以给一些建议
但这取决于游戏开发者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1372) [来决定要做出什么样的妥协](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1376) [以帮助系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1378) [以帮助系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1378) [你知道什么行动最适合你的游戏
以在压力下保持出色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1381) [我的一些建议是针对帧速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1386) [以在整个游戏会话保持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1390) [例如
如果你不能以每秒60帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1393) [维持10分钟或更长
那么保持每秒30帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1396) [调整GPU工作也非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1401) [例如 考虑降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1405) [中间生成目标的分辨率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1408) [或者简化阴影图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1410) [加载更简单的资产](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1413) [甚至完全删除一些后期处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1414) [什么办法最适合你的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1418) [你就应该采取什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1421) [而且这把我们带到我们的下一个议题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1424) [关于处理不必要的GPU工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1429) [为此 请欢迎我的同事Ohad上台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1431) [他会都告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1434) [（不必要的GPU工作）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1436) [谢谢 Guillem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1440) [大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1444) [我叫Ohad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1446) [Apple的游戏技术团队成员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1447) [在之前的幻灯片中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1450) [Guillem展示了
适应系统的重要性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1452) [响应低功耗模式或不同的热状态等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1457) [将要求你调整GPU工作负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1462) [以保持整个游戏阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1464) [一致的帧速](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1466) [然而 对于许多开发人员来说
GPU有点像黑盒子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1469) [藏在游戏引擎的窗帘后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1473) [今天 我们来拉开这个窗帘](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1476) [浪费GPU时间是一个很常见的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1480) [也经常被忽视](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1483) [但我希望你记住这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1486) [技术上出色的游戏
不仅会达到其GPU预算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1487) [它们也是系统的好公民
帮助它保持低温并节能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1492) [所有流行的游戏引擎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1497) [都提供了一系列最佳实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1499) [都提供了一系列最佳实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1499) [我们不会介绍这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1502) [相反 我们将专注于
如何判断生成的内容是否昂贵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1503) [正如我们今天已经对CPU多次做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1508) [这最佳实践是对GPU进行分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1511) [我们GPU的强大功能可以隐藏许多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1517) [内容或算法上的效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1519) [你需要对工作量计时
但也要了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1522) [你启用的每种生成技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1526) [并只保留那些
明显增加游戏视觉质量的技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1529) [但是你怎么发现效率问题？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1534) [你如何确定过程的
哪些部分完全不必要？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1537) [这当然让我们回到了工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1540) [与往常一样 你的第一站
应该是Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1544) [我们在这里看看Metal系统跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1548) [它将为你提供精确的时间：](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1550) [顶点、片段及计算工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1554) [但是测量GPU时间
只是一半的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1557) [但是测量GPU时间
只是一半的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1557) [接下来 你想要真正了解
每一步正在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1560) [为此我们今年为Metal系统跟踪
添加了一个新工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1567) [这是依赖关系图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1571) [依赖关系图是一个单帧的故事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1575) [它由节点和边组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1580) [每一个都讲述了故事的不同部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1581) [边表示步与步之间的依赖关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1585) [当你从上到下跟踪它们时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1589) [你将看到每一步
在哪里可嵌入你的生成管道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1591) [以及它们如何协同工作来创建框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1594) [另一方面 节点是单个步的故事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1599) [它们由三个主要组成部分组成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1604) [首先 title元素将给出步名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1606) [我想确实强调这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1610) [命名标记一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1612) [这不仅有助于
Dependency查看器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1614) [也有助于我们的整个工具套件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1616) [其次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1619) [其次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1619) [它可以让你快速了解
正在查看的步类型](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1620) [生成、位块传输还是计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1624) [这里 从图标中
我们可以看到它是一个生成步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1627) [接下来 这里有一个统计列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1631) [描述了此步中正在完成的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1633) [最后 在底部 在此步中写入的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1636) [所有资源的列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1640) [并且每个资源都带标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1642) [允许预览的缩略图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1645) [以及具体描述每个资源的信息列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1647) [所有这些一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1653) [可让你真正了解每一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1654) [好的 现在我们知道如何读图表了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1657) [让我们跳转到一个演示
看看它们是如何组合在一起的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1660) [我在我的机器上运行了
Fox II演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1672) [它是在SceneKit中构建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1677) [允许我添加各种很棒的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1678) [允许我添加各种很棒的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1678) [如你所见 我有瀑落式阴影图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1682) [高光 景深 所有这些合在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1686) [创建一个精美生成的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1689) [我们用依赖关系查看器
来查看它是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1692) [首先 我们将转到Xcode
然后我们将捕获一个帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1695) [用底部的
Capture GPU框架按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1698) [我们选择左边的主要步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1701) [并切换到自动模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1705) [我们右边出现助手](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1707) [现在 注意我在调试导航器中
选择的同一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1710) [也是被选的 并且在主视图中心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1714) [这是一条双向的街](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1718) [当我们与图表进行交互时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1720) [选择不同的步或纹理甚至缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1723) [左侧的导航器和右侧的助手](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1729) [都会更新以显示你的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1732) [这是帧导航的一种非常棒的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1735) [现在当我缩小时
你会注意到的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1741) [是统计隐藏了 焦点消失了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1743) [视图从单独步转到了整个帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1746) [我可以缩小更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1750) [可以看到我整个帧的鸟瞰图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1752) [现在注意真正酷的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1757) [由于依赖关系驱动图的互联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1759) [每个逻辑工作在空间中组合在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1764) [让我们放大
看看我是什么意思](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1768) [这里我有一个工作分支
正在创建我的阴影图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1770) [在左边 我可以看到三步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1775) [生成阴影](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1779) [这太好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1781) [因为我不只是了解整个帧的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1782) [还有这两层之间的联系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1786) [每个生成技术是怎么构建起来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1789) [而当你使用游戏引擎打开它们时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1793) [这并非总是显而易见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1796) [例如 用我的阴影图 我可能不知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1798) [例如 用我的阴影图 我可能不知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1798) [每个级联都需要自己的步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1801) [如果我单独考虑这些中的每一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1805) [这不会很明显](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1808) [但现在我看到
我必须将它们视为一个群体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1809) [我在调整GPU工作负载作妥协时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1813) [这个认识帮我做出明智决策](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1817) [这就是依赖关系查看器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1822) [我切换回幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1824) [欢迎Guillem回到台上
谈他最后几点想法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1826) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1829) [谢谢 这是一个出色的演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1836) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1838) [酷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1843) [Ohad刚刚向我们展示过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1844) [通过依赖关系查看器查看图帧的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1846) [而且 你可以检查GPU工作负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1850) [例如 我们通常可能
从一个非常小而简单的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1854) [像这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1859) [像这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1859) [演变到一个非常复杂的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1861) [经过后期处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1863) [HDR中的多个阴影图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1866) [所有这些的实现方法可以是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1869) [在你的游戏引擎的相机对象中
添加几个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1872) [你会发现这些更改的代码复杂性很小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1877) [但生成复杂性可能增加了十倍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1881) [这就把我们带回到开头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1886) [就在我们开篇的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1889) [分析资料](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1892) [了解游戏的功能非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1894) [你花了数万小时开发游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1899) [你应该考虑花一些时间进行分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1903) [我们今天看到的一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1907) [可以在几分钟内找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1910) [最好的部分是什么？](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1912) [你无需知道自己在寻找什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1913) [仅仅记录口吃 查到长帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1916) [并从那里开始一直继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1919) [并从那里开始一直继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1919) [就这么简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1921) [这个工具将为你提供所需的所有信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1923) [来识别问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1925) [但你需要使用该工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1927) [这就是关键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1930) [我们看到了一堆常见的陷阱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1934) [和一些最佳的解决办法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1937) [所有这些问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1939) [可以通过分析找到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1941) [我们就是这样找到问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1943) [我们分析了大量游戏
发现了常见问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1944) [并决定把它们放在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1947) [如果你有权访问引擎源代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1949) [确保帧速度和线程优先级都配置好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1953) [这只是几行代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1957) [但无论如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1960) [你的游戏应该始终适应热量需求](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1961) [并且不要提交不必要的GPU工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1964) [确保遵循所有这些最佳实践](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1968) [你也将开发技术上令人敬畏的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1971) [这就是我们这个谈话的宗旨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1974) [更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1977) [中午12点会设一个实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1978) [中午12点会设一个实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1978) [我们会在那儿 我会在那儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1981) [如果你在这次会议之后有任何问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1983) [我们非常乐意回答](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1985) [或者也许你只是想坐下来
让我们分析你的游戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1987) [此次WWDC还有两场精彩的演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1992) [关于游戏开发者的Metal
和我们的分析工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1996) [非常感谢 祝你们今天愉快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=2001) [度过愉快的一天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=2003)