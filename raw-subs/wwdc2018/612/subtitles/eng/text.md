# Metal Game Performance Optimization

## Summary
Realize the full potential of your Metal-based games by tackling common issues that cause frame rate slowdowns, stutters, and stalls. Discover how to clear up jitter and maintain a silky-smooth frame rate with simple changes in frame pacing. Get introduced to new tools for analyzing rendering passes and pinpoint expensive or unexpected work. Learn how to avoid thread stalls and get specific advice about handling thermal notifications.

## Info
* Graphics and Games
* WWDC 2018 - Session 612 - iOS, macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=6) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=22) [&gt;&gt; Good morning, and welcome to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=29) [this talk.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=30) [My name is Guillem Vinals](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=32) [Gangollels.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=33) [And I work at the GPU Software](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=34) [Performance Team here at Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=35) [Good developers like you make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=38) [iOS an excellent gaming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=40) [platform.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=42) [And we at Apple obviously want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=43) [to help.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=45) [So this year we reviewed some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=46) [the top iOS games and found some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=47) [common performance issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=50) [We analyzed a lot of data, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=52) [as a result of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=54) [investigation, we decided to put](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=55) [this talk together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=57) [So this is going to be the main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=58) [So this is going to be the main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=58) [topic today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=61) [Develop Awesome Games.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=62) [But I will only be providing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=65) [technical directions here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=66) [So we'll [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=67) [Before we begin, please let me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=70) [thank our friends at Croteam.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=73) [They are the developers behind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=75) [The Talos Principle, which is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=76) [really awesome game.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=78) [You will see it featured in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=79) [these slides and in two of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=81) [demos.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=82) [Notice that it has stunning](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=83) [visuals but it does really not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=86) [compromise in performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=88) [And that's what this is all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=90) [about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=90) [So let's do a quick run through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=92) [of the agenda.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=93) [I'll start with an introduction](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=95) [to the tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=97) [This is a very good place to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=98) [start.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=99) [And then we'll talk about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=100) [actual performance issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=102) [Around frame pacing, thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=104) [priorities, thermal states, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=106) [unnecessary GPU work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=108) [Even though all these issues](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=111) [seem unrelated, they will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=112) [compound and aggravate each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=114) [other.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=115) [So it's important to tackle them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=116) [all.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=117) [Let's start with the tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=118) [Let's start with the tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=118) [This is the most important](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=121) [message.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=125) [You should profile early and do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=126) [it often.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=128) [Do not ship your game unless](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=130) [you've profiled it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=132) [And for that you will need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=134) [know your tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=135) [Today, I will focus on two of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=137) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=139) [First, we have instruments,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=141) [which is our main profiling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=143) [tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=144) [You will want to use it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=145) [understand performance, latency,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=146) [and overall timing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=149) [Second, we have the Metal Frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=151) [Debugger, which is also very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=153) [powerful tool, which you will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=154) [want to use to debug your GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=157) [workload.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=158) [So where do we start?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=159) [This is a question we often get.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=162) [Well, this year we are making it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=165) [easier for you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=167) [We are introducing a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=168) [instruments template, which will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=169) [be a great starting point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=171) [The Game Performance Template.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=173) [It is the combination of already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=175) [existing instruments such as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=176) [System Trace, Time Profiler, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=178) [System Trace, Time Profiler, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=178) [Metal System Trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=182) [We configured it for you so it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=184) [records all the CPU and GPU data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=185) [that is relevant for your game.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=187) [So you can make it smooth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=189) [So how do we launch it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=192) [How do we get there?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=193) [Well, just open Instruments and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=194) [you will see it right there in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=197) [the center.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=198) [After you choose it, you will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=199) [able to configure it same as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=201) [every other template.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=202) [Once you start recording, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=204) [will do so in windowed mode,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=206) [which will allow you to play](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=207) [your game for as long as you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=208) [like, and only the last few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=210) [seconds of data will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=212) [recorded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=213) [And this is how this last few](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=214) [seconds of data will look like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=215) [There's a lot of information so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=218) [let's have a quick high-level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=220) [overview.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=222) [First, we have System Trace and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=222) [Time Profiler, which will give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=226) [you an overview of the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=228) [load as well as your application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=229) [CPU usage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=231) [For example, user interactive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=233) [mode will record all the active](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=235) [threads at a given time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=237) [In this case, the orange color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=239) [In this case, the orange color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=239) [you can see means that there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=241) [more runnable threads available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=243) [than CPU cores.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=245) [So there is some contingency.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=246) [These will offer a great view of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=249) [the system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=250) [There's a couple of great talks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=252) [that talk about this instrument](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=254) [in more depth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=255) [Please follow-up on them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=257) [Next on our list is Metal System](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=260) [Trace, our GPU profiling tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=262) [It offers a great view of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=265) [graphic stack.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=266) [All the way from the Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=268) [Framework down to the display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=269) [In particular, we will want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=272) [pay close attention to the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=274) [[inaudible], which is split in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=277) [vertex, fragment, and compute if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=278) [your game uses it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=280) [Notice as well that the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=282) [track will be the starting point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=284) [of many of our investigations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=285) [We will identify a long frame or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=287) [a starter and we will work it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=289) [all the way up from there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=290) [So it's a very natural place to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=292) [start.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=293) [There is a lot of information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=294) [about the tool because it really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=297) [is a very powerful tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=299) [is a very powerful tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=299) [And I encourage you all to catch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=300) [up on it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=301) [These are a couple sessions that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=303) [will provide you a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=304) [starting point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=305) [Okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=308) [So next on our list we'll have a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=309) [thread states view which we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=310) [introduced this year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=312) [This view will show you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=314) [state of every thread in your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=315) [game.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=316) [In this case, each color](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=317) [represents a possible thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=318) [state, such as preempted which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=320) [is represented in orange.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=322) [Or blocked which is represented](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=324) [in red.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=326) [We designed this view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=327) [specifically with you, game](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=328) [developers, in mind.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=330) [Because we know the threading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=331) [systems in modern games are very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=332) [complex.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=335) [And we hope this really will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=336) [help you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=338) [Also we have a track for each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=340) [CPU core.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=342) [It will show the thread running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=344) [on that core as well, as well as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=345) [the priority of that thread,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=347) [which is color coded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=349) [By using this, you will be able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=351) [to see at a glance how easy the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=353) [system really is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=354) [That was a short but a quite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=356) [That was a short but a quite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=356) [wide introduction to the tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=360) [So it's about time we move to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=362) [the actual performance issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=363) [The first one will be around](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=366) [frame pacing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=367) [And let's visualize it first.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=369) [For this we used the modified](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=372) [version of the Fox [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=374) [demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=375) [That will help us illustrate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=376) [issue better.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=378) [Can you guess which game renders](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=380) [faster?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=383) [Well, some of you may not have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=387) [guessed it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=390) [The game on the left is trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=391) [to render at 60 frames per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=393) [second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=394) [But it can only achieve 40, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=396) [it's inconsistent, and it seems](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=398) [jittery.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=400) [The game on the right on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=401) [other hand is targeting 30](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=402) [frames per second, which can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=404) [consistently be achieved.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=405) [That's why it looks smoother.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=407) [But that's a bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=409) [counterintuitive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=412) [How, how come the game that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=414) [renders faster doesn't look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=416) [smoother?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=418) [Well, this issue's known as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=420) [micro stuttering or inconsistent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=421) [frame pace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=424) [It occurs when the frame time is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=426) [higher than the display refresh](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=428) [interval.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=430) [For example, our game may take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=431) [25 milliseconds to render or 40](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=434) [frames per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=436) [And the display may refresh at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=438) [16.6 millisecond or 60 frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=439) [per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=442) [Same as the video we've just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=443) [seen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=444) [These will create some visual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=445) [inconsistencies.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=446) [So how did we get there?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=449) [What have we done to be in this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=451) [situation?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=454) [Well, we didn't do much really,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=455) [and that's kind of the whole](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=458) [point of this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=459) [After rendering the frame, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=461) [requested the next drawable from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=463) [the display link.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=465) [And as soon as we got the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=466) [drawable, we finished the final](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=467) [pass and presented it right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=469) [away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=470) [We explicitly told the system to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=471) [present that drawable as soon as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=474) [possible, at the next refresh](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=475) [interval.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=477) [After all, we are targeting 60](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=478) [After all, we are targeting 60](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=478) [frames per second, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=480) [There's also another class of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=483) [problems that will cause micro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=484) [stuttering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=485) [And some games are already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=486) [targeting lower frame rate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=490) [But we have also identified many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=492) [of those games that are using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=494) [usleep on their main or random](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=496) [thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=498) [This is a very bad practice in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=499) [iOS, so please don't do that and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=500) [just hang, hang here for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=502) [next few minutes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=505) [And I'll tell you the actual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=505) [correct way of doing this in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=506) [iOS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=510) [Now, let's have a deeper look](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=510) [into what happens in the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=513) [for micro stuttering to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=516) [visible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=517) [In this case, we see here a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=519) [timeline of all the components](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=520) [involved in rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=521) [And we'll start rendering our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=524) [game normally.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=526) [Notice this is a three-point](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=527) [buffer case, which is quite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=529) [common in iOS.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=530) [In this case, every drawable is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=531) [represented by a letter and a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=533) [color.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=535) [And also notice the premise](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=536) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=538) [Rendering to drawable V takes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=539) [Rendering to drawable V takes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=539) [longer than one display refresh](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=541) [interval, which is the time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=543) [between vsyncs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=545) [In this case, could be 25](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=546) [millisecond to render to V and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=549) [16.6 millisecond in between](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=551) [display refresh intervals.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=553) [So since that is the premise,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=555) [this means that we will need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=558) [[inaudible] on the display for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=560) [the next interval to give time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=562) [so we can finish.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=564) [And we will do so.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=566) [And that during that interval,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=567) [we will actually B, B will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=569) [actually finish.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=571) [And we will be ready to present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=573) [it but notice that we have just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=575) [hid the issue here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=577) [During this interval, we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=579) [also finished rendering to C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=581) [And we are ready to present it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=583) [right away.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=584) [So we will [inaudible] an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=586) [inconsistent frame pacing from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=587) [that moment onward.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=590) [We are stuck in this pattern.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=591) [Every other frame will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=593) [inconsistent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=594) [And the user will see micro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=596) [stuttering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=597) [Now this may appear in different](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=600) [shapes and forms in the real](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=603) [world.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=605) [So what we'll do now is a quick](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=606) [demo and I'll show you an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=607) [instruments trace of the Talos](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=609) [Principle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=611) [And we will use to see if we can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=612) [identify micro stuttering in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=613) [real world case.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=615) [Okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=625) [So what we see here is the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=625) [lot of information I've shown](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=627) [you before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=629) [This has been captured with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=630) [Game Performance Template by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=631) [default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=632) [Notice all the same instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=634) [I talked about here displayed on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=635) [the left.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=639) [And all the game threads here in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=639) [the middle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=641) [In particular though, we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=642) [looking now at micro stuttering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=643) [So this quite intuitively will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=647) [bring us to look at the display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=648) [track because micro stuttering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=650) [by definition is frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=651) [presented inconsistently.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=653) [In this case, we have the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=655) [display track here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=656) [Notice as well that there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=658) [some hints in the display track.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=659) [some hints in the display track.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=659) [We [inaudible] and these are the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=662) [hints here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=664) [They will show you when a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=666) [surface has been displayed for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=667) [longer than we would expect on a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=669) [normal rendering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=671) [So maybe this is a great place](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=673) [to start looking at it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=674) [There's some clusters of them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=675) [So let's zoom into one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=677) [To zoom, we will hold the option](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=679) [key and just drag the pointer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=680) [the region of interest.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=682) [And in this case, if we keep](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=684) [looking at the display track,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=687) [it's kind of evident already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=689) [that we are micro stuttering.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=690) [We can see that every display](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=692) [has a different timing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=694) [So in this case for example, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=696) [have 50, 33, 16, back to 50, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=697) [back to 33.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=703) [So when we see this pattern in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=704) [an instruments capture, it means](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=706) [that we are micro stuttering and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=708) [we should correct it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=710) [So let's just do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=711) [Back to the slides.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=713) [Okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=718) [We've just seen the problem, how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=719) [We've just seen the problem, how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=719) [it occurs in the real world.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=720) [The pattern is basically the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=722) [same.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=723) [So how do we go about fixing it?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=724) [The best practice here is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=727) [target the frame rate your game](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=729) [can achieve.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=730) [So at the minimum frame duration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=732) [there is longer than the time it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=734) [takes to render.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=735) [For that, there's a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=738) [APIs that can help you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=739) [For example, MT Drawable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=741) [addPresentedHandler will give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=743) [you a call back once that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=745) [drawable is presented.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=746) [So you can identify micro](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=747) [stuttering as it is happening.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=749) [The other two APIs will help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=751) [to actually fix the problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=753) [They will allow you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=755) [explicitly control the frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=756) [rating-- the frame pacing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=758) [In this case we have present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=760) [afterMinimumDuration and present](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=761) [atTime.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=763) [What we want to do here?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=765) [We set the minimum duration for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=766) [our frame longer than it takes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=768) [to render.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=770) [And we'll do just that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=771) [Let's see how that looks.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=773) [Notice that when we start](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=776) [rendering, we are already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=777) [consistent from the get-go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=779) [consistent from the get-go.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=779) [Our frame spends on display more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=781) [time it takes to render.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=783) [Every frame will be consistent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=785) [The user will see also being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=788) [consistent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=790) [And that's great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=792) [Also notice that there's a side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=793) [effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=795) [The frame rate will be lowered.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=795) [We went from 40 frames per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=797) [second to 30 frames per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=798) [So that also gave us some extra](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=801) [frame time to play with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=802) [So how did we do this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=805) [How did we fix the-- the frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=807) [pacing?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=811) [Well, really it's just a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=811) [of lines of code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=814) [We have the same pattern as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=816) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=817) [We rendered the scene.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=818) [We get the next drawable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=819) [We do the final pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=821) [The only difference here is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=823) [we specify a minimum duration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=825) [for our frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=827) [And present it with that minimum](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=828) [duration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=830) [That's all it takes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=831) [That will allow us to set the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=833) [minimum duration for our frames.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=834) [And they will all be consistent.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=836) [And after doing so, you may be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=839) [And after doing so, you may be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=839) [thinking well, what about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=840) [maximum duration?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=843) [What about the concept of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=845) [priority of our work?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=847) [Or how long a thing could take?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=848) [Well, that's actually the next](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=851) [issue on our list-- thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=853) [priorities.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=854) [Let's visualize it first, same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=855) [as we did before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=857) [Again, with the modified version](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=859) [of the Fox II demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=860) [You may be thinking and you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=862) [would be right that there are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=864) [many things that could cause](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=865) [stuttering such as this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=866) [Maybe you are doing some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=867) [resource loading or [inaudible]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=869) [compilation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=870) [Today we will focus on the more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=872) [fundamental but also incredibly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=873) [common type of stutter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=876) [That caused by thread stalling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=877) [If the work priority is not well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=881) [communicated to the system, your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=884) [game may have unexpected stalls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=887) [iOS does plenty of stuff besides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=890) [rendering your game.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=892) [Thread priorities are used to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=894) [warranty the quality of service](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=896) [in the whole system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=898) [So if a thread does a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=900) [work, its priority will be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=902) [lowered over time so other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=904) [threads can run instead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=906) [That's the concept known as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=908) [priority decay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=909) [Also you see on the slide behind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=911) [me priority inversion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=913) [This is another class of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=916) [problems that manifests in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=917) [very similar way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=918) [In this case, priority inversion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=920) [occurs when the render thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=922) [depends on the lower priority](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=924) [worker thread from your same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=926) [engine in order to complete the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=928) [work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=930) [Let's see how that looks like in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=931) [the same timeline as we've seen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=932) [before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=934) [In this case, we start rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=934) [at 30 frames per second so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=937) [are cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=939) [But then there is some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=941) [background work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=942) [iOS does lots of stuff.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=944) [Maybe now it's checking the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=945) [email.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=947) [And the problem here is that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=948) [[inaudible] thread is not well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=950) [configured.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=951) [You may get preempted by that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=953) [background work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=954) [You may not finish scheduling](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=956) [all the work onto the GPU.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=958) [And there is no such thing as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=961) [maximum duration for a frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=962) [So that could potentially go](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=965) [along for hundreds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=966) [milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=967) [The user will see a stutter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=968) [This is also the theory behind](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=972) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=974) [And in practice it shows in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=974) [different ways that follow the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=976) [same pattern.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=978) [So let's do another demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=979) [I'll show you another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=981) [instruments capture of the Talos](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=981) [Principle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=983) [That will show you how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=984) [identify this problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=986) [So in this case, what you see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=997) [here is again a capture taken](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=999) [with the Game Performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1002) [Template.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1003) [But this time we have already](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1004) [zoomed into the frame we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1005) [interested in, which is this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1007) [very long frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1009) [It has a duration of 233](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1011) [milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1013) [So that's likely a very good](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1014) [stutter that we should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1015) [investigate.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1016) [By-- by looking at it at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1017) [By-- by looking at it at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1017) [glance, we can already tell that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1020) [the GPU does not seem to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1022) [doing much.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1023) [It's idle during this time, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1025) [this means that we are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1027) [fitting it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1028) [Now we can look at the CPU, of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1030) [course, and they seem to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1033) [fairly busy down here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1035) [Right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1037) [They are really-- all of it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1038) [seems quite solid.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1040) [But notice what you see here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1042) [the time profiler view of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1044) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1047) [And it does not seem to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1048) [running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1049) [Why is our game not running and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1051) [how come that causes a stutter?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1054) [Why?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1055) [Well, we can switch to the new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1057) [view I talked to you about, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1060) [new thread states view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1061) [To do so you will go into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1063) [icon of your application and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1065) [click on that button here and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1068) [that would pull out the track](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1070) [display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1071) [And in this case, you can switch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1073) [to thread states.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1074) [And that will hope-- hopefully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1076) [already help you to see there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1079) [already help you to see there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1079) [something wrong here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1080) [It is highlighted in orange, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1082) [it's already telling us that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1084) [thread has been preempted for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1086) [192 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1087) [So that's the actual problem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1090) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1091) [A render thread is not running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1091) [Something preempted it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1093) [If you want to know more, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1096) [can expand information at the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1098) [bottom, which will contain also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1099) [the thread narrative.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1101) [And by clicking at the preempted](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1103) [thread, you will see here an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1106) [explanation of what's going on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1109) [In this case, your render thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1111) [was preempted at priority 26,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1113) [which is very low.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1116) [It's below background priority](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1117) [because the App Store was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1119) [updating.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1120) [So that's something we do not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1122) [want.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1123) [We want to tell the system that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1124) [to our user, our game is more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1126) [important than an App Store](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1128) [update at that particular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1129) [moment.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1130) [So let's go back to the slides](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1131) [and see how can we do that?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1132) [So the best practice here is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1142) [configure your render set.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1144) [We recommend the render set](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1146) [priority to be fixed to 45.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1147) [Notice that the [inaudible] OS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1151) [and macOS priorities have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1152) [ascending values.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1154) [So priority 31 has higher](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1156) [priority than priority four.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1159) [Also, we need to opt out of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1162) [scheduler's quality of service](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1164) [in order to prevent priority](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1166) [decay which could lower our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1167) [priority as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1169) [Let's see how a well-configured](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1171) [render thread looks like.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1173) [In this case, we configure just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1174) [how I told you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1178) [We start rendering normally.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1179) [We also have some background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1182) [work going on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1184) [Otherwise it wouldn't be fair.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1184) [And this background work could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1186) [be updating the App Store just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1188) [as we've seen in the demo.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1189) [But notice that vsync after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1191) [vsync, our render occurs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1193) [normally.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1196) [We are preempting the background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1197) [work of the CPUs so we can run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1199) [work of the CPUs so we can run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1199) [instead.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1200) [The user does not see the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1202) [stutter.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1204) [Your game can run at 30 solid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1205) [frames per second, even though](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1207) [the system is under heavy load.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1209) [That is technically awesome, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1211) [that's what this is all about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1213) [So let's see how we make this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1215) [happen with a little bit of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1216) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1219) [And it literally is a little bit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1220) [of code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1221) [It is only like a couple lines.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1222) [In this case, it's just about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1224) [configuring the pthread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1227) [attributes before we can create](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1228) [the pthread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1230) [We need to opt out of quality of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1232) [service, set the priority to 45.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1233) [And that's it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1238) [We can create the pthread with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1238) [those attributes, and it will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1239) [work just fine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1241) [It is simple and technically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1243) [awesome.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1244) [What's not so simple though is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1245) [the next issue on our list.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1249) [That about dealing with multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1252) [thermal states.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1254) [The message is very clear.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1256) [Design for sustained performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1259) [Design for sustained performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1259) [and deal with the occasional](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1261) [thermal issues.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1264) [So let's see how we go about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1265) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1267) [iOS devices give you access to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1268) [an unprecedented amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1270) [power.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1272) [But [inaudible] in a very small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1272) [form factor.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1274) [So more apps use more resources](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1275) [on the device, the system may](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1277) [begin enacting measures in order](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1280) [to stay cool and responsive.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1282) [Also the user may have enabled a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1285) [low power mode condition, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1287) [will have a very similar effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1290) [Okay, so the best practice](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1292) [really is just to adjust your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1296) [workload to the system state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1298) [You should monitor the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1302) [and tune the workload](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1303) [accordingly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1304) [iOS has many APIs to help you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1305) [with that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1307) [For example, use NSProcessInfo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1308) [thermalState to either query or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1311) [register for notification when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1313) [the device thermal state](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1315) [changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1316) [You should also check for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1317) [low power mode condition in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1319) [low power mode condition in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1319) [similar fashion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1321) [Also consider querying the GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1323) [start/GPU end time from the MTL](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1325) [Command Buffer in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1327) [understand how system loads may](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1328) [impact the GPU time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1331) [Let's see how we do that with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1333) [simple code example.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1335) [This comes straight from our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1338) [best practices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1339) [A tip score is a very simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1341) [switch statement when every case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1343) [corresponds to a thermal state.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1345) [We have nominal, fair, serious,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1347) [and critical.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1353) [And that is all very good.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1354) [So now we know that we are in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1359) [thermal state and thse command's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1361) [telling us to do something about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1363) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1365) [So how can, how can we actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1366) [help the system stay cool?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1368) [Well, I can give you some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1371) [suggestions, but it's up to you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1373) [game developers to decide what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1375) [compromises to make in order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1377) [help the system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1379) [help the system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1379) [You know what's best for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1381) [game to keep being awesome under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1382) [stress.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1384) [Some recommendations I'll give](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1386) [you though are to target the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1387) [frame rate that can be sustained](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1389) [for the entire game session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1391) [For example, stay at 30 frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1393) [per second if you cannot sustain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1396) [60 for ten minutes or more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1397) [Doing the GPU work is also super](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1401) [helpful.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1404) [For example, consider lowering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1406) [the resolution of intermediate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1407) [render targets, or simply find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1408) [the shadow maps, loading simpler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1411) [assets and even removing some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1414) [the post-processes altogether.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1416) [Wherever, whatever fits your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1418) [game the best.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1420) [You should decide that one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1421) [And this will bring us to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1425) [next issue on our list.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1426) [That about dealing with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1429) [unnecessary GPU work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1430) [For that, please welcome my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1432) [colleague Ohad on stage.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1433) [He's going to tell you all about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1434) [it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1435) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1436) [&gt;&gt; Thank you, Guillem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1440) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1441) [Hey, everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1444) [My name is Ohad, and I'm a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1446) [member of the Game Technologies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1447) [Team here at Apple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1449) [In the previous slides, Guillem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1450) [showed you how important it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1452) [to adapt to the system.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1454) [Responding to states like low](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1457) [power mode or the varying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1459) [thermal states will require you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1460) [to tune your GPU workload in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1463) [order to maintain consistent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1464) [frame rates throughout an entire](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1466) [game session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1467) [However, for many developers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1468) [the GPU is a bit of a black box](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1471) [hidden behind the curtains of a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1473) [game engine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1475) [Today, we'll pull back those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1476) [curtains.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1478) [Wasted GPU time is a very common](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1480) [problem and it's one that often](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1482) [goes unnoticed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1484) [But I want you to remember this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1486) [Technically awesome games don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1487) [only hit their GPU budget.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1489) [They're also good citizens to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1492) [the system, helping it to stay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1493) [cool and save power.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1495) [All the popular game engines](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1497) [provide a great list of best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1499) [provide a great list of best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1499) [practices to follow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1500) [We won't cover those.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1502) [Instead we'll focus on how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1503) [tell if something is expensive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1505) [to render.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1506) [And as we've done with the CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1508) [several times today, the best](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1510) [practice here is profile your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1512) [GPU as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1514) [The power of our GPUs can hide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1515) [many efficiencies in either](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1518) [content or algorithms.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1520) [You will want to time your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1522) [workload, but also understand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1523) [each rendering technique that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1526) [you enable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1527) [And only keep those that add](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1529) [noticeably to the visual quality](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1530) [of your games.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1532) [But how do you find these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1534) [inefficiencies?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1535) [How do you determine which parts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1537) [of your pipeline are flat-out](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1538) [excessive?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1539) [This of course brings us back to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1540) [tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1542) [As always, your first stop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1544) [should be Instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1546) [Here we're looking at Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1548) [System Trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1549) [It'll provide you accurate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1550) [timings for vertex, fragment,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1551) [and compute work being done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1554) [But by measuring your GPU time,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1556) [you're only halfway there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1559) [you're only halfway there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1559) [Next you want to really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1560) [understand what each of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1562) [passes is doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1564) [And for this, we're added a new](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1567) [tool to the Metal Frame Debugger](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1568) [this year.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1570) [It's the Dependency graph.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1571) [The Dependency graph is a story](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1574) [of a single frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1577) [It's made up of nodes and edges](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1580) [and each one of these tell a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1582) [different part of the story.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1583) [Edges represent dependencies](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1585) [between passes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1588) [As you follow them from top to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1589) [bottom, you'll see where each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1591) [pass fits into your rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1592) [pipeline.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1594) [And how they work together to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1594) [create your frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1596) [Nodes on the other hand are the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1599) [story of a single pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1600) [They're made up of three main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1603) [components.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1605) [First, the title element will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1606) [give you the name of the pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1608) [Now I really want to emphasize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1610) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1611) [Label everything.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1612) [It'll help you not only in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1614) [Dependency viewer, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1615) [throughout our entire suite of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1616) [tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1617) [Secondly, it'll allow you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1619) [Secondly, it'll allow you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1619) [quickly tell what type of pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1621) [you're looking at.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1623) [Render, blit, or compute.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1624) [Here from the icon we can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1627) [that it's a render pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1628) [Next, you have a list of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1631) [statistics describing the work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1632) [being done in this pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1634) [And finally to the bottom, a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1636) [list of all the resources that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1638) [are being written to during this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1640) [pass, and each of these also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1642) [comed with a label, a thumbnail](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1643) [allowing you to preview your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1645) [work, and a list of information](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1646) [describing each one of those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1648) [resources specifically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1650) [And all that together allows you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1653) [to really understand each of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1655) [your passes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1656) [Okay, so now we know how to read](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1657) [the graph.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1659) [Let's jump into a demo and see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1660) [how it all fits together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1662) [Okay.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1672) [So I have the Fox II demo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1673) [running on my machine here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1675) [It was built in Scene Kit, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1677) [allowed me to add all sorts of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1678) [allowed me to add all sorts of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1678) [great effects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1680) [As you can see, I have cascading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1682) [shadow maps, bloom, depth of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1684) [field, and all of it comes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1687) [together to create a beautifully](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1689) [rendered scene.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1690) [Let's use the dependency viewer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1692) [to see how it all works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1693) [First, we'll go to Xcode and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1695) [we'll capture a frame using the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1697) [capture GPU frame button in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1699) [bottom.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1700) [And we'll select the main pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1701) [on the left.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1702) [[Applause] And we'll also switch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1704) [to automatic mode which will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1706) [give us, will give us our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1708) [assistant on the right.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1709) [Now notice that the same pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1710) [that I selected in the debug](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1712) [navigator is also the one that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1713) [showing-- is selected, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1715) [focused in the main view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1716) [And this is a two-way street.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1718) [So as we interact with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1720) [graph, select, selecting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1723) [different passes or textures or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1724) [even buffers, both the navigator](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1728) [on the left and the assistant on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1730) [the right will update to show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1732) [your selection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1733) [So this is a really fantastic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1735) [way to navigate your frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1736) [Now as I zoom out, the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1741) [thing you'll notice that the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1743) [statistics hide and the focus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1743) [goes away from the individual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1745) [passes onto the frame as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1747) [whole.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1749) [And I can zoom out even more to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1750) [see a great bird's-eye view of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1752) [my entire frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1754) [Now the really cool thing to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1756) [notice here is that since](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1758) [dependencies drive the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1760) [connectivity of the graph, each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1761) [logical piece of work is grouped](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1764) [together in space.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1766) [So let's zoom in and see what I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1768) [mean.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1769) [Here I have a branch of work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1770) [that's creating my shadow maps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1772) [On the left, I can see three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1774) [passes that are rendering the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1777) [shadows.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1779) [So this is really fantastic](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1780) [because I'm not just getting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1782) [story of my entire frame.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1784) [But there's another story in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1786) [between these two layers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1788) [One of how each rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1789) [technique is built up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1791) [And this is something that isn't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1793) [always entirely obvious when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1794) [you're using a game engine to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1796) [turn these on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1797) [For instance, when my shadow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1798) [maps, I may not have known that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1799) [maps, I may not have known that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1799) [cas-- that each cascade would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1801) [require its own pass.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1803) [If I considered each one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1805) [these individually, they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1806) [wouldn't really stand out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1808) [But now I see that I have to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1809) [consider them as a group.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1810) [And that gives me the insights](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1812) [that I need to make informed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1815) [decisions on any compromises](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1816) [that I make while tuning my GPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1819) [workload.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1820) [So that's the Dependency viewer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1821) [I'll switch back to the slides.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1824) [And please help me welcome](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1826) [Guillem back onto the stage for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1827) [his final thoughts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1828) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1829) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1830) [&gt;&gt; Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1836) [That was an awesome demo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1836) [[inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1839) [Cool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1844) [So Ohad had just shown us how a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1844) [frame looks like through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1846) [Dependency viewer.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1847) [And that is great for you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1850) [inspect your GPU workload.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1852) [For example, oftentimes we may](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1854) [go from a very small and simple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1857) [pipeline such as this one to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1858) [pipeline such as this one to a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1858) [very complex one with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1861) [post-process, multiple shadow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1864) [maps in HDR.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1867) [And all of these can be done by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1867) [adding, you know, a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1871) [properties to the common object](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1873) [of your favorite game engine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1874) [You see that the code complexity](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1877) [of those changes is minimal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1879) [But the-- but the rendering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1881) [complexity may have increased](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1882) [tenfold, which will really bring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1884) [us back to the beginning right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1888) [where we started.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1890) [Profile.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1892) [It is very important that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1894) [understand what your game does.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1896) [You spend tens of thousands of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1899) [hours developing a game, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1901) [should consider spending some of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1903) [that time profiling as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1905) [Everything we have seen today](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1907) [can be found within minutes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1910) [The best part?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1912) [You don't need to know what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1913) [you're looking for.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1914) [Just record the stutter, get the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1916) [long frame, and work it all up--](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1918) [long frame, and work it all up--](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1918) [all the way up from there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1920) [It's that simple.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1921) [The tool will give you all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1923) [information you need to identify](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1924) [the problems.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1926) [But you will need to use the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1927) [tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1930) [And that is really the takeaway.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1931) [So we have seen a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1934) [common pitfalls followed by some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1935) [best practices.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1938) [All of these issues can be found](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1939) [through profiling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1942) [That's how we found them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1943) [We analyzed a ton of games,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1944) [found the common issues, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1946) [decided to put a talk together.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1947) [Now, if you have access to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1950) [engine source code, make sure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1951) [that both thread pacing and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1954) [thread priorities are well](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1955) [configured.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1956) [It's just a couple lines of code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1957) [really.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1959) [But regardless, your game should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1960) [always adapt to thermals and do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1962) [not submit unnecessary GPU work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1965) [By making sure to follow all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1968) [these best practices, you too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1969) [will be developing technically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1972) [awesome games.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1973) [And that's what this is all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1974) [about.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1975) [For more information, there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1977) [a-- a coming lab at 12 PM.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1979) [a-- a coming lab at 12 PM.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1979) [We will be there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1981) [I'll be there and now we'll be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1982) [more than happy to ask any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1984) [questions you may have after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1985) [this session.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1986) [Or maybe you just want to sit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1988) [down and let us profile your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1989) [game.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1991) [Also there, there were two great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1992) [talks [inaudible] about Metal](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1994) [for game developers and our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1996) [profiling tools.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1998) [Thank you very much, and enjoy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=1999) [the rest of the day.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=2002) [And have a great one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=2003) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/612/?time=2004)