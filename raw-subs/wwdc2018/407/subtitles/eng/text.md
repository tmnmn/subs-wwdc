# Practical Approaches to Great App Performance

## Summary
All apps benefit from a focus on performance and an increase in overall responsiveness. This information packed session gives you strategies for fixing performance problems using Instruments and other tools. Additionally, get practical advice based on experience in tuning Apple's own apps including Xcode and Photos on iOS.

## Info
* Developer Tools
* WWDC 2018 - Session 407 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/

## Text
 [[ Music ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=7) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=19) [&gt;&gt; Good afternoon everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=25) [My name is John Hess.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=27) [Today I'm going to be joined by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=28) [Matthew Lucas, and we are going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=29) [to be talking to all of you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=30) [about practical approaches to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=31) [great app performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=33) [Now, I'm an engineer on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=35) [Xcode team, and I've had the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=36) [luxury of spending the last](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=38) [several years focused on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=39) [performance work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=41) [First, with Project Find, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=42) [Open Quickly, two areas of Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=44) [that treat performance as the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=47) [primary feature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=49) [Most recently, I've had the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=50) [opportunity to do a survey of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=52) [Xcode GY responsiveness, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=54) [want to share with you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=55) [approaches that I take to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=57) [performance work, both in code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=58) [performance work, both in code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=58) [that I'm intimately familiar](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=60) [with, and in code that I'm just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=61) [experiencing for the first time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=63) [Now, if I could get everyone in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=65) [today's presentation to just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=67) [take one lesson away, it is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=69) [all of your performance work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=71) [should be based on measurement.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=73) [Before you start solving a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=75) [performance problem, you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=77) [measure, to establish a baseline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=78) [so you know where you stand.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=81) [As you iterate on solving a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=83) [performance problem, you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=85) [measure it each step of the way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=86) [to ensure that your performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=88) [changes are having the impact](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=89) [that you expect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=91) [When you're done solving a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=93) [performance problem, you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=94) [measure again, so that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=95) [compare to your original](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=97) [baseline, and make a quantified](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=98) [claim about just how much you've](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=101) [improved the performance of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=103) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=104) [You want to share this with your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=105) [boss, your colleagues, and your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=106) [users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=108) [Now, when you think about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=110) [improving performance for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=111) [users, you need to think about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=112) [what I like to call the total](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=115) [performance impact.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=116) [If you improve the functionality](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=118) [If you improve the functionality](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=118) [and performance of one area of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=121) [your application, by 50%, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=123) [it's something that just 1% of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=126) [your users encounter, that does](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=128) [not have nearly the breadth of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=130) [impact as improving some other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=131) [feature by just 10% that all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=133) [your users use all the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=135) [So make sure you're not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=137) [optimizing edge cases, and make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=138) [sure that your changes are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=139) [impacting all of your users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=140) [Now how do we fix performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=144) [bugs?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=147) [Well, how do we fix regular](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=148) [bugs?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=149) [Normally it starts with some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=149) [sort of defect report from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=151) [users, and we take this report](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=153) [of the application not behaving](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=155) [the way that people expect, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=156) [we find some way to synthesize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=158) [steps to reproduce so that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=160) [can cause the failure at will.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=161) [Once we've done this, we attach](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=163) [a debugger to our program, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=165) [that we can see just what our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=166) [program is doing while it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=167) [misbehaving.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=168) [We combine that with our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=170) [knowledge of how the code is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=171) [supposed to work, to modify it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=172) [as necessary and eliminate the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=174) [undesired behavior.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=176) [We verify that we haven't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=177) [introduced any unwanted side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=178) [introduced any unwanted side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=178) [effects, and we repeat as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=180) [necessary until we've completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=182) [solved the bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=183) [I've fixed performance bugs in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=185) [just the same way.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=187) [Except instead of using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=190) [debugger, I use a profiler, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=191) [a profiler is just a fancy tool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=193) [for measuring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=195) [I find some set of steps to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=196) [reproduce the program being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=198) [slow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=200) [And I run those steps with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=201) [profiler attached, so that I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=203) [get an insight into what my code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=205) [is doing while it's running](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=206) [slowly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=207) [I combine that knowledge with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=209) [what my program has to do to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=211) [accomplish the task at hand, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=212) [I find steps that are happening](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=214) [and remove them, because the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=216) [primary way you make your code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=217) [faster is you remove redundant](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=219) [steps from whatever is that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=222) [calculating.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=223) [Now, I make the modifications to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=225) [the source code, and I repeat](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=227) [and measure as necessary until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=229) [I'm happy with the total result.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=230) [When I'm doing this type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=234) [performance work, I often find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=236) [myself in one of a handful of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=237) [scenarios.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=239) [scenarios.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=239) [And these different scenarios](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=240) [change the way that I go about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=242) [testing the code in question to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=243) [reproduce the bugs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=245) [Sometimes I'm up against a big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=246) [performance regression, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=249) [Everything was moving along](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=251) [smoothly, then someone checked](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=252) [something in on our team, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=254) [it was me, and performance has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=255) [fallen through the floor, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=257) [now we have to go back and find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=258) [out what caused this regression.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=259) [If this regression is very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=262) [pronounced, or it's in an area](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=263) [that I don't think it's likely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=265) [to regress again in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=267) [immediate future, I may just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=268) [test it with my hands, manually,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=269) [with the profiler attached.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=272) [However, your performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=274) [victories are going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=276) [hard-won battles, and they can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=277) [easily be lost through a slow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=280) [stream of regressions.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=282) [I would encourage all of you to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=283) [write automated performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=285) [tests to capture your app's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=286) [performance, so that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=288) [ensure that it's not regressing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=290) [over time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=291) [Another scenario I often find](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=295) [myself in, is, are applications](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=296) [performing the same as it has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=298) [performing the same as it has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=298) [been for a long time?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=300) [Maybe it is running at 45 frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=301) [a second in some drawing test,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=303) [but we expect it to run at 60.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=305) [It needs to be improved](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=306) [marginally, and we have reason](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=307) [to believe through our previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=309) [performance work that we can get](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=310) [there through spot fixes and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=312) [incremental changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=314) [Now, in this type of scenario, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=316) [probably also have automated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=317) [tests already in play, because I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=319) [understand my performance over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=320) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=324) [And a third scenario, our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=325) [application is just suffering](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=326) [from a poor design and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=328) [performance is orders of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=329) [magnitude worse than it should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=330) [be.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=332) [We know that we can't improve it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=333) [with simple spot fixes, because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=334) [we've tried them in the past,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=336) [and we are still stuck here with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=337) [a very sub-par performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=339) [In a situation like this, you'd](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=342) [want to do a total performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=343) [overhaul, where you are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=345) [redesigning some core part of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=345) [the feature, or the algorithms](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=347) [in question, so that performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=348) [is a primary constraint.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=350) [And definitely in these cases,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=352) [you would have performance tests](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=353) [to measure that you're actually](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=355) [hitting your performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=356) [targets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=357) [Now, it is important that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=359) [Now, it is important that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=359) [know just what to test.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=360) [I want to caution you that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=362) [don't ever immediately jump to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=363) [these sort of performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=365) [overhauls as a way of fixing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=366) [performance problem.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=368) [I love to do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=369) [It's sort of Greenfield](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=370) [engineering, where you get to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=372) [design things from the ground](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=373) [up, but it's very risky.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=374) [You're going to end up with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=376) [better product at the end, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=377) [it's going to be a turbulent](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=378) [path getting there as you rework](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=379) [an entire feature.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=381) [When you're doing this style of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=384) [work, it is imperative you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=385) [understand not only the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=386) [functional constraints of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=388) [code in question, but also the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=389) [performance constraints, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=391) [typical use patterns that your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=392) [users are most frequently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=394) [applying to this feature, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=395) [you only get that by having done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=397) [performance work in the area in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=399) [the past.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=400) [I'd like to share an anecdote](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=401) [about our work on a situation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=403) [like this, within Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=405) [In Xcode 9, we reworked Project](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=407) [Find, with performance as a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=409) [primary goal.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=410) [It was our goal to deliver](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=412) [search results in just tens of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=413) [milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=415) [When we were going to discuss](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=416) [this feature with our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=419) [this feature with our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=419) [colleagues, we were often](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=420) [challenged to perform searches](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=421) [across large projects for things](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=423) [like string, or even the letter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=425) [E.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=427) [Things that produce millions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=427) [results, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=428) [And certainly if our application](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=430) [could produce millions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=432) [results quickly, it would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=433) [fast on anything.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=434) [But if you consider what typical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=436) [patterns are, we search for APIs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=437) [we use, the names of our own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=440) [classes, the names of, you know,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=442) [images that we're referencing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=444) [Things like that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=445) [They produce dozens, maybe](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=446) [hundreds of results.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=447) [Certainly, it is essential that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=448) [the application works decently](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=450) [when you get a million results,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=452) [but the normal use case is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=453) [hundreds of results.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=455) [Now, some of your work in doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=456) [a task like search is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=458) [be proportional on things like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=460) [generating the raw results, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=461) [other work is going to be based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=463) [on how efficiently you can index](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=465) [the text in the project, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=466) [avoid work in the first place.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=468) [In these two scenarios, you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=470) [likely to have completely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=471) [different targets for what you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=473) [would optimize to make one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=475) [these searches faster than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=476) [other, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=477) [So it's essential that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=479) [So it's essential that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=479) [understand how your users are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=480) [going to use the product, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=482) [that you can optimize for the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=483) [right cases.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=484) [Now, in all of these cases, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=487) [need to do some form of testing,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=489) [whether it's manual, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=491) [automated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=493) [I want to share with you two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=496) [types of performance tests that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=497) [I will typically write to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=498) [measure the performance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=500) [Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=502) [We will either do unit tests, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=503) [integration tests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=505) [Let's compare and contrast them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=506) [In a performance unit test, it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=509) [your goal to isolate some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=511) [feature of your application and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=513) [measure it all by itself.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=515) [You might mock out its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=516) [dependencies, and you might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=517) [launch it in a context where it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=519) [has been isolated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=521) [If I were to write performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=523) [unit tests for Xcode's code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=525) [completion, I might write a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=527) [series of three small tests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=528) [One of these tests would measure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=531) [talking to the compiler and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=533) [getting the raw results, the raw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=534) [set of code completion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=536) [candidates back.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=537) [Another performance test would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=538) [Another performance test would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=538) [measure correlating, ranking and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=541) [scoring those results, so we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=542) [knew which ones to display to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=544) [the user.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=545) [A third test might take those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=546) [already prepared results, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=548) [measure putting them into UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=550) [elements for final display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=551) [And in covering all three of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=553) [these areas, I would have pretty](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=555) [good coverage over the major](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=556) [components of code completion in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=557) [the IDE.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=560) [Now, there are some great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=563) [aspects to these performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=564) [unit tests.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=566) [They're going to be highly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=567) [focused, which means if they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=568) [regress in the future, I'm going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=570) [to have a very good idea on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=571) [where the regression is, because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=572) [the code that is running has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=574) [been scoped so well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=575) [They are also going to produce](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=576) [much more repeatable results](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=579) [from run to run.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=580) [They're not going to have a big](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=581) [variance in the times that they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=582) [produce.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=584) [Again, because the code is so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=585) [focused.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=586) [Now, let's contrast that to an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=588) [integration test.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=589) [In an integration test, your job](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=591) [is to measure the performance of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=592) [your application as your users](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=594) [experience it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=596) [Holistically.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=598) [So, if I was writing code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=599) [So, if I was writing code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=599) [completion unit tests for Xcode,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=601) [I'm sorry, integration tests, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=603) [would launch the full Xcode app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=605) [I would open a source file.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=608) [I would navigate to the source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=609) [file, and I would type, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=611) [would bring up code completion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=613) [over and over again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=614) [When I profile this, to see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=616) [Xcode is doing, and how much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=617) [time it is taking, I am going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=618) [find that this test is anything](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=620) [but focused and quiet.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=621) [Xcode is going to be doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=624) [drawing and layout as I type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=625) [It is going to be doing syntax](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=626) [coloring as I type.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=629) [In the background, it might be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=630) [indexing, fetching get status,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=631) [deciding to show new files in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=634) [the Assistant Editor,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=635) [and all of these things are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=636) [going to be competing for CPU](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=637) [resources, along with code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=640) [completion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=641) [Maybe when I look in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=643) [Profiler, I'll see that we spend](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=644) [80% of our time syntax coloring,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=645) [and 20% of our time in code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=647) [completion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=650) [And with this data, I would know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=651) [that the best way to improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=652) [code completion performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=654) [would be to defer syntax](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=656) [coloring.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=657) [I will never gain that type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=658) [I will never gain that type of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=658) [knowledge with a highly focused](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=660) [unit test.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=661) [So if I can get everyone here to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=662) [take two things away from this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=664) [presentation, the second one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=665) [should be that your performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=667) [investigations should absolutely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=668) [start with these wide](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=670) [integration tests that measure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=672) [how the users experience your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=674) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=675) [So I'm talking about testing,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=678) [measuring and profiling.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=679) [And right now, I'd like to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=681) [introduce you to profiling in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=682) [Xcode with instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=684) [Let's head over to the demo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=685) [machine.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=686) [Today we are going to be looking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=695) [at a performance problem that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=695) [fixed between Xcode 9 and Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=697) [10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=699) [I want to show it to you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=699) [I'm going to launch Xcode 9, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=701) [open our solar system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=704) [application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=705) [Now the problem that we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=707) [going to be looking at is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=707) [creating tabs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=708) [I'm going to just press](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=710) [Command-T quickly a couple of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=711) [times, and as you can see, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=712) [whole screen flashes black, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=714) [it takes several seconds to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=716) [create those tabs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=718) [That definitely doesn't meet my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=719) [That definitely doesn't meet my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=719) [expectations as far as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=721) [performance goes, and we need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=722) [fix this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=724) [So let's take a look at how you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=724) [would do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=726) [First, I'm going to launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=728) [Instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=729) [That is our profiling tool.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=729) [You can do that from the Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=731) [menu, under Open Developer Tool,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=732) [Instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=734) [Now, I'm currently in Xcode 9,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=735) [so if I choose this, it's going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=738) [to launch the Instruments from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=739) [Xcode 9, and of course, I want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=740) [the Instruments from Xcode 10,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=741) [which I've put here in my doc.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=742) [So I'm going to hide Xcode, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=744) [bring up Instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=746) [Now, when Instruments launches,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=749) [we're presented with a list of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=751) [profiling tools that we could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=753) [use to measure our application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=754) [There's all kinds of tools here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=756) [They can measure graphics](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=757) [utilization, memory consumption,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=758) [IO, and time in general.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=761) [It can be intimidating to know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=765) [which one of these profilers to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=767) [start with.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=768) [I would encourage all of you, if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=771) [you just learn one of these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=773) [tools, it should be the Time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=775) [Profiler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=776) [I use it for 95% or more of my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=778) [I use it for 95% or more of my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=778) [performance work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=780) [When your users complain about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=781) [your app being slow, they're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=783) [complaining about it taking too](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=784) [long, and long is time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=785) [If it turns out that you're slow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=788) [because you're doing too much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=790) [IO, that is going to correlate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=790) [with time, and you will be able](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=792) [to see this with the Time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=793) [Profiler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=794) [So if you learn just one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=795) [instrument, it should be the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=797) [Time Profiler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=798) [Let's take a look at how that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=800) [works.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=802) [I'm going to launch the Time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=805) [Profiler by just double clicking](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=806) [on it here, and make Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=808) [take the full best op.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=811) [Now, we'd like to record Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=813) [In the upper left-hand corner of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=816) [the Instruments window, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=818) [control which process you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=819) [going to attach to and record.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=821) [By default, hitting this record](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=823) [button would record all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=825) [processes on my Mac.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=826) [I just want to focus on Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=828) [I'll switch this popover to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=834) [Xcode and hit record.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=836) [Now, I like to keep an eye on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=839) [Now, I like to keep an eye on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=839) [this area of the window to track](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=840) [view while I'm recording.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=842) [So I'm going to resize the Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=843) [window to be a little shorter,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=845) [so I can still see that, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=846) [then I'm going to do the thing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=848) [that was slow.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=849) [I'm going to create a couple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=849) [more tabs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=850) [And you can see the graph](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=852) [changed here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=855) [Now, I'm going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=855) [quit, and return to Instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=857) [So what just happened?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=861) [While the Profiler was running,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=863) [it was attached to our process](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=866) [like a debugger.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=867) [And it stopped it, thousands of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=868) [times per second, and as it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=870) [stopping it, it gathered back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=872) [traces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=874) [Now, just a reminder, a back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=875) [trace is a description of how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=877) [your program got to where it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=878) [currently is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=879) [So if you're on line 6 of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=880) [function C and you got there](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=882) [because main called A, called B,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=883) [called C, then your back trace](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=885) [is Main, A, B, C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=887) [When Instruments captures one of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=889) [these back traces, it notes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=890) [hey, we just spent one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=892) [millisecond in function C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=893) [It says one millisecond, because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=894) [that is our sampling interval](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=896) [for recording once every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=898) [millisecond.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=899) [Now, on the main thread, all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=901) [these back traces are going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=902) [start with the Main function,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=903) [and they're probably going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=904) [call Application Main, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=905) [they're going to branch out, all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=906) [through your source code after](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=908) [that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=909) [We can collapse these back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=910) [traces together, and overlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=911) [them into a prefix tree, so they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=913) [start at Main and work their way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=915) [out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=916) [And we can bubble up those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=917) [millisecond counters that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=918) [captured at the top, so that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=919) [can hierarchically see how much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=921) [time was spent in all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=923) [different areas of our source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=924) [code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=925) [And we are going to look at this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=926) [data to try and find redundant](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=927) [and unnecessary operations that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=929) [we can make faster, and that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=931) [our primary method that we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=932) [going to use to improve the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=933) [performance of our application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=934) [Now, as you can imagine, we're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=937) [capturing thousands of back](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=939) [traces per second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=940) [There is an overwhelming amount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=941) [of data for you to wade through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=943) [in instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=944) [My primary advice to you is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=946) [you want to filter this data as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=948) [much as possible so that you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=949) [see the course grain performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=951) [leads, and not focus on minutia.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=953) [All right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=955) [So I want to show you how to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=956) [apply a bunch of powerful](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=957) [filters and instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=959) [filters and instruments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=959) [So as I did the recording, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=964) [remember, I had the track view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=966) [visible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=967) [I did that because I wanted to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=969) [see how the CPU utilization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=970) [changed and where it was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=972) [changing, while I was creating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=973) [new tabs, and I noted to myself](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=975) [that it was right here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=978) [I simply dragged and selected](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=980) [over that area of the trace, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=981) [I've caused instruments to only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=986) [focus its back trace data on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=987) [just that time interval.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=991) [Everything over here, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=993) [before I was creating tabs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=994) [Everything over here, this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=996) [after I was creating tabs, when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=997) [I was quitting the application.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=998) [That's not what I'm trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1000) [optimize right now, so I don't](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1000) [need to see that data.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1002) [Now, in the bottom area of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1005) [Instruments window, Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1008) [is showing me all the traces it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1009) [collected.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1010) [By default, there is one row per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1011) [thread that was running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1015) [And in this example it looks](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1016) [like there was only four threads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1017) [running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1018) [Sometimes you'll have much more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1019) [Sometimes you'll have much more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1019) [Depends on how concurrent your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1020) [application is.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1021) [I often like to collapse these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1023) [in the name of focusing, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1024) [also like to collapse them so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1026) [they're based on the top level](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1027) [functions executing in each of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1030) [the threads, rather than the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1031) [thread IDs, because that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1033) [corresponds better with how I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1034) [use Grand Central Dispatch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1036) [Down in the bottom of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1038) [Instruments window, I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1039) [click on this button that says](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1041) [Call Tree, and I'm going to zoom](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1042) [in on it, so you can see what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1044) [I'm about to do.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1045) [There are several filters](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1046) [available here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1047) [One of them is separate by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1048) [thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1050) [It is on by default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1050) [I am going to go ahead and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1051) [disable that, and instead, all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1053) [of the threads are going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1055) [grouped by their top level entry](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1056) [point, rather than their thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1057) [ID.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1059) [Now, looking at this trace, I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1062) [can see that of all these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1065) [threads running, which by the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1066) [way, below the main trace, which](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1069) [is the aggregate CPU usage, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1070) [CPU usage is broken down per](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1073) [thread, I can see that almost](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1074) [all the other threads were](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1076) [largely inactive during this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1077) [trace.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1078) [I can focus on just the main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1079) [I can focus on just the main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1079) [thread by selecting it here, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1080) [now I'm only looking at traces](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1083) [from the main thread during this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1084) [time period.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1086) [I'm ready to start digging into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1088) [this call hierarchy, so I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1089) [see what my application was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1091) [doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1092) [Often, I'll walk this with the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1093) [keyboard, by just pressing right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1095) [arrow and down, over and over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1097) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1098) [But I'd like to show you the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1099) [heaviest back trace inspector](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1101) [that Instruments offers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1102) [If your Inspector is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1104) [visible, you can toggle it with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1105) [this button, and the heaviest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1106) [back trace will be available](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1108) [here, in this tab, Extended](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1109) [Detail.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1111) [Now, the heaviest back trace is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1112) [just the trace that occurred](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1114) [most frequently.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1115) [It's the back trace that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1116) [happened most frequently while](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1117) [we were recording under the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1119) [current selection.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1120) [And you can use this to quickly](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1122) [navigate many frames deep at a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1123) [time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1125) [I typically look through here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1126) [looking for my own APIs, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1128) [things that would surprise me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1129) [for taking up this amount of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1130) [time, or for areas where we make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1131) [a significant branching point in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1134) [the number of samples.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1136) [Now, looking through here, I see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1138) [this call, which is to IDE](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1139) [this call, which is to IDE](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1139) [Navigator, replacement view, did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1142) [install view controller.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1144) [Now, I'm familiar with this API,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1145) [because it's an internal API of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1147) [Xcode.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1148) [And in the trace, I can see over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1150) [here on the left-hand side of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1152) [the window that it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1153) [responsible for 1.19 seconds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1154) [the total time we're recording,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1158) [or 45% of the time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1160) [That is far and away above my](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1162) [expectations for how much this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1164) [method should cost.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1165) [However, it's hard to focus on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1167) [what is happening here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1169) [Right? I'm, there is all this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1170) [other stuff at the bottom of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1172) [trace, and it looks like I'm,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1173) [you know, 30 or 40 stack ranges](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1175) [deep.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1177) [That can be intimidating.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1178) [I want to show you how to focus.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1179) [The first technique is back here](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1181) [in that call tree popover again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1183) [I'm going to use this popover to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1187) [choose the flattened recursion.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1189) [Let's go ahead and do that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1191) [And now you can see that, that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1195) [repeated set of method calls](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1196) [that was right here, oops, has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1197) [that was right here, oops, has](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1197) [been collapsed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1200) [I'm sorry, let me scroll down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1202) [That has been collapsed.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1205) [In fact, I'm confident that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1206) [want to continue my performance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1208) [investigation inside of this IDE](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1209) [Navigator area, API call, and I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1211) [can refocus the entire call tree](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1214) [by context, clicking here, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1217) [choosing Focus on Subtree.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1219) [And Instruments is going to take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1221) [that symbol up to the top of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1222) [call graph, it's going to remove](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1223) [everything else, and it is going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1225) [to reset the percentages at 100%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1226) [so I can focus on just this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1228) [Now, I can continue to walk this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1230) [sample with the arrow keys to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1233) [see what we're doing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1235) [And I'm familiar with these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1236) [APIs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1238) [And it looks like we're doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1238) [state restoration.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1240) [And as I continue to expand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1241) [this, I can see that we are sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1243) [of deep inside the table view,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1245) [and in addition to there being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1247) [this sort of hot call path, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1249) [know, that is taking large](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1251) [number of the total percentage,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1252) [there's all these other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1254) [incidental samples as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1255) [It's easy to get distracted by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1258) [these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1259) [these.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1259) [One of them here is OPC Message](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1261) [Send.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1263) [This can occur all over your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1264) [tracers if you're writing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1266) [objective C.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1267) [Even if you're writing Swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1268) [code, as you work your way into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1269) [the system libraries, you'll see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1270) [this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1271) [You'll often see its counterpart](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1272) [functions, OPC, Load Strong,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1273) [Load Weak, etc., Retain, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1275) [remove all that content from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1278) [call tree by context clicking on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1280) [it, and choosing Charge OPC to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1283) [Callers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1288) [That's going to tell Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1289) [to take all the samples that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1290) [came from lib OPC and remove](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1291) [them from the call data, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1293) [keep the time as attributed to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1295) [the parent frames that called](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1296) [them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1297) [I tend to treat those objective](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1298) [C runtime functions as just the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1299) [cost of doing business when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1301) [writing objective C code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1302) [It's rarely the case that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1303) [going to attempt to optimize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1305) [them out, so I just prefer to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1306) [remove them from the data, so I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1308) [can focus on the things that I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1309) [likely to take action on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1310) [Another very powerful filter](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1313) [that you can apply, and one that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1315) [I'm going to use to remove all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1316) [these small samples that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1319) [these small samples that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1319) [occurred during this set of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1320) [frames, is here in the call tree](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1322) [constraint section.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1324) [Let me show you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1326) [I'm going to tell Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1331) [that I would only like to see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1332) [areas of the trace that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1334) [accounted for let's say 20 or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1336) [more samples.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1338) [I'm picking 20 because I know](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1339) [that I've selected about a two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1340) [second interval and 20](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1341) [milliseconds is going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1343) [represent about 1% of the total](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1344) [work, and that is about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1346) [granularity that I like to work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1347) [at by default.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1348) [So with call tree constraints](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1351) [set to a minimum of 20, I now](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1353) [focus this down much more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1357) [significantly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1358) [Now, I mentioned here that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1360) [were expanding out my view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1361) [items.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1362) [I see that in the fact that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1363) [we're calling NS outline view,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1365) [expand item, expand children.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1366) [Now, a lot of people would stop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1368) [with the call graph at this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1370) [point.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1371) [They'd see I'm calling into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1372) [system framework, and I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1374) [spending a lot of time there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1375) [This isn't my fault, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1376) [What can I do about this?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1378) [I can't optimize NS Outline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1378) [I can't optimize NS Outline](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1378) [View, Expand Items.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1380) [You absolutely have the power to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1383) [influence these situations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1384) [For example, the system](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1386) [framework could be spending all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1387) [of this time because it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1388) [operating on data that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1390) [provided it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1391) [It could be taking a lot of time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1393) [because you are calling this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1394) [method thousands or millions of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1395) [times.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1396) [It could be taking a lot of time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1398) [because it's calling back into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1399) [your code through delegation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1400) [And most importantly, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1402) [get an insight into what the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1404) [system framework is doing by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1405) [expanding down through the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1407) [Instruments tree, and looking at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1408) [the names of functions that are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1410) [being called.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1411) [In fact, that's exactly how I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1412) [learned to fix this bug.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1413) [As I expand the trace into the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1417) [outline view, I can see that it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1419) [is calling these two methods](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1421) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1422) [Batch Expand Items with item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1424) [entries, expand children, and do](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1427) [work after end updates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1429) [Now, those are big clues to me](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1431) [that there is probably some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1433) [opportunity for efficiency](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1434) [through batching.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1435) [As you could imagine, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1436) [outline view starts with a small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1438) [outline view starts with a small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1438) [set of items, and then we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1440) [trying to restore expansion](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1442) [state in this area of our code,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1443) [and so we are telling it to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1445) [open, for example, the top item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1446) [And when we tell it to open the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1448) [top item, internally you might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1449) [imagine that it moves all the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1451) [other items down.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1452) [Then you ask me to expand the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1454) [second item.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1455) [It moves all the items down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1456) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1457) [And the third item, and so on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1457) [And by the time you're done,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1459) [you've moved those bottom items](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1460) [down thousands of times.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1462) [That is all redundant work, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1465) [that is exactly the sort of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1466) [thing I'm looking to eliminate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1467) [when I'm trying to improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1469) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1470) [Now the fact of these method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1471) [calls talk about batching leads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1472) [me to believe that there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1475) [probably some API where I can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1476) [ask the outline view to do the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1478) [work in bulk so it computes all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1479) [the positions just once, instead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1481) [of over and over again as I make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1483) [the calls.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1484) [I also see a call that says to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1486) [do the work after end updates.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1488) [Now, sometimes an API will offer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1490) [sort of bulk method that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1492) [operates on an array, and other](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1493) [times, it will offer a sort of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1495) [transactional API that says I'm](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1497) [going to begin making changes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1499) [going to begin making changes,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1499) [then you make a bunch of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1501) [changes, and then you say you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1501) [done, and it computes something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1502) [that happened for the whole](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1505) [range of your changes, more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1505) [efficiently than if it had done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1507) [them all individually.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1508) [So at this point, I would head](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1511) [over to the NS Outline View, or](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1512) [NS Table View API, and I would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1514) [look for some such method.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1515) [And there is exactly one there.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1517) [In NS Table View, there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1519) [methods for beginning and end](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1520) [updating, that allow the table](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1522) [view to coalesce, and make all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1523) [this work significantly more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1525) [efficient.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1526) [Of course, we adopted that in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1527) [Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1528) [Let me show you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1530) [I'm going to launch Xcode 10.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1533) [I'm going to open the source as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1538) [an application, and I'm going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1539) [create a couple of tabs.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1543) [And you can see, there is no](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1544) [awful flashing, and the tabs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1546) [open much more quickly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1547) [Now, I'd like the tabs to open](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1549) [even quicker than that, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1552) [So what am I going to do next?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1554) [I got lucky here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1556) [It's not every day that you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1558) [going to go into the trace, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1559) [going to go into the trace, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1559) [find something so obvious and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1560) [easy to fix, that is responsible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1562) [for 50% of the sample.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1563) [Right? In fact, there is not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1565) [going to be any other huge lead](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1568) [sitting there waiting for me.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1569) [Instead, what I'm going to need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1571) [to do is go through that whole](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1572) [sample, with those course](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1574) [filters applied, so I'm only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1575) [looking at operations that take](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1577) [about 1% of the time or more,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1578) [and I'm going to look for every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1580) [single thing that I see that I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1581) [think I can come up with some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1583) [mechanism for making a little](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1584) [bit faster.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1585) [I'm going to note them all down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1588) [on a piece of paper or in a text](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1589) [document or something, and then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1590) [I'm going to start solving them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1592) [Now, I need to pick an order to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1593) [solve them in, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1594) [Because sometimes the fifth](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1595) [thing on the list, fixing it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1597) [with an obsolete, whatever fix](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1598) [you would do for the second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1600) [thing on the list, and it feels](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1600) [bad to do them in the wrong](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1602) [order, such that you did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1603) [redundant work, because that's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1604) [the whole thing we're trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1605) [remove in the first place, is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1606) [redundant work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1607) [But it's very hard to predict](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1608) [how these things are all going](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1610) [to play out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1611) [And you often can't know until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1612) [you've already done the work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1613) [So do not let this stop you from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1614) [getting started, because you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1617) [going to get your second 30%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1619) [going to get your second 30%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1619) [improvement by stacking 10 3%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1620) [improvements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1623) [Okay?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1625) [Now, I want to go back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1627) [slides, and show you some of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1630) [techniques we typically use to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1633) [make those continued](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1634) [improvements.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1635) [Far and away, the thing that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1641) [comes up the most frequently is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1642) [using those same techniques the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1643) [outline view was using.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1645) [Batching and deferring, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1646) [You have an API, and when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1648) [API is called, it has some side](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1649) [effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1651) [And then you have some code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1652) [calling your API in the loop.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1653) [That's what you're doing-- the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1654) [primary piece of work that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1655) [being requested, and having a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1656) [side effect.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1657) [Well, if no one was reading the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1659) [result of the side effect, then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1660) [you're doing that work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1662) [redundantly, over and over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1663) [again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1664) [You can often get a much more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1665) [efficient interface by using a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1667) [batch interface, where a client](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1668) [gives you an array or some sort](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1670) [of collection of all the work to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1672) [be done, so that you can compute](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1673) [that side effect just once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1674) [Now, sometimes you have many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1677) [clients, right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1678) [And they can't batch across each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1679) [And they can't batch across each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1679) [other, and you can get even--](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1680) [you can still get that same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1682) [style of performance through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1683) [deferring the work and doing it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1684) [lazily.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1686) [A third easy way to improve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1689) [performance is you look through](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1690) [that instrument's trace, is to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1691) [find areas where you see the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1694) [same thing being computed over](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1695) [and over again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1697) [For example, you have a method](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1698) [in its computing, the size of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1699) [some text, then you see the same](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1700) [thing happening several frames](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1702) [later, for the same text, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1704) [again, and again.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1705) [Now, in this situation, of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1707) [course, you want to try to just](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1708) [compute that value one time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1709) [Compute it at the top, and pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1712) [it down or maybe cache it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1713) [Another technique you have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1716) [available in your UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1717) [applications is considering how](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1718) [many views you are using to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1721) [render your UI.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1722) [It can be very great for your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1723) [source code organization to use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1726) [very small views, with small](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1728) [sets of functionality, and to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1730) [compose them together into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1731) [larger pieces.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1732) [But the more views you use, the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1733) [harder you tax the rendering and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1735) [layout systems.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1737) [Now, this is a two-way street,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1739) [Now, this is a two-way street,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1739) [because smaller views often led](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1741) [you to have more fine-grain](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1742) [caching, which can be good for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1744) [performance as well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1745) [But generally, you can tweak the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1747) [number of views that you have in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1748) [order to have a significant](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1750) [impact on performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1751) [It is not always best to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1752) [fewer views, otherwise all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1754) [our applications would just have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1756) [one giant view for the whole](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1757) [thing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1758) [Another technique that comes up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1761) [pretty frequently is using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1762) [direct observation.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1763) [We often have two areas of our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1765) [source code that are loosely](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1766) [coupled.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1769) [Maybe one area knows about the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1770) [other, and they're communicating](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1771) [with each other through some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1773) [indirect mechanism.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1774) [Maybe they're using NS](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1776) [Notification Center, some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1777) [block-based call backs,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1779) [delegation, or key value](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1781) [observing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1783) [Now something that I see very](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1785) [frequently is we'll have some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1786) [model code, and it's going in a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1787) [loop, being changed, and every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1789) [time it is going to that loop,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1790) [it is firing lots of KVO](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1792) [notifications.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1794) [You can't actually see that in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1795) [the model code, of course, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1796) [over in some other controller,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1797) [it's madly responding and trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1799) [it's madly responding and trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1799) [to keep up with whatever is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1800) [changing in the model, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1801) [you're burning lots of CPU time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1803) [doing this, that ends up being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1804) [redundant when you consider the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1806) [whole scope of changes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1807) [Now, if this was direct callouts](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1809) [from the model code, either](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1812) [through notifications,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1813) [delegation or manual block-based](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1815) [call backs, it would be much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1817) [more obvious that this was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1818) [happening as you edited that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1819) [model code.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1820) [And you might decide that it is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1821) [totally appropriate to pull some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1822) [of those notifications out from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1824) [inside the loop to outside the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1826) [loop, to have a big impact on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1827) [performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1829) [Now, alternatively, on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1830) [controller side, you could use](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1831) [one of these deferring and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1833) [batching techniques to avoid the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1835) [redundant work and just not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1836) [respond synchronously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1838) [Last, this is an easy one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1841) [Once your code is already on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1842) [[inaudible] happy path, you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1845) [know, it's already linear, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1846) [it's not going to get any better](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1847) [than linear.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1848) [That's sort of the minimum](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1849) [performance that you're going to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1851) [get.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1852) [You're after all the constant](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1853) [time improvements that you can.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1854) [Now, an easy one is that if](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1857) [you're using dictionaries like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1858) [you're using dictionaries like](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1858) [they were objects, then you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1860) [probably know you're doing this,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1861) [if you have a bunch of string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1862) [constants for all the keys, then](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1864) [you can get a big improvement to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1866) [code clarity, to code](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1867) [completion, to re-factoring, to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1869) [making the validating your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1871) [source code, by using specific](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1872) [types.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1874) [It couldn't be easier with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1875) [strucks and swift with their](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1876) [implicit initializers and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1878) [conformance to equitable hash.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1879) [And this can just be hands-down](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1881) [an improvement to your source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1883) [code, and you'd be surprised at](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1884) [how much time you're spending in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1886) [string hashing and string](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1887) [equation if you were doing this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1889) [millions of times on lots of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1891) [small objects.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1892) [So with that, I'd like to turn](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1894) [it over to Matthew to talk to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1895) [you about how we've applied](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1897) [these techniques inside of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1899) [photos.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1900) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1902) [&gt;&gt; Thanks Jim.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1908) [Hi everyone.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1909) [I'm Matthew Lucas, an engineer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1910) [in the photos team, and today I](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1912) [want to give you some practical](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1916) [examples on performance from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1917) [directly from photos.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1919) [directly from photos.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1919) [So first, let's talk about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1921) [photos for a second.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1922) [We are all familiar with this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1924) [app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1925) [It lets you store, browse, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1926) [experience your favorite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1927) [moments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1929) [So you can browse your favorite](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1930) [moments from the moments view,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1931) [that you can see here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1933) [It's is the default view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1934) [But you can also get another](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1935) [view from the collection, or the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1937) [years.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1939) [And I'll talk more about this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1940) [view later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1942) [Now, libraries today can go from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1943) [1,000 to 100,000 assets previous](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1945) [depending on your love for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1949) [photography.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1950) [And we all love capturing those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1951) [fun and precious moments we live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1953) [every day.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1954) [So we are patient enough to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1956) [capture them, but we are less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1957) [patient when something like this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1958) [appears.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1960) [How would you feel if something](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1961) [moments like this would be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1962) [displayed in Photos the first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1964) [time you launch the app?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1965) [Now, you may also experience](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1967) [something like this, where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1968) [are showing a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1970) [placeholders, and that's really](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1971) [not great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1973) [Maybe you're soft scrolling,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1974) [you'll be lost in this gray](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1975) [area, the [inaudible] would](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1977) [start to load, but then you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1978) [start to load, but then you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1978) [keep scrolling and then you'll](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1980) [experience some frame drops](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1981) [because the views are being](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1982) [updated.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1983) [Well, our goal is to not show](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1985) [views like this.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1986) [We think this is not providing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1988) [great user experience, but we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1989) [understand that sometimes it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1992) [unavoidable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1993) [But when it's too frequent, this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1994) [isn't really great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1995) [Now, when you work on an app,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1998) [you want to make sure that it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1999) [responsive, and usable at once.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2000) [You also want to make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2003) [the animations are smooth.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2005) [And these two attributes are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2007) [really crucial to providing a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2010) [great user experience.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2011) [If the users don't find your app](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2013) [relatable or pertinent, they](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2015) [might stop using it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2017) [Now, to illustrate these two](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2019) [points, I would like to give you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2020) [two examples.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2022) [And the first one is going to be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2023) [how we optimize launching to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2025) [this moment view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2027) [The second one is how we build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2028) [the collections and years view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2030) [for good scrolling preference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2032) [First, let's do launching](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2036) [[inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2040) [So what is launch?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2042) [There are three kinds of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2044) [launches.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2044) [The first and more expensive one](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2046) [is the find referred as called,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2048) [and it depends the first time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2049) [you are going to relaunch your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2051) [app after it reboots.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2052) [So basically, nothing has been](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2054) [cached yet, and it might require](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2055) [some bug run processes or some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2057) [libraries to load.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2059) [Now, it also happens when the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2061) [system goes under memory](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2063) [pressure and starts reclaiming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2064) [some memory.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2067) [Now, if you kill an app, it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2070) [might not trigger a code launch,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2071) [because the system decides when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2072) [the resources should be paged](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2074) [out.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2078) [And when you kill an app, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2079) [you relaunch it a few second](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2080) [later, it's almost guaranteed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2081) [that you'll hit a warm launch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2083) [And we call it warm, because the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2086) [resources or the dependents are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2087) [still in the cache, so it's](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2090) [faster to launch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2092) [Now, the last type is-- we call](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2094) [it hot, and it's basically a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2096) [resume, because it's when your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2099) [resume, because it's when your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2099) [app is already running and is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2100) [being brought back to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2102) [foreground.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2103) [So when you start measuring](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2105) [launch, you should start by](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2106) [measuring the warm launch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2107) [And the time it takes to launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2109) [during this warm is less](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2112) [variable than the cold launch,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2114) [and the test iteration is much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2117) [faster as you don't need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2118) [reboot your device.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2119) [Now, the way we measure launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2121) [is by evaluating the time it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2123) [takes from the moment you hit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2125) [the application icon, and until](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2126) [you can start interacting with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2128) [the app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2129) [And what I mean by interacting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2130) [is that it's really using and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2132) [not interacting with a spinner.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2134) [A common pattern is to dispatch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2137) [some work and display a spinner](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2138) [in the meantime, well that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2140) [doesn't make the app usable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2141) [sooner, so we are trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2143) [avoid that here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2144) [Now there are three goals that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2147) [we are shooting for at Photos,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2148) [and the first one is that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2150) [want to instant, we don't want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2152) [to display any spinner, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2154) [don't want to display any](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2157) [placeholder or [inaudible].](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2160) [And I Have to be honest with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2163) [you, we-- you might see some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2164) [placeholders the first time you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2166) [synchronize with iClub, but when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2167) [the data is local, we really try](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2169) [our best to not display any.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2171) [Now, what do we mean by instant?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2173) [Well, the time it takes to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2176) [launch should be the same time](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2177) [as the zoom animation from the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2178) [home screen.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2180) [That is usually between 500 and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2181) [600 milliseconds, and that way,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2182) [the transition from the home](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2185) [screen to the application is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2186) [seamless for the user, and the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2187) [user can start interacting with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2189) [it, as soon as the animation is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2191) [done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2192) [And by the way, this is the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2193) [lowest recommendation, not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2194) [something just for photos, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2195) [it's valid for any apps.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2197) [Now, let's look at how photos](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2200) [launches today.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2201) [If we look more closely at what](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2203) [is happening exactly, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2204) [see that photos is all set up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2206) [and ready before the animation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2208) [is done.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2210) [And if we dive into the launch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2213) [anatomy, you will see there is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2215) [mainly two parts.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2217) [The first part is being spent in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2218) [The first part is being spent in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2218) [DYD, this is the loader that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2220) [going to load and link all of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2222) [your dependent libraries, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2223) [it's also going to run your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2225) [static initializers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2226) [And your control over that part](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2228) [is limited, but it's not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2230) [impossible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2231) [I would encourage you to watch](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2232) [the DYD session from last year](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2234) [in order to get more details on](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2238) [that part.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2241) [Now DYD is also calling Main in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2243) [your object table, which leads](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2245) [us to the second part here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2247) [where you have lots of control](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2249) [over, and this part, you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2250) [make sure that it stays under](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2252) [500 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2254) [Now, the first [inaudible] pass](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2255) [that is being scheduled right](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2257) [after the Did Finish launching](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2258) [will mark the end of your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2260) [launch, and this is basically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2261) [when your app should be usable.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2262) [There are a few principles that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2266) [we will be referring to during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2267) [this session, and these are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2269) [really the common pillars of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2271) [performance work that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2272) [achieved.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2273) [The first one is that we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2275) [be lazy and defer the work that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2276) [we don't need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2279) [we don't need.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2279) [The second one is that we want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2281) [to be proactive, and it's valid](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2282) [for two things.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2284) [It's valid for being proactive](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2285) [in order to anticipate the work](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2288) [that we are making it later, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2289) [also want to be proactive and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2292) [catch regressions quickly, so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2293) [you should make sure that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2295) [have continuous integration](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2296) [testing in place.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2297) [And the last point is we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2301) [be constant, regardless of the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2303) [total amount of data that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2304) [need to load.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2306) [Now, if we were taking a naïve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2309) [approach, and we were loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2311) [everything we needed during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2312) [launch, this is how long it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2314) [would take roughly for a 30,000](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2315) [item library.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2317) [First you need to initialize the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2319) [database, then you need to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2321) [prepare some view controllers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2322) [You need to configure the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2324) [sources, load some library](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2325) [images, and fetch the cloud](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2327) [status.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2328) [And keep in mind that this might](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2329) [vary as the data grow, and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2332) [fact, the data will grow forever](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2334) [as people takes pictures every](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2336) [day.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2339) [So at Photos, really keep in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2340) [mind that we are dealing with a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2341) [non-bonded data sets.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2342) [Now, let's see how we optimize](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2345) [each of these steps for Photos,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2347) [and let's start with](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2349) [initializing the database.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2349) [So first, usually, the database](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2353) [is initialized and loaded when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2355) [the first query is being fired.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2356) [One optimization that we have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2358) [found was to do it as early as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2359) [possible in the background](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2361) [thread, so that it doesn't have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2362) [to do the initialization when](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2364) [the first query has been fired.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2366) [And this is an issue, especially](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2368) [if the first query is being done](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2370) [from the main thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2372) [Now, we spend a lot of time and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2374) [we are still spending a lot of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2379) [time reviewing all the queries](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2380) [that we're doing during launch,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2381) [and we want to make sure that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2383) [the work that we are doing is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2384) [only the necessary one, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2386) [are not doing more.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2387) [Now, lastly, we want to ensure](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2393) [that all the queries that we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2396) [doing are efficient as possible,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2397) [and we want to avoid the complex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2399) [and we want to avoid the complex](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2399) [query as much as possible as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2401) [well.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2404) [And we sometimes we understand](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2405) [that we need this, and for these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2406) [cases, we are setting up some](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2408) [indexes, so that we can speed](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2410) [them up.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2412) [Now we are aiming for, at most,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2415) [30 milliseconds spent in that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2417) [initialization.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2419) [So next, let's look at how we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2421) [are preparing our view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2422) [controllers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2423) [So we have four tabs](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2425) [representing the main features](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2425) [of the app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2427) [And so the first thing that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2429) [need to be careful of is we want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2430) [to minimize the work that is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2432) [being done in the initialization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2433) [of these three non-visible ones,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2435) [and the rule that we are trying](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2437) [to follow here is to do as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2439) [little work as possible in the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2441) [initializers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2442) [We really want to do the bare](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2444) [minimum, and note all the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2445) [in the view that loads.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2447) [This also allows us to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2450) [initialize our controllers in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2452) [constant time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2454) [Now, lastly, we also want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2458) [ensure that only the visible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2459) [ensure that only the visible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2459) [views are loaded.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2461) [It's easy, and we often regress](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2462) [on that part, so you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2466) [really be careful about that.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2467) [So preparing the view](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2472) [controllers, we are now aiming](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2472) [for 120 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2474) [But preparing view controllers](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2476) [implies configuring the data](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2478) [sources, and let's look at that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2479) [chunk next.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2481) [So the Moments view is a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2485) [representation of these things,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2486) [events in your life, and the UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2487) [represents that by having this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2490) [group of photos, and these](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2491) [headers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2492) [In this library, for example, we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2494) [might have 500 moments, and in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2495) [order to build a view, we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2498) [to load all the moments up](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2500) [front.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2500) [But the only thing we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2503) [really for these moments is only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2504) [the meta data so we can build](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2506) [the view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2508) [We don't need your content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2509) [So the first thing we do is we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2511) [fire that query, which is super](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2514) [fast.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2516) [And then we are only loading the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2516) [content that we need here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2519) [content that we need here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2519) [In that case here, we are only](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2522) [going to load the visible](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2524) [content, which in our case is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2525) [going to be between 7 to 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2527) [Moments.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2529) [Since our deficit is limited,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2530) [and finite, we can allow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2532) [ourselves to do it synchronously](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2534) [on the main thread.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2536) [Now, we also want to anticipate](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2538) [and schedule the work so that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2540) [can start loading the remaining](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2543) [data as synchronously.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2545) [And we do that on the bug run](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2547) [thread, with the right quality](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2548) [of service to make sure that it](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2550) [doesn't preempt the main thread](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2551) [from running.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2552) [Now we are aiming at 100](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2558) [milliseconds here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2560) [So lastly, our data sources are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2564) [also providing some images and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2568) [let's see how we optimize that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2570) [part.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2571) [So this was by far the biggest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2573) [chunk here that we are all](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2574) [attacking, and when we realized](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2575) [that we were spending multiple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2577) [seconds loading this image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2579) [seconds loading this image](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2579) [during launch, we realized that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2580) [we were doing too much work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2582) [So the first thing that we did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2585) [is that we evaluated the number](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2586) [of images that we needed during](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2588) [launch, and we are only loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2590) [that during that first](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2592) [transaction.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2593) [In that case, that can be up to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2595) [60 including some piling above](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2597) [and below.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2599) [And next, in order to load those](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2600) [images firstly, we need to make](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2603) [sure that we are all loading](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2605) [only low-resolutions one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2606) [That way we are loading fewer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2608) [pixels in memory, and it is much](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2609) [more efficient.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2612) [That chunk is now representing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2615) [200 milliseconds.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2616) [And this is, by far, the biggest](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2619) [gain that we had.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2620) [Which I need to be a constant](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2622) [time, and that's really great.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2623) [Now, sometimes you have to ask](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2627) [yourself the question, is this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2629) [really needed during launch?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2630) [And one of our examples here is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2632) [this footer view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2634) [That pulls information via the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2635) [network or the database, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2637) [network or the database, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2637) [literally first our design was](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2640) [to not show it during launch.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2641) [To prioritize all the images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2644) [that we are seeing here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2645) [We wanted to show as much images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2646) [as possible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2648) [So that may be simpler.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2649) [We are now only scheduling that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2651) [work post-launch, and we cache](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2652) [to process information for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2654) [raising later.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2656) [Now, if we would have had the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2660) [requirement of displaying this](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2661) [information, one approach could](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2662) [have been to leverage the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2664) [register background at refresh](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2665) [API from UA kit, that will](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2667) [proactively clear your app so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2669) [that you can start preparing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2671) [some content when the user is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2672) [going to launch your app.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2673) [So now, that part has gone from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2677) [launch, and that saves us 400](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2678) [milliseconds of CPU time.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2680) [If we look at the updated](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2683) [breakdown here, we can see that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2685) [we now have only 450](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2687) [milliseconds worth of work.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2688) [We are now fitting into that 500](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2690) [millisecond time window, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2693) [regardless of how things can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2695) [represented concurrently here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2698) [the most important part of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2699) [the most important part of that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2699) [is to really make sure that you](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2701) [think about the cost of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2702) [preparing your content.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2703) [And what I mean by think is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2705) [really measure it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2707) [Now, you should strive for doing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2710) [work in constant time,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2712) [regardless of the total amount](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2713) [of data you are loading.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2714) [In our case, really have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2716) [unbonded data assets, and we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2717) [need to stay constant.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2719) [Now that we have launched the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2724) [app, we need to start using it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2725) [And let's see how we did](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2727) [collections and [inaudible] for](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2729) [good [inaudible] performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2730) [So as I mentioned earlier, our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2731) [users can seamlessly transition](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2734) [with animation from the Moments,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2737) [through the collections, to the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2739) [years view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2740) [And this is a complex hierarchy.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2744) [We have thousands of pictures to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2746) [display.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2748) [We need to support live updates,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2749) [we need to also support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2751) [animation between these layers,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2753) [and we also have some gestures.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2755) [Now, we also have some goals](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2760) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2761) [For the experience we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2762) [provide to our users.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2764) [The first one is the same as](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2766) [before, we don't want to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2767) [any spinner.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2768) [We don't want to have](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2769) [placeholders, but we also want](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2770) [to have smooth animations.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2772) [And by smooth animations, I mean](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2773) [60 or 120 frames per second,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2775) [depending on the screen you're](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2779) [running on.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2780) [Now, remember the principles](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2783) [that we've seen before.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2784) [Well, they are all applicable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2785) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2786) [We want to be lazy and defer the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2787) [work we donate up front.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2788) [We want to be proactive, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2790) [catch regressions quickly, but](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2791) [we also want to be constant in](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2794) [our layout passes, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2795) [regardless of a lot of data that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2797) [we are loading.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2799) [Now, this time, we also want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2801) [be timely, and we want to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2802) [remember the rendering loop](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2804) [cycle.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2805) [And what I mean by that is that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2807) [I want you to remember that we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2808) [only have 8 or 16 milliseconds](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2809) [to render that frame, so we need](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2812) [to make sure that we are not](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2813) [going over that time, otherwise](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2814) [we would start dropping frames.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2815) [Now, let's take a step back, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2819) [Now, let's take a step back, and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2819) [look at what we are trying to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2821) [achieve here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2822) [We wanted to have this portable](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2823) [view, with sections and mini](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2825) [cells in it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2826) [And that is basically what your](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2829) [Collection view is providing,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2831) [right?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2832) [Except that in this extreme](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2833) [case, we are restricting the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2835) [limit of what we could achieve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2836) [with a basic approach.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2837) [And that resulted in too many](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2838) [views, too many layers.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2840) [But also in an increased layered](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2843) [complexity, and that also had an](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2846) [increased memory cost.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2848) [So we needed to innovate here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2851) [and we did that by restricting](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2853) [the number of views drastically](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2855) [while still using a collection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2856) [view.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2857) [We used a technique more](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2860) [commonly used in video games,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2862) [that is called atlasing.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2863) [And it basically consists of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2865) [combining a set of images into a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2867) [single one.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2868) [We do that efficiently by using](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2870) [only very small thumbnails](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2872) [first, then we stamp all the raw](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2873) [image data on the canvas we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2876) [using as a strip.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2878) [Now, we use image raw data so](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2881) [that we can avoid decoding each](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2883) [thumbnail as we send.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2884) [So basically we are displaying a](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2888) [random strip of images.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2889) [Now, we generate and cache them](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2892) [on the fly so that we can be](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2894) [more flexible.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2895) [And as we render multiple images](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2898) [into a single one, we are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2900) [registering the number of cells,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2902) [layers, objects drastically,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2903) [which simplifies the layout and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2904) [the time spent building it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2906) [Now, the separate works well,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2909) [but it has trade offs to](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2911) [consider as well, and this is](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2912) [one of them.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2914) [So if someone tries to long](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2916) [press or force search an item](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2918) [here, we will need to figure its](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2920) [position so that we can achieve](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2922) [the preview correctly.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2924) [And as we display a single](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2925) [image, we need to maintain the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2928) [mapping of each individual](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2930) [image, and its render strip.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2933) [Now, you might be thinking, why](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2936) [are we generating them on the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2937) [fly?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2938) [Well, we need to support live](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2940) [updates, that's the reason.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2941) [We need also to support](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2944) [different view sizes.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2945) [For example, we have landscape](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2947) [here.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2948) [But we also have portraits.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2949) [And also we can do that because](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2952) [we can [inaudible] because our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2956) [user's labor typically grows](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2957) [organically over a long period](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2958) [of time, and the cases where we](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2960) [might need to generate thousands](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2962) [of them are pretty rare.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2964) [Now, you may be wondering also](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2967) [why are we not generating the](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2969) [whole section then?](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2970) [Well the answer is that our](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2972) [design record is to do this cool](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2973) [animation, where you can see](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2975) [that the collections are](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2976) [expanding into their own](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2977) [sections or collapsing into](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2979) [group ones, and the other way](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2980) [around.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2982) [So if there is one thing that](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2985) [you should also remember from](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2987) [that second part is you should](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2988) [really think about the layout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2989) [course of your hierarchy and](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2990) [measure it.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2993) [Lastly, you should always think](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2996) [about performance.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2998) [At Photos, we care deeply about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2999) [At Photos, we care deeply about](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2999) [it, and this is really part of](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3001) [our daily job.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3002) [For more information, you can](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3004) [come and see us in these three](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3006) [labs that are mentioned here,](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3009) [and I hope that you have a great](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3010) [conference.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3012) [Thank you.](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3013) [[ Applause ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3014)