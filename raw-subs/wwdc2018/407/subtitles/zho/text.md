# Practical Approaches to Great App Performance

## Summary
All apps benefit from a focus on performance and an increase in overall responsiveness. This information packed session gives you strategies for fixing performance problems using Instruments and other tools. Additionally, get practical advice based on experience in tuning Apple's own apps including Xcode and Photos on iOS.

## Info
* Developer Tools
* WWDC 2018 - Session 407 - iOS, macOS, tvOS, watchOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/

## Text
 [［ 音乐 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=7) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=19) [&gt;&gt; 大家下午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=25) [我是 John Hess](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=27) [今天我将和 Matthew Lucas 一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=28) [与在座的各位](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=30) [谈谈提高 App 性能的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=31) [一些实用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=33) [我现在是一名 Xcode 团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=35) [在过去的七年](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=36) [我有幸一直专注于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=38) [提高性能的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=39) [首先是在 Xcode 的两个领域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=42) [“Project Find” 和 “Open Quickly”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=44) [二者的主要功能 都是提高性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=47) [最近 我有机会去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=50) [做一项关于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=52) [Xcode GY 响应性的调查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=54) [我想与你们分享的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=55) [在进行性能工作时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=57) [我所使用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=58) [我所使用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=58) [其中包括我十分熟悉的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=60) [也包括我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=61) [第一次接触到的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=63) [那么 如果各位想从今天的演讲中有所收获](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=65) [我希望各位至少能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=67) [记住一点 那就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=69) [你们所有提高性能的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=71) [都要基于测量的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=73) [在开始解决一个性能问题时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=75) [你需要进行测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=77) [来建立一个基线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=78) [让你知道自己所处的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=81) [当你重复解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=83) [同一个性能问题时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=85) [你应该测量每一步所使用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=86) [以确保性能的改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=88) [能够带来你所期待的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=89) [当你解决了一个性能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=93) [你还需要再测量一遍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=94) [这样你可以与原先的基线](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=95) [进行对比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=97) [从而给出一个量化的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=98) [关于你将 App 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=101) [真正提高了多少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=103) [你想要将成果报告给你的老板](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=105) [分享给你的同事和用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=106) [那么 当你想要为你的用户提高性能时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=110) [你需要考虑这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=112) [我喜欢称它为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=115) [总体性能影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=116) [如果你将 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=118) [如果你将 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=118) [一个领域的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=121) [提高了 50%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=123) [但你的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=126) [只体验到了其中的 1%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=128) [那么这种提升的影响广度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=130) [还不及你只提高了其他领域的 10%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=131) [但所有用户都能体验到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=133) [这全部的 10%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=135) [所以一定不要去优化边缘的案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=137) [要确保你的性能的优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=139) [能够为全部的用户所体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=140) [那么我们如何修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=144) [性能漏洞呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=147) [如何修复常规的漏洞呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=148) [一般来说 最开始用户反馈给我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=149) [某方面的缺陷报告](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=151) [我们接收到这个报告](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=153) [了解到用户对 App 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=155) [有一些不满意的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=156) [于是我们会设法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=158) [来综合步骤进行故障重现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=160) [以便我们可以随意地使程序出错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=161) [一旦我们成功的做到 我们就给](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=163) [程序附加一个调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=165) [以便我们看到我们的程序出错的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=166) [在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=168) [再结合我们的知识](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=170) [想想代码应该如何工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=171) [在必要时修改它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=172) [来消除那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=174) [不如意的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=176) [我们要确保我们没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=177) [带来任何不想要的副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=178) [带来任何不想要的副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=178) [同时 要进行必要的重复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=180) [直到我们完全地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=182) [解决了这个漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=183) [我已经用相同的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=185) [修复了许多性能漏洞](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=187) [只不过我并没有使用调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=190) [而是使用了一个分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=191) [分析器就是一个很好的测量工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=193) [我用一些步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=196) [来重现运行很慢的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=198) [程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=200) [我用一个附加的分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=201) [来执行这些步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=203) [因此我可以深入地了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=205) [当我的代码运行缓慢时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=206) [它发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=207) [然后再结合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=209) [我的程序必须要如何运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=211) [才能完成手边的任务](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=212) [我找到其中正在进行的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=214) [并删除了它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=216) [因为想让你的代码变快的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=217) [首要方法就是删除多余的步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=219) [无论它正在计算的是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=222) [现在 我修改了源代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=225) [在必要时进行反复测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=227) [直到我对整体的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=229) [感到满意为止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=230) [当我通过这种方法提高性能时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=234) [我发现自己常常处于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=237) [一些场景当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=239) [一些场景当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=239) [这些不同的场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=240) [改变了我测试有问题代码的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=242) [以及复制这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=243) [漏洞的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=245) [有时我会遇到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=246) [严重的性能衰退问题 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=249) [开始一切都在平稳地运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=251) [然后我们的团队里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=252) [有人对其进行了检测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=254) [这个人也许是我](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=255) [然后发现性能出现了严重的衰退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=257) [那么我们就需要回去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=258) [找出这种衰退的原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=259) [如果这种衰退十分明显](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=262) [或者是它出现在一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=263) [我认为近期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=265) [不可能再次衰退的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=267) [我也许会自己手动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=268) [运用附加的分析器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=269) [对它进行测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=272) [但是 想提高你的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=274) [这是一个不大容易的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=276) [因为很可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=277) [只是一系列轻微的衰退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=280) [就会让你功亏一篑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=282) [我建议你们所有人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=283) [创建自动化的性能测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=285) [来捕捉你的 App 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=286) [这样你就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=288) [保证它不会随着时间而衰退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=290) [我经常所处的另一个场景是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=295) [App 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=296) [在很长一段时间后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=298) [在很长一段时间后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=298) [还能保持不变吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=300) [也许在一些绘图测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=301) [它运行的速度是 45 帧每秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=303) [但是我们希望的运行速度是 60 每秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=305) [所以我们需要小幅地提高它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=306) [并且我们有理由相信](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=307) [通过我们先前的性能工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=309) [我们可以利用现场修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=310) [以及增量式变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=312) [来对它进行提高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=314) [在这种场景下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=316) [我或许也已经自动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=317) [开始进行测试了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=319) [因为随着时间的推移](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=320) [我已经很了解我的性能了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=324) [还有第三种场景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=325) [我们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=326) [因为设计不良而受到损害](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=328) [性能也远远比不上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=329) [它原应达到的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=330) [我们知道我们不能用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=333) [简单的场地修复来提高性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=334) [因为过去我们这么尝试过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=336) [但并没有成功](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=337) [无法提高性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=339) [在这样的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=342) [你会想要做一次彻底的性能检修](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=343) [你会想重新设计一些特性的核心部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=345) [或是有问题的算法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=347) [以使性能成为一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=348) [首要的约束条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=350) [在这些情况里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=352) [你必然要对性能进行检测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=353) [以测量你确实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=355) [达到了你的性能目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=356) [知道你要测试什么 很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=359) [知道你要测试什么 很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=359) [我想要提醒你的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=362) [我从来都不会立刻投入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=363) [这些性能检修](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=365) [将其视为解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=366) [某种性能问题的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=368) [我喜欢这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=369) [这是一种未曾开发的工程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=370) [你能够从头开始 设计这些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=372) [但这也颇具风险](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=374) [你最终要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=376) [一个性能更好的产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=377) [但这却是一个曲折的过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=378) [因为你需要重新设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=379) [整个特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=381) [当你做这种工作的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=384) [你不仅需要知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=385) [这些代码的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=386) [功能约束条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=388) [你还要知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=389) [性能约束条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=391) [以及你的用户应用这一特性时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=392) [最常使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=394) [典型的模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=395) [而你只能从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=397) [过去这方面的性能工作中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=399) [获得这方面信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=400) [我想和你们分享一件轶事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=401) [是我们的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=403) [在 Xcode 里工作的案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=405) [在 Xcode 9 中 我们重做了 “Project Find”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=407) [将性能作为一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=409) [首要的目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=410) [我们的目标就是要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=412) [在短短几十毫秒中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=413) [传递出搜索结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=415) [当我们与同事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=416) [讨论这个特性时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=419) [讨论这个特性时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=419) [我们常常遇到一些挑战](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=420) [比如让我们在一些大的项目上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=421) [搜索一些类似于字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=423) [或者甚至是字母 E](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=425) [这样的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=427) [这些东西能搜索出成千上万种结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=427) [不是吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=428) [当然如果你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=430) [能够迅速生产出成千上万的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=432) [它搜索任何东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=433) [都会很快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=434) [但是如果你思考一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=436) [什么是典型的模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=437) [我们搜索我们使用的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=440) [我们自己的类名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=442) [还有我们引用的图片名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=444) [诸如此类的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=445) [它能搜索出很多结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=446) [也许上百种结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=447) [当然十分重要的是 当有一百万种搜索结果时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=448) [你的 App 能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=450) [正常地工作运转](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=452) [但是通常的使用情况是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=453) [有数百种搜索结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=455) [那么 在进行搜索这样的任务时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=456) [你所做的一些工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=458) [要与生成原始结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=460) [这样的东西相对应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=461) [而其余的工作则要基于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=463) [你能多有效地索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=465) [项目中的文本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=466) [并预先避免工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=468) [在这两种场景中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=470) [你可能会有完全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=471) [不同的优化目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=473) [让其中一个目标的搜索速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=475) [快于其他的目标 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=476) [因而你有必要了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=479) [因而你有必要了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=479) [你的用户将要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=480) [如何使用该产品](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=482) [这样你就可以优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=483) [应该优化的案例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=484) [在所有的这些案例中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=487) [我需要进行一些形式的测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=489) [无论是手动地 还是自动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=491) [我想要与你分享](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=496) [两类典型的性能测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=497) [我通常用它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=498) [来测量 Xcode 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=500) [我们或者进行单元测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=503) [或者进行综合测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=505) [我们来对比一下这两种测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=506) [在性能的单元测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=509) [你的目标就是对你的 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=511) [某些特征进行隔离](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=513) [并单独地对其进行测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=515) [你也许会抹去它的相关性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=516) [然后在一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=517) [隔离的环境中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=519) [启动它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=521) [如果我要为 Xcode 的代码完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=523) [性能的单元测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=525) [那我也许会编写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=527) [一系列的三个小测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=528) [其中一个测试会测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=531) [与编译器的对话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=533) [并得到原始的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=534) [和原始的代码完成候选的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=536) [另一个性能测试则会测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=538) [另一个性能测试则会测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=538) [那些结果的相互关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=541) [对它们进行排列以及评分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=542) [以便我们知道要将哪些结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=544) [显示给用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=545) [第三个测试会选取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=546) [那些已经准备好的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=548) [并测量将它们放入 UI 元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=550) [后最终展示出来的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=551) [为了涉及到全部三个方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=553) [我会很好地覆盖 IDE 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=555) [代码完成的主要的组件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=557) [这些性能单元测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=563) [有一些很好的方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=564) [我们将高度聚焦这些方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=567) [这意味着如果它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=568) [在将来出现衰退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=570) [我会很清楚地知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=571) [这些衰退出现在哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=572) [因为这些正在运行的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=574) [已经处于检查之中了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=575) [而它们也将在不断地运行过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=576) [产生出更多的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=579) [可重复的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=580) [而它们产生的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=581) [也不会有太大的波动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=582) [因为这些代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=585) [是高度聚焦的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=586) [现在 我们来将单元测试与](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=588) [综合测试进行对比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=589) [在综合测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=591) [你要做的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=592) [在用户使用 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=594) [对其性能进行全面地测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=596) [所以 如果我为 Xcode 编写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=599) [所以 如果我为 Xcode 编写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=599) [代码完成单元测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=601) [哦不对 是综合测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=603) [我会启动全部的 Xcode App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=605) [我会打开一个源文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=608) [我会定位到该源文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=609) [然后进行书写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=611) [再反复地进行代码完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=613) [当我执行这些步骤的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=616) [看看 Xcode 在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=617) [看看它花了多少时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=618) [我会发现这个测试 一点也不聚焦](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=620) [Xcode 会在我书写的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=624) [进行绘制和布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=625) [当我归类时 它还会同时进行语法着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=626) [在后台 Xcode 也许正在进行索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=630) [读取获取状态 并决定把新的文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=631) [显示在 Assistant Editor 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=634) [而所有的这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=636) [都将与代码完成一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=637) [来竞争 CPU 的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=640) [也许当我查看 Profiler 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=643) [我会看到我们花费了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=644) [80% 的时间在做语法着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=645) [而剩下的 20% 则用在了代码完成上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=647) [从这个数据我可以知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=651) [要提高代码完成性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=652) [最好的方法就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=654) [推迟语法着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=656) [这样的知识](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=658) [这样的知识](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=658) [是我在高度聚焦的单元测试中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=660) [所无法获得的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=661) [所以如果今天各位听完这个演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=662) [只能带走两样东西的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=664) [第二样就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=665) [要调查你的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=667) [必然应该从这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=668) [广泛的综合测试开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=670) [它们会测量你的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=672) [使用 App 时的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=674) [对 我说的就是测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=678) [测量以及分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=679) [现在我想向你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=681) [介绍一下用工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=682) [在 Xcode 中进行分析](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=684) [让我们来看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=685) [demo machine](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=686) [今天我们要看的是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=695) [我们在 Xcode 9 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=695) [Xcode 10 之间修复了的性能问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=697) [我想展示给你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=699) [下面我先启动 Xcode 9](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=701) [打开我们的 Solar System App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=704) [那么 我们所](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=707) [面临的问题就是创建标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=707) [接着我要快速地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=710) [按几下快捷键 “Command-T”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=711) [如你所见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=712) [整个屏幕闪现了黑色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=714) [并且创建这些标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=716) [花了好几秒的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=718) [这肯定达不到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=719) [这肯定达不到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=719) [我对性能的预期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=721) [我们需要来对它进行修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=722) [那么我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=724) [如何进行修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=726) [首先 我将启动 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=728) [这是我们的分析工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=729) [你可以从 Xcode 菜单中打开它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=731) [在 Instruments 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=732) [Open Developer Tool 里面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=734) [现在 我在 Xcode 9 里面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=735) [所以如果我选择这个选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=738) [那我启动的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=739) [Xcode 9 中的 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=740) [当然我想要从 Xcode 10 中启动 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=741) [我已经把我的文件放在这里了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=742) [我将隐藏 Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=744) [打开 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=746) [当 Instruments 启动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=749) [就会出现一系列的分析工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=751) [我们可以用它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=753) [测量我们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=754) [这里是各种各样的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=756) [它们能够测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=757) [图形的利用率 内存消耗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=758) [IO 以及整体的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=761) [你们也许会对从哪个工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=765) [先开始学习](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=767) [而感到不安](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=768) [那么我对你们的建议是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=771) [如果只学习其中的一个工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=773) [那么你们应该学习](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=775) [Time Profiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=776) [在我的性能工作中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=778) [在我的性能工作中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=778) [有 95% 甚至更多的情况下都在使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=780) [当你的用户抱怨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=781) [你的 App 运行很慢时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=783) [他们是在抱怨](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=784) [它花费了太多的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=785) [假如你的 App 太慢了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=788) [是因为你运行了太多的 IO](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=790) [从而花费了太多的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=790) [那么你就能在 Time Profiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=792) [上看到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=793) [所以如果你只学习一个工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=795) [那就学 Time Profiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=797) [我们来看看它是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=800) [我要启动 Time Profiler](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=805) [只需要双击这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=806) [然后将 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=808) [全屏显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=811) [下面 我想要记录 Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=813) [在 Instruments 视窗的左上角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=816) [你可以控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=818) [你想要附加和记录的进程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=819) [在默认情况下 只要按下这个记录按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=823) [我的 Mac 上的所有进程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=825) [都会被记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=826) [而我只想锁定到 Xcode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=828) [我会将这个弹出框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=834) [切换到 Xcode 然后点击记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=836) [现在 当我记录的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=839) [现在 当我记录的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=839) [我就要关注视窗中的这个区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=840) [来追踪轨迹视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=842) [我要调整 Xcode 视窗的大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=843) [将它调小一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=845) [我就能看到那个区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=846) [然后我就要进行让它变慢的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=848) [我要多创建几个标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=849) [你可以看到这里的图表 发生了变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=852) [现在 我要退出 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=855) [然后回到 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=857) [所以刚刚发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=861) [当分析器在运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=863) [它被附加在我们的进程之中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=866) [像一个调试器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=867) [这个分析器每秒钟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=868) [都数千次地停止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=870) [我们的进程 并且它采集了跟踪轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=872) [那么 提醒一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=875) [跟踪轨迹描述了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=877) [你的程序如何到达](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=878) [它目前所处的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=879) [所以如果你现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=880) [处于 C 函数的第 6 行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=882) [你到达那里的原因是因为 Main 函数调用了 A B C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=883) [那么你的跟踪轨迹就是 Main A B C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=885) [当 Instruments 捕捉到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=889) [这些跟踪轨迹中的其中一个时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=890) [它会说 嘿 我们刚刚在 C 函数中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=892) [花了一毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=893) [它说一毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=894) [是因为我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=896) [记录采样间隔为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=898) [一毫秒每次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=899) [那么 在主线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=901) [所有的这些跟踪轨迹都要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=902) [从 Main 函数开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=903) [它们也许将要调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=904) [Application Main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=905) [之后它们将会通过你的源代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=906) [不断地进行扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=908) [我们可以将这些跟踪轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=910) [折叠在一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=911) [将它们覆盖放进一个前缀树](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=913) [以便它们从 Main 开始 进行下去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=915) [我们可以将我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=917) [捕捉到的这些毫秒计数器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=918) [放在顶端 这样我们就能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=919) [看到在我们源代码的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=921) [所有不同层级的区域上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=923) [我们都花费了多少时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=924) [我们要看看这个数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=926) [试着找出多余的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=927) [和不必要的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=929) [这样我们就可以提高速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=931) [这是我们提高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=932) [App 性能的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=933) [首要方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=934) [现在 正如你能想象到那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=937) [我们每秒能捕捉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=939) [上千的跟踪轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=940) [在 Instruments 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=941) [有大量的数据需要你去处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=943) [我首先要给你的建议就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=946) [你想要尽可能多地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=948) [过滤这里的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=949) [你需要看整个过程的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=951) [不要把精力集中在细节点上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=953) [好吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=955) [我想要给你演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=956) [如何应用一堆强大的过滤器和工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=957) [如何应用一堆强大的过滤器和工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=957) [因为我之前做了记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=964) [还记得吧 我让轨迹视图显示了出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=966) [我这么做是因为我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=969) [看看当我创建标记的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=970) [CPU 的利用率是如何变化的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=972) [以及在哪里发生了变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=973) [然后我告诉自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=975) [就在这儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=978) [我只是拖动鼠标并选中了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=980) [轨迹所在的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=981) [我让 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=986) [将它的跟踪轨迹数据只专注于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=987) [那里的时间间隔上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=991) [所有在这里的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=993) [都是我创建标记之前的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=994) [而所有这里的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=996) [都是我创建了标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=997) [退出 App 之后的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=998) [那不是我现在要优化的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1000) [所以我不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1000) [看那里的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1002) [现在 在 Instruments 视窗的底部区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1005) [Instruments 会显示出所有它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1008) [所采集到的轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1009) [默认情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1011) [每个线程上只有一行在运作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1015) [在这个例子里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1016) [看起来只有四个线程在运作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1017) [而有时候则会更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1019) [而有时候则会更多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1019) [这取决于你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1020) [是如何并行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1021) [我通常喜欢以聚焦的名义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1023) [我也喜欢折叠它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1026) [让他们建立在每个线程中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1027) [函数执行的最顶层上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1030) [而不是线程 ID 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1031) [因为前者与我使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1033) [Grand Central Dispatch 的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1034) [更为契合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1036) [接下来我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1038) [Instruments 视窗的底部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1039) [我要点击这个叫 Call Tree 的按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1041) [然后放大它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1042) [这样你就能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1044) [我要做什么了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1045) [这里有几个可用的过滤器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1046) [其中一个被线程分开了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1048) [默认情况下它就已经开启了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1050) [接下来我要禁用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1051) [相反地 所有的线程都将按照](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1053) [它们的最顶层入口点来分组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1056) [而不是它们的线程 ID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1057) [现在 来看这个轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1062) [可以看到所有这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1065) [正在运作的线程 顺便提一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1066) [在主要轨迹的下面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1069) [是总的 CPU 使用率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1070) [CPU 使用率被分解到每一个线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1073) [我们可以看到在这个轨迹中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1074) [几乎其他所有的线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1076) [大部分都是闲置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1077) [我可以只聚焦主线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1079) [我可以只聚焦主线程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1079) [从这里选择它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1080) [现在我们就可以只看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1083) [在这个时间段内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1084) [主线程的轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1086) [我准备开始深入到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1088) [这个调用层级当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1089) [这样就能看到我的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1091) [在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1092) [通常我会键入这一过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1093) [只要按下向右箭头和向下箭头](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1095) [然后不断地进行重复就可以了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1097) [但是我想要给你们演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1099) [Instruments 提供的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1101) [最密集的跟踪轨迹检测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1102) [如果你的检测是不可见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1104) [你可以用这个按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1105) [进行切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1106) [最密集的追踪轨迹就都会在这](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1108) [在这个标记里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1109) [“Extended Detail”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1111) [那么 最密集的追踪轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1112) [正是出现得最频繁的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1114) [那个轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1115) [当我们在当前选择下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1116) [进行记录的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1117) [追踪轨迹出现得最为频繁](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1119) [你可以利用这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1122) [在一段时间内 快速浏览许多帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1123) [我通常会浏览这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1126) [寻找我自己的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1128) [还有值得我花这么多时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1129) [来寻找的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1130) [或者是寻找](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1131) [我们在样本数中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1134) [有重要分支点的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1136) [现在我们看这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1138) [我看到这个给 IDE 的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1139) [我看到这个给 IDE 的调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1139) [Navigator Replacement View](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1142) [Did Install View Controller](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1144) [我十分熟悉这个 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1145) [因为这是一个 Xcode 内部的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1147) [在这个轨迹中 我可以查看这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1150) [在视窗的左手边](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1152) [这里负责的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1153) [我们记录的总时间中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1154) [或者 45% 的时间中的 1.19 秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1158) [这种方法要花费的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1162) [远远超出了我的预期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1164) [但是 我们很难聚焦在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1167) [看看究竟发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1169) [对吗 这是这个轨迹下面的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1170) [其他所有的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1172) [那么 它看起来就好像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1173) [30 到 40 的堆线范围深度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1175) [这是很吓人的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1178) [我要给你演示如何聚焦这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1179) [第一种方法就在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1181) [我们又要使用 “Call Tree” 弹出框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1183) [我要在这个弹出框里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1187) [选择 “flattened recursion”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1189) [让我们来继续完成这步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1191) [现在你就可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1195) [就在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1196) [一组重复的方法调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1197) [一组重复的方法调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1197) [被折叠了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1200) [不好意思 让我滑下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1202) [它被折叠了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1205) [事实上 我就是想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1206) [继续我的性能测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1208) [在这个 IDE Navigator 范围里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1209) [在这个 API 调用中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1211) [我可以根据上下文](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1214) [重新聚焦整个 Call Tree 点击这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1217) [然后选择 “Focus on Subtree”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1219) [之后 Instruments 就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1221) [将这个符号放到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1222) [整个调用图的最顶层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1223) [其他的所有东西都会被删除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1225) [它会重新将百分比设置为 100%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1226) [因此我可以就聚焦在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1228) [现在 我可以用键盘上的箭头键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1230) [来继续运行这个样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1233) [看看我们在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1235) [我很熟悉这些 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1236) [看起来我们好像正在进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1238) [状态恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1240) [当我继续扩大这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1241) [我可以看到我们几乎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1243) [深入了这个表格视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1245) [除了有这种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1247) [热调用路径以外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1249) [你知道 这种调用路径占了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1251) [大部分的总百分比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1252) [同时还有其他的这些附带样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1254) [它们很容易分散](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1258) [我们的注意力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1259) [我们的注意力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1259) [它们的其中之一就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1261) [OPC Message Send](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1263) [它可以遍布你的追踪器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1264) [只要你在写 Objective C](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1266) [即使你在写 Swift 代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1268) [当你按照你的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1269) [进入系统库时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1270) [你也会看到这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1271) [你会经常看到它的对应函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1272) [OPC LoadStrong LoadWeak](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1273) [Retain 等等 你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1275) [将所有的内容从调用关系树里删除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1278) [根据上下文点开这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1280) [选择 “Charge OPC to Callers”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1283) [它就会告诉 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1289) [来选取所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1290) [来自于 OPC 库的样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1291) [然后将它们从调用数据中删除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1293) [但是要将时间的属性归于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1295) [调用它们的父框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1296) [我倾向于将那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1298) [Objective C 运行时的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1299) [视为在书写 Objective C 代码时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1301) [的代价成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1302) [我很少会去试图优化它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1303) [所以我只会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1306) [将它们从数据中删除](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1308) [这样我就可以聚焦在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1309) [我可能要处理的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1310) [还有一个你们可以应用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1313) [强大的过滤器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1315) [我要用它来删除所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1316) [出现在这一组帧中的小样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1319) [出现在这一组帧中的小样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1319) [它就在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1320) [Call Tree 约束条件的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1322) [让我来给你演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1326) [我将要告诉 Instruments](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1331) [我想要看到的轨迹范围](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1332) [只包括我们所说的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1334) [20 或者更多的样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1336) [我选择 20 是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1339) [我知道我已经选择了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1340) [一个两秒的间隔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1341) [那么 20 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1343) [将会呈现出整个工作的大约 1%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1344) [而就包含了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1346) [在默认情况下 我想进行工作的粒度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1347) [因此将 Call Tree 约束条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1351) [设置为一个最小值 20](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1353) [我就能更有效地聚焦在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1357) [那么 我在这里提到过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1360) [我们在扩展我的视图项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1361) [我看到在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1363) [我们其实在调用 NS 大纲视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1365) [扩展项目 扩展子项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1366) [在这里 很多人都会将调用图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1368) [停在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1371) [我们会看到 我正在调用一个系统框架](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1372) [我在那里花了很多时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1375) [这不是我的错 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1376) [那么我能做什么呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1378) [我不能优化 NS 大纲视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1378) [我不能优化 NS 大纲视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1378) [扩大项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1380) [但你肯定有能力](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1383) [改变这些情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1384) [例如 花费在系统框架上的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1386) [所有这些时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1387) [都是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1388) [它在运算你提供给它的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1390) [这需要花费很多的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1393) [因为你在成千上万次地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1394) [调用这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1395) [它会花这么多时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1398) [还因为它还要通过授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1399) [回调你的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1400) [而最重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1402) [你可以深入地了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1404) [系统框架在做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1405) [只要沿着 Instruments 树](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1407) [不断地进行扩展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1408) [并查看这些被调用的函数的名称](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1410) [其实 我就是这样学会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1412) [修复这个漏洞的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1413) [当我将这个轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1417) [扩展到大纲视图中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1419) [我能看到 它正在调用这里的两种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1421) [用项目入口来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1424) [批量处理扩展项目和子项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1427) [然后再进行最后更新后的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1429) [现在 那些对我来说都是重要的线索](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1431) [说明我们或许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1433) [有可能通过批量处理来提高效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1434) [正如你能想象的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1436) [大纲视图从一小组项目开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1438) [大纲视图从一小组项目开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1438) [然后我们试着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1440) [在我们代码的这个区域内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1442) [不断修复扩展状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1443) [我们会告诉它打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1445) [比如说顶部的项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1446) [而当我告诉它打开顶部的项目时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1448) [你能够想象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1449) [它同时将里面的其他项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1451) [都向下移了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1452) [然后我继续扩展第二个项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1454) [它就会再次下移其他项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1456) [接着是第三个项目 以此类推](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1457) [而等到你做完这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1459) [你已经将这些底部的项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1460) [向下移动了数千次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1462) [那这些都是多余的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1465) [而它们正是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1466) [我在提高性能时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1467) [想要消除的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1469) [现在 这些方法调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1471) [谈到的批量处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1472) [让我觉得或许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1475) [在一些 API 中我可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1476) [让大纲视图批量地进行工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1478) [因此它就可以对所有的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1479) [只进行一次计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1481) [而不是在我进行调用的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1483) [反复地计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1484) [我还看到一个调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1486) [用来进行最后更新之后的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1488) [那么 有时 API 会提供那种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1490) [在一组列阵上进行运算的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1492) [整体方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1493) [而有时它则会提供一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1495) [事务型 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1497) [它会说我要开始进行更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1499) [它会说我要开始进行更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1499) [然后就做了一系列的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1501) [然后你说你完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1501) [之后它会对你变化的全程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1502) [进行计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1505) [这比它自己独自完成这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1507) [要更有效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1508) [那么这时候 我会前往](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1511) [NS 大纲视图或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1512) [NS 表格视图 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1514) [我会找一些这样的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1515) [那里确实有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1517) [在 NS 表格视图里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1519) [有一些开始和结束更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1520) [所使用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1522) [它们允许合并表格视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1523) [并能够大大提高这些工作的效率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1525) [当然 我们要在 Xcode 10 中使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1527) [让我来给你演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1530) [我要启动 Xcode 10](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1533) [我要把 Source](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1538) [作为一个 App 打开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1539) [然后我来创建一些标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1543) [你可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1544) [这里屏幕没有出现闪黑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1546) [标记也打开得更快了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1547) [现在 我想让标记打开的速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1549) [比这个更快 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1552) [那么我接下来应该怎么做呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1554) [我很幸运](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1556) [因为你不是每天](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1558) [都需要进入轨迹中去寻找](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1559) [都需要进入轨迹中去寻找](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1559) [一些如此明显且容易修复的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1560) [而这样的东西在样本里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1562) [占到了 50%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1563) [对吗 其实并没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1565) [什么巨大的严重问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1568) [等待我来解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1569) [相反 我要做的其实就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1571) [检查整个样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1572) [并在此过程中应用过滤器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1574) [所以我只是寻找](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1575) [一些只占到 1% 或者更多时间的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1577) [我要寻找每一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1580) [我认为能够运用一些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1581) [来将其速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1583) [提高一点的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1584) [我会将它们都记下来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1588) [放在一张纸上或一个文档里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1589) [或者其他什么东西上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1590) [然后我就会着手解决它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1592) [现在 我需要选择一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1593) [解决它们的顺序 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1594) [因为有的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1595) [用修复第二件事情时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1597) [所用的方法来修复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1598) [列表中的第五件事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1600) [这方法可能会是过时的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1600) [如果没有排好顺序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1602) [你就会做多余的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1603) [这是十分糟糕的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1604) [因为我们首先要删除的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1605) [多余的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1607) [但是这些工作都是如何进行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1608) [我们又很难去预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1610) [你通常无法事先知道这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1612) [所以不要因为这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1614) [停下你开始的脚步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1617) [因为你想要把速度提高 30%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1619) [因为你想要把速度提高 30%](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1619) [就得进行 103% 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1620) [改善工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1623) [明白吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1625) [现在 回到我们的幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1627) [我要给你演示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1630) [一些我们常用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1633) [用来持续改善我们的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1634) [毫无疑问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1641) [我们最常见的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1642) [使用那些与大纲视觉里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1643) [相同的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1645) [批量处理和推迟处理 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1646) [你有一个 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1648) [而当这个 API 被调用时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1649) [会出现一些副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1651) [然后你用一些代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1652) [调用你在循环中的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1653) [这就是你在做的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1654) [被请求的首要工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1655) [这其中有一个副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1656) [好 如果没有人读取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1659) [这个副作用的结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1660) [那你就是在反复地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1662) [进行多余的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1663) [你通常可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1665) [通过使用成批的接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1667) [得到一个更加有效的接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1668) [在这里客户端会给你一系列的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1670) [或者某种集合 包括所有要完成的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1672) [以便你能够一次性地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1673) [计算那个副作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1674) [那么 有时你有很多个客户端 对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1677) [你无法对它们进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1679) [你无法对它们进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1679) [批量处理 那也没关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1680) [你仍然可以通过推迟工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1682) [以及缓慢地进行工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1683) [来获得一样的性能风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1684) [第三种提高你的性能的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1689) [简单的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1690) [是检查整个 Instruments 的轨迹](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1691) [来寻找你看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1694) [对同样的东西进行反复计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1695) [的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1697) [比如说 有一个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1698) [在它计算某个文档的大小的过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1699) [你看到同样的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1700) [在之后的几帧中也出现了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1702) [对于相同的文档](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1704) [不断地重复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1705) [好 在这样的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1707) [当然 你肯定想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1708) [一次性计算出该值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1709) [在最顶端计算它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1712) [让它不断地传下去 或者缓存它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1713) [另一个你可以在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1716) [UI App 中使用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1717) [就是考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1718) [你使用了多少视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1721) [来渲染你的 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1722) [使用一些带有小的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1723) [函数集的很小的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1726) [然后再将它们一起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1728) [生成大的函数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1730) [以此来组织你的源代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1731) [这是很好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1732) [但是你使用的视图越多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1733) [你就越难负担绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1735) [进行系统的布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1737) [现在 这是一条双向道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1739) [现在 这是一条双向道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1739) [因为更小的视图通常会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1741) [让你有更多精密的捕捉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1742) [它们也可以提高你的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1744) [但是一般来说 你可以微调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1747) [你拥有的视图的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1748) [以对性能产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1750) [显著的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1751) [但视图更少的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1752) [也并不都是最好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1754) [否则我们所有的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1756) [都会只有一个包括所有内容的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1757) [巨大视图了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1758) [另一个经常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1761) [用到的方法就是直接观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1762) [我们的源代码中通常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1765) [有两个松散耦合的方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1766) [也许它们彼此知道对方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1770) [而它们是通过一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1771) [间接的机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1773) [进行交流的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1774) [也许它们用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1776) [NS Notification Center](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1777) [一些基于代码块的回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1779) [授权或者关键值观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1781) [我常常见到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1785) [我们会有一些模型代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1786) [它们在一个循环中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1787) [被不断地改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1789) [而每次它走向循环](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1790) [就会引起许多 KVO 通告机制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1792) [当然 你其实并不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1795) [在模块代码中看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1796) [但是在一些其他的控件里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1797) [它会十分活跃地作出回应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1799) [它会十分活跃地作出回应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1799) [并试图与模块里的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1800) [保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1801) [这时你就花费了许多 CPU 时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1803) [最终当你考虑整个的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1804) [变化的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1806) [这些都是多余的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1807) [那么 如果这是模块代码中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1809) [直接调用 那么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1812) [不论是通过通告机制或授权](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1813) [还是手动进行基于代码块的回调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1815) [改变都会发生地更加明显](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1817) [当你编辑该模块代码时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1819) [你也许认为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1821) [将一些通告机制从循环中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1822) [拖出到循环之外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1824) [以对性能产生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1826) [较大的影响 是完全合适的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1827) [那么 或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1830) [在控件这边 你可以用这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1831) [推迟和批量处理方法中的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1833) [来避免多余的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1835) [只是它们的回应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1836) [是不同步的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1838) [最后 这是最简单的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1841) [一旦你的代码已经在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1842) [一个很好的路径上了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1845) [你知道 它已经是线性的了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1846) [而且不会有比线性更好的了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1847) [这是一种你要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1849) [获得的最低性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1851) [毕竟 你要尽可能地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1853) [改进常数时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1854) [那么 很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1857) [如果你将词典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1858) [如果你将词典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1858) [作为对象使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1860) [那你或许已经看到这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1861) [如果你有一堆为秘钥准备的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1862) [字符串常数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1864) [那么你就可以大幅度提高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1866) [代码的清晰性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1867) [提高代码完成和重构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1869) [以及源代码验证](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1871) [通过使用特定的形式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1872) [用它们的 strucks 和 swift](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1875) [用它们隐含的初始化器和一致性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1876) [来平等哈希值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1878) [这再简单不过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1879) [而这能轻而易举地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1881) [改进你的源代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1883) [如果你在许多小目标上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1884) [完成数百万次的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1886) [字符串哈希映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1887) [和字符串 equation 的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1889) [你会惊讶于你花费了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1891) [多少时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1892) [那么接下来的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1894) [我想请 Matthew 上台来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1895) [谈谈我们如何将这些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1897) [应用到“照片”中去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1899) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1902) [&gt;&gt; 谢谢 Jim](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1908) [大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1909) [我是 Matthew Lucas](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1910) [一名“照片”团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1912) [今天我想给你们一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1916) [直接从“照片”中来的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1917) [实用的性能的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1919) [实用的性能的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1919) [那么首先 让我们先来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1921) [简单谈谈“照片”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1922) [我们都十分熟悉这个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1924) [它可以供你存储 浏览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1926) [并体验你最喜爱的时刻](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1927) [因此你可以浏览你最喜欢的时刻](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1930) [从这个“时刻”视图里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1931) [在这里可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1933) [这是默认视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1934) [但是你也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1935) [切换到另一种视图“精选”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1937) [或者“年度”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1939) [这个我一会再细说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1940) [现在图片库里可以有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1943) [1000 到 100000 张先前的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1945) [这取决于你对拍照的喜爱](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1949) [我们都喜欢捕捉每天的生活中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1951) [那些快乐而珍贵的瞬间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1953) [所以我们都很耐心地去捕捉它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1956) [但是当这样的事发生时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1957) [我们并不是那么地有耐心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1958) [在你启动“照片”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1961) [这个 App 的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1962) [如果你的“时刻”变成了这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1964) [你会有什么感受](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1965) [那么 你也许](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1967) [还会遇到这样的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1968) [在这里只有许多的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1970) [空白图片框 这样看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1971) [并不是非常好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1973) [也许你轻轻滑动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1974) [这个灰色的地方就会消失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1975) [照片就会开始加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1977) [照片就会开始加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1977) [但你继续滑动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1980) [你就会遇到一些掉帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1981) [因为视图被更新了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1982) [好 我们的目标就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1985) [不要出现这样的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1986) [我们认为这种视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1988) [并不是好的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1989) [但是我们知道有时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1992) [这是不可避免的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1993) [但是当它过于频繁时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1994) [就无法忍受了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1995) [现在 当你运行一个 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1998) [你想要确保它一开始就能用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=1999) [能够做出响应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2000) [你还要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2003) [动画是很流畅的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2005) [而这两个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2007) [对用户体验来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2010) [都是十分重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2011) [如果用户发现你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2013) [并不相关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2015) [他们也许不会再使用它了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2017) [现在我来举例说明这两点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2019) [我要给你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2020) [举两个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2022) [第一个就是我们如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2023) [对这个“时刻”视图的启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2025) [进行优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2027) [第二个则是我们如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2028) [创建这个“精选”和“年度”视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2030) [以更好地适应用户的偏好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2032) [首先是启动“时刻”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2036) [[ 音质不清晰 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2040) [那么什么是启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2042) [我们有三种启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2044) [第一种也是更为昂贵的一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2046) [即我们所说的冷启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2048) [它取决于在重启后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2049) [第一次重新启动你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2051) [所以里面基本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2054) [还没有缓存任何东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2055) [也许你需要载入一些后台过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2057) [或者一些库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2059) [下面在这样的情况也会冷启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2061) [系统在内存压力下运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2063) [开始回收一些内存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2064) [那么 如果你关闭一个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2070) [也许不会触发代码运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2071) [因为是系统决定了资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2072) [应该何时被放在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2074) [页面上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2078) [而如果你关闭了一个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2079) [然后几秒之后重新打开它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2080) [几乎可以肯定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2081) [你进行的是一个热启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2083) [我们称其为热启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2086) [是因为资源或从属的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2087) [都仍然在缓存里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2090) [所以它能更快地启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2092) [那么 最后一种类型就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2094) [我们所说的热启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2096) [根本上说它就是继续启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2099) [根本上说它就是继续启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2099) [因为这时 App 已经处于运行状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2100) [直接把它带回前台就可以了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2102) [所以当你开始测量启动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2105) [你应该从测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2106) [热启动开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2107) [它所用的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2109) [要比冷启动所花的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2112) [变量更小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2114) [而测试迭代也更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2117) [因为你不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2118) [重启你的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2119) [那么 我们用来测量启动的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2121) [是对从你点击这个 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2123) [的图标的那一刻](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2125) [到你可以开始与你的 App 进行互动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2126) [的整个时间进行评估](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2128) [我说互动的意思就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2130) [它真的可以使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2132) [而不再有旋转的圈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2134) [它通常会在显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2137) [这个旋转的圈的同时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2138) [分派一些工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2140) [但并不能让 App 更快地投入使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2141) [所以我们想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2143) [避免这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2144) [现在 我们有三个针对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2147) [“照片”的目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2148) [第一个就是我们想要瞬时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2150) [我们不想出现任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2152) [等待的圆圈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2154) [我们不想出现任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2157) [空白的图片框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2160) [坦白地说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2163) [你也许会看到一些空白图片框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2164) [在你第一次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2166) [同步 iClub 的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2167) [但是当数据本地化后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2169) [就尽可能地不显示了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2171) [那么 我所说的瞬时是什么意思呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2173) [就是它启动所花的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2176) [应该和从主屏幕上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2177) [放大的动画过程的时间 保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2178) [这个时间通常是 500 到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2181) [600 毫秒之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2182) [这样一来 从主屏幕到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2185) [App 的转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2186) [就是无缝连接的了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2187) [用户可以立刻与 App 互动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2189) [只要它显示完动画过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2191) [顺便说一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2193) [这是最基本的建议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2194) [这不只是给“照片”的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2195) [所以它适用于所有的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2197) [那么让我们来看看“照片”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2200) [现在是如何启动的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2201) [如果我们近距离地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2203) [看看到底发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2204) [你就能看到“照片”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2206) [在动画过程完成之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2208) [就已经准备好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2210) [如果我们深入剖析这个启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2213) [我们就会看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2215) [这里主要有两个部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2217) [第一部分时间花在 DYD 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2218) [第一部分时间花在 DYD 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2218) [这是载入器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2220) [它将加载并连接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2222) [你所有的动态链接器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2223) [而它还要运行你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2225) [静态初始化器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2226) [虽然你对这部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2228) [的控制是有限的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2230) [但也有可能做到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2231) [我鼓励你们去看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2232) [去年 DYD 的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2234) [就能得到这个方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2238) [更多的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2241) [那么 DYD 也要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2243) [在你的项目表中调用 Main](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2245) [这就将我们带到了第二个部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2247) [在这里你有很多控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2249) [这个部分里 你需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2250) [将它的时间保持在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2252) [500 毫秒以内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2254) [现在 第一个布局正好被排在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2255) [Did Finish Launching 之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2258) [它将标记启动的结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2260) [而这时你基本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2261) [就可以使用你的 App 了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2262) [在这个部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2266) [我们将要提到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2267) [一些原则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2269) [它们的确是我们在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2271) [进行性能工作时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2272) [最大的收获](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2273) [第一是我们需要惰性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2275) [推迟我们不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2276) [的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2279) [的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2279) [第二则是要积极主动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2281) [而这两个方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2282) [都有它的效用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2284) [积极主动能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2285) [十分有效地预料](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2288) [我们之后要做的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2289) [我们想要积极主动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2292) [快速捕捉到衰退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2293) [因而你要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2295) [你设置了连续的综合测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2296) [最后一点就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2301) [无论我们总共需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2303) [加载多少数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2304) [我们都要持续不变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2306) [现在 如果我们用这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2309) [我们载入所有在启动中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2311) [要用到的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2312) [这是它大概会在一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2314) [有 30000 项的库里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2315) [花费的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2317) [首先你需要初始化数据库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2319) [然后你需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2321) [准备一些视图控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2322) [接着需要配置数据资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2324) [加载一些库图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2325) [然后读取云状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2327) [你要记住 这个时间也许会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2329) [随着数据的生长发生变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2332) [而其实数据将会一直生长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2334) [只要人们每天都拍照](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2336) [所以在“照片”里一定要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2340) [我们要处理的是没有边界的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2341) [数据集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2342) [那么让我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2345) [如何优化“照片”的每一个步骤](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2347) [就让我们从初始化数据库开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2349) [首先 数据库通常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2353) [是在执行第一个查询的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2355) [被初始化和载入的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2356) [我们发现了一个非常](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2358) [值得优化的地方 就是尽快地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2359) [在后台线程中完成初始化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2361) [这样它就不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2362) [在执行第一个查询时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2364) [再进行初始化工作了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2366) [这是个问题 特别是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2368) [如果第一个查询已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2370) [从主线程当中完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2372) [现在 我们已经花了很多时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2374) [而我们仍要花费很多时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2379) [来检查我们在启动过程中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2380) [所有的查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2381) [我们想要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2383) [我们正在做的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2384) [是必要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2386) [我们不再做更多的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2387) [那么最后 我们要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2393) [我们所做的所有查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2396) [都要尽可能地高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2397) [我们也想尽可能地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2399) [我们也想尽可能地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2399) [避免复杂的查询](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2401) [我们有时知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2405) [我们需要这样做 针对这类情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2406) [我们设置了一些索引](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2408) [以便我们能提高速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2410) [现在我们的目标是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2415) [在初始化上花费的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2417) [不超过 30 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2419) [那么接下来让我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2421) [我们如何准备视图控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2422) [这里我们有四个标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2425) [呈现在 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2425) [主要特性上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2427) [那么我们需要注意的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2429) [就是我们想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2430) [通过做最少的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2432) [来初始化这三个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2433) [不可见的标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2435) [这里我们要遵循的原则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2437) [就是做尽可能地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2439) [少的工作来进行初始化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2441) [我们想要将工作最小化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2444) [同时记录载入的视图中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2445) [所有的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2447) [这也让我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2450) [在恒定时间内](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2452) [初始化我们的控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2454) [那么最后 我们想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2458) [确保我们只加载了可见视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2459) [确保我们只加载了可见视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2459) [这很简单 而我们通常是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2462) [在那个部分出现衰退的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2466) [因此你应该格外小心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2467) [那么在准备视图控件的工作上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2472) [我们现在的目标是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2472) [花费 120 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2474) [但是准备视图控件意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2476) [要配置数据资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2478) [接下来我们就来看这一块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2479) [所以在“时刻”视图里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2485) [会呈现出这些东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2486) [呈现你生活中的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2487) [而 UI 则通过获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2490) [这组照片来呈现出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2491) [这些标题栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2492) [比如说在这个图库中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2494) [我们也许有 500 张照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2495) [为了创建一个视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2498) [我们需要预先加载所有的图片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2500) [但是我们只是需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2503) [这些照片的元数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2504) [这样我们就可以创建视图了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2506) [我们不需要你的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2509) [因此我们首先要做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2511) [执行那个超高速的询问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2514) [然后我们只加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2516) [我们这里需要的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2519) [我们这里需要的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2519) [既然是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2522) [我们只要加载可见内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2524) [在我们这个例子里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2525) [可见内容在 7 到 10 个图片之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2527) [因为我们的可见内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2530) [是有限值 所以我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2532) [在主线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2534) [同时进行加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2536) [同时 我们还想预先安排工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2538) [这样我们就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2540) [开始异步加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2543) [剩下的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2545) [我们在后台线程上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2547) [以正确的特性进行加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2548) [来确保它不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2550) [抢占主线程的运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2551) [在这里我们的目标是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2558) [100 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2560) [那么最后 我们的数据源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2564) [还提供一些图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2568) [我们来看看如何优化这个部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2570) [所以目前为止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2573) [这是我们面对的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2574) [最大的数据块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2575) [当我们意识到在启动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2577) [我们花费了好几秒的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2579) [我们花费了好几秒的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2579) [来加载这个图像 我们就意识到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2580) [我们做了太多的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2582) [所以我们所做的第一件事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2585) [就是估计我们在启动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2586) [需要用到多少张图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2588) [然后在第一个事务中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2590) [我们只加载那些图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2592) [这种情况下 这一数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2595) [可以达到 60 张](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2597) [包括上下堆起的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2599) [接下来 为了先加载那些图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2600) [我们需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2603) [我们只加载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2605) [低分辨率的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2606) [这样我们加载在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2608) [内存里的像素就越少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2609) [这样就能更高效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2612) [呈现出这个数据块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2615) [现在需要 200 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2616) [这是目前为止](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2619) [我们提速最多的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2620) [我要它成为一个常数时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2622) [真的很不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2623) [那么 有时候你禁不住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2627) [问问自己这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2629) [这在启动的时候真的需要吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2630) [我们这里的一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2632) [是页脚视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2634) [它通过网络或数据库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2635) [来搜集信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2637) [来搜集信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2637) [而其实我们最先的设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2640) [是不要在启动时显示它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2641) [以优先所有我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2644) [在这里看到的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2645) [我们想要显示尽可能多的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2646) [那这样可能就更简单了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2649) [我们现在只要安排](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2651) [启动后的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2652) [我们缓存并加工之后要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2654) [显示的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2656) [现在 如果我们已经需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2660) [显示这个信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2661) [有一个方法可以办到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2662) [利用后台来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2664) [从 UA 工具包中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2665) [刷新 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2667) [它便会主动清除你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2669) [这样当用户要启动 App 的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2671) [你就可以开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2672) [准备一些内容了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2673) [所以现在 这个部分已经从启动中删除了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2677) [为我们节省了 400 秒的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2678) [CPU 时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2680) [现在我们看这里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2683) [更新后的分解图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2685) [可以看到这些工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2687) [只值得花费 450 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2688) [而我们现在在这个 500 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2690) [窗口之中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2693) [而且不论如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2695) [将其同时呈现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2698) [最重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2699) [最重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2699) [一定要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2701) [你要考虑你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2702) [准备内容的时间成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2703) [我这里说的考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2705) [是要真的去测量它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2707) [现在 你应该争取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2710) [在常量时间里进行工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2712) [无论你加载的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2713) [数据总共有多少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2714) [在我们的例子里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2716) [我们的确有许多数据集](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2717) [我们需要保持常量时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2719) [既然我们已经启动了 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2724) [我们要开始使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2725) [那么我们来看看我们是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2727) [如何创建“精选”和“年度”视图的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2729) [以便我们提高性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2730) [正如我之前提到过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2731) [我们的用户能够进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2734) [从动画过程到“时刻”视图的无缝转换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2737) [再通过“精选”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2739) [到“年度”视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2740) [这是一个复杂的层级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2744) [我们要展示数千张的照片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2746) [我们要支持实时更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2749) [我们也要支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2751) [这些图层间的动画过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2753) [我们还有一些手势](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2755) [那么 我们这里还有一些目标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2760) [对于带给我们用户的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2762) [第一个和之前一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2766) [我们不想有任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2767) [等待的圆圈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2768) [我们不想有空白的图片框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2769) [当然我们想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2770) [流畅的动画过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2772) [这里所说的流畅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2773) [是指 60 到 120 帧每秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2775) [这依赖于你正在运行的屏幕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2779) [记得之前我们说过的原则](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2783) [现在 它们在这里都是有用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2785) [我们想要懈怠并推迟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2787) [我们预先递交的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2788) [我们想要积极地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2790) [快速捕捉衰退](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2791) [但是我们也想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2794) [在布局关口中保持不变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2795) [无论我们要加载多少数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2797) [那么 这次我们还想要及时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2801) [我们想要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2802) [绘制循环周期](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2804) [这里我的意思是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2807) [你要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2808) [我们只有 8 或 16 毫秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2809) [来绘制那一帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2812) [所以我们需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2813) [我们不超时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2814) [否则就会开始掉帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2815) [现在 让我们返回一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2819) [现在 让我们返回一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2819) [看看我们要在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2821) [获取什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2822) [我们要这个便捷视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2823) [里面有分栏和小单元格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2825) [而这基本上就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2829) [“精选”视图给你提供的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2831) [对吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2832) [只不过在这样极端的例子里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2833) [我们会限制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2835) [我们使用这个基本的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2836) [可以获得的极限](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2837) [那样就会导致过多的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2838) [视图和过多的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2840) [但是随着分层的复杂性不断增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2843) [花在内存上的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2846) [也在不断增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2848) [所以这里我们需要创新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2851) [我们大幅地限制视图的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2853) [同时仍使用一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2855) [“精选”视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2856) [我们使用的这种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2860) [在电子游戏里更为常见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2862) [它叫做图谱法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2863) [它基本上就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2865) [把一组图像组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2867) [成为一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2868) [我们高效地完成了它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2870) [开始只用很小的缩略图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2872) [然后我们将所有的原始图像数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2873) [标记在一个我们用作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2876) [带状的画布上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2878) [接着 我们使用图像原始数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2881) [这样就能够避免去解码每一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2883) [我们发送的缩略图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2884) [因此基本上我们会显示一条](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2888) [随机的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2889) [那么 我们飞速生成并缓存它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2892) [因此我们可以更加灵活](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2894) [当我们将多个图片绘制成一个时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2898) [我们会大量寄存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2900) [单元格 图层及目标的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2902) [这样便简化了布局](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2904) [节省了创建它要花费的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2906) [现在这样很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2909) [但是也要有所取舍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2911) [这就是它们的其中一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2912) [如果有人试着长按](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2916) [或强制搜索一个这里的项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2918) [我们就需要计算它的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2920) [这样我们才能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2922) [正确地获得预览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2924) [因为只要我们显示一张图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2925) [我们就需要维持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2928) [每个图像的映射](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2930) [以及它的绘制条](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2933) [现在你也许在想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2936) [我们为什么要飞速地生成它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2937) [我们要支持实时更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2940) [这就是原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2941) [我们也需要不一样的视图大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2944) [比如说 我们这里有风景图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2947) [但也有人像图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2949) [但是这没有关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2952) [因为我们的用户增长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2956) [在很长一段时间里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2957) [是十分典型的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2958) [而我们需要生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2960) [数千张图像这样的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2962) [相当地罕见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2964) [现在 你或许想知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2967) [那我们为什么不生成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2969) [整个这部分呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2970) [答案就是我们的设计记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2972) [就是完成这个动画过程](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2973) [在这里你能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2975) [在“精选”视图中它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2976) [都扩展到自己的那部分中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2977) [或者相反地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2979) [折叠进它们的小组里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2980) [所以如果说第二部分里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2985) [你只要记住一件事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2987) [那就是你应该考虑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2988) [你的层级的布局成本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2989) [然后对它进行测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2990) [最后 你要时刻考虑性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2996) [在“照片”里我们十分关心这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2999) [在“照片”里我们十分关心这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=2999) [这正是我们日常工作的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3001) [要了解更多的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3004) [你们可以观看我在这里提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3006) [三个实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3009) [祝你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3010) [参会愉快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3012) [谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3013) [［ 掌声 ］](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/407/?time=3014)