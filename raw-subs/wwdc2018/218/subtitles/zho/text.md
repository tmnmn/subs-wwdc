# Advanced Dark Mode

## Summary
Step deeper into Dark Mode adoption in your macOS application. Learn about the powerful Cocoa technologies at the core of Dark Mode, and take a detailed look at the APIs and best practices for adapting to this beautiful new look.

## Info
* Frameworks
* WWDC 2018 - Session 218 - macOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=7) [&gt;&gt; 大家早上好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=17) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=19) [哇 谢谢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=20) [欢迎来到升级版的深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=24) [我是 Matt Jacobson](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=26) [我的同事 Jeff Nadeau](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=27) [一会儿也会上台来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=29) [我们都是 Apple Cocoa 框架团队的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=30) [我今天非常激动能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=34) [与你们谈谈 Mojave 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=36) [超赞的深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=39) [你们已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=40) [从昨天的介绍会上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=45) [了解了如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=48) [将你的 App 改为深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=50) [比如在 macOS 10.14 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=52) [上对 App 进行重建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=54) [使用动态色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=55) [来代替静态或硬编码色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=58) [来代替静态或硬编码色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=58) [正确使用模板图像和素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=61) [最重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=65) [利用 Xcode 10 的新功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=67) [来定义深色模式专用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=69) [自定义颜色和图像素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=71) [如果你需要再回顾一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=75) [这些话题 那么我十分推荐](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=77) [你之后再去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=78) [看看昨天介绍会的视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=80) [只需利用那些技巧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=84) [大多数 UI 在深色模式中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=87) [就会看起来很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=88) [其实 我们的一些系统 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=89) [并不需要额外的改变 这非常好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=91) [但在某些情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=94) [只凭那些技巧还不够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=96) [这就是我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=97) [在这场会上要讲的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=98) [今天我们将涵盖六个主要的方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=103) [首先是外观系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=107) [它是怎样运作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=110) [要如何在自定义视图里使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=111) [第二是素材 什么是素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=114) [如何才能在你的 UI 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=117) [充分利用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=119) [充分利用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=119) [接下来的部分由 Jeff 介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=122) [他将谈谈 “Vibrant Blending（动态混合）”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=123) [这种方法很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=125) [会让你的视图看起来更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=126) [他还会讲到用一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=129) [叫做背景风格的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=131) [对选择做出正确的反应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=133) [最后 他会综合起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=135) [说说如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=137) [当你在旧的 macOS 版本上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=139) [使用你的 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=141) [仍然能支持深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=142) [还有一些小技巧和方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=145) [来帮你改进 App 的深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=147) [好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=150) [我们开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=150) [在 Mojave 中 你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=153) [无论在浅色还是深色模式都要看起来很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=156) [这个时候你就要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=160) [用到一个叫做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=161) [NSAppearance 的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=162) [NSAppearance 是整个 Cocoa 都在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=165) [使用的主题系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=167) [关键是你只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=169) [保持一个单一的视图层级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=171) [NSAppearance 就会让你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=173) [在浅色和深色模式中都很好看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=175) [好了 除了用作深色模式的核心外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=179) [好了 除了用作深色模式的核心外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=179) [我们已经使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=181) [NSAppearance 好几年了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=183) [同时它还是一些特性的基础](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=185) [如 macOS 的高对比度模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=188) [以及为触控栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=190) [这个出色的硬件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=192) [设计的 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=194) [我们先前已经有了一个主要外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=196) [为 Aqua 窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=200) [准备的浅色外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=201) [叫做 Aqua](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=203) [当然 在 10.14 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=204) [我们要引入一种新的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=206) [用于深色模式下的 Aqua 窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=207) [叫做 darkAqua](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=210) [这些对象包括所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=212) [视图绘制所需的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=213) [因此 只要你使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=216) [系统动态色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=218) [标准效果 或已命名的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=219) [甚至只是标准的 Cocoa 控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=222) [这些对象都会为你提供素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=223) [只要你关联了 macOS 10.14 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=226) [AppKit 就会自动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=229) [基于系统偏好设置里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=231) [用户对浅色或深色的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=233) [为你所有的视图和窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=235) [提供相应外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=236) [这是我们可爱的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=240) [《Chameleon Wrangler》App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=242) [是 Rachel 和 Taylor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=243) [在之前的介绍会中创建的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=246) [你可以看到 如果我们将它与 macOS 10.14](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=248) [SDK 关联  AppKit 就会开始运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=250) [并自动给它设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=253) [darkAqua 外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=254) [这样很好 但如果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=256) [我们想要改变外观呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=258) [比如说 我们想要改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=260) [这个笔记的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=262) [在深色的外观下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=266) [我们也许想要让](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=269) [笔记的视图仍然是浅色的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=270) [这时 你就可以利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=273) [NSAppearanceCustomization](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=277) [这是一个协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=279) [但它不是那种需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=281) [你在 App 中应用的协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=282) [它已在 NSView 和 NSWindow 中应用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=285) [在 Mojave 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=287) [NSApplication 也会遵循这个协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=290) [它是个相当简单的协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=293) [只添加了两项属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=294) [第一是 appearance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=296) [这里你可以重写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=298) [这里你可以重写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=298) [一个特定对象的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=300) [它是一个可选择的 NSAppearance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=303) [因为如果你将它的参数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=305) [设置为 “nil” 那么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=307) [该对象只会继承](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=309) [父对象的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=310) [第二个是 effectiveAppearance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=313) [这是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=315) [只读属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=317) [你可以用它来找到一个视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=319) [会用什么外观来绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=322) [当然 要利用这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=323) [你得有个正确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=326) [NSAppearance 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=328) [你可以用 NSAppearance 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=330) [named: 初始化语句来轻松完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=332) [根据你想要的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=334) [只要传入“.aqua”或“.darkAqua”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=338) [你就能继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=341) [将其指定为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=342) [所要定制的对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=344) [外观属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=345) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=347) [我们将指定 Aqua 外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=349) [给 textView 的外观属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=351) [现在 它就变成浅色外观了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=352) [好的 这个很简单 所以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=354) [我们来看下一种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=359) [我们来看下一种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=359) [你可能会有一个窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=362) [像这样悬浮在某个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=364) [特定视图下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=366) [你可能想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=367) [将它的外观与其所在的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=369) [保持一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=371) [那么 我们可以直接指定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=372) [Aqua 外观给这个窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=375) [就像刚刚那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=376) [但是 我们真正想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=378) [不仅如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=380) [我们想要它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=381) [继承视图中的外观 我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=383) [就可以这样做 首先 AppKit](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=386) [会自动地在一些常用窗口中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=388) [继承视图的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=390) [如菜单 弹出框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=391) [工具提示和工作表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=394) [因此你不需要担心这些窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=396) [但是 对于这样的自定义窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=399) [在 Mojave 中有一个新的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=401) [可以供你使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=403) [叫做 appearanceSource](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=406) [这是一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=409) [能使任何对象都遵循](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=411) [NSAppearanceCustomization 协议的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=414) [包括视图和窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=415) [你只要为其指定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=417) [你只要为其指定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=417) [appearanceSource 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=420) [该窗口就会从该对象中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=424) [继承视图的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=426) [那么 在这里 我们将 testView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=428) [指定到该子窗口的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=431) [appearanceSource 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=432) [这样一来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=434) [textView 的外观就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=436) [一直继承该视图的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=438) [其实 你可以将外观系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=442) [想象成一种层级结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=444) [与你可能比较熟悉的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=447) [视图层级类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=449) [但要将其扩展到窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=451) [以及 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=452) [当我们要求 AppKit 给出一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=454) [视图的有效外观时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=457) [AppKit 就会沿着这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=459) [层级结构走下去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=461) [直到找到一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=463) [有具体外观的对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=465) [那便是我们使用的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=467) [好 现在 我们知道了对象如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=469) [获得外观 以及外观系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=473) [是如何运作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=474) [下面我们就来谈谈如何在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=475) [自定义视图和控件中使用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=477) [举个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=479) [举个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=479) [如果我想要让这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=480) [自定标头视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=482) [在浅色和深色的外观下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=484) [使用不同的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=487) [现在 我们已经知道在 Xcode 10 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=489) [我可以进入素材目录编辑器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=491) [为浅色或暗色主题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=493) [设置特定的色彩素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=495) [但怎样在我的自定视图中使用它呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=498) [好 下面我要演示的这个方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=502) [看起来很靠谱 但其实行不通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=504) [我会告诉你为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=506) [首先 我们将给我们的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=508) [添加一个 NSColor 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=510) [初始化状态下 我们将用该颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=512) [填充我们的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=514) [而如果颜色改变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=518) [我们也将开始更新相应的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=521) [让我们来试试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=524) [好 在浅色模式下看起来很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=526) [但是如果我们转为暗的状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=528) [就能看到我们的颜色其实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=531) [并没有改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=532) [这是因为即使](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=535) [我们的 NSColor 是动态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=536) [所得到的 cgColor 也是静态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=539) [所得到的 cgColor 也是静态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=539) [它不会随外观而改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=540) [因为我们在初始化程序段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=543) [已经设置了图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=545) [那么在外观改变时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=548) [我们无法运行任何代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=549) [重点就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=551) [要把你随外观改变的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=554) [放到特定的区域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=555) [具体来说 就是使用 NSView 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=559) [updateConstraints() layout() draw()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=561) [以及 updateLayer() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=563) [这样的话 当外观改变时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=567) [如有需要 AppKit 就会自动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=569) [调用这些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=571) [如果你需要手动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=572) [触发它们 你当然可以一直使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=574) [needsUpdateConstraints](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=576) [needsLayout](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=578) [和 needsDisplay 这些属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=579) [AppKit 会自动调用它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=582) [好 现在回到我们的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=586) [与其重写 init](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=588) [我们可以执行 updateLayer()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=590) [接着 就可以放心地通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=593) [向我们的 NSColor 请求一个 cgColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=597) [来填充我们的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=599) [来填充我们的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=599) [如果只有颜色变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=601) [而那里的图层却没有更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=603) [我们就只需要将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=605) [needsDisplay 属性设置为真](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=607) [AppKit 会自动回来并调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=609) [updateLayer()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=612) [好 现在再看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=614) [在浅色的状态仍然看起来很好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=616) [现在 在深色的状态下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=617) [它的颜色正如我们所愿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=621) [效果很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=622) [好 如果我们想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=625) [做一些更复杂的东西怎么办](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=627) [如果仅仅用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=628) [动态色彩或者图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=629) [可能不太容易表达](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=631) [例如 也许我想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=633) [在 Chloe 美丽的脸庞后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=635) [加点这种白色的光晕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=638) [但只是在深色模式下我会怎么做呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=640) [好 这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=644) [我们在 Mojave 中会有新的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=646) [你可以用它来与你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=649) [视图外观相比对](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=650) [我来示范一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=651) [在这个视图下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=653) [我会重写 layout() 方法 并开启](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=656) [effectiveAppearance.bestMatch(from:)](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=658) [effectiveAppearance.bestMatch(from:)](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=658) [我会通过一个数组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=661) [该数组有我的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=665) [所知道的全部外观的名字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=666) [在这里是 Aqua 和 darkAqua](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=668) [接着就只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=671) [给这些外观一一执行动作了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=674) [那么 对于 Aqua 外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=677) [我会只把我含有 Chole 大头照的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=679) [imageView 作为一个子视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=681) [而对于 darkAqua 外观 我不仅](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=684) [要用 imageView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=687) [还要在后面加上 glowView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=688) [最后 我会执行一个默认 case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=693) [这是为了我的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=695) [所不了解的默认外观而设](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=698) [包括将来 Apple](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=700) [可能发布的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=703) [好的 让我们看看现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=705) [看起来怎么样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=707) [现在 是浅色的外观下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=708) [没有光晕 是我们想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=710) [切换到深色外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=712) [就有光晕了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=714) [很好 好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=715) [下面让我们谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=718) [高对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=719) [高对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=719) [我之前说过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=721) [我们已经将 NSAppearance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=722) [用作 macOS 的高对比度模式了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=725) [为了支持深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=728) [所做的一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=730) [带来的好处之一就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=731) [让支持高对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=732) [变得十分容易](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=734) [提醒一下 高对比度是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=739) [通过勾选系统偏好设置里的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=741) [“提高对比度”复选框来实现的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=743) [在这种模式下 色彩改变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=746) [所以控件边界](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=749) [和其他各种边界](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=751) [都更容易看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=752) [现在 这种模式下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=756) [AppKit 会自动将 Aqua](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=758) [和 darkAqua 外观替换为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=761) [高对比度外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=763) [而这些高对比度外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=765) [继承了他们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=766) [正常对比度的版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=768) [那么 这就意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=770) [你所编写的任何利用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=773) [深色模式的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=774) [都会自动适用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=776) [高对比度的深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=778) [但你还可以更进一步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=780) [在 Xcode 10 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=782) [如果你在素材目录编辑器中选中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=784) [这个 “High Contrast（高对比度）”复选框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=786) [你可以特别为该外观的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=788) [高对比度版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=790) [指定颜色和图像素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=793) [你也可以在代码中使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=797) [那些外观的名字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=800) [你也许会忍不住想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=801) [唔 很好 我只要把它们传入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=804) [NSAppearance 主题就好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=806) [然后我会获得 NSAppearance 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=807) [再继续做点什么 但这行不通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=809) [那些外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=812) [只在系统偏好设置中可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=814) [而你能做的是把它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=816) [传给 bestMatch(from:)](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=819) [像之前我们在深色模式做的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=821) [执行自定义编程行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=822) [好的 我们再来说说子图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=828) [我知道你们许多人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=831) [都有管理着子图层的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=832) [我们要注意 关于深色模式的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=836) [一些很重要的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=838) [首先 你需要知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=841) [自定义子图层不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=843) [自动继承你的视图的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=845) [现在 最简单的修补方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=848) [就是将他们从子图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=852) [转换为子视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=853) [如果这么做了 那么 AppKit 就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=855) [自动处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=857) [那些视图的外观继承](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=859) [就像其他视图一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=862) [否则 你就必须](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=865) [手动管理那些图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=867) [用几种我下面提到的技巧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=869) [viewDidChangeEffectiveAppearance()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=870) [以及代表当前外观的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=873) [NSAppearance.current](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=875) [好 先是 viewDidChange](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=876) [EffectiveAppearance()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=879) [这是一种 NSView 中的新方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=881) [你可以进行重写来发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=884) [视图的有效外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=887) [什么时候发生改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=888) [这是执行所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=891) [可能需要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=892) [自定义禁用或释放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=893) [任何不再相关的缓存的好时机](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=896) [但是记住 你不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=898) [但是记住 你不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=898) [使这里的视图本身失效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=900) [AppKit 会自动为你完成这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=902) [第二点 “当前外观”的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=907) [现在 这是一个线程局部变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=910) [你可以通过一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=912) [NSAppearance 上的类属性来访问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=914) [如果你比较熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=917) [如 NSGraphicsContext.current](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=920) [或 NSProgress.current 这样的概念](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=921) [你就已经明白了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=922) [我在说什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=924) [如果你不熟悉 只要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=925) [这是用作解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=927) [动态色彩和图片的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=929) [AppKit 会在我们调用那些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=934) [我们之前所说的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=935) [特殊的 NSView 方法之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=937) [自动为你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=939) [建立当前外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=940) [如 updateConstraints() layout() draw()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=941) [以及 updateLayer() 方法 但你也可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=944) [在必要时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=947) [自己进行建立](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=949) [那我们来看一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=950) [说明你为什么可能这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=951) [好 这是一个包括了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=955) [一些子图层的自定义视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=957) [我会重写这个新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=960) [viewDidChange](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=962) [EffectiveAppearance() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=963) [再给我的子图层设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=965) [NeedsDisplay()](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=967) [而如果我没有进行这些设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=968) [我的子图层不会随着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=970) [视图的有效外观的变化而更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=972) [它只会保持原样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=974) [接着在我的图层委托子程序里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=975) [我会保存当前外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=979) [以备之后使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=981) [接着我会继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=982) [把我的当前外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=984) [设置成 effectiveAppearance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=986) [然后我就可以继续更新我的图层了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=987) [这时 如果我之前没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=992) [设置当前外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=994) [那这个代码就不会使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=996) [我视图的外观 那样看起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=998) [就不对了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=999) [最后 到这一步 我只要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1001) [还原先前的当前外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1002) [如果你在管理图层的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1008) [这里还需要注意一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1009) [你或许已经有一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1012) [看起来像之前两个例子之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1014) [要么你要将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1016) [一个图层的内容设置为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1017) [某个 NSImage 要么你就要使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1019) [某个 NSImage 要么你就要使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1019) [layerContents(forContentsScale:) API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1021) [来用某个图像为你的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1024) [创建一个 layer.contents](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1026) [如果你有这样的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1029) [你要知道图像不会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1031) [自动继承外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1032) [像之前一样 最好的修补方法就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1035) [把它切换成视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1039) [在这里要用 NSImageView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1040) [NSImageView 会自动处理到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1042) [这个细节 包括许多其他细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1043) [因此你最好这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1045) [否则 你就要为你的图层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1050) [从 NSImage 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1052) [创建一个 CGImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1055) [这时 你需要用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1056) [NSImage 中的 cgImage(forProposedRect:](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1057) [context: hints:) API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1060) [同时 你要注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1064) [应该在当前外观正确的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1066) [来做这件事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1067) [因此 最好在你的 updateLayer() 方法里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1069) [完成这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1071) [好了 这就是外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1072) [下面我们来谈谈素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1076) [好 你大概已经听过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1077) [好 你大概已经听过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1077) [素材是现在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1080) [Mac UI 的一个重要部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1082) [但你也许有过疑惑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1084) [素材究竟是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1086) [那么我就从它的定义开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1089) [素材是使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1091) [一些效果的动态背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1093) [比如模糊 渐变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1095) [着色和半透明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1098) [它们为你的 UI 提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1101) [深度 环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1104) [同时还有点美化作用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1106) [这是一个相当典型的 Mac 桌面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1108) [你可以看到我们使用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1111) [这些素材效果的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1113) [所有的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1115) [而其实 这些不是全部](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1116) [现在 AppKit 会自动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1121) [为一些常见的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1122) [提供素材 如标题栏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1124) [窗口背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1127) [表格视图 侧边栏 弹出框](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1129) [以及菜单 还有其他的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1132) [但你也可以自己创建一种素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1136) [并将其添加到你的 UI 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1138) [并将其添加到你的 UI 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1138) [这就要用到一种视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1141) [叫作 NSVisualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1142) [如果你不熟悉它 很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1144) [它是一种显示素材的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1147) [如果你想使用这种视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1150) [你要注意三个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1152) [需要设置的主要属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1154) [而我将依次地进行介绍](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1155) [包括 state blendingMode](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1157) [和 material](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1159) [首先是 state 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1163) [它决定了素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1164) [是否使用活动窗口外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1167) [默认情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1170) [素材会匹配包含它的窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1171) [当这个窗口活动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1173) [素材也会看起来出于活动状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1174) [当窗口不活动时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1176) [素材也会不活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1177) [但是你也可以将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1179) [特定的部分指定为活动或不活动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1182) [如果你想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1184) [手动控制的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1186) [第二个 blendingMode 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1189) [这个属性控制着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1191) [素材是否会穿透](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1193) [窗口的背后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1195) [下面我来给你演示一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1196) [这是“预览” App 用了两种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1199) [这是“预览” App 用了两种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1199) [不同的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1202) [一个是 这个标题栏素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1204) [如果我们把它掀开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1206) [就能看到它混合了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1209) [窗口里的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1210) [包括里面的彩色图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1212) [所以 它没有穿透到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1214) [窗口的后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1216) [这是一个侧边栏素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1219) [如果我们将它掀开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1220) [我们就能看到它将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1223) [窗口后面的内容模糊了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1224) [所以穿透到了窗口后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1226) [因而它可以看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1228) [其背后的窗口 还有桌面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1229) [好的 默认情况下 一个视觉效果视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1240) [将会处于穿透窗口模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1242) [但你可以用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1243) [blendingMode 属性来控制它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1246) [最后是 material 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1248) [该属性封装了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1252) [对素材效果的定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1253) [这是什么意思呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1256) [也就是模糊 半透明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1258) [也就是模糊 半透明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1258) [渐变以及着色的具体方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1260) [这些都取决于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1263) [material 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1265) [现在 我们先开始在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1267) [Yosemite 里使用素材时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1268) [我们有两种主要素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1271) [一种浅色的 一种深色的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1272) [开始这两种素材很好用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1274) [但之后我们已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1275) [扩大了系统中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1278) [素材的使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1279) [那么在深色模式中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1282) [仅仅指定一种素材为亮或暗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1283) [不再具有实质性的意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1284) [相反 我们有一种叫](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1288) [语义素材的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1289) [如果你熟悉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1292) [语义色彩的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1293) [就知道它们的命名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1296) [取决于其使用的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1297) [而不在于它们看起来像什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1299) [语义素材也是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1301) [例如 菜单素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1304) [会一直看起来像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1306) [系统环境菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1307) [不论是浅色还是深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1309) [在 Mojave 中 我们引进了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1311) [更多的语义素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1315) [这样你就总可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1318) [在特定用例下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1319) [在特定用例下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1319) [使用正确的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1322) [其实 这些语义素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1322) [是现在我们使用素材时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1326) [喜欢用的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1328) [我们淘汰了一些非语义素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1330) [如浅色 深色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1332) [中浅色 或者极深色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1335) [如果你正在用这些素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1337) [那你最好赶快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1339) [切换到一个适用于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1341) [你的用例的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1343) [语义素材中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1344) [现在给你大概展示一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1349) [在整个系统里 我们会在哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1350) [使用这些语义素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1352) [这是“访达”使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1354) [标题栏和侧边栏素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1355) [这是“邮件”使用的标头视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1359) [和内容背景素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1361) [这是《Chameleon Wrangler》App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1365) [所使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1367) [页面背景素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1368) [这是系统偏好设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1370) [所使用的窗口背景素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1374) [现在 关于这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1377) [窗口背景素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1378) [你大概有所耳闻](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1379) [你大概有所耳闻](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1379) [它是 Mojave 里新的特殊的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1380) [桌面着色素材之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1383) [而它们运作的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1384) [就是基于窗口在屏幕上的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1386) [从桌面图片中挑出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1389) [一小块色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1391) [这里的目的是要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1393) [将你的窗口融入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1394) [系统里其他部分的窗口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1396) [那么 要得到这些根据桌面着色的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1398) [最简单的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1404) [就是使用 NSWindow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1405) [NSScrollView  NSTableView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1406) [和 NSCollectionView 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1409) [自动支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1410) [这些对象的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1412) [默认配置与这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1413) [桌面着色效果同时进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1415) [你也可以通过设置 NSBox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1417) [获取这些素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1422) [只需要把它的类型设为自定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1425) [并选择其中的一个填充色彩即可](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1428) [它会使用相应的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1430) [NSVisualEffectView 素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1431) [下面是例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1434) [我会把 boxType 设置为自定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1436) [然后我会将它的填充色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1439) [然后我会将它的填充色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1439) [设定为 underPageBackgroundColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1440) [当然 我也可以用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1443) [NSVisualEffectView 我可以将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1445) [它的素材属性设置为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1446) [underPageBackground 素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1448) [那么 使用 NSBox 的好处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1450) [就是它可以一直](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1451) [向后兼容至 Leopard](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1453) [另一方面 visualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1457) [则给了我们更大的发挥空间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1458) [稍后我会给你一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1459) [相关的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1461) [提醒一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1462) [这些素材会在浅色状态下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1466) [显示未着色的色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1468) [在深色状态下 它们才会显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1471) [桌面着色效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1473) [但是要记住 着色效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1475) [可能会被禁用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1477) [原因是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1479) [在 Mojave 中你可以给系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1480) [选择一个强调色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1485) [如果你将它切换为石墨色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1487) [你就会看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1492) [所有的控件都失去了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1495) [它们的色彩强调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1496) [但这些桌面着色素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1500) [也会失去它们的着色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1501) [所以无论如何要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1504) [你不要指望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1506) [桌面着色一直可用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1507) [默认情况下 visualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1512) [会在像这样的矩形框里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1516) [显示它的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1518) [这样挺好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1519) [但是如果我想要用这个素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1521) [显示一个自定义 UI 元素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1523) [比如说一个这样的对话气泡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1524) [我要怎么做呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1527) [下面这种方法看似有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1529) [实则行不通](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1532) [我来演示一下为什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1533) [我们先在 NSView 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1535) [执行 draw() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1538) [然后获取我的自定义对话气泡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1542) [NSBezierPath](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1544) [接着我会在路径中执行 fill() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1545) [参数为 controlBackgroundColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1548) [参数为 controlBackgroundColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1552) [好了 如果这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1553) [它就会像这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1554) [看起来还不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1556) [但如果我们放大看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1558) [但如果我们放大看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1558) [就会发现对话框并没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1561) [我们想要的桌面着色效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1562) [这只是单纯的灰色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1564) [这是怎么回事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1567) [因为 这种效果是由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1569) [Quartz 窗口服务器提供的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1571) [我们许多其他的素材效果也一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1573) [这就意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1575) [它与你的 App 之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1576) [是异步更新的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1579) [对性能表现来说这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1580) [但也意味着你不能直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1583) [使用那个颜色绘制视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1585) [或是获取它的 RGB 值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1587) [相反 你可以用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1589) [NSVisualEffectView 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1591) [maskImage 属性来实现类似的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1593) [maskImage 是 NSVisualEffectView 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1597) [一种可选的 NSImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1600) [而 NSVisualEffectView 则会利用它来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1604) [覆盖它的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1605) [或者说是它显示的素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1607) [除了使用标准的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1609) [基于图案的图像外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1610) [你还可以用 Drawing-handler 图像来模拟](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1613) [素材绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1616) [下面请看个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1616) [回到我的视图中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1620) [我会重写 layout() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1621) [继续添加一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1624) [NSVisualEffectView

00:27:07.896 --> 00:27:09.716 A:middle
并将其素材设置为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1625) [contentBackground 素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1629) [接着 我用 NSImage(size: flipped:)](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1632) [生成一个初始化程序代码块](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1634) [来创建一个 Drawing-handler 图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1637) [这里 我设置成白色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1642) [但什么颜色并不重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1644) [只要它是不透明的就行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1645) [之后 我会继续填充](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1647) [我的路径](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1649) [然后在 NSVisualEffectView 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1652) [将该图像设置为 maskImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1654) [好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1657) [现在我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1659) [看起来好很多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1661) [它有桌面着色了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1663) [并且 如果对比起来看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1665) [我们就能看到不同了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1667) [那么 这个技巧对任何素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1671) [都适用 但是要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1673) [只有图像的 Alpha 通道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1675) [被用来制作蒙版](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1677) [这点和模板图像类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1678) [这点和模板图像类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1678) [而且蒙版仅仅会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1681) [覆盖素材 而非任何子视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1683) [或 NSVisualEffectView 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1686) [其他继承视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1687) [有一个通用的技术可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1690) [为 maskImage 创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1692) [可调整大小的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1695) [那就是用 NSImage 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1696) [capInsets 和 resizingMode 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1698) [这对性能十分有利](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1700) [好 接下来的部分 我将交给 Jeff](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1704) [他将和我们谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1705) [“Vibrant Blending（动态混合）”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1706) [[ 掌声 ] Jeff](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1708) [&gt;&gt; 好的 谢谢 Matt](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1713) [好 现在我们已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1715) [对素材有所了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1716) [下面我要谈的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1718) [是在那些素材前面的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1719) [特别是那些我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1721) [通过抓取部分背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1722) [并创建出很棒的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1724) [模糊效果的素材 所以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1726) [如果我们再进入《Chameleon Wrangler》App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1728) [我们这里已经有了 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1731) [这是我们的情绪指示器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1732) [接着 我们将记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1734) [我们各种爬行动物的情绪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1736) [它在一个弹出框中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1738) [它在一个弹出框中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1738) [意味着它会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1740) [自动地将该弹出框素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1741) [作为基底素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1743) [而当我们拉下这个基底素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1745) [我们想要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1747) [我们的内容能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1748) [从各种背景中凸现出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1750) [就像这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1753) [那么 我们就要用一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1755) [叫做 “Vibrancy（动态化）”的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1756) [那么 什么是 Vibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1758) [它就是一种混合模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1760) [我们将这种模式运用到内容中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1762) [将其背后的内容统一地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1764) [提亮或变暗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1766) [这和色彩的减淡或加深](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1768) [颇为相似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1770) [你也许在你常用的照片编辑器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1771) [或设计工具中见过它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1772) [我们来仔细看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1774) [这里我们有一个 Glyph](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1776) [它是一种中等灰色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1778) [大概是 50% 的灰色 但完全不透明](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1779) [当我们使用针对深色素材的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1784) [动态混合效果时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1785) [这时我们称之为提亮效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1787) [我们能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1788) [其实并不是 Glyph 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1791) [不透明度下降了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1793) [而是它背后的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1794) [通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1795) [该灰色值的亮度被提亮了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1798) [其实 我们可以看看它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1799) [其实 我们可以看看它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1799) [在一系列灰色值上是怎样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1803) [这里我们有从 0% 到 100% 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1804) [灰色色盘 它们都是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1806) [完全不透明的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1808) [现在我们使用提亮效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1810) [我们看到一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1811) [有趣的事情发生了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1812) [看看右下侧的灰色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1815) [变成了 100% 的亮色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1816) [因为我们给内容的背后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1819) [添加了白色的亮度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1820) [它就变成了这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1823) [没有更亮的颜色了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1824) [但再看左上角](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1826) [我们之前绘制的是黑色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1827) [无法进行任何提亮了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1829) [这意味着它完全消失了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1831) [事实上 如果不是我在那儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1833) [画了一个圈儿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1833) [你都无法看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1834) [而中间的这些 我们能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1835) [不同程度的提亮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1837) [我们能用这个来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1839) [在我们的 App 中创建一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1840) [内容层级结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1842) [但这种效果从哪里来呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1844) [这时我们的老朋友](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1847) [NSAppearance 又派上了用场](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1848) [我们有两种特殊的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1850) [动态的 NSAppearance 对象](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1852) [vibrantDark 和 vibrantLight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1853) [他们都是完整的包](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1857) [不仅包括](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1858) [不仅包括](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1858) [我们用作提亮或调暗效果的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1860) [精确的公式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1861) [而且还有一套](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1863) [已被设计用在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1865) [该混合模式中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1866) [控件图案和颜色定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1867) [但你的代码要如何使用它呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1870) [其实很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1874) [在你的 NSView 子类别中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1876) [你可以重写 allowsVibrancy 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1878) [将其返回为真](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1879) [混合效果就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1882) [自动应用到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1883) [你的视图及其](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1884) [所有继承视图的绘制当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1885) [特别的是 当你在这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1889) [动态的环境中绘制时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1891) [你应该采用内置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1893) [LabelColor 之一 取决于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1894) [内容的突显度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1895) [vibrantDark 和

00:31:38.976 --> 00:31:39.896 A:middle
vibrantLight 都有所有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1897) [这四种颜色的很好的定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1899) [让你能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1901) [创建很好的层级结构](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1902) [但是 你也不是必须使用这些颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1905) [你可以使用任意你喜欢的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1907) [但是我们最好不要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1908) [使用非灰度颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1910) [要避免使用非灰度颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1912) [因为一旦使用它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1913) [混合效果就会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1916) [影响到你的颜色的设计意图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1917) [还会用一种你不想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1919) [还会用一种你不想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1919) [方式去冲染你的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1920) [稍后我会给你一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1923) [那么 再打开 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1926) [我们可以继续在我们的视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1929) [重写 allowsVibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1931) [在这里我们就只需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1933) [在包含整个弹出框和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1934) [指示器的视图上设置它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1935) [现在我们来看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1939) [好了 滑块看起来很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1941) [完全如我们所愿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1944) [但是这些表情是怎么回事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1945) [他们都被冲淡了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1948) [这是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1950) [我们在整个指示器视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1952) [设置 allowsVibrancy 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1954) [我们不仅在该视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1956) [获得了动态混合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1957) [还包括了这些子视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1959) [这里的修复方法很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1962) [我们只要将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1964) [allowsVibrancy 的定义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1965) [局部化到绘制滑块的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1967) [我们就能获得我们想要的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1969) [我们的滑块是动态绘制的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1970) [而表情按钮的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1972) [也是我们想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1973) [当你进行动态绘制时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1977) [你往往只想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1978) [在绘制你确实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1979) [在绘制你确实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1979) [想要动态化的内容的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1981) [叶视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1983) [应用 Vibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1984) [并且 如果你有绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1985) [混合内容的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1986) [那就意味着你可能想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1988) [将你的绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1989) [分成一些兄弟视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1990) [以在你想要的粒度层级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1992) [应用 Vibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1994) [而且 你还应该避免](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1997) [将动态和非动态的视图相重叠](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=1999) [因为如果重叠了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2002) [混合模式将发生冲突](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2004) [而一些你的内容就会以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2006) [一种你并不想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2007) [混合模式绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2009) [还有 不要通过将 Cocoa 控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2011) [编入子集来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2013) [重写 allowsVibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2014) [我前面提到过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2016) [vibrantLight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2017) [和 vibrantDark 外观是由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2018) [专门为混合模式指定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2020) [控件图案和色彩所设计的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2021) [如果你移除这个混合模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2023) [图案的对比度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2025) [就不尽如人意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2027) [因为我们使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2028) [该混合模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2029) [来让它们在素材中突出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2031) [因此你应该](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2032) [只在你确实在重写绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2034) [且你知道哪种混合模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2036) [或者非混合模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2037) [适合你正在进行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2038) [适合你正在进行的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2038) [绘制的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2040) [对 allowsVibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2041) [进行重写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2042) [这就是 Vibrancy](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2043) [接下来 我要谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2045) [背景风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2046) [特别是我们用于选定的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2047) [背景风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2049) [这里我们有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2051) [在 Aqua Cocoa App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2052) [非常典型的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2054) [在这个例子中 有一条](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2056) [取“邮件” App 的消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2058) [我们能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2060) [当我们在选定状态时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2062) [我们需要让这个表格行里的内容反色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2063) [来在蓝色的选择背景下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2066) [看起来自然](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2068) [但如果我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2070) [添加了 darkAqua 的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2072) [就能看到我们并不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2076) [单纯进行反色了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2077) [它们看起来不一致](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2078) [因而我们需要对这些状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2080) [进行语义化描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2081) [如果对 Cocoa 熟悉的话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2083) [你可能已经看到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2085) [NSView.BackgroundStyle 枚举](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2088) [这其中包括很多个 Case](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2090) [包括浅色和深色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2091) [并且 NSTableView 会自动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2094) [在 NSTableRowView 和 NSTableCellView 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2094) [以及 NSTableCellView 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2096) [直接子视图的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2098) [直接子视图的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2098) [所有控件上自动进行设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2100) [传统情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2103) [我们会在未被选定行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2105) [设置了浅色的背景风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2107) [在被选定行设置了深色的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2109) [但是现在 在这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2111) [背景总是深色的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2113) [全新的漂亮的主题中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2115) [以前的命名便](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2116) [不再有意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2118) [所以我们要将它们分别重新命名为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2120) [“normal（普通）”和 “emphasized（强调）”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2122) [这些是更为语义化的描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2124) [能够更好地匹配这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2125) [应用在新版的 Cocoa App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2127) [枚举 Case 的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2129) [关于背景风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2132) [我们还做了一些更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2133) [包括 NSTableView 现在会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2135) [自动地将背景风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2137) [循环设置在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2138) [表格行中的所有控件上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2140) [而不仅只是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2141) [你 cellView 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2143) [直接子视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2144) [所以 如果你已经了解了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2146) [那个背景风格](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2146) [并试着将其应用到所有的子视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2148) [因为你想要为布局用一个堆叠视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2149) [或是其他什么东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2151) [你不再需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2152) [在 Mojave 上进行这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2153) [之前手动完成这些的人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2156) [正在鼓掌](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2158) [谢谢 我曾经也是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2159) [此外 全部的四种 LabelColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2161) [都自动适应到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2163) [背景风格当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2165) [这意味着你可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2167) [创建一次你的内容层级](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2168) [并语义化地描述它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2170) [那么它会在所有的这些环境中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2171) [看起来很棒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2172) [你也可以手动使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2174) [这些强调的变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2177) [举个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2178) [这是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2179) [看起来有点像“访达”里的图标视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2180) [我们有两个标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2183) [它们分别是 labelColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2185) [和 secondaryLabelColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2186) [我们想要在他们后面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2188) [绘制一个自定义选定效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2190) [因此我们有了这个自定义的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2191) [基于 Bezier 路径的选定效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2192) [我们也许会用另一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2193) [已选定控件颜色来填充它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2194) [我们还想要在这个强调的风格中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2196) [将我们的标签与主要变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2200) [及次要变体相匹配](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2202) [这很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2204) [我们需要做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2206) [在我们的文本域](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2207) [将背景风格设为强调](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2209) [这样它们会自动地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2210) [提供这个强调变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2211) [很棒的是因为 我们已经将它描述成这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2213) [当我们切换为深色模式时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2216) [一切就会如我们所愿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2218) [一切就会如我们所愿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2218) [我们不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2220) [再做什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2221) [关于选定 最后要注意一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2224) [通常你在侧边栏 菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2226) [及弹出框中所见到的选定素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2228) [都跟随着 Mojave 上的强调色 偏好设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2230) [这就意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2236) [如果我们绘制一个自定义蓝色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2237) [选定效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2238) [它会不适应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2240) [而这时 你要用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2241) [NSVisualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2242) [它有一个特殊的选择素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2243) [适用于这种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2244) [使用 NSVisualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2246) [该素材就会如你所愿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2247) [自动跟随偏好选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2248) [好 最后一部分是重头戏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2253) [小技巧和方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2255) [但在此之前 我想就](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2256) [向后兼容谈几句](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2258) [因为我们知道你们中的许多人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2259) [特别是使用 Mac 的人](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2260) [喜欢将你们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2262) [向后兼容到之前发布的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2263) [macOS 版本当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2265) [要确保你在向后兼容时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2267) [无需进行任何必要的妥协](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2268) [就可以使用深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2269) [这十分重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2271) [所以我会讲讲几个 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2272) [检测它们的向后兼容情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2276) [从系统颜色开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2277) [所以 这里是我们所支持的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2279) [所以 这里是我们所支持的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2279) [系统颜色的样本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2280) [它们对外观来说是动态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2282) [这里我要强调的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2284) [高亮为绿色的部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2285) [都至少已经在 10.10 Yosemite 里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2286) [出现过了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2287) [其中的很多甚至出现得更早](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2290) [这就意味着我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2292) [你可以使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2295) [足够多的色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2297) [几乎可以描述](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2298) [你所喜欢的任何 UI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2300) [并且它们已经直接可以向后兼容了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2302) [就自定义色彩而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2306) [我们现在更偏爱的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2308) [定义它们的方式是使用素材目录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2309) [而这早在 10.13 就已经可用了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2312) [现在 如果要给你的任何素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2315) [添加特定的深色变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2317) [当你进行向后兼容时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2319) [这些深色变体都会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2321) [在之前版本的操作系统上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2322) [被忽略掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2323) [所以那就是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2325) [内建的向后兼容解决方案](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2327) [但是如果我想要再回去](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2329) [对甚至比 10.13 更早的版本进行兼容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2330) [你可以用这样的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2332) [创建一个自定义色彩属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2335) [这里我们只是封装](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2337) [可用性检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2339) [可用性检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2339) [以在支持素材目录的操作系统上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2341) [使用我们的素材目录色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2342) [我们可以继续放一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2344) [硬编码回调颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2345) [给那些旧的操作系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2347) [桌面着色素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2349) [是 Mojave 里的另一个新特点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2353) [如果你想要把](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2353) [这些素材直接](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2356) [编为 NSVisualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2357) [当然这只能在 10.14 上进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2359) [但我们已经提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2360) [我们已经有一些类提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2363) [这些素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2364) [包括 NSWindow](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2365) [NSScrollView 以及 NSTableView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2366) [这些在最开始的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2368) [就已经提供给大家了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2369) [其实 有的在 macOS 10.0 之前就有了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2372) [因此 如果你正确地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2375) [进行设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2377) [那么在之前的操作系统上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2380) [他们也会显示出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2381) [特殊的 NSColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2383) [正如你所期望的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2384) [接着 如果你在 Mojave 上运行它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2386) [你会自动得到那个素材](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2388) [当然 NSBox](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2390) [自定义风格让你能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2392) [设置一个填充色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2393) [并将它向后兼容到 Leopard 10.5 当中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2396) [NSCollectionView 也是一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2398) [而无论你用的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2399) [而无论你用的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2399) [之前的 NSCollectionView API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2400) [还是最新的版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2401) [都不会影响它的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2403) [当然我们希望你用新的版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2405) [最后是 启动深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2408) [通常这只是在关联了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2412) [10.14 SDK 之后才可以进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2414) [但是你也看到了 其实](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2417) [创建一个深色模式下的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2419) [所需要的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2421) [并非 10.14 SDK 上专有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2423) [你完全可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2424) [用现有的 10.13 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2426) [来进行创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2428) [那么 如果在某种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2431) [你无法更新你的 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2433) [我们有个 Info.plist Key](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2434) [你可以用它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2436) [进入深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2438) [它叫做 NSRequiresAquaSystemAppearance](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2439) [如果将其设为 “NO”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2442) [那么就启动了深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2443) [即使你使用的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2445) [之前的 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2446) [当然我们十分希望你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2448) [能更新你的 SDK](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2450) [因为这是一个更明智的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2451) [你也可以将该秘钥设为 “YES”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2453) [使其暂时失效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2455) [我想强调一下 只是暂时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2457) [你可以利用它给你的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2459) [你可以利用它给你的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2459) [来获取一个完美](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2460) [支持深色模式的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2461) [更新版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2463) [最后是 一些技巧和方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2467) [首先](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2471) [当你更新你的 App 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2473) [你可以彻底审查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2475) [你对 NSColor 的使用情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2476) [你只需要通过搜索你的代码库](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2477) [并查看你使用它的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2481) [你可能会发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2483) [一些可以升级的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2484) [来优化你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2485) [深色模式体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2487) [比如说 这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2488) [我们发现在一些地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2490) [我们正在使用非动态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2491) [命名色彩以及一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2493) [包含硬编码的色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2494) [当我们遇到这些情况时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2496) [可以选择以下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2497) [两种方案中的其中一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2499) [第一种 也许有一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2502) [内建系统色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2504) [它能描述我想要的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2506) [在外观中也是完全动态的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2507) [或者 第二种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2509) [这是一个自定义色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2511) [它对我的 App 来说非常重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2513) [第一种情况非常简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2515) [我们之前在这个标签上使用黑色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2517) [之后我们可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2518) [将其转为 labelColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2519) [将其转为 labelColor](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2519) [这样一来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2520) [它就是完全动态的了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2522) [但在第二种情况中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2523) [我们也许发现这个色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2525) [对我们的 App 是十分重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2526) [把它放入素材目录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2527) [是一个很好的想法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2529) [我们不仅清理了我们的代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2532) [因为我们从代码中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2533) [删掉了这些乱七八糟的数字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2535) [并将它们放入一个数据驱动源中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2536) [我们还可以接着为该色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2538) [设置一个深色变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2540) [这样我们就能嵌入](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2542) [对深色模式的支持了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2544) [另一个常见的问题来源是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2548) [离屏绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2549) [要进行离屏绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2551) [你需要确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2553) [你对外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2554) [以及其他绘制条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2555) [十分敏感](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2556) [关于这个 有个情况很常见](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2558) [就是用 NSImage 中的 lockFocus API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2559) [来试着绘制自定义 NSImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2561) [这种情况下 我们要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2565) [试着画一个带标记的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2566) [我们有一个基础图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2568) [但由于我们的蜥蜴有了一些新的改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2569) [我们需要在它的头像上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2570) [添加一个标记](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2572) [在这个例子里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2573) [我们创建一个 NSImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2575) [并在它上面调用 lockFocus() 之后进行绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2577) [但问题是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2580) [一旦我们使用了 lockFocus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2582) [我们就失去了许多语义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2584) [我们现在只有一个位图表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2585) [如果外观发生了改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2588) [或者其他许多情况改变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2590) [包括我们所说的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2592) [基底比例系数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2593) [比如你将窗口从一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2594) [视网膜显示屏移动到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2595) [一个非视网膜显示屏](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2596) [突然 这个绘制就过时了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2598) [所以 更好地解决方法就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2600) [使用基于代码块的 NSImage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2602) [用图像初始化程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2604) [和 NSImage(size: flipped: )绘制处理程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2607) [你可以直接进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2609) [与之前一样的绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2611) [但要在这个代码块中进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2612) [当你给这种图像指定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2614) [一个 NSImageView 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2616) [这个代码块会自动重新运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2618) [如果外观发生变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2619) [比例系数发生变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2621) [色彩空间发生变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2623) [其实任何东西发生变化都会导致它重新运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2625) [这是一个好消息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2626) [因为如果我们的标记填充色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2628) [是一个动态色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2629) [那么它就会一直处理为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2631) [正确的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2632) [还有一些其他的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2634) [也许能帮你进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2635) [离屏绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2636) [你也许在通过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2637) [NSGraphicsContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2639) [NSGraphicsContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2639) [或 CGBitmapContext](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2640) [制作自定义位图图形环境](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2642) [根据你在做的事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2643) [这些也许还可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2644) [用一个基于代码块的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2646) [NSImage 来替换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2647) [再者 如果使用参数为 NSRect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2649) [的 cacheDisplay() 方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2651) [来将你的图片缓存为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2653) [一个位图表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2655) [那么要注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2658) [这种方法并不会捕捉到一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2659) [我们更进阶的渲染技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2661) [比如素材和模糊](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2662) [如果你的外观改变了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2665) [那么这种创建绘图的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2666) [也就过时了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2667) [要注意这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2668) [你也许还会碰上另一种情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2673) [如果你有一个 NSAttributedString 或](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2676) [NSTextStorage](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2678) [而你在手动操作这些属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2680) [在这里 我将我的属性设置为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2682) [一个带着字体的词典](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2684) [然后就会呈现出这样的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2688) [甚至当你切换为深色模式时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2689) [你的文本仍在绘制黑色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2691) [这里发生了什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2692) [好 我们错过了一个前景颜色属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2694) [当文本绘制引擎](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2696) [遇到一系列的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2698) [遇到一系列的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2698) [没有一个前景颜色属性的属性字符串时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2700) [它便会默认为黑色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2702) [这就是它一直默认的颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2704) [并且它还会继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2706) [为了兼容而保持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2708) [默认颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2709) [修复方法之一是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2711) [给我们的一个动态系统色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2712) [明确地设置一个前景颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2713) [接着就会产生我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2715) [所期待的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2717) [但是还有一种更好的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2719) [如果你手动绘制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2721) [属性字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2722) [你应该切换成一个 Cocoa 控件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2724) [比如一个 NSTextField](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2725) [它将自动为你完成这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2727) [或者 如果你正在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2728) [操作一个 textView 的存储](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2730) [我们有新的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2732) [叫做 performValidatedReplacement](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2736) [它会在 textView 上产生不错的效果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2738) [如果你继续用一个 textView 中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2740) [属性字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2743) [来代替一个字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2745) [那它就会用 textView 中的正在使用属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2747) [填充任何缺失的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2750) [所以你可以继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2751) [制定新的属性字符串](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2754) [而不用手动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2755) [合并所有的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2757) [这是我们在一些地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2763) [所遇到的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2764) [即将外观设置在了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2766) [“Interface Builder（界面构建器）”里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2767) [如果你继续创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2769) [并调试你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2770) [并且 你的 App 中的某些地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2771) [并没有切换过来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2773) [也许是因为你的界面构建器中有这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2775) [硬编码的 Aqua 外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2778) [这个很容易被忽视](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2780) [因为在今天之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2782) [你一直都是在用 Aqua 运行程序](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2783) [因此你并没有注意到这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2785) [这个修复方法也很简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2787) [如果你将这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2789) [在弹出菜单里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2790) [设置回“Inherited（继承）”选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2792) [你的视图会自动进行继承它的父辈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2794) [还有一个特殊的例子是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2796) [NSVisualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2800) [如果你在界面构建器里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2801) [或者在代码里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2802) [有一个 visualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2804) [你很可能要将两种动态的外观中的一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2805) [设置在它上面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2807) [好消息是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2809) [在 macOS 10.14 中不再需要这样设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2811) [而 NSVisualEffectView 将自动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2815) [根据他所继承的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2816) [选择正确的动态外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2818) [选择正确的动态外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2818) [所以 如果它继承了 darkAqua](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2820) [它就会选择 vibrantDark](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2822) [而如果继承了 Aqua](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2823) [就会选择 vibrantLight](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2825) [修补方法是这样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2826) [在界面构建器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2828) [你可以将其设置为 “Inherited”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2830) [然后在代码里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2831) [你可以设置外观 “nil”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2832) [或者删除你的重写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2834) [说到界面构建器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2835) [它是一个很棒的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2840) [可以很好地用来设计和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2842) [预览你的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2843) [比如说 这里有一个视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2845) [确切地说是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2847) [使用界面构建器设计工具的自定义视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2848) [我在渲染一个渐变的同时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2850) [我就能直接在画布中看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2852) [默认情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2854) [画布会自动用它当前的外观模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2855) [来预览我的自定视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2857) [在这里是深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2859) [但是看看下面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2862) [这有一个新的切换开关](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2863) [你可以把它切换为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2865) [浅色外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2866) [这样你可以预览你的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2867) [在任意外观中的样子了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2868) [多亏了界面构建器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2870) [对素材目录颜色的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2872) [良好支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2874) [我们才能使用我们的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2876) [自定义素材目录颜色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2877) [它们有浅色和深色的变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2879) [它们有浅色和深色的变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2879) [我们可以在画布中实时预览](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2881) [如果你看到那里有个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2883) [固定在弹出按钮前的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2884) [小箭头按钮](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2885) [你可以用它来追踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2887) [直接进入到你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2888) [素材目录的定义中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2889) [你可以实时看到一切变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2890) [你可以直接这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2893) [不用构建或者重新编译](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2895) [当你构建并运行时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2896) [你会在你的调试工具栏中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2898) [看到一个新的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2900) [它会产生菜单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2902) [让你为你的 App 选择外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2904) [这样很方便](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2906) [你可以预览你的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2907) [在各种外观下的样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2909) [不用重新配置整个系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2910) [你不仅可以选择浅色还是深色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2913) [也可以选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2914) [高对比度变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2916) [并对它们进行测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2917) [同时 如果你有一台](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2920) [带触控栏的 Mac](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2921) [它也会在你的触控栏出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2922) [你甚至不需要离开 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2924) [回到 Xcode 中 就可以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2925) [完成这个操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2927) [最后 我想谈谈](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2930) [Xcode 中的一个很棒的工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2931) [它非常适合被用于调试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2933) [深色模式下的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2934) [这是我们的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2936) [看起来还不错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2938) [没什么不对的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2939) [没什么不对的地方](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2939) [但是当我稍微来回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2942) [滑动几下 哦](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2944) [我发现了一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2946) [意想不到的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2947) [这里有一个浅色的背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2948) [隐藏在背后某处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2949) [而如果不是这个小小的滑动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2951) [我们很难看到它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2952) [这是应该使用 “View Debugger（视图调试器）”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2954) [的一个很好的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2956) [用视图调试器的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2958) [扩展 3D 视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2959) [就能很容易地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2962) [看到我们那个不太对的视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2963) [在这个例子中 我们能看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2965) [虽然我们的集合视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2966) [显示出我们想要的背景](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2967) [但在它后面的滚动视图的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2969) [背景却仍然是浅色的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2971) [我们可以选出这部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2973) [并用 Inspector 来检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2975) [它是如何配置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2977) [在这里 我们可以确定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2978) [没错 它有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2979) [硬编码的白色](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2980) [这很好处理](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2982) [视图调试器在 Xcode 10 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2984) [做了很多优化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2986) [能够很好地调试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2987) [深色模式的 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2988) [包括色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2990) [它们现在可以显示出色彩的名字](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2993) [包括动态系统色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2994) [和你的素材目录色彩](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2995) [这样你可以分辨出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2997) [这些 RGB 成分来自哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2999) [这些 RGB 成分来自哪里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=2999) [它还会显示你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3000) [NSAppearance 视图的配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3002) [包括它要绘制的外观](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3004) [以及在该对象上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3006) [是否有任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3008) [NSAppearance 的局部重写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3010) [好了 我们已经涉及了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3014) [非常多的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3016) [让我们快速回顾一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3017) [确保我们能记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3018) [我们从 NSAppearance 开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3019) [用它顺利地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3021) [绘制了基于主题的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3023) [自定义视图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3025) [然后我们学习了如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3027) [使用全新的 NSVisualEffectView](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3028) [素材的调色盘](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3030) [来增加我们 UI 的深度并美化它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3031) [我们谈到了如何在一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3034) [有趣的环境中绘图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3035) [包括 Vibrancy 和选定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3037) [之后谈到通过一些方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3039) [Xcode 可以帮你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3040) [设计和调试你的 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3042) [深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3043) [你可以像往常一样 前往](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3044) [developer.apple.com](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3046) [再次观看此次讨论会的视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3047) [也可以观看任何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3049) [相关的资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3051) [我们今天有个特别的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3052) [Cocoa 和深色模式实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3054) [在下午 2:00 进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3058) [届时不仅会有 Cocoa 的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3059) [届时不仅会有 Cocoa 的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3059) [帮助你解决代码问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3060) [还有人机界面设计师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3061) [帮助你解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3062) [你的设计问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3063) [所以先去吃午饭吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3065) [思考一下深色模式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3067) [然后再来与我们相会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3068) [最后 我们还有一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3069) [额外的 Cocoa 实验室](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3071) [在周五上午 11:00](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3072) [好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3074) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3074) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/218/?time=3076)