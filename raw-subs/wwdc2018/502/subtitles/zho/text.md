# Measuring and Optimizing HLS Performance

## Summary
HTTP Live Streaming (HLS) is used to stream live and on-demand content to global audiences. Discover how to adjust and tune stream authoring and delivery elements to improve the viewing experience. Learn how to accurately measure your streaming performance, identify optimization opportunities, and implement changes to your HLS streams that can significantly improve the user experience.

## Info
* Media
* WWDC 2018 - Session 502 - iOS, macOS, tvOS
* https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/

## Text
 [[ 音乐 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=7) [&gt;&gt; 各位 上午好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=20) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=23) [欢迎大家参加今年的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=27) [关于 HTTP 流媒体网络传输协议（HLS）的会议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=28) [我是 Emil Andriescu](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=31) [今天我们将讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=33) [测量和优化 HLS 性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=35) [首先 让我们思考一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=38) [为什么我们应该关注它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=40) [以及为什么它对于 App 很重要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=42) [假设在一个星期六的晚上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=45) [你们坐在舒适的沙发上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=48) [熟练地浏览了所有的评论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=50) [确定了要观看的视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=52) [爆米花也已经准备好了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=53) [你们迫不及待地轻点播放键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=55) [但是这时发生了这样的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=58) [但是这时发生了这样的事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=58) [面对这种神秘且永无止境的动画](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=62) [你们会问自己](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=65) [还有什么比这更糟糕的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=67) [让我们面对它 你们知道吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=70) [它其实是一个播放错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=72) [但是客户真正期望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=73) [HLS 会提供什么样的体验呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=77) [他们期待清晰的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=81) [高保真的音质](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=82) [以及轻点播放键时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=84) [即时的媒体反应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=86) [然而 互联网上流媒体 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=89) [的性能表现总是受网络的影响](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=91) [那么我们该如何调和呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=92) [HLS 的设计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=96) [就是为了解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=98) [即在不可预知的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=100) [网络环境中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=102) [提供最好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=103) [不间断的流媒体体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=106) [所以我们为什么今天在这里](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=107) [还有很多理由](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=108) [如今 HLS 已经发展成一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=110) [更动态的生态系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=112) [它支持新的功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=114) [如 I-frame 播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=116) [新媒体格式 当然还有新的编解码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=118) [新媒体格式 当然还有新的编解码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=118) [与此同时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=121) [我们不断地添加强大的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=123) [iOS tvOS 以及 macOS 的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=126) [比如你们可以针对你们的目标用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=129) [优化和调整播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=132) [并提供更丰富的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=133) [交付模式和传输协议](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=136) [也在不断发展](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=138) [因此重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=140) [结合观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=142) [在移动设备上或客厅中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=143) [内容被消费的情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=146) [以判断服务器端的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=147) [考虑到所有这些指标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=154) [你们如何确定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=156) [你们为观众提供的用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=157) [是最好的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=159) [第一步是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=161) [结合你们对内容 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=163) [或交付的更改](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=167) [理解并量化用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=169) [我们认为在这一方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=172) [确定哪种配置是最优的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=173) [应该是测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=175) [而不是猜测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=177) [那么这个会议将是什么内容呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=180) [首先 我们想要建立一种](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=182) [共同的语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=183) [来讨论流媒体服务的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=185) [然后我们想讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=187) [如何客观地度量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=189) [App 的流媒体性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=191) [第三 我们希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=193) [帮助你们识别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=195) [并解决一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=197) [影响流媒体服务质量的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=199) [最后 我们想修正](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=202) [主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=204) [这是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=205) [我们在流媒体质量中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=207) [看到的许多问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=209) [实际上根源于](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=211) [主播放列表的编写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=213) [在详细讨论之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=215) [让我们先简要概述一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=217) [HLS 播放会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=218) [正如你们所期望的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=221) [它从下载一个主播放列表开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=222) [一旦 AVPlayer 开始读取播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=224) [它就知道这个播放列表指向的是什么内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=227) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=230) [我们有两个比特率 1 兆比特和 2 兆比特](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=231) [AVPlayer 会选择其中的一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=233) [然后下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=235) [一个媒体播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=237) [以及附加的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=238) [例如密钥的工件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=239) [例如密钥的工件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=239) [然后继续下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=241) [媒体片段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=243) [直到缓冲层足够播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=245) [这种情况出现时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=247) [AVPlayeItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=250) [将通过设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=251) [playbackLikeyToKeepUp == true 的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=254) [来传达对播放性能的预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=256) [如果你预先将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=258) [AVPlayer 速率设置为 1](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=260) [那么你正在使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=262) [AVPlayer 的自动播放功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=264) [该播放器将立即开始播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=266) [我们称之为时间间隔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=268) [启动时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=269) [从这一点开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=271) [挂钟（也称为实时时钟）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=273) [将和 PlayerItem.timebase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=275) [以相同的速度前进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=277) [有一个条件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=279) [即内容必须以](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=281) [与 AVPlayer 使用的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=283) [相同或更快的速度到达](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=286) [如果这样不行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=288) [AVPlayer 会尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=289) [切换到这里的 1 兆比特](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=292) [如果网络仍然不能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=293) [在 1 兆比特时保持实时速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=295) [那么缓冲区将最终耗尽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=297) [AVPlayer 没有选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=299) [AVPlayer 没有选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=299) [它需要停止播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=301) [我们将这种事件称为卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=303) [播放器将保持这种状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=305) [不仅直到数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=307) [再次开始流动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=309) [而且直到有足够的缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=310) [为 PlayItem 触发](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=311) [另一个积极的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=313) [播放性能预测之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=315) [播放将正常继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=318) [现在让我们讨论一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=320) [如何量化这种会话中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=322) [用户体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=324) [我们通过定义一组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=326) [关键性能指标 也就是 KPI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=327) [来实现这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=329) [我们选择了其中 5 个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=331) [我们认为是 HLS 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=332) [最具代表性的 KPI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=334) [你们可能会问](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=336) [我的用户需要花多少时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=338) [等待播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=340) [1 秒吗 还是 5 秒或30 秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=342) [这是用户体验的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=347) [一个重要方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=349) [此外 播放卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=351) [就像我们刚才看到的那样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=353) [也会对用户造成干扰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=355) [我们关心这两者发生的频率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=357) [但也许更重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=359) [但也许更重要的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=359) [从卡顿中恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=360) [需要多长时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=362) [然而 在不了解未来的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=365) [最好的策略是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=369) [以最低的可用比特率交付内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=371) [但那当然不是我们想要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=373) [我们希望提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=374) [最好的音频和视频质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=376) [同时仍不卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=378) [所以 在卡顿的风险](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=379) [以及媒体质量之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=381) [有一个明显的权衡](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=383) [为此 我们需要另一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=384) [可以衡量整体媒体质量的会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=388) [最后 播放错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=390) [我已经讨论过这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=392) [它们比卡顿更具破坏性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=394) [我们如何跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=396) [播放错误呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=399) [好的 让我们从启动时间开始讲起](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=401) [有很多种 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=403) [你可以用来获取或计算启动时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=405) [首先 不要使用将 AVPlayer.status 更改为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=408) [.readyToPlay 这种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=411) [这并没有告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=412) [播放将要开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=413) [然而 如果你正在使用自动播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=416) [那么你可以预先设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=418) [播放器的速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=419) [播放器的速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=419) [你可以将 AVPlayerItem.status 更改为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=420) [.readyToPlay](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=422) [或者将](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=424) [AVPlayerItem.isPlaybackLikelyToKeepUp](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=426) [更改为 true](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=428) [这些都是可观测的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=429) [这样做之后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=432) [你就可以知道播放即将开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=433) [但是播放可能需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=435) [几毫秒才会开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=437) [所以我们向你们推荐两种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=439) [一种是将 AVPlayer.timeControlStatus](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=441) [更改为 .Playing](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=443) [另一种是跟踪](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=445) [AVplayerItem.timebase](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=446) [而且会有一个通知允许你这么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=448) [AVPlayer 依靠探试法来避免卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=450) [但我们知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=454) [有时它们是不可避免的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=456) [你可以通过观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=458) [AVPlayerItemPlaybackStalled 的通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=460) [来监控卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=463) [这里的建议是计数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=465) [卡顿的出现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=466) [当然 如果你想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=468) [比较和合计](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=469) [不同时长的会话的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=472) [卡顿行为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=474) [那么你需要将其正常化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=476) [这又该如何做到呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=477) [我们建议你使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=478) [我们建议你使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=478) [总观看时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=480) [并计算卡顿率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=481) [以单位观看时间内的卡顿次数为单位 例如卡顿/小时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=484) [对用户来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=489) [30 秒的卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=493) [比 1 秒的卡顿更糟糕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=496) [这就是为什么我们也关心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=497) [再缓冲时间或卡顿时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=499) [通过测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=502) [播放卡顿的通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=503) [以及当 PlayerItem.timebase 变为 1 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=505) [之间的时间间隔](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=506) [你就可以计算出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=508) [准确的卡顿时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=511) [此外 通过使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=512) [会话的播放时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=514) [你也可以对总时长进行正常化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=517) [那么 你可能想知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=519) [我是如何计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=520) [一个会话的播放时长的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=521) [答案是通过访问日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=523) [让我们来看看怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=525) [这是一段代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=527) [首先 我们从 PlayerItem 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=530) [获得对访问日志的引用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=532) [我们迭代访问日志中的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=535) [并简单地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=537) [计算每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=539) [计算每个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=539) [event.durationWatched](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=542) [就是这样 我们计算了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=542) [一个会话的总播放时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=544) [现在你可能会想](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=545) [这个事件是什么](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=547) [访问日志中的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=548) [是什么意思呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=549) [那么 让我们看看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=550) [AVPlayerItemAccessLog 是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=552) [AVPlayerItemAccessLog 提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=555) [你的会话的历史记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=556) [它最初是 null](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=559) [但是当播放开始时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=561) [你将收到一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=563) [AVPlayerItemNewAccessLogEntry 通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=565) [到那时你将拥有一个访问日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=567) [你将看到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=569) [访问日志中的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=570) [包含关于不同方面的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=573) [例如 当前变体 URL 当前比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=576) [播放时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=578) [卡顿次数等等这些值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=581) [初始化为负值或 null](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=585) [当播放开始时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=589) [它们会依据实际的测量数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=592) [和正在播放的实际变量 URL 进行更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=593) [两种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=596) [我们会向访问日志中添加新事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=599) [我们会向访问日志中添加新事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=599) [一种是变量切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=600) [就像在本例中一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=602) [另一种是播放查找](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=604) [但是在添加新事件之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=606) [旧的事件不再可变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=608) [然后我们才能添加新事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=610) [现在请记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=612) [当播放开始时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=613) [这些值会不断更新](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=616) [所以上一个事件中的值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=617) [并不是可观察的属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=621) [我们也提到我们关心的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=625) [媒体质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=626) [我们应如何计算它呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=629) [衡量用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=633) [是否获得最好的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=635) [媒体质量的一种方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=636) [当然是看视频比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=638) [这里我们不关心](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=640) [启动时间或卡顿时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=642) [所以我们把它们去掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=644) [我们还剩下播放状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=646) [在这个例子中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=648) [我们看到我们在 2 兆比特的变量上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=650) [播放的时间更长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=652) [而 1 兆比特的时间更短](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=655) [按时间加权每一个比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=657) [我们可以获得一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=659) [我们可以获得一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=659) [视频质量的单一值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=661) [并对此在不同的会话中进行比较](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=662) [我们称这个度量为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=666) [时间加权的指示比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=667) [计算它就像计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=669) [总时长一样简单](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=671) [再一次 我们获得了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=675) [对 PlayerItems 的访问日志的引用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=677) [我们迭代日志中的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=679) [我们也计算了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=681) [相对于我们之前计算过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=683) [totalDurationWatched 的每个事件的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=685) [时间权重 最后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=686) [我们计算得出了加权比特率值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=689) [现在请记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=691) [有些属性可能没有初始化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=693) [所以在代码中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=695) [应进行适当的检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=696) [另一个你绝对应该跟踪的事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=701) [当然是播放失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=704) [为此 你需要观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=705) [AVPlayerItem.status](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=707) [如果它的值更改为 false](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=709) [则意味着 AVPlayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=711) [遇到不可恢复的错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=712) [有没有将这种观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=715) [转换成 KPI 的好方法呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=716) [一种方法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=719) [一种方法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=719) [观察失败的会话](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=723) [占总会话的百分比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=724) [但是可能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=726) [还有其他的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=727) [这里我想强调的一点是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=728) [并非你的流中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=730) [所有错误都是致命的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=732) [有些可能会影响媒体质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=734) [而有些错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=736) [用户甚至可能无法察觉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=738) [但是尽管如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=739) [如果存在错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=741) [它们就反映了你的流存在问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=743) [那么 我该如何深入了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=745) [流中出现了什么问题呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=749) [答案就来自](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=751) [PlayerItemErrorLog](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=752) [AVPlayerItemErrorLog](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=755) [错误日志记录了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=757) [对用户造成不同程度影响的错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=758) [它的工作方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=761) [与访问日志类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=763) [只是事件表示错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=765) [而不是播放器的访问状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=767) [它们涉及很多方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=769) [如交付问题 网络问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=772) [内容编写错误等等](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=774) [例如 它们可以让你了解](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=777) [发生卡顿的原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=779) [发生卡顿的原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=779) [比如媒体文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=781) [在大约 10 秒内没有响应](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=783) [我们之前讨论了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=785) [你可以在每次会话中跟踪的启动时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=789) [我们建议你查看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=791) [你的 App 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=792) [启动时间分布](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=794) [我们还讨论了卡顿的发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=796) [以及卡顿时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=798) [我们也提到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=800) [时间加权表示的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=802) [可以很好地表示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=803) [整个会话的媒体质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=805) [最后 你可能希望](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=807) [尽可能降低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=809) [失败会话的百分比](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=810) [请记住 并非所有的 KPI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=816) [都可以在会话中进行比较](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=819) [一个例子就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=822) [AVPlayerFoundation](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=824) [使用屏幕上的 AVPlayer 层大小](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=826) [来评估 HLS 的模糊变体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=828) [例如](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=831) [如果你有 10 个 ATP 的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=833) [它可能不会显示在 200 像素的视图上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=835) [但这并不意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=837) [用户体验了很差的图像质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=838) [用户体验了很差的图像质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=838) [接下怎么做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=842) [我们建议你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=843) [收集附加的上下文信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=845) [以及流化度量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=847) [这将允许你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=849) [稍后在对 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=850) [有意义的类中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=852) [对回放会话进行分区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=854) [作为 HLS 目录示例的一部分](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=856) [本节的示例代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=858) [可在 Apple 开发人员](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=860) [网站上获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=861) [现在 请允许我欢迎 Zhenheng Li](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=864) [她将与你们讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=866) [如何提高 HLS 的性能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=868) [谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=869) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=870) [&gt;&gt; 谢谢 Emil 大家好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=875) [我是 Zhenheng](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=883) [我们已经讨论了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=885) [所有用户最关心的 KPI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=890) [在这部分的讨论中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=893) [我们将着重探讨如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=895) [改进这些 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=897) [我们将在三个方面进行更深入的研究](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=897) [我们将在三个方面进行更深入的研究](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=897) [第一 如何减少启动时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=900) [第二 如何调查和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=905) [避免卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=907) [第三 如何调查和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=909) [避免错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=911) [让我们开始吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=913) [什么可以导致播放延迟开始呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=915) [下面是用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=919) [从点按播放键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=920) [到视频开始的操作示例](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=923) [App 创建每个资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=927) [并开始对资源进行检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=928) [以确定资源的时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=931) [和可授予的媒体选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=934) [下载主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=938) [和 [ 音质不清晰 ] 播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=940) [需要在设备和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=942) [内容服务器之间来回运行几次](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=945) [然后 App 会创建 AVPlayer 和 AVPlayerItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=948) [开始缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=954) [有时 缓冲会被中断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=956) [内容被加密](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=959) [内容被加密](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=959) [它需要在设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=962) [和密钥服务器之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=964) [进行几次往返](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=966) [以获取解密密钥](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=967) [一旦密钥被获取](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=969) [缓冲便会恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=972) [然而 它也可能再次被中断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=975) [假设这个 App 提供了一个特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=978) [可以从之前播放的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=980) [断点处恢复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=982) [App 为用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=985) [在播放器上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=987) [设置一个 sic 时间[ 音质不清晰 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=988) [播放器将丢弃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=992) [现有的缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=994) [并从新的位置开始下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=996) [第 100 个片段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=998) [它还可能再一次被打断](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1001) [用户在 App 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1004) [拥有语言首选项设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1007) [她或他更喜欢西班牙语](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1010) [因此 App 在 PlayerItem 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1013) [设置 MediaSelection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1017) [丢弃现有的音频缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1019) [丢弃现有的音频缓冲区](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1019) [播放器开始下载不同的语言变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1021) [几秒钟后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1025) [PlayerItem 通知 isPlaybackLikeToKeepUp](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1028) [App 设置一个速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1031) [播放开始 并从断点继续](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1035) [这一段时间 用户都在等待](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1038) [所以正如我们所看到的启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1042) [以及在设备 内容服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1048) [和密钥服务器之间运行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1051) [还有 AVPlayer 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1053) [App 之间的往返](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1055) [均需要一些耗时的操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1057) [通常 AVPlayer 和 App](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1060) [在不同的进程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1062) [那么 App 如何](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1064) [测量时间成本和启动时间呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1066) [它可以测量在 API 调用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1069) [与 Player/PlayerItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1072) [状态更改通知之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1075) [所花费的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1077) [每个 PlayerItem 也提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1079) [每个 PlayerItem 也提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1079) [访问日志中的启动时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1082) [这个时间是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1086) [由 AVPlayeritem 测量的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1089) [只表示缓存的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1091) [它从开始媒体下载时开始测量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1094) [并在第一个播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1095) [被选定开始时结束](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1097) [我们的用户希望视频快速启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1101) [最多几秒钟内完成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1103) [有很多方法可以做到这一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1107) [一种方法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1110) [我们可以在用户点按播放键之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1113) [将一些操作移动到另一个阶段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1116) [例如 可以将 AV 资源创建](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1120) [和检查移出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1124) [密钥获取可以被移出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1126) [因此 当用户开始视频播放时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1131) [等待的时间会更少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1134) [那么我们将这些操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1139) [那么我们将这些操作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1139) [移到哪里呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1140) [当你的用户正在查看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1143) [视频目录或视频信息时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1146) [在用户决定播放之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1149) [就可以提前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1152) [创建并检查 AV 资源了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1155) [去年我们引入了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1157) [AVContentKeySession 的 API](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1159) [这个新的 API 将媒体负载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1162) [与密钥获取分离开来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1165) [它为 App 提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1167) [对密钥管理的全面控制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1169) [它提供了优化密钥获取的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1171) [例如将多个密钥请求打包回](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1175) [密钥服务器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1179) [如果你碰巧采用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1181) [AVContentKeySession](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1183) [并花费几个小时的工程时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1185) [你的用户将会注意到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1188) [启动时间变得更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1190) [现在我们已经将创建 AV 资源](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1193) [和密钥获取的工作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1196) [从启动时间中移出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1198) [那么剩下的主要是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1199) [那么剩下的主要是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1199) [AVPlayerItem 缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1203) [以及 AVPlayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1205) [和 App 之间的通信时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1208) [通常情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1211) [由于播放查找或媒体选项等等因素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1214) [App 可以避免缓冲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1219) [我们甚至可以尝试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1220) [减少播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1224) [和 App 之间的往返次数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1226) [这样 启动时间将进一步减少](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1229) [我们来看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1233) [当你创建 AVPlayerItem 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1234) [如果你知道](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1238) [用户打算在哪里开始回放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1242) [请设置 PlayerItem 上的当前时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1245) [如果你知道媒体选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1247) [都是如何设置的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1249) [比如要下载哪一种语言进行播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1251) [那么在你将 AVPlayerItem 放置到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1253) [播放器上之前也要设置它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1256) [AVPlayer 也是如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1259) [AVPlayer 也是如此](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1259) [一旦用户点按播放键](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1262) [在为 AVPlayerItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1265) [开始下载之前设置速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1267) [因此 只要 PlayerItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1272) [有足够的内容播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1273) [播放就会自动开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1276) [总而言之](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1279) [即在缓冲之前设置 AVPlayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1282) [在将 PlayerItem 设置到播放器之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1284) [设置 AVPlayer速率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1288) [很多 App 都提供了一个特性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1291) [即允许用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1296) [选择多个视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1299) [然后一个接一个地播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1301) [比如狂热地观看电视节目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1303) [我们已经看到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1306) [例如每个视频分配一个播放器和一个 PlayerItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1308) [的这种实现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1310) [每个新视频都](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1312) [需要一个启动缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1314) [你可以使用 AVQueuePlayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1317) [以减少新视频的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1320) [缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1322) [创建多个 PlayerItem](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1325) [将它们全部包含在播放队列中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1328) [在播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1331) [播放当前项目的过程中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1334) [当媒体下载结束时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1337) [播放器将开始](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1339) [下载下一个项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1342) [同时当前项目仍在播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1344) [因此 一旦当前事件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1347) [播放到最后](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1350) [下一个 PlayerItem 将立即开始播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1352) [因此一定要使用 AVQueuePlayer](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1355) [来播放多个项目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1359) [并提前将第二个 AVPlayerItem 编入队列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1362) [那么还剩下些什么呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1367) [缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1369) [首先 什么决定了网络缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1371) [有四个因素](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1375) [变量的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1377) [变量的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1377) [内容的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1381) [播放列表目标时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1384) [当然还有 网络带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1386) [让我们看几个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1389) [缓冲时间的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1393) [首先 这是一个简单的主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1396) [它将一个 ATP 视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1399) [设置在 5 mbps 左右的下载速度](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1402) [假设网络带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1404) [在 6 mbps 左右](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1406) [我们的目标时长是 10 秒](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1408) [在大多数情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1412) [PlayerItem 会在通知播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1415) [需要开始之前](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1419) [缓冲一个片段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1421) [然而 相同的主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1422) [在几乎相同的网络条件下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1426) [用户可能会](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1428) [观察到较慢的启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1431) [请记住 原因是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1435) [网络带宽改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1438) [网络带宽改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1438) [内容比特率也会改变](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1440) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1442) [有一些片段需要更长的时间来下载](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1444) [因此播放器需要更久的时间来启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1446) [要解决这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1449) [提供一个低比特率的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1453) [可能会有所帮助](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1454) [播放器就可以选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1456) [调低比特率并更快启动](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1460) [当其他信息均缺失时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1464) [所列出的第一个变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1466) [将是你的启动变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1469) [在这个例子中 有两个变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1471) [在相同的网络条件下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1476) [首先列出较低比特率的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1477) [播放器将会启动更快](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1480) [并且在网络带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1485) [足够的情况下快速切换](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1490) [总之 为了减少网络缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1493) [我们应该明智地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1498) [我们应该明智地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1498) [选择初始变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1500) [更低的内容比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1502) [意味着更短的缓冲时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1505) [但也同时是视频质量的折衷](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1507) [如果你正在提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1511) [多种媒体格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1513) [例如 HDR 和 SDR 视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1516) [或者立体声音频和多声道音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1519) [请确保每种媒体格式的初始版本](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1522) [都处于类似的比特率级别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1526) [以便你的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1529) [将拥有类似的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1532) [无论他们进行](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1534) [何种类型的观看设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1536) [这就是我要讲的关于减少启动时间的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1538) [我们的视频已经开始播放了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1542) [现在我们来谈谈卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1545) [需要明确的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1548) [尤其是当网络带宽特别低的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1551) [卡顿就可能发生](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1553) [所以在这部分的演讲中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1556) [让我们关注如何调查卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1558) [以及如何改进 或避免卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1559) [以及如何改进 或避免卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1559) [App 是如何调查卡顿的呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1564) [App 应该一直在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1569) [监听卡顿通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1572) [App 也应该检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1576) [AVPlayer.status](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1580) [例如 isPlayBackLikelyToKeepUp](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1583) [AVPlayerItem 还提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1587) [错误日志和访问日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1590) [当暂停发生时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1592) [App 应该时刻关注](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1593) [对那些日志的检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1597) [接下来让我们看两个卡顿的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1599) [首先 App 已收到了卡顿通知](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1604) [也应该收到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1609) [错误日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1612) [错误注释会告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1615) [所发生的事情的详细信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1618) [所发生的事情的详细信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1618) [在这种情况下它的记录是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1621) [“15 秒内未收到媒体文件”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1623) [App 检查访问日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1626) [以找出发生卡顿时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1629) [AVPlayer 正在播放的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1632) [它会记录详细的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1635) [比如播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1637) [正在播放什么内容以及 URI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1640) [indicatedBitrate 指的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1644) [内容比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1646) [这里具体是 36 mbps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1647) [它是一个 4K 内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1650) [observedBitrate 指的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1652) [当前的网络带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1655) [这里具体是 2.8 mbps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1657) [显然网络带宽跟不上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1660) [内容比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1665) [所以要处理变化的网络情况](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1667) [请记得提供一套](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1670) [完整的比特率层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1673) [你的一些用户的网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1675) [可能连接较慢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1677) [或者你的用户可能正忙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1678) [或者你的用户可能正忙](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1678) [比如在查看视频时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1681) [使用蜂窝网络](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1683) [如果你提供多种视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1685) [和多种媒体格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1687) [那么每个编解码组合](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1690) [都需要自己的一组层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1692) [并不是所有的卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1696) [都是由于网络环境造成的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1700) [让我们来看看这个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1702) [卡顿发生了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1704) [然而错误日志中却有了不同的记录](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1706) [“播放列表文件](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1709) [连续两次没有改变”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1712) [如果你在那个时候检查访问日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1715) [播放器正在线播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1717) [indicatedBitrate 很低](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1722) [内容比特率是 400 kbps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1724) [而网络带宽是 3.7 mbps](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1728) [这看起来像是一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1731) [内容交付问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1733) [因此 为了减少或避免](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1737) [由于内容交付而造成的卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1739) [由于内容交付而造成的卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1739) [内容服务器和 CDN](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1741) [必须无延迟地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1744) [交付媒体文件 片段和密钥](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1747) [至少每一个目标时长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1749) [更新实时播放列表 CDN 缓存](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1751) [必须加以配置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1755) [以交付最新的播放列表 避免过时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1757) [同步播放列表之间的不连续序号](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1762) [使用正确的 HTTP 状态代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1767) [进而清楚地指示服务器端失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1769) [这就是所有关于卡顿的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1775) [那么错误又是怎么回事](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1777) [我们应该如何调查错误呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1779) [有几种方法可供选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1782) [我们有来自 AVPlayerItem 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1785) [错误日志和访问日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1789) [我们也有来自](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1792) [每个 Player 和](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1795) [PlayerItem 的错误属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1797) [PlayerItem 的错误属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1797) [此外 我们还为你们提供了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1802) [一些媒体验证工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1804) [来检测内容问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1806) [让我们一个一个地看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1809) [AVPlayerItemErrorLog](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1811) [Emil 对此已经与我们讨论了一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1815) [这种类型的错误日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1819) [表明网络或](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1821) [内容格式存在问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1822) [然而这些问题并不总是致命的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1825) [当错误被指示出来时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1828) [播放可能是完全](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1831) [没问题的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1833) [但是 App 显示了在错误注释中的检查结果](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1836) [以查找更多的细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1840) [比如这个我们之前见过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1842) [“15 秒内未收到媒体文件”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1846) [这表明你的用户可能已经](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1849) [或者即将观察到卡顿](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1854) [下一个是 HTTP 错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1856) [下一个是 HTTP 错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1856) [它记录“文件没有找到”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1860) [这表明了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1861) [内容交付的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1863) [用户可能会观察到音频丢失或视频丢失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1865) [甚至同时观察到这两者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1867) [[ 音质不清晰 ] 变量的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1873) [指定带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1875) [这个很有趣](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1876) [它指示了卡顿的风险](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1878) [然而当错误被指示时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1880) [播放可能没有问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1882) [它意味着](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1885) [某些片段的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1888) [比主播放列表中指定的比特率要高](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1890) [最后一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1892) [加密格式错误 “不支持的加密格式”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1897) [这可能指示了一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1900) [播放失败](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1902) [当我们有 AVPlayer 和 PlayerItem 的错误时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1904) [所有列出的这些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1907) [以及这里没有提到的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1909) [其他错误信息 都非常有用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1912) [让我们看一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1915) [App 应该观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1919) [App 应该观察](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1919) [AVPlayerItem.status](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1921) [和 AVPlayerItem 的错误属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1924) [以查找此类错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1925) [这些便是致命错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1929) [当错误被指示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1931) [且播放已经终止时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1933) [我们该怎么办呢](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1935) [我们如何找出原因](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1938) [这有一个例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1940) [App 观察到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1942) [PlayerItem.status](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1944) [已经改成失败状态](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1947) [然后 App 对 AVPlayer 的错误属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1950) [和 AVPlayerItem的 错误日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1955) [进行检查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1957) [这个就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1961) [PlayerItem 的错误属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1965) [它提供了一些有用的信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1967) [来自于 AVFoundationErrorDomain 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1970) [错误代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1972) [它还提供了一些提示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1973) [检查了 AVPlayerItem 的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1976) [错误日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1979) [错误日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1979) [相对应的 AVPlayer 错误日志](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1981) [可以提供更多细节](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1985) [它会告诉你日期 时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1988) [以及在什么 URI 上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1990) [有什么类型的错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1993) [在这里错误是“不支持的加密格式”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1994) [它还告诉你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=1999) [当发生错误时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2002) [设备处于哪种类型的网络接口](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2004) [下一种错误类型 HDCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2009) [如果你正在提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2013) [需要 HDCP 保护的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2014) [你的 App 应该注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2018) [这个十分长的属性名](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2019) [IsOutputObscuredDueTo](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2023) [InsufficientExternalProtection](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2026) [此属性的值变化为 2 时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2029) [意味着三件事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2030) [当前项目需要外部保护](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2034) [设备不满足保护级别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2038) [设备不满足保护级别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2038) [用户将会观察到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2042) [或已经观察到视频丢失](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2044) [例如通过 [ 音质不清晰 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2046) [为了避免这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2048) [你的主播放列表应该提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2053) [至少一个不需要 HDCP](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2056) [作为回退的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2059) [请记住 并不是所有的用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2062) [都有 HDCP 支持的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2064) [查看设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2067) [App 用户界面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2068) [应反映属性的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2071) [以便及时提示用户](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2073) [许多播放问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2076) [都是由创建内容引起的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2078) [比如在 [ 音质不清晰 ] 切换时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2081) [声音和视频出现了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2083) [中断或故障](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2086) [除了我们讨论过的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2088) [错误调查](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2089) [和错误处理之外](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2090) [我们还建议你们使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2093) [我们的媒体流验证器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2095) [它可以在开发者网站中获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2098) [它可以在开发者网站中获得](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2098) [这就是我今天想说的全部内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2102) [现在让我们欢迎我的同事 Eryk Vershen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2104) [来谈谈如何以正确的方式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2110) [编写主播放列表 谢谢大家](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2112) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2115) [&gt;&gt; 谢谢你 Zhenheng](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2125) [我是 Eryk Vershen](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2126) [我是一名从事于 HLS 工具的工程师](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2127) [我们已经讨论了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2129) [如何衡量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2131) [流媒体 App 的性能表现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2133) [以及如何解决相关问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2135) [然而 获得成功且无错误的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2136) [播放体验的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2138) [关键元素之一](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2140) [是确保你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2142) [主播放列表是正确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2144) [主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2146) [使得播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2147) [在播放之前和播放期间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2149) [做出明智的决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2151) [所以确保它的正确是十分重要的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2153) [让我们开始吧 我的建议是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2156) [不不 这只是个玩笑](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2158) [我想我需要给你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2159) [我想我需要给你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2159) [更多的背景知识](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2161) [来理解 Roger 的意思](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2162) [我们希望你们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2164) [把所有的编码选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2166) [都放到你的主播放列表中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2167) [并且尽可能完整地描述它们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2169) [假设你在问我这个问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2172) [这是一个关键问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2174) [也是你们必须解决的主要问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2177) [首先 你需要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2180) [一个主播放列表不能仅仅因为有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2182) [就被判定是正确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2184) [我就见过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2187) [像这样的主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2188) [它在语法上是正确的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2190) [却几乎没用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2192) [好的 那这个怎么样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2194) [它有更多的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2196) [好一点 但还是很糟糕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2198) [我们还能播放这个视频吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2201) [它使用什么编解码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2202) [它是 HDR 吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2204) [它是 60 fps 吗](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2205) [你需要告诉我们一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2206) [我们想要你告诉我们一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2208) [比如 平均带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2210) [平均带宽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2212) [使我们能够更好地决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2214) [切换到哪个变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2216) [它能更好地预测](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2218) [我们是否能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2219) [我们是否能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2219) [与流保持同步](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2220) [编解码器使我们能够过滤掉](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2222) [不能播放的东西](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2224) [分辨率使我们能够](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2226) [对选择哪种变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2228) [做出正确的决定](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2230) [请记住 直到我们需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2232) [我们才会查看](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2233) [媒体播放列表或媒体片段](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2235) [所以你需要提前在你的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2237) [主播放列表中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2239) [告诉我们一些事情](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2240) [这是一个简单的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2242) [主播放列表的例子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2245) [这个播放列表使得播放器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2246) [适应带宽的变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2248) [并正确地选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2250) [使用哪种变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2251) [我们在这里所做的一切](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2253) [对于用户来说都是不可见的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2256) [它只会让流播放得更好](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2258) [好的 让我们来看一个常见的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2261) [你的流正在播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2263) [但你没有在快进中看到任何图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2265) [或者 你没有在搓擦条中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2266) [看到缩略图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2268) [这是 Apple TV 的搓擦条](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2270) [你可以看到你的内容有多长](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2273) [你也可以看到你在内容中的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2275) [以及你想去的位置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2276) [为了得到缩略图](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2278) [你需要给我们一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2279) [你需要给我们一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2279) [I-frame 播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2282) [I-frame 播放列表允许我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2284) [在你的 iPad](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2286) [或 iPhone 上提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2289) [快进和回放中的图像](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2290) [为了讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2294) [I-frame 播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2295) [我们首先需要讨论一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2297) [普通视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2298) [这是一种在 HLS 中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2300) [可视化常规视频片段的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2302) [每个段都有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2305) [若干帧的内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2306) [所以它有一个总帧数](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2308) [也有一个特定的平均比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2310) [这个比特率在每个片段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2311) [都是不同的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2314) [由于压缩技术](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2316) [视频中的大多数帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2318) [只能依照其他帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2320) [进行解码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2321) [但是 I-frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2323) [其中的 I 代表的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2325) [内部编码的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2327) [它们是可独立解码的帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2328) [也是允许其他帧进行解码的基本帧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2329) [正如我在这里展示的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2332) [在一个片段中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2334) [你可能有多个 I-frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2336) [并且 I-frame 不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2338) [并且 I-frame 不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2338) [以固定间隔排列](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2342) [I-frame 播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2345) [是一个只指向 I-frame 内容的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2347) [播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2349) [也就是说 它只下载 I-frame 数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2350) [当我们讨论](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2353) [一个 I-frame 的时长时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2354) [我们指的是从这个 I-frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2356) [到下一个 I-frame 的时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2357) [我已经将这个特殊的 I-frame 组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2360) [从正常的内容中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2361) [提取出来了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2363) [但是你也可以制作一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2364) [所谓高密度的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2366) [I-frame 播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2368) [你不能仅仅从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2369) [正常内容中将它提取出来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2371) [相反 你需要刻意地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2372) [用间隔更加均匀的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2373) [I-frame 来制作](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2375) [这样会更有效](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2377) [它允许我们在快进的时候](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2378) [为你提供一个更加平滑的体验](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2380) [现在 我给你们看一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2384) [没有添加 I-frame 的主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2385) [请注意 I-frame 播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2389) [与普通播放列表的标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2391) [几乎完全相同](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2393) [唯一的区别是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2396) [I-frame 播放列表不支持](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2398) [帧速率这个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2399) [帧速率这个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2399) [因为在那个上下文中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2402) [它没有任何意义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2402) [对于你的 I-frame 播放列表而言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2404) [一个好的测试](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2406) [是尝试直接播放它](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2407) [也就是说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2409) [将 I-frame 播放列表的 URI](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2411) [粘贴到 Safari 浏览器中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2413) [它应该以 1 倍的速度播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2414) [你会看到 I-frame](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2416) [一个接一个地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2418) [在一个缓慢变化的序列中显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2420) [现在我还要指出](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2423) [比特率方面的区别](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2424) [请注意 I-frame 的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2427) [比正常的比特率要低得多](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2428) [应该一直是这样的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2430) [谈到比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2434) [我们已经在 HLS 规范中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2436) [定义了如何计算](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2439) [峰值比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2440) [一定要这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2442) [否则你可能会得到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2443) [片段超过](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2445) [指定带宽的错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2446) [现在 我们不再讨论视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2450) [将话题转向音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2452) [对此最常见的问题是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2455) [我如何支持多种语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2457) [界面是这个样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2459) [界面是这个样子](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2459) [我有一个语言列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2461) [用户可以从中选择一种语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2463) [这是一个样本播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2466) [我们所做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2469) [在每个视频变量上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2470) [添加一个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2473) [音频属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2477) [我们也添加了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2479) [带有组 ID 的媒体标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2481) [组 ID 是一个标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2483) [它允许你将音频展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2487) [与视频变量关联起来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2490) [请注意这两个](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2493) [音频版本之间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2494) [有很多不同之处](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2497) [就像对待你的变量一样 我们希望你](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2498) [尽可能详细地](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2500) [描述你的媒体](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2502) [在媒体标签上](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2504) [有两个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2506) [令人们困扰](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2507) [那就是 Default 和 Autoselect](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2509) [好的 Autoselect 指的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2512) [播放器中的媒体选择代码](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2516) [可以在用户没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2517) [可以在用户没有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2517) [任何特殊输入的情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2520) [进行选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2522) [大多数情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2524) [你会将 Autoselect 设置为 yes](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2525) [如果你没有设置](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2528) [用户将不得不做出一个明确的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2530) [从而进行视频的播放](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2531) [另一方面 Default 是指](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2535) [当用户没有提供首选语言时](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2537) [所进行的选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2539) [一般来说](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2542) [它应该是你的视频的原始语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2543) [并且 Default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2546) [必须是可自动选择的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2547) [因为系统必须进行选择](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2548) [这里的 Default](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2551) [与默认的视频变量没有关系](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2553) [它是演示组中的默认值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2555) [好的 我有多种语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2559) [但我真的想要一些](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2563) [多声道音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2564) [我有 5.1 声道音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2565) [好的 首先要记住的是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2568) [并不是所有的设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2570) [都能播放多声道音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2572) [你还需要为用户提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2573) [立体声选项](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2576) [你应该把这件事看成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2578) [你应该把这件事看成](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2578) [填满一个矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2580) [你需要拥有](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2582) [涵盖每种语言的每种格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2584) [你可能会说 好吧](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2587) [我没有法语版多声道的原版音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2590) [我没有法语版的 5.1 声道音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2594) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2596) [你仍应该把你的立体声内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2597) [放到那个组中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2599) [你需要填满](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2603) [在这个矩阵中的每个槽](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2605) [我们再来看一个播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2607) [这个播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2611) [和之前的例子一样](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2614) [只是我改变了组 ID](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2616) [而且这样没有问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2618) [因为组 ID 只是用来](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2619) [连接音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2621) [和视频变量的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2623) [我们有了多声道组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2625) [然后我用法语](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2628) [把它设置为立体声](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2630) [在这你可以看到如何做到这点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2632) [你需要做的是确保](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2635) [编解码器标签指示了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2638) [编解码器标签指示了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2638) [所有可能出现在该演示组中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2640) [不同的编解码器](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2644) [请注意 我们需要复制](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2648) [我们的视频变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2649) [现在我们有两个条目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2652) [一个条目指向其中一个音频组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2653) [另一个条目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2656) [则指向另一个音频组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2657) [在后面的幻灯片中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2658) [你会再次看到这种重复](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2659) [假设我有几个不同音频比特率的音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2662) [但不是 5.1 声道的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2665) [我有一些高比特率音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2667) [而且我知道我需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2670) [为一些用户提供](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2672) [低比特率音频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2675) [所以在展示方面](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2676) [和我们之前所谈到的类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2678) [我们仍然需要一个矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2681) [并用每种语言](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2682) [来填充每一个比特率变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2684) [由于这两者都是 AAC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2687) [我们可以认为它们是相同格式的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2688) [如果我想要另一种格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2690) [我所做的就是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2692) [扩展这个矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2695) [我想提出一点](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2697) [我一直说语言是为了便利](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2698) [但是你们应该记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2699) [但是你们应该记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2699) [这里涉及的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2700) [唯一的属性是名称属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2701) [而不是语言属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2704) [在这个播放列表中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2707) [我不会给你们展示媒体标签](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2709) [但我将展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2710) [带有音频组名称的视频变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2711) [你需要将你的低比特率视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2714) [与你的低比特率音频相关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2716) [同时将高比特率视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2718) [与高比特率音频相关联](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2721) [你总是需要将它们像这样分开](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2723) [如果你有一套](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2727) [配有低比特率音频的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2729) [完整视频变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2730) [和一套配有高比特率音频的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2731) [完整视频变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2733) [那么这种情况是完全错误的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2735) [因为如果你这样做](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2736) [你就会在](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2737) [高视频比特率和低音频比特率变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2739) [之间跳跃](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2741) [在这里 我添加了 AC3 内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2743) [再次注意](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2750) [我们必须复制我们的视频变量条目](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2751) [但是它们指向](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2754) [相同的视频播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2756) [也要注意视频变量中的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2758) [比特率也在变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2759) [比特率也在变化](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2759) [这是因为](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2762) [与视频变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2763) [相关的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2766) [是视频本身](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2767) [以及任何相关展示的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2768) [现在让我们](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2772) [再次讨论一下视频](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2776) [因为我想要具有多个视频格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2778) [我想要 HEVC](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2779) [这样我就可以以同样的比特率](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2783) [获得更好的质量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2785) [或者我想要杜比视界（Dolby Vision）](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2786) [这样我就可以获得 HDR 内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2788) [同样 我们需要填一个矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2789) [在这种情况下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2794) [无论我们选择哪种视频格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2795) [我们都需要设置一组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2797) [合理的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2799) [所以这里的行是基于质量的层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2800) [我们需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2802) [用每一层中每一个格式的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2806) [来填充矩阵](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2807) [我们不需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2810) [在旧格式中填写](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2812) [更高的层](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2817) [你可以节省一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2818) [但与音频类似](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2820) [并不是所有设备](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2822) [都支持杜比视界（Dolby Vision）等功能](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2824) [因此你需要提供一个 H.264 变体作为备用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2826) [有一个主要的点需要记住](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2831) [在每一列中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2832) [你都需要让比特率形成一个良好的递进](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2833) [这个播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2836) [有点太大了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2839) [不能在一张幻灯片上显示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2840) [所以我要把它分成三张幻灯片](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2841) [这一部分向你展示 H.264 的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2843) [在这张幻灯片中 我们展示了 HEVC 变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2846) [请注意 任何变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2850) [都有其指向的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2851) [视频播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2854) [这是我们的杜比视界（Dolby Vision）变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2856) [这里的一切变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2857) [都有相同的音频组](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2860) [如果我们想要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2861) [含有多种音频格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2862) [我们需要为每种音频格式](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2865) [复制视频变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2867) [同样 这不会增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2869) [视频播放列表的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2871) [只会增加](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2873) [播放列表中条目的数量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2874) [好的 我们几乎完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2877) [好的 我们几乎完成了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2877) [最后一点关于一般字幕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2880) [和可隐藏式字幕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2882) [你可能可以猜到](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2883) [它是如何工作的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2885) [我们的变量](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2887) [需要指向我们正在使用的](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2890) [一般字幕和可隐藏式字幕](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2892) [所以我们需要](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2894) [为视频变量添加一个属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2895) [我们也需要描述这个展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2898) [请注意可隐藏式字幕的展示](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2900) [没有 URI 属性](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2904) [这告诉系统](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2906) [可隐藏式字幕的数据](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2908) [存在于在视频内容中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2910) [而不是在单独的播放列表中](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2913) [那么没错](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2914) [“正确的做法是](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2918) [把一切都交给我们”](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2918) [现在你应该更加明白我的意思了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2919) [好的 请允许我快速地总结一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2922) [我们今天的演讲](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2924) [Emil 谈到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2927) [关键性能指标](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2928) [关于如何获取或计算这些值](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2929) [以及它们的含义](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2931) [Zhenheng 谈到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2932) [减少启动时间的方法](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2935) [以及如何解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2937) [以及如何解决](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2937) [卡顿和其他错误](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2940) [我则谈到了](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2941) [如何制作主播放列表](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2942) [我想简单地提一下](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2944) [HLS 验证工具](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2946) [它们可以发现](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2948) [很多与主播放列表和媒体播放列表有关的问题](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2950) [值得你花时间去使用](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2952) [一如既往地 你可以从](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2955) [WWDC App 或者](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2957) [开发者网站中获得更多信息](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2960) [这就是我们今天要讲的全部内容](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2961) [非常感谢各位的关注和时间](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2963) [[ 掌声 ]](https://developer.apple.com/videos/wwdc2018/videos/play/wwdc2018/502/?time=2965)